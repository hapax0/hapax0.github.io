<!DOCTYPE HTML>
<html>
  <head>
    <style>
    div[id="cont"] {
      /* This bit sets up the horizontal layout */
      display:flex;
      flex-direction:row;
      width:1400px;
      /* I've used padding so you can see the edges of the elements. */
      padding:1px;
    }

    body {
      background-color: #a2a1a1;
    }
    canvas {
      margin-left: 1%;
      background-color: #000;
    }
    svg {
      margin-top: 2px;
      display:inline-block;
      background-color:#fff;
      padding:2px;
      vertical-align: 0%;
    }
    svg[class="invert"] {
      margin-top: 2px;
      display:inline-block;
      color:#fff;
      background-color:#000;
      padding:2px;
      vertical-align: 0%;
    }
    .lowscore {
      color:rgb(255, 255, 255);
      background:#f7faff;
      font-weight: 500;
      font-size: 14pt;
      /* top | right | bottom | left */
      padding:0px 2px 0px 2px;
    }
    .oib {
      fill:rgb(0, 0, 0);
      background-color:#ffffff;
    }
    .order {
      fill:#000000;
      color:#000000;
      background-color:#ffffff;
    }
    .map {
      background-color:#ffd8ab;
    }
    .solve {
      background-color:#ffffff;
    }
    .pink {
      background-color:#fabeff;
    }
    a, u {
      text-decoration: none;
      margin: 2px;
      padding:0px;
    }
    textarea {
      width: 430px;
      height: 460px;
      margin-left: 1%;
      font-size:16px;
      tab-size : 4;
      background-color:#fbf7e9;
    }
    input[type=checkbox] {
      vertical-align: 30%;
    }
    select {
      height:24px;
      width:80px;
      margin-bottom: 4px;
      vertical-align: 50%;
    }
    .grouping {
      display:inline-block;
      background:#cdcccc;
      vertical-align: top;
      /* top | right | bottom | left */
      padding:2px 2px 0px 2px;
      margin:4px 3px 0px 1px;
    }
    .macro {
      display:inline-block;
      background:#ffffff;
      vertical-align: top;
      /* top | right | bottom | left */
      padding:2px 2px 0px 2px;
      margin:2px 3px 0px 1px;
    }
    .number {
      width:40px;
      height:20px;
      vertical-align: 50%;
    }

    .check {
      vertical-align: text-top;
      text-align:right;
    }
    label {
      margin-bottom: 2px;
      vertical-align: 60%;
    }
    hr {
      display: table;
      width: 96%;
      height:0px;
    }
    .lower {
      margin-top:10px;
      margin-bottom:10px;
      vertical-align: 50%;
    }
    button {
      height:32px;
      vertical-align: top;
    }
    div [id="buttons"] {
      width: 500px;
      margin-top: 1%;
      margin-bottom: 12px;
      margin-left: 2px;
      padding-left: 2px;
      vertical-align: baseline;
    }
    div[id="tip"] {
      position:absolute;
      top:160px;
      left:24px;
      width:260px;
      color:#000;
      display: none;
      background-color: #fff;
      border:3px solid #222222;
      padding:8px;
      font-size:16px;
      z-index:2;
    }
    .container {
      width:max-content;
    }
    .column {
      float: left;
    }
    /* Clear floats after the columns */
    .row:after {
      content: "";
      display:inline-table;
      clear: both;
    }
    </style>
  </head>
<body>
<div class="container">
<div class="row">
  <div class="column" style="width:270px;">
    <span class="grouping">
   <label for="numpoints">N</label> 
   <input type="number" id="numpoints" value="50" class="number" min="3">
    <label for="testcases">points </label><select id="testcases" title="configuration">
      <option>random</option>
      <option>costal</option>
      <option>disc</option>
      <option>ellipse</option>
      <option>cresent</option>
      <option>diffusion</option>
      <option>radial</option>
      <option>small_disc</option>
      <option>square</option>
      <option>offset</option>
      <option>dumbell</option>
      <option>corners</option>
      <option>elongated</option>
      <option>spiral</option>
      <option>circle</option>
      <option>atom</option>   
      <option>concentric</option>   
      <option>concentric2</option>   
      <option>cat_ears</option>   
    </select>
    <a href="javascript:loadpoints();" title="load test case">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-plus" viewBox="0 0 16 16">
    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
    </svg>
    </a>
    </span>
    <br>
    <span class="grouping">
      <a href="javascript:dispatch('shuffle_points');" title="shuffle points">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="no" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"/>
      <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"/>
    </svg></a>

    <a href="javascript:jigglepoints()" class="act"  title="jiggle points">
    <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <g id="g2437" transform="translate(-2.7390869,20)"> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 19.610748,205.04778 C 32.255794,187.07062 44.902105,169.09166 57.549671,151.11092" id="path2335" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 98.800956,204.70504 C 85.555406,187.16562 72.308542,169.62446 59.060356,152.08155" id="path2408" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="m 101.3075,205.65885 c 12.64505,-17.97717 25.29136,-35.95612 37.93893,-53.93687" id="path2414" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 180.49772,205.3161 C 167.25217,187.77669 154.0053,170.23552 140.75711,152.69262" id="path2416" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="m 183.00428,206.2699 c 12.64505,-17.97717 25.29136,-35.95613 37.93892,-53.93686" id="path2426" /> </g> <g id="g2449" transform="translate(-2.7390869,-53.287795)"> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 19.610748,205.04778 C 32.255794,187.07062 44.902105,169.09166 57.549671,151.11092" id="path2439" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 98.800956,204.70504 C 85.555406,187.16562 72.308542,169.62446 59.060356,152.08155" id="path2441" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="m 101.3075,205.65885 c 12.64505,-17.97717 25.29136,-35.95612 37.93893,-53.93687" id="path2443" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 180.49772,205.3161 C 167.25217,187.77669 154.0053,170.23552 140.75711,152.69262" id="path2445" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="m 183.00428,206.2699 c 12.64505,-17.97717 25.29136,-35.95613 37.93892,-53.93686" id="path2447" /> </g> <g id="g2481" transform="translate(-2.7390869,-126.57559)"> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 19.610748,205.04778 C 32.255794,187.07062 44.902105,169.09166 57.549671,151.11092" id="path2471" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 98.800956,204.70504 C 85.555406,187.16562 72.308542,169.62446 59.060356,152.08155" id="path2473" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="m 101.3075,205.65885 c 12.64505,-17.97717 25.29136,-35.95612 37.93893,-53.93687" id="path2475" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="M 180.49772,205.3161 C 167.25217,187.77669 154.0053,170.23552 140.75711,152.69262" id="path2477" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-dasharray:none;stroke-dashoffset:0" d="m 183.00428,206.2699 c 12.64505,-17.97717 25.29136,-35.95613 37.93892,-53.93686" id="path2479" /> </g> </svg>
    </a>
    <!--a href="javascript:stochastic_walk();" title="stochastic walk">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-dice-3" viewBox="0 0 16 16">
    <path d="M13 1a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2zM3 0a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V3a3 3 0 0 0-3-3z"/>
    <path d="M5.5 4a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m8 8a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m-4-4a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
    </svg></a-->
    </span>
    <span class="grouping">
    <a href="javascript:dispatch('segmentswap');" title="segment swap">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="oib" viewBox="0 0 240 240" version="1.1">
      <path fill-opacity="0.494" d="M 41.500 1.662 C 31.033 7.180, 26.831 19.957, 32.344 29.500 L 34.655 33.500 28.095 46.750 C 21.655 59.756, 21.474 60, 18.227 60 C 8.588 60, -0 69.663, 0 80.508 C 0 101.770, 30.218 107.476, 38.452 87.768 C 40.733 82.311, 40.408 75.263, 37.656 70.500 L 35.345 66.500 41.905 53.250 C 48.300 40.335, 48.547 40, 51.699 40 C 53.477 40, 56.492 39.256, 58.398 38.347 L 61.863 36.695 90.472 54.543 C 117.869 71.636, 119.165 72.584, 121.089 76.934 C 124.867 85.475, 131.435 89.937, 140.290 89.978 C 161.733 90.076, 167.617 59.841, 147.768 51.548 C 140.577 48.543, 132.052 49.991, 126.364 55.184 L 124.228 57.135 97.154 40.317 L 70.081 23.500 70.041 19.210 C 69.995 14.427, 67.411 8.635, 63.834 5.298 C 58.361 0.193, 47.607 -1.558, 41.500 1.662 M 20 120 L 20 126 30 126 L 40 126 40 120 L 40 114 30 114 L 20 114 20 120 M 60 120 L 60 126 70 126 L 80 126 80 120 L 80 114 70 114 L 60 114 60 120 M 100 120 L 100 126 110 126 L 120 126 120 120 L 120 114 110 114 L 100 114 100 120 M 140 120 L 140 126 150 126 L 160 126 160 120 L 160 114 150 114 L 140 114 140 120 M 180 120 L 180 126 190 126 L 200 126 200 120 L 200 114 190 114 L 180 114 180 120 M 81.500 141.662 C 68.741 148.388, 66.021 165.239, 76.166 174.702 C 81.168 179.367, 92.135 181.604, 97.067 178.964 C 98.737 178.070, 101.837 180.368, 119.751 195.784 L 140.500 213.640 140.165 219.193 C 138.821 241.449, 169.900 248.236, 178.535 227.571 C 179.598 225.026, 180.049 221.645, 179.832 217.846 L 179.500 212.023 195.864 195.636 L 212.229 179.249 218.417 179.745 C 227.780 180.497, 234.916 176.231, 238.452 167.768 C 244.089 154.277, 234.341 140, 219.492 140 C 207.845 140, 199.452 149.622, 200.168 162.154 L 200.500 167.977 184.136 184.364 L 167.771 200.751 161.551 200.252 C 157.781 199.949, 154.477 200.209, 153.165 200.912 C 151.188 201.970, 149.180 200.506, 130.249 184.216 L 109.500 166.360 109.835 160.807 C 110.550 148.958, 101.623 139.937, 89.282 140.040 C 86.652 140.062, 83.150 140.792, 81.500 141.662 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.031" d="M 43.685 1.017 C 38.959 2.435, 33.868 7.044, 31.759 11.812 C 29.329 17.305, 29.807 25.427, 32.843 30.220 L 34.820 33.343 28.229 46.567 L 21.639 59.790 16.945 60.413 C 2.535 62.324, -4.711 79.316, 3.711 91.445 C 12.170 103.627, 30.944 102.274, 37.823 88.987 C 39.713 85.335, 40.056 83.429, 39.667 78.744 C 39.392 75.435, 38.336 71.642, 37.184 69.822 L 35.180 66.657 41.771 53.433 L 48.361 40.210 52.967 39.599 C 55.500 39.263, 58.456 38.378, 59.536 37.632 C 61.320 36.401, 63.981 37.827, 88.500 53.151 C 120.283 73.016, 121 73.517, 121 75.880 C 121 76.881, 122.381 79.607, 124.069 81.937 C 132.581 93.688, 151.048 92.074, 157.823 78.987 C 162.708 69.550, 158.627 57.168, 148.987 52.177 C 142.642 48.893, 134.452 49.591, 128.278 53.943 L 123.874 57.048 97.053 40.293 L 70.232 23.539 69.668 18.074 C 68.344 5.247, 56.185 -2.735, 43.685 1.017 M 20 120 L 20 126 30 126 L 40 126 40 120 L 40 114 30 114 L 20 114 20 120 M 60 120 L 60 126 70 126 L 80 126 80 120 L 80 114 70 114 L 60 114 60 120 M 100 120 L 100 126 110 126 L 120 126 120 120 L 120 114 110 114 L 100 114 100 120 M 140 120 L 140 126 150 126 L 160 126 160 120 L 160 114 150 114 L 140 114 140 120 M 180 120 L 180 126 190 126 L 200 126 200 120 L 200 114 190 114 L 180 114 180 120 M 83.685 141.017 C 75.071 143.602, 69.357 152.478, 70.317 161.779 C 71.622 174.429, 81.867 181.856, 94.454 179.278 L 99.469 178.250 119.985 195.846 L 140.500 213.442 140.504 220.140 C 140.507 225.958, 140.903 227.408, 143.517 231.169 C 147.875 237.440, 153.865 240.281, 161.405 239.653 C 168.814 239.036, 174.547 235.312, 177.825 228.987 C 179.805 225.165, 180.067 223.533, 179.589 217.974 L 179.028 211.449 195.007 195.493 L 210.986 179.537 218.907 179.519 C 226.074 179.502, 227.240 179.213, 231.164 176.487 C 240.336 170.112, 242.632 157.688, 236.317 148.595 C 227.829 136.373, 209.073 137.701, 202.175 151.013 C 200.195 154.835, 199.933 156.467, 200.411 162.025 L 200.972 168.551 184.736 184.760 L 168.500 200.969 163.484 200.373 C 160.725 200.045, 156.725 200.258, 154.596 200.846 L 150.724 201.915 130.112 184.237 L 109.500 166.558 109.496 159.860 C 109.493 154.042, 109.097 152.592, 106.483 148.831 C 101.401 141.518, 92.350 138.416, 83.685 141.017 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.480" d="M 42.491 1.865 C 35.266 5.147, 30.023 13.206, 30.006 21.054 C 30.003 22.458, 31.147 25.909, 32.548 28.721 L 35.097 33.835 28.541 46.918 C 22.540 58.894, 21.754 60.002, 19.243 60.022 C 9.709 60.098, -0.040 70.742, 0.028 81 C 0.088 90.285, 10.870 100.039, 21 99.972 C 27.855 99.928, 36.938 92.487, 38.940 85.277 C 40.527 79.562, 40.242 76.877, 37.452 71.279 L 34.903 66.165 41.459 53.082 C 47.460 41.106, 48.246 39.998, 50.757 39.978 C 52.266 39.966, 55.432 39.079, 57.793 38.008 L 62.086 36.059 90.923 54.072 C 118.829 71.502, 119.815 72.226, 121.439 76.478 C 124.353 84.110, 132.928 90.025, 141 89.972 C 150.285 89.912, 160.039 79.130, 159.972 69 C 159.912 59.715, 149.130 49.961, 139 50.028 C 135.864 50.048, 128.946 53.145, 127.128 55.342 C 126.373 56.254, 125.023 56.984, 124.128 56.965 C 123.232 56.946, 110.800 49.590, 96.500 40.617 L 70.500 24.304 69.885 19.363 C 69.108 13.120, 67.047 9.126, 62.578 5.203 C 56.639 -0.012, 49.305 -1.230, 42.491 1.865 M 20 120 L 20 126 30 126 L 40 126 40 120 L 40 114 30 114 L 20 114 20 120 M 60 120 L 60 126 70 126 L 80 126 80 120 L 80 114 70 114 L 60 114 60 120 M 100 120 L 100 126 110 126 L 120 126 120 120 L 120 114 110 114 L 100 114 100 120 M 140 120 L 140 126 150 126 L 160 126 160 120 L 160 114 150 114 L 140 114 140 120 M 180 120 L 180 126 190 126 L 200 126 200 120 L 200 114 190 114 L 180 114 180 120 M 82.491 141.865 C 75.277 145.143, 69.977 153.279, 70.028 161 C 70.054 164.995, 73.385 171.253, 77.330 174.716 C 82.974 179.672, 89.416 180.865, 97.583 178.466 C 99.243 177.978, 103.869 181.455, 120.369 195.593 L 141.073 213.331 140.417 217.708 C 138.759 228.763, 149.193 240.050, 161 239.972 C 164.995 239.946, 171.253 236.615, 174.716 232.670 C 178.621 228.224, 180.355 222.259, 179.532 216.114 L 178.914 211.500 195.308 195.160 L 211.703 178.819 217.231 179.510 C 221.606 180.056, 223.670 179.797, 227.129 178.267 C 234.665 174.934, 240.024 166.893, 239.972 159 C 239.928 152.145, 232.487 143.062, 225.277 141.060 C 219.976 139.588, 217.106 139.768, 212.491 141.865 C 204.126 145.665, 199.228 154.636, 200.468 163.886 L 201.087 168.500 185.021 184.500 L 168.956 200.500 162.228 200.516 C 158.528 200.524, 154.335 200.892, 152.911 201.334 C 150.570 202.059, 148.344 200.440, 129.625 184.402 L 108.927 166.669 109.583 162.292 C 111.241 151.237, 100.807 139.950, 89 140.028 C 87.625 140.037, 84.696 140.863, 82.491 141.865 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="1.000" d="M 42.491 1.865 C 35.266 5.147, 30.023 13.206, 30.006 21.054 C 30.003 22.458, 31.147 25.909, 32.548 28.721 L 35.097 33.835 28.541 46.918 C 22.540 58.894, 21.754 60.002, 19.243 60.022 C 9.709 60.098, -0.040 70.742, 0.028 81 C 0.088 90.285, 10.870 100.039, 21 99.972 C 27.855 99.928, 36.938 92.487, 38.940 85.277 C 40.527 79.562, 40.242 76.877, 37.452 71.279 L 34.903 66.165 41.459 53.082 C 47.460 41.106, 48.246 39.998, 50.757 39.978 C 52.266 39.966, 55.432 39.079, 57.793 38.008 L 62.086 36.059 90.923 54.072 C 118.829 71.502, 119.815 72.226, 121.439 76.478 C 124.353 84.110, 132.928 90.025, 141 89.972 C 150.285 89.912, 160.039 79.130, 159.972 69 C 159.912 59.715, 149.130 49.961, 139 50.028 C 135.864 50.048, 128.946 53.145, 127.128 55.342 C 126.373 56.254, 125.023 56.984, 124.128 56.965 C 123.232 56.946, 110.800 49.590, 96.500 40.617 L 70.500 24.304 69.885 19.363 C 69.108 13.120, 67.047 9.126, 62.578 5.203 C 56.639 -0.012, 49.305 -1.230, 42.491 1.865 M 20 120 L 20 126 30 126 L 40 126 40 120 L 40 114 30 114 L 20 114 20 120 M 60 120 L 60 126 70 126 L 80 126 80 120 L 80 114 70 114 L 60 114 60 120 M 100 120 L 100 126 110 126 L 120 126 120 120 L 120 114 110 114 L 100 114 100 120 M 140 120 L 140 126 150 126 L 160 126 160 120 L 160 114 150 114 L 140 114 140 120 M 180 120 L 180 126 190 126 L 200 126 200 120 L 200 114 190 114 L 180 114 180 120 M 82.491 141.865 C 75.277 145.143, 69.977 153.279, 70.028 161 C 70.054 164.995, 73.385 171.253, 77.330 174.716 C 82.974 179.672, 89.416 180.865, 97.583 178.466 C 99.243 177.978, 103.869 181.455, 120.369 195.593 L 141.073 213.331 140.417 217.708 C 138.759 228.763, 149.193 240.050, 161 239.972 C 172.307 239.898, 183.190 224.522, 179.029 214.500 C 178.327 212.809, 180.820 209.862, 195.154 195.435 L 212.110 178.369 216.950 179.360 C 223.271 180.655, 229.523 178.377, 234.370 173.012 C 239.979 166.803, 241.319 159.501, 238.135 152.491 C 234.857 145.277, 226.721 139.977, 219 140.028 C 207.693 140.102, 196.810 155.478, 200.971 165.500 C 201.673 167.191, 199.173 170.145, 184.795 184.617 L 167.788 201.733 163.729 200.703 C 160.819 199.965, 158.426 200.006, 155.271 200.850 C 152.851 201.497, 150.297 201.683, 149.595 201.263 C 148.894 200.844, 139.457 192.888, 128.624 183.585 L 108.927 166.670 109.583 162.293 C 111.241 151.237, 100.808 139.950, 89 140.028 C 87.625 140.037, 84.696 140.863, 82.491 141.865 " stroke="none" fill="black" fill-rule="evenodd"/>
    </svg></a>
    <a href="javascript:dispatch('insert_run')" title="insert">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="oib" viewBox="0 0 240 240" version="1.1">
      <path fill-opacity="0.251" d="M 111.765 78.450 L 111.500 106.900 98.710 90.915 L 85.921 74.930 79.960 79.612 C 76.682 82.188, 74 84.461, 74 84.663 C 74 85.540, 119.291 141.500, 120 141.500 C 120.709 141.500, 166 85.540, 166 84.663 C 166 84.461, 163.318 82.188, 160.040 79.612 L 154.079 74.930 141.290 90.915 L 128.500 106.900 128.235 78.450 L 127.969 50 120 50 L 112.031 50 111.765 78.450 M 108.565 152.020 C 102.413 154.422, 95.986 160.625, 92.965 167.075 L 90.658 172 55.329 172 L 20 172 20 180 L 20 188 55.422 188 L 90.845 188 92.055 191.666 C 93.842 197.082, 100.633 203.890, 107.500 207.150 C 122.612 214.324, 140.587 207.614, 147.415 192.250 L 149.304 188 184.652 188 L 220 188 220 180 L 220 172 184.578 172 L 149.155 172 147.945 168.334 C 146.158 162.918, 139.367 156.110, 132.500 152.850 C 125.125 149.349, 116.199 149.040, 108.565 152.020 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.330" d="M 111.765 78.590 L 111.500 107.181 98.684 91.115 L 85.868 75.050 79.973 79.767 C 74.852 83.865, 74.237 84.713, 75.289 86.227 C 78.191 90.403, 119.549 141.901, 120 141.901 C 120.451 141.901, 161.809 90.403, 164.711 86.227 C 165.763 84.713, 165.148 83.865, 160.027 79.767 L 154.132 75.050 141.316 91.115 L 128.500 107.181 128.235 78.590 L 127.969 50 120 50 L 112.031 50 111.765 78.590 M 109.357 152.021 C 102.446 154.761, 95.964 160.672, 93.052 166.889 L 90.658 172 55.329 172 L 20 172 20 180 L 20 188 55.453 188 L 90.906 188 92.809 192.301 C 97.316 202.490, 106.658 208.960, 118 209.747 C 130.025 210.582, 141.984 203.710, 146.948 193.111 L 149.342 188 184.671 188 L 220 188 220 180 L 220 172 184.547 172 L 149.094 172 147.191 167.699 C 142.552 157.211, 133.255 150.927, 121.500 150.335 C 116.178 150.066, 113.267 150.470, 109.357 152.021 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.054" d="M 111.765 78.590 L 111.500 107.181 98.684 91.115 L 85.868 75.050 79.973 79.767 C 74.852 83.865, 74.237 84.713, 75.289 86.227 C 78.191 90.403, 119.549 141.901, 120 141.901 C 120.451 141.901, 161.809 90.403, 164.711 86.227 C 165.763 84.713, 165.148 83.865, 160.027 79.767 L 154.132 75.050 141.316 91.115 L 128.500 107.181 128.235 78.590 L 127.969 50 120 50 L 112.031 50 111.765 78.590 M 112.718 151.034 C 110.637 151.556, 107.685 152.628, 106.158 153.418 C 101.652 155.748, 95.310 162.727, 93.336 167.528 L 91.500 171.993 55.750 171.996 L 20 172 20 180 L 20 188 55.453 188 L 90.906 188 92.814 192.250 C 95.443 198.106, 101.311 203.785, 107.933 206.882 C 115.080 210.224, 125.191 210.417, 132 207.341 C 137.841 204.702, 144.348 198.104, 146.664 192.472 L 148.500 188.007 184.250 188.004 L 220 188 220 180 L 220 172 184.547 172 L 149.094 172 147.186 167.750 C 141.731 155.599, 125.639 147.795, 112.718 151.034 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="1.000" d="M 113 79 C 113 94.950, 112.662 107.978, 112.250 107.951 C 111.838 107.924, 105.875 100.746, 99 92 C 92.125 83.254, 86.221 76.076, 85.881 76.049 C 84.986 75.978, 75 84.044, 75.002 84.835 C 75.005 86.090, 118.989 140.500, 120 140.500 C 121.011 140.500, 164.995 86.090, 164.998 84.835 C 165 84.044, 155.014 75.978, 154.119 76.049 C 153.779 76.076, 147.875 83.254, 141 92 C 134.125 100.746, 128.162 107.924, 127.750 107.951 C 127.338 107.978, 127 94.950, 127 79 L 127 50 120 50 L 113 50 113 79 M 112.718 151.034 C 104.266 153.152, 97.147 159.253, 93.287 167.683 L 90.853 173 55.427 173 L 20 173 20 180 L 20 187 55.364 187 L 90.728 187 92.374 191.309 C 94.606 197.154, 101.153 203.711, 107.911 206.872 C 115.099 210.233, 125.194 210.423, 132 207.326 C 138.070 204.563, 143.766 198.753, 146.713 192.317 L 149.147 187 184.573 187 L 220 187 220 180 L 220 173 184.636 173 L 149.272 173 147.626 168.691 C 142.895 156.303, 125.931 147.722, 112.718 151.034 " stroke="none" fill="black" fill-rule="evenodd"/>
    </svg></a>
    <a href="javascript:dispatch('swapAcross');" title="swap across">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="oib" viewBox="0 0 240 240" version="1.1">
      <path fill-opacity="0.494" d="M 212.588 39.250 L 208.842 42.500 211.671 46.214 C 213.227 48.256, 214.950 49.925, 215.500 49.923 C 216.050 49.921, 218.030 48.611, 219.899 47.012 C 223.582 43.863, 223.589 43.920, 218.674 37.750 C 216.865 35.480, 216.959 35.457, 212.588 39.250 M 24.619 43.433 C 23.178 45.322, 22 47.234, 22 47.683 C 22 48.132, 23.649 49.816, 25.665 51.424 L 29.330 54.349 32.681 50.424 L 36.032 46.500 32.349 43.250 C 30.324 41.462, 28.345 40, 27.952 40 C 27.559 40, 26.059 41.545, 24.619 43.433 M 196.672 51.863 L 193.069 54.726 196.205 58.807 C 199.589 63.209, 199.895 63.207, 205.242 58.732 L 207.985 56.437 204.920 52.719 C 203.234 50.673, 201.499 49, 201.065 49 C 200.630 49, 198.654 50.288, 196.672 51.863 M 40.028 56.115 L 36.773 60.165 40.137 63.042 C 41.986 64.624, 44.025 65.937, 44.666 65.959 C 45.307 65.982, 47.187 64.289, 48.843 62.199 C 51.219 59.198, 51.574 58.197, 50.530 57.449 C 49.802 56.927, 47.873 55.502, 46.244 54.282 L 43.283 52.065 40.028 56.115 M 181.327 64.086 L 177.154 67.309 180.271 71.187 C 182.138 73.511, 183.951 74.849, 184.794 74.525 C 186.580 73.840, 191.871 69.690, 191.945 68.917 C 191.975 68.596, 190.537 66.652, 188.750 64.598 L 185.500 60.862 181.327 64.086 M 55.750 68.439 C 54.237 70.339, 53.025 72.255, 53.055 72.697 C 53.121 73.657, 58.235 77.796, 60.149 78.439 C 61.451 78.877, 65.506 74.630, 66.439 71.851 C 66.870 70.570, 62.759 66.608, 59.851 65.500 C 59.092 65.211, 57.294 66.499, 55.750 68.439 M 165.115 76.976 L 161.730 79.871 164.953 83.941 L 168.176 88.011 170.927 86.052 C 176.248 82.263, 176.523 81.374, 173.570 77.502 C 172.100 75.576, 170.359 74.018, 169.699 74.041 C 169.040 74.063, 166.977 75.384, 165.115 76.976 M 71.204 81.194 L 68.067 85.276 72.251 88.587 C 74.553 90.408, 76.523 91.808, 76.631 91.699 C 76.739 91.590, 78.232 89.730, 79.950 87.567 L 83.073 83.633 80.286 81.303 C 74.888 76.789, 74.593 76.785, 71.204 81.194 M 149.783 89.201 L 146.066 92.296 149.117 96.148 C 150.795 98.267, 152.478 100, 152.856 100 C 153.235 100, 155.229 98.611, 157.288 96.914 L 161.032 93.828 157.932 89.914 C 156.227 87.761, 154.532 86.024, 154.166 86.053 C 153.800 86.082, 151.827 87.498, 149.783 89.201 M 86.755 93.691 C 83.729 97.679, 83.939 98.397, 89.237 102.169 L 92.151 104.244 95.035 100.872 C 96.621 99.017, 97.937 97.050, 97.959 96.500 C 98.004 95.398, 91.585 89.978, 90.303 90.036 C 89.862 90.056, 88.265 91.701, 86.755 93.691 M 108.572 92.018 C 98.079 96.115, 90.002 108.121, 90.001 119.624 C 90 122.993, 90.623 127.514, 91.384 129.671 L 92.768 133.593 54.343 164.334 L 15.918 195.076 17.931 197.788 C 19.038 199.280, 20.790 201.572, 21.825 202.881 L 23.707 205.263 61.103 175.332 C 81.671 158.871, 99.016 145.089, 99.647 144.706 C 100.278 144.322, 103.779 145.405, 107.426 147.112 C 113.352 149.885, 114.827 150.173, 121.279 149.812 C 126.185 149.538, 130.103 148.638, 133.500 147.007 C 136.250 145.687, 138.993 144.633, 139.597 144.666 C 140.200 144.700, 157.703 158.347, 178.493 174.995 L 216.293 205.263 218.175 202.881 C 219.210 201.572, 220.960 199.282, 222.065 197.794 L 224.074 195.087 186.287 164.903 C 165.504 148.302, 148.152 134.413, 147.727 134.037 C 147.302 133.661, 147.639 131.714, 148.477 129.709 C 152.290 120.582, 149.189 106.531, 141.760 99.275 C 132.736 90.462, 119.801 87.633, 108.572 92.018 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.054" d="M 212.677 39.234 L 208.855 42.500 212.177 46.329 L 215.500 50.158 219.214 47.329 C 221.256 45.773, 222.944 44.237, 222.964 43.917 C 222.984 43.596, 221.537 41.676, 219.750 39.651 L 216.500 35.968 212.677 39.234 M 24.750 43.447 C 23.238 45.342, 22.016 47.255, 22.036 47.697 C 22.056 48.138, 23.744 49.769, 25.786 51.321 L 29.500 54.142 32.757 50.321 L 36.013 46.500 32.257 43.265 C 30.190 41.486, 28.275 40.023, 28 40.015 C 27.725 40.007, 26.262 41.551, 24.750 43.447 M 197.250 51.584 C 195.463 52.992, 194 54.500, 194 54.935 C 194 55.369, 195.290 57.349, 196.867 59.333 L 199.735 62.941 203.591 59.608 L 207.447 56.275 204.673 52.637 C 203.147 50.637, 201.584 49.005, 201.199 49.011 C 200.815 49.017, 199.037 50.175, 197.250 51.584 M 39.775 56.666 L 37.050 60.258 40.662 63.129 C 42.649 64.708, 44.640 66, 45.087 66 C 45.533 66, 47.146 64.365, 48.670 62.366 L 51.442 58.732 48.009 55.866 C 46.120 54.290, 44.109 53.016, 43.538 53.036 C 42.967 53.056, 41.274 54.690, 39.775 56.666 M 181.671 64.177 L 177.842 67.500 180.671 71.214 C 182.227 73.256, 183.763 74.944, 184.083 74.964 C 184.404 74.984, 186.324 73.537, 188.349 71.750 L 192.032 68.500 188.766 64.677 L 185.500 60.855 181.671 64.177 M 55.671 68.786 L 52.842 72.500 56.671 75.831 L 60.500 79.162 63.831 75.331 L 67.162 71.500 63.414 68.250 C 61.353 66.463, 59.404 65.016, 59.083 65.036 C 58.763 65.056, 57.227 66.744, 55.671 68.786 M 165.662 76.871 L 162.050 79.742 164.775 83.334 C 166.274 85.310, 167.967 86.944, 168.538 86.964 C 169.109 86.984, 171.102 85.726, 172.967 84.169 L 176.359 81.337 173.561 77.669 C 172.022 75.651, 170.428 74, 170.019 74 C 169.610 74, 167.649 75.292, 165.662 76.871 M 71.589 81.077 C 70.165 82.769, 69 84.546, 69 85.026 C 69 85.506, 70.628 87.140, 72.619 88.658 L 76.237 91.418 79.119 88.193 C 80.703 86.420, 82 84.566, 82 84.073 C 82 83.018, 76.226 78, 75.012 78 C 74.553 78, 73.013 79.385, 71.589 81.077 M 150.697 88.750 C 148.704 90.263, 147.075 91.950, 147.077 92.500 C 147.079 93.050, 148.384 95.023, 149.976 96.885 L 152.871 100.270 156.923 97.061 L 160.975 93.852 157.820 89.926 C 156.085 87.767, 154.588 86, 154.494 86 C 154.399 86, 152.691 87.237, 150.697 88.750 M 88.341 92.289 C 83.628 97.673, 83.633 97.541, 88.018 101.014 C 92.513 104.574, 92.115 104.702, 96.648 98.252 C 98.128 96.145, 98.079 95.878, 95.864 93.985 C 91.345 90.125, 90.417 89.916, 88.341 92.289 M 109.424 91.996 C 94.681 97.846, 86.533 114.377, 91.380 128.603 C 92.696 132.463, 92.770 133.651, 91.759 134.634 C 91.067 135.307, 74.075 148.978, 54 165.014 C 33.925 181.050, 17.385 194.694, 17.245 195.335 C 17.104 195.976, 18.493 198.383, 20.330 200.683 L 23.672 204.867 62.086 174.160 L 100.500 143.454 106 146.472 C 110.821 149.118, 112.487 149.491, 119.500 149.495 C 126.209 149.499, 128.404 149.056, 133.100 146.750 C 136.179 145.238, 139 144, 139.367 144 C 139.734 144, 156.937 157.535, 177.596 174.077 C 198.255 190.619, 215.727 203.935, 216.422 203.668 C 217.118 203.401, 219.108 201.388, 220.845 199.195 L 224.004 195.208 186.752 165.473 C 166.263 149.119, 148.952 135.234, 148.283 134.617 C 147.329 133.737, 147.373 132.631, 148.489 129.497 C 153.171 116.349, 146.376 99.790, 133.638 93.304 C 126.604 89.723, 116.526 89.178, 109.424 91.996 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.500" d="M 212.348 39.734 L 209.195 42.360 212.241 46.150 L 215.287 49.941 219.129 46.898 L 222.970 43.856 220.235 40.428 C 218.731 38.543, 217.050 37.024, 216.500 37.054 C 215.950 37.083, 214.081 38.289, 212.348 39.734 M 24.627 44.422 L 22.016 47.845 25.810 50.849 C 28.754 53.181, 29.815 53.565, 30.551 52.567 C 35.547 45.792, 35.447 46.294, 32.344 43.564 C 28.595 40.267, 27.722 40.364, 24.627 44.422 M 197.136 51.958 L 193.773 54.835 196.505 58.418 C 198.008 60.388, 199.521 61.988, 199.869 61.973 C 200.216 61.958, 202.034 60.674, 203.909 59.119 L 207.318 56.292 204.409 52.646 C 202.809 50.641, 201.275 49.018, 201 49.041 C 200.725 49.063, 198.986 50.376, 197.136 51.958 M 40.458 56.644 L 37.678 60.289 41.089 63.117 C 42.965 64.673, 44.725 65.942, 45 65.937 C 45.275 65.931, 46.741 64.292, 48.258 62.293 L 51.015 58.658 47.758 55.870 C 45.966 54.336, 44.216 53.063, 43.869 53.041 C 43.521 53.018, 41.987 54.640, 40.458 56.644 M 181.783 64.267 L 178.066 67.296 181.105 71.133 L 184.144 74.970 187.572 72.235 C 189.457 70.731, 190.982 69.050, 190.959 68.500 C 190.937 67.950, 189.700 66.091, 188.209 64.368 L 185.500 61.237 181.783 64.267 M 56.176 68.931 L 53.106 72.751 56.878 75.782 L 60.649 78.813 63.325 75.460 C 64.796 73.616, 66 71.745, 66 71.303 C 66 70.862, 64.480 69.287, 62.623 67.805 L 59.246 65.111 56.176 68.931 M 166.047 76.917 L 162.594 79.779 165.348 83.390 C 166.863 85.375, 168.416 86.982, 168.801 86.959 C 169.185 86.937, 170.966 85.664, 172.758 84.130 L 176.015 81.342 173.258 77.707 C 171.741 75.708, 170.275 74.069, 170 74.063 C 169.725 74.058, 167.946 75.342, 166.047 76.917 M 71.640 81.585 L 68.779 85.170 72.140 88.044 C 73.988 89.625, 75.725 90.937, 76 90.959 C 76.275 90.982, 77.809 89.359, 79.409 87.354 L 82.318 83.708 78.909 80.881 C 77.034 79.326, 75.275 78.042, 75 78.027 C 74.725 78.012, 73.213 79.613, 71.640 81.585 M 150.673 89.345 L 146.976 92.500 149.561 95.750 C 150.982 97.537, 152.675 98.986, 153.322 98.968 C 154.446 98.938, 160 94.544, 160 93.685 C 160 93.460, 158.733 91.681, 157.185 89.733 L 154.370 86.190 150.673 89.345 M 87.694 93.516 C 86.212 95.374, 85 97.164, 85 97.495 C 85 98.414, 90.366 102.933, 91.500 102.968 C 92.050 102.986, 93.731 101.457, 95.235 99.572 L 97.970 96.144 94.179 93.142 L 90.389 90.140 87.694 93.516 M 112.718 91.034 C 107.310 92.390, 104.046 94.270, 99.611 98.584 C 91.923 106.062, 88.622 117.824, 91.357 127.997 C 92.171 131.023, 92.459 133.945, 91.999 134.497 C 91.538 135.049, 74.498 148.775, 54.131 165 C 33.764 181.225, 17.095 194.950, 17.088 195.500 C 17.081 196.050, 18.594 198.275, 20.451 200.445 C 23.007 203.432, 24.151 204.135, 25.163 203.342 C 25.898 202.766, 43.174 188.979, 63.553 172.703 L 100.606 143.111 106.331 145.998 C 109.479 147.586, 114.014 149.180, 116.408 149.539 C 122.151 150.400, 131.005 148.486, 135.551 145.401 C 137.870 143.827, 139.621 143.248, 140.351 143.814 C 140.983 144.304, 158.307 158.128, 178.848 174.533 L 216.196 204.362 219.561 200.431 C 221.411 198.269, 222.942 196.169, 222.962 195.764 C 222.983 195.359, 206.012 181.452, 185.250 164.859 C 164.488 148.266, 147.325 134.547, 147.111 134.372 C 146.896 134.197, 147.506 131.258, 148.465 127.841 C 151.415 117.327, 148.895 107.180, 141.456 99.611 C 134.354 92.385, 122.018 88.703, 112.718 91.034 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="1.000" d="M 212.849 39.844 L 209.666 42.688 212.506 46.248 L 215.347 49.808 218.674 47.154 C 220.503 45.694, 221.986 44.050, 221.968 43.500 C 221.934 42.414, 217.432 37, 216.564 37 C 216.271 37, 214.599 38.280, 212.849 39.844 M 24.644 44.400 L 22.050 47.801 25.694 50.580 L 29.337 53.359 32.213 49.929 L 35.089 46.500 32.029 43.750 C 30.346 42.237, 28.579 41, 28.103 41 C 27.627 41, 26.070 42.530, 24.644 44.400 M 197.846 51.683 C 196.006 53.177, 194.344 54.504, 194.152 54.631 C 193.698 54.933, 199.347 62.012, 200 61.959 C 200.275 61.937, 201.971 60.660, 203.769 59.121 L 207.038 56.323 204.115 52.645 L 201.192 48.967 197.846 51.683 M 40.505 56.582 L 37.773 60.165 41.136 63.058 L 44.500 65.951 47.721 62.343 L 50.941 58.735 47.333 55.867 C 45.349 54.290, 43.615 53, 43.481 53 C 43.347 53, 42.008 54.612, 40.505 56.582 M 181.350 64.791 L 178.201 67.500 180.923 70.750 C 184.166 74.621, 184.667 74.669, 188.308 71.467 C 191.242 68.885, 191.177 68.138, 187.677 64.250 C 185.180 61.477, 185.205 61.475, 181.350 64.791 M 55.846 69.326 L 53.192 72.653 56.662 75.422 C 60.046 78.122, 60.182 78.145, 62.159 76.356 C 66.091 72.797, 66.324 71.188, 63.292 68.519 C 59.641 65.307, 58.997 65.377, 55.846 69.326 M 166.136 76.952 L 162.773 79.835 165.505 83.418 C 167.008 85.388, 168.347 87, 168.481 87 C 168.615 87, 170.319 85.733, 172.267 84.185 L 175.810 81.370 172.655 77.719 L 169.500 74.068 166.136 76.952 M 71.775 81.666 L 69.050 85.258 72.645 88.115 L 76.240 90.972 79.139 87.325 L 82.038 83.677 78.769 80.879 C 76.971 79.340, 75.275 78.079, 75 78.077 C 74.725 78.075, 73.274 79.690, 71.775 81.666 M 150.280 89.652 L 147.059 92.211 149.648 95.605 C 151.072 97.472, 152.599 99, 153.042 99 C 153.484 99, 155.226 97.839, 156.913 96.420 L 159.979 93.840 157.371 90.420 C 155.936 88.539, 154.479 87.021, 154.131 87.047 C 153.784 87.073, 152.051 88.245, 150.280 89.652 M 87.734 93.814 C 85.109 97.182, 85.066 97.416, 86.735 99.259 C 90.199 103.087, 91.829 103.305, 94.481 100.292 C 97.685 96.649, 97.620 95.994, 93.738 92.898 L 90.477 90.295 87.734 93.814 M 114.920 91.063 C 105.536 92.543, 96.959 99.285, 92.974 108.314 C 90.500 113.921, 90.101 123.266, 92.057 129.796 C 92.827 132.367, 92.971 134.395, 92.418 134.895 C 91.913 135.352, 74.744 149.104, 54.264 165.454 C 13.893 197.685, 16.194 195.173, 21.364 201.362 L 23.754 204.224 61.531 173.976 C 82.308 157.339, 99.800 143.698, 100.403 143.663 C 101.007 143.629, 104.102 144.855, 107.283 146.388 C 115.418 150.311, 124.582 150.311, 132.717 146.388 C 135.898 144.855, 138.993 143.629, 139.597 143.663 C 140.200 143.698, 157.692 157.339, 178.469 173.976 L 216.246 204.224 218.636 201.362 C 223.818 195.158, 226.225 197.766, 184.588 164.473 L 146.196 133.775 147.686 130.208 C 148.506 128.247, 149.176 123.636, 149.176 119.961 C 149.176 101.540, 133.319 88.163, 114.920 91.063 " stroke="none" fill="black" fill-rule="evenodd"/>
    </svg></a>
    <a href="javascript:dispatch('uncross_paths');" title="uncross">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="oib" viewBox="0 0 240 240" version="1.1">
      <path fill-opacity="0.494" d="M 21.500 21.662 C 8.741 28.388, 6.021 45.239, 16.166 54.702 C 21.628 59.797, 32.082 61.560, 38.168 58.413 C 41.207 56.842, 41.276 56.863, 45.102 60.599 L 48.966 64.373 52.405 60.436 L 55.844 56.500 51.714 52.250 L 47.584 48 119.851 48 C 167.368 48, 191.908 48.340, 191.505 48.992 C 190.783 50.160, 196.939 58.156, 198.037 57.477 C 198.450 57.222, 200.396 57.685, 202.362 58.507 C 215.724 64.090, 230 54.268, 230 39.492 C 230 21.410, 206.362 13.085, 194.626 27.033 C 193.182 28.749, 192 30.569, 192 31.077 C 192 31.633, 163.344 32, 120 32 C 76.656 32, 48 31.633, 48 31.077 C 48 29.090, 42.377 23.622, 38.541 21.880 C 33.597 19.634, 25.542 19.531, 21.500 21.662 M 179.731 59.752 L 175.962 63.623 179.394 67.562 L 182.825 71.500 186.413 68.054 C 188.386 66.158, 189.993 64.358, 189.985 64.054 C 189.977 63.749, 188.514 61.786, 186.735 59.690 L 183.500 55.881 179.731 59.752 M 59.284 66.796 L 56.233 70.592 60.272 73.983 L 64.310 77.373 67.659 73.436 L 71.008 69.500 67.519 66.250 C 65.600 64.463, 63.648 63, 63.182 63 C 62.716 63, 60.962 64.708, 59.284 66.796 M 164.235 73.452 L 160.500 76.904 164.167 80.602 L 167.833 84.300 171.940 81.047 L 176.047 77.795 172.773 73.982 C 170.973 71.885, 169.156 70.131, 168.735 70.085 C 168.315 70.038, 166.290 71.553, 164.235 73.452 M 74.253 79.947 L 71.006 83.859 74.731 86.929 C 76.779 88.618, 78.757 90, 79.124 90 C 79.492 90, 81.238 88.354, 83.005 86.341 L 86.218 82.682 82.359 79.379 C 80.236 77.562, 78.275 76.066, 78 76.056 C 77.725 76.045, 76.039 77.796, 74.253 79.947 M 149.555 86.487 L 145.611 89.827 149.322 93.934 L 153.033 98.042 157.070 94.271 L 161.107 90.500 157.303 86.823 L 153.500 83.147 149.555 86.487 M 89.703 92.792 L 85.995 96.589 89.792 100.297 L 93.589 104.005 97.297 100.208 L 101.005 96.411 97.208 92.703 L 93.411 88.995 89.703 92.792 M 134.823 99.697 L 131.147 103.500 134.487 107.445 L 137.827 111.389 141.934 107.678 L 146.042 103.967 142.271 99.930 L 138.500 95.893 134.823 99.697 M 104.026 106.624 L 100.844 110.247 104.637 113.374 C 106.723 115.093, 108.698 116.500, 109.026 116.500 C 109.354 116.500, 111.060 114.862, 112.818 112.860 L 116.014 109.220 112.472 106.110 C 110.524 104.399, 108.543 103, 108.069 103 C 107.595 103, 105.775 104.631, 104.026 106.624 M 119.501 113.134 C 116.111 116.109, 116.017 116.361, 117.621 118.134 C 119.207 119.886, 119.206 120.115, 117.604 121.885 C 115.976 123.684, 116.071 123.913, 119.677 126.885 C 121.755 128.598, 123.765 130, 124.144 130 C 124.522 130, 126.201 128.271, 127.874 126.158 C 130.180 123.247, 130.636 122.036, 129.758 121.158 C 128.881 120.281, 128.881 119.719, 129.758 118.842 C 130.636 117.964, 130.180 116.753, 127.874 113.842 C 126.201 111.729, 124.435 110, 123.951 110 C 123.466 110, 121.464 111.410, 119.501 113.134 M 104.641 126.379 L 100.782 129.682 103.995 133.341 C 105.762 135.354, 107.702 137, 108.306 137 C 108.910 137, 110.862 135.588, 112.643 133.862 L 115.881 130.723 112.690 126.880 C 110.936 124.766, 109.275 123.045, 109 123.056 C 108.725 123.066, 106.764 124.562, 104.641 126.379 M 134.310 132.880 L 131.119 136.723 134.590 140.087 C 138.432 143.811, 139.712 143.605, 143.395 138.672 L 145.391 135.999 141.999 132.499 C 140.134 130.575, 138.358 129.008, 138.054 129.018 C 137.749 129.028, 136.064 130.766, 134.310 132.880 M 89.716 139.778 L 85.995 143.589 89.748 147.235 L 93.500 150.881 97.366 147.321 L 101.232 143.761 97.335 139.864 L 93.438 135.967 89.716 139.778 M 149.013 146.486 L 145.635 149.972 149.567 153.404 L 153.500 156.836 156.750 153.722 C 158.537 152.009, 160 150.061, 160 149.393 C 160 148.158, 154.449 143, 153.119 143 C 152.720 143, 150.872 144.569, 149.013 146.486 M 74.552 153.088 L 71.035 156.176 74.268 160.070 C 76.045 162.212, 77.725 163.965, 78 163.967 C 78.275 163.969, 80.250 162.489, 82.390 160.679 L 86.280 157.388 83.036 153.694 C 81.252 151.662, 79.405 150, 78.931 150 C 78.457 150, 76.487 151.390, 74.552 153.088 M 164.040 159.459 C 160.336 163.280, 160.536 164.109, 166.115 168.082 L 168.908 170.071 172.411 166.285 L 175.913 162.500 172.206 159.288 C 170.168 157.521, 168.251 156.058, 167.946 156.038 C 167.642 156.017, 165.884 157.557, 164.040 159.459 M 60.250 165.863 C 58.462 167.394, 57 169.020, 57 169.478 C 57 170.925, 62.050 177, 63.253 177 C 63.887 177, 65.871 175.579, 67.662 173.843 L 70.919 170.686 67.876 166.843 C 66.202 164.729, 64.532 163.018, 64.166 163.041 C 63.800 163.063, 62.038 164.333, 60.250 165.863 M 179.084 172.714 L 176.023 176.428 179.208 179.714 C 180.959 181.521, 182.926 183, 183.577 183 C 184.229 183, 185.993 181.387, 187.496 179.416 L 190.230 175.832 186.919 172.416 C 185.098 170.537, 183.279 169, 182.877 169 C 182.475 169, 180.768 170.671, 179.084 172.714 M 44.934 179.533 C 41.403 183.064, 41.399 183.065, 37.733 181.533 C 24.277 175.910, 10 185.679, 10 200.508 C 10 218.590, 33.638 226.915, 45.374 212.967 C 46.818 211.251, 48 209.431, 48 208.923 C 48 208.367, 76.656 208, 120 208 C 163.344 208, 192 208.367, 192 208.923 C 192 209.431, 193.219 211.295, 194.709 213.066 C 202.103 221.853, 216.869 222.231, 224.702 213.834 C 231.981 206.031, 231.569 192.513, 223.834 185.298 C 218.407 180.236, 207.921 178.438, 201.921 181.541 C 200.282 182.388, 198.569 182.852, 198.114 182.571 C 196.963 181.859, 190.752 189.789, 191.505 191.008 C 191.908 191.660, 167.360 191.991, 119.809 191.975 L 47.500 191.950 51.760 187.929 L 56.021 183.908 52.843 179.954 C 51.095 177.779, 49.396 176, 49.066 176 C 48.736 176, 46.877 177.590, 44.934 179.533 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.031" d="M 23.685 21.017 C 15.033 23.614, 9.356 32.473, 10.326 41.866 C 11.485 53.101, 20.296 60.578, 31.297 59.663 C 34.486 59.398, 38.021 58.566, 39.153 57.814 C 41.025 56.572, 41.561 56.796, 45.043 60.278 L 48.873 64.109 52.422 60.304 L 55.972 56.500 51.986 52.714 C 49.794 50.632, 48 48.719, 48 48.464 C 48 48.209, 80.420 48, 120.044 48 C 179.409 48, 192.036 48.234, 191.794 49.328 C 191.434 50.954, 197.027 57.421, 199.042 57.707 C 199.844 57.821, 202.312 58.450, 204.527 59.104 C 213.722 61.821, 224.367 56.947, 228.209 48.260 C 232.454 38.663, 228.336 27.017, 218.987 22.177 C 210.456 17.762, 197.650 21.178, 193.162 29.066 L 191.500 31.987 120 31.956 L 48.500 31.924 45.713 27.897 C 41.166 21.326, 32.094 18.493, 23.685 21.017 M 179.516 60.250 L 176.061 63.500 179.395 67.387 L 182.730 71.274 186.568 67.757 L 190.406 64.240 187.453 60.692 C 185.829 58.741, 184.156 57.112, 183.735 57.072 C 183.315 57.032, 181.416 58.462, 179.516 60.250 M 59.623 66.606 L 56.745 70.212 60.363 73.830 L 63.981 77.447 66.950 73.974 C 68.583 72.063, 69.937 69.960, 69.959 69.301 C 69.994 68.277, 64.086 63, 62.906 63 C 62.683 63, 61.205 64.623, 59.623 66.606 M 164.774 73.312 L 161.047 76.500 164.461 80.500 L 167.875 84.500 171.671 80.750 L 175.467 77 171.983 73.562 L 168.500 70.125 164.774 73.312 M 75.158 79.337 C 73.421 81.129, 72 83.083, 72 83.679 C 72 84.275, 73.651 86.022, 75.669 87.561 L 79.337 90.359 82.169 86.967 C 83.726 85.102, 84.968 83.109, 84.928 82.538 C 84.888 81.967, 83.384 80.280, 81.586 78.789 L 78.316 76.079 75.158 79.337 M 149.687 86.805 C 146.310 90.330, 146.330 90.984, 149.921 94.424 L 152.842 97.223 156.421 94.493 C 158.389 92.991, 160 91.401, 160 90.958 C 160 89.565, 154.880 84, 153.598 84 C 152.925 84, 151.165 85.262, 149.687 86.805 M 90.199 92.294 C 88.440 94.110, 87 96.052, 87 96.611 C 87 97.840, 92.249 103, 93.500 103 C 94.806 103, 100 97.814, 100 96.509 C 100 95.895, 98.515 93.953, 96.699 92.193 L 93.398 88.994 90.199 92.294 M 135.077 99.589 C 131.314 102.755, 131.269 103.628, 134.687 107.195 C 138.058 110.714, 138.955 110.700, 142.424 107.079 L 145.223 104.158 142.493 100.579 C 140.991 98.611, 139.401 97, 138.958 97 C 138.516 97, 136.769 98.165, 135.077 99.589 M 104.398 106.545 L 101.694 110.089 105.046 113.548 L 108.398 117.006 111.699 113.807 C 113.515 112.047, 115 110.044, 115 109.355 C 115 108.187, 109.047 103, 107.707 103 C 107.374 103, 105.885 104.595, 104.398 106.545 M 120.019 113.056 C 116.876 115.742, 116.666 116.235, 117.851 118.133 C 118.793 119.641, 118.858 120.542, 118.082 121.318 C 116.248 123.152, 116.856 124.653, 120.582 127.495 L 124.165 130.227 127.042 126.864 C 130.181 123.193, 130.683 121.397, 128.750 120.746 C 127.773 120.417, 127.797 119.965, 128.861 118.677 C 130.039 117.249, 129.838 116.567, 127.361 113.586 C 125.787 111.693, 124.275 110.130, 124 110.113 C 123.725 110.095, 121.934 111.420, 120.019 113.056 M 105.046 126.452 L 101.694 129.911 104.398 133.455 C 105.885 135.405, 107.334 137, 107.618 137 C 108.852 137, 115 131.651, 115 130.577 C 115 129.926, 113.515 127.953, 111.699 126.193 L 108.398 122.994 105.046 126.452 M 134.283 132.920 L 131.065 136.671 134.330 139.835 C 136.126 141.576, 138.113 143, 138.747 143 C 139.380 143, 141.115 141.405, 142.602 139.455 L 145.306 135.911 141.957 132.455 C 140.115 130.555, 138.358 129.038, 138.054 129.085 C 137.749 129.131, 136.052 130.857, 134.283 132.920 M 90.077 139.589 C 88.385 141.013, 87 142.676, 87 143.284 C 87 144.758, 92.073 150, 93.500 150 C 94.875 150, 100 144.782, 100 143.382 C 100 142.311, 94.817 137, 93.772 137 C 93.432 137, 91.769 138.165, 90.077 139.589 M 149.099 146.398 L 145.806 149.795 149.653 153.329 L 153.500 156.862 155.842 154.681 C 160.449 150.390, 160.633 148.891, 156.930 145.800 C 155.085 144.260, 153.309 143, 152.984 143 C 152.659 143, 150.910 144.529, 149.099 146.398 M 75.250 152.863 C 73.463 154.394, 72 156.087, 72 156.627 C 72 157.166, 73.463 159.018, 75.250 160.742 L 78.500 163.876 82.077 160.583 L 85.654 157.290 82.730 153.645 C 81.122 151.640, 79.512 150.018, 79.153 150.041 C 78.794 150.063, 77.037 151.333, 75.250 152.863 M 164.589 159.077 C 161.213 163.089, 161.320 164.244, 165.359 167.325 L 168.718 169.886 171.859 166.646 C 173.586 164.863, 175 163.082, 175 162.688 C 175 161.840, 168.797 156.072, 167.839 156.029 C 167.475 156.013, 166.013 157.385, 164.589 159.077 M 60.005 166.495 L 56.617 169.991 59.558 173.240 C 61.176 175.028, 62.583 176.650, 62.684 176.846 C 63.027 177.507, 70 171.771, 70 170.828 C 70 169.752, 64.778 163, 63.946 163 C 63.642 163, 61.868 164.573, 60.005 166.495 M 179.229 172.864 L 176.124 176.728 179.360 179.864 C 181.139 181.589, 183.024 182.968, 183.548 182.928 C 184.071 182.888, 185.803 181.289, 187.395 179.375 L 190.290 175.894 186.949 172.447 C 185.111 170.551, 183.321 169, 182.971 169 C 182.621 169, 180.937 170.739, 179.229 172.864 M 44.654 179.999 C 41.254 182.984, 41.221 182.990, 37.377 181.384 C 31.852 179.076, 23.796 180.072, 18.555 183.711 C 6.373 192.170, 7.726 210.944, 21.013 217.823 C 29.544 222.238, 42.350 218.822, 46.838 210.934 L 48.500 208.013 120 208.044 L 191.500 208.076 194.295 212.114 C 202.319 223.709, 221.109 221.956, 227.823 208.987 C 234.260 196.551, 224.553 180, 210.823 180 C 202.727 180, 190.028 187.025, 191.445 190.719 C 191.843 191.753, 178.074 192, 119.969 192 C 80.386 192, 48 191.774, 48 191.497 C 48 191.221, 49.820 189.351, 52.044 187.341 L 56.089 183.687 52.848 180.343 C 51.066 178.505, 49.262 177, 48.839 177 C 48.416 177, 46.533 178.349, 44.654 179.999 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.480" d="M 22.491 21.865 C 15.277 25.143, 9.977 33.279, 10.028 41 C 10.072 47.855, 17.513 56.938, 24.723 58.940 C 30.373 60.509, 33.181 60.243, 38.294 57.654 C 40.842 56.364, 42.699 55.678, 42.420 56.130 C 41.920 56.939, 47.841 62.914, 49.199 62.971 C 49.584 62.987, 51.116 61.404, 52.604 59.452 L 55.310 55.905 51.905 53.054 C 50.032 51.486, 48.163 50.409, 47.750 50.661 C 47.337 50.912, 47 50.731, 47 50.259 C 47 47.103, 49.322 47, 120.187 47 L 190.973 47 192.349 50.250 C 194.184 54.586, 196.455 56.331, 202.865 58.328 C 209.657 60.445, 212.507 60.407, 217.509 58.135 C 224.723 54.857, 230.023 46.721, 229.972 39 C 229.912 29.715, 219.130 19.961, 209 20.028 C 204.630 20.056, 198.415 23.623, 194.433 28.386 L 190.576 33 120.202 33 L 49.828 33 44.664 27.590 C 37.456 20.039, 30.477 18.237, 22.491 21.865 M 180.250 60.057 C 178.463 61.660, 177 63.344, 177 63.799 C 177 64.254, 178.313 65.884, 179.918 67.421 L 182.835 70.217 186.349 67.413 C 190.166 64.367, 190.098 63.281, 185.842 59.322 L 183.500 57.143 180.250 60.057 M 60.021 66.629 L 56.713 70.397 60.069 73.198 C 61.914 74.739, 63.695 76, 64.025 76 C 64.356 76, 65.929 74.639, 67.523 72.976 L 70.419 69.953 66.874 66.407 L 63.328 62.862 60.021 66.629 M 165.102 73.386 L 161.705 76.900 164.763 80.383 L 167.821 83.866 171.427 80.683 L 175.032 77.500 171.766 73.686 L 168.500 69.873 165.102 73.386 M 74.675 80.359 L 72.114 83.718 75.358 86.862 L 78.602 90.006 82.051 86.433 L 85.500 82.861 82.234 79.930 C 80.438 78.319, 78.579 77, 78.103 77 C 77.627 77, 76.085 78.511, 74.675 80.359 M 150.034 86.830 L 146.644 89.661 149.572 93.330 C 151.182 95.349, 152.749 97, 153.054 97 C 153.358 97, 155.017 95.537, 156.739 93.750 L 159.870 90.500 156.949 87.250 C 155.343 85.463, 153.892 84, 153.726 84 C 153.560 84, 151.899 85.274, 150.034 86.830 M 89.688 93.531 L 86.876 96.917 90.188 99.929 C 92.009 101.586, 93.725 102.922, 94 102.898 C 94.275 102.875, 95.803 101.288, 97.396 99.373 L 100.293 95.890 96.896 92.986 C 95.028 91.388, 93.275 90.095, 93 90.113 C 92.725 90.130, 91.234 91.668, 89.688 93.531 M 135.173 100.106 L 131.846 103.109 134.474 106.555 C 135.919 108.450, 137.416 109.982, 137.801 109.959 C 138.185 109.937, 140.063 108.583, 141.974 106.950 L 145.447 103.981 141.974 100.541 L 138.500 97.102 135.173 100.106 M 104.949 106.582 L 101.500 110.170 104.962 113.085 C 106.866 114.688, 108.726 116, 109.094 116 C 109.462 116, 110.915 114.489, 112.325 112.641 L 114.886 109.282 111.642 106.138 L 108.398 102.994 104.949 106.582 M 120.058 113.440 C 117.221 116.367, 116.890 117.162, 117.966 118.459 C 119.005 119.710, 119.005 120.290, 117.966 121.541 C 116.889 122.838, 117.226 123.638, 120.094 126.599 L 123.500 130.116 126.821 126.496 C 129.499 123.576, 129.910 122.597, 128.948 121.438 C 128.020 120.319, 128.042 119.654, 129.050 118.439 C 130.149 117.115, 129.822 116.355, 126.887 113.421 L 123.429 109.962 120.058 113.440 M 104.962 126.933 L 101.500 129.866 105.036 133.452 L 108.571 137.038 111.749 133.759 L 114.927 130.480 112.391 127.240 C 110.996 125.458, 109.533 124, 109.140 124 C 108.746 124, 106.866 125.320, 104.962 126.933 M 134.474 133.445 L 131.846 136.891 135.173 139.894 L 138.500 142.898 141.974 139.459 L 145.447 136.019 141.974 133.050 C 140.063 131.417, 138.185 130.063, 137.801 130.041 C 137.416 130.018, 135.919 131.550, 134.474 133.445 M 90.219 140.043 L 86.937 143.028 89.719 146.514 C 91.248 148.431, 92.725 149.982, 93 149.959 C 93.275 149.937, 95.012 148.625, 96.860 147.044 L 100.221 144.170 97.360 140.585 C 95.787 138.613, 94.275 137.013, 94 137.029 C 93.725 137.045, 92.023 138.402, 90.219 140.043 M 149.750 146.447 C 148.238 148.342, 147 150.119, 147 150.396 C 147 150.672, 148.550 152.081, 150.445 153.526 L 153.891 156.154 156.881 152.827 L 159.870 149.500 156.739 146.250 C 155.017 144.463, 153.358 143, 153.054 143 C 152.749 143, 151.262 144.551, 149.750 146.447 M 75.219 153.274 L 72.009 156.586 74.805 159.935 C 77.861 163.597, 79.491 163.430, 83.453 159.051 C 85.376 156.927, 85.370 156.903, 81.907 153.440 L 78.429 149.962 75.219 153.274 M 164.477 160.024 L 161.581 163.047 165.140 166.607 L 168.700 170.167 171.858 166.179 L 175.016 162.192 171.931 159.596 C 170.235 158.168, 168.515 157, 168.110 157 C 167.705 157, 166.071 158.361, 164.477 160.024 M 60.039 166.826 L 56.654 169.652 60.077 173.384 L 63.500 177.116 66.942 173.563 L 70.383 170.009 67.505 167.005 C 65.921 165.352, 64.356 164, 64.025 164 C 63.695 164, 61.901 165.272, 60.039 166.826 M 179.687 172.805 C 178.209 174.347, 177.032 176.035, 177.072 176.555 C 177.112 177.075, 178.647 178.747, 180.483 180.270 L 183.821 183.041 186.886 179.322 L 189.951 175.604 186.725 172.843 C 184.951 171.324, 183.247 170.063, 182.937 170.041 C 182.627 170.018, 181.165 171.262, 179.687 172.805 M 45 180.381 C 41.731 183.530, 41.325 183.663, 38.855 182.405 C 30.947 178.376, 21.776 180.185, 15.630 186.988 C 10.021 193.197, 8.681 200.499, 11.865 207.509 C 15.143 214.723, 23.279 220.023, 31 219.972 C 35.370 219.944, 41.585 216.377, 45.567 211.614 L 49.424 207 119.798 207 L 190.172 207 195.336 212.410 C 202.544 219.961, 209.523 221.763, 217.509 218.135 C 224.723 214.857, 230.023 206.721, 229.972 199 C 229.928 192.145, 222.487 183.062, 215.277 181.060 C 210.076 179.616, 208.210 179.723, 202.300 181.804 C 196.045 184.007, 194.647 185.116, 192.545 189.546 L 190.906 193 120.153 193 C 49.323 193, 47 192.897, 47 189.741 C 47 189.269, 47.337 189.088, 47.750 189.339 C 48.163 189.591, 50.032 188.514, 51.905 186.946 L 55.310 184.095 52.604 180.548 C 51.116 178.596, 49.584 177.002, 49.199 177.005 C 48.815 177.008, 46.925 178.527, 45 180.381 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="1.000" d="M 22.491 21.865 C 15.277 25.143, 9.977 33.279, 10.028 41 C 10.088 50.177, 20.789 59.970, 30.782 59.994 C 33.626 60.001, 39.766 57.484, 42.446 55.212 C 44.311 53.631, 44.365 53.630, 43.156 55.195 C 42.022 56.663, 42.293 57.297, 45.173 59.916 C 47.003 61.580, 48.815 62.955, 49.199 62.971 C 49.584 62.987, 51.116 61.404, 52.604 59.452 L 55.310 55.905 51.905 53.054 C 50.032 51.486, 48.163 50.409, 47.750 50.661 C 47.337 50.912, 47 50.731, 47 50.259 C 47 47.103, 49.322 47, 120.187 47 L 190.973 47 192.349 50.250 C 194.184 54.586, 196.455 56.331, 202.865 58.328 C 209.657 60.445, 212.507 60.407, 217.509 58.135 C 224.723 54.857, 230.023 46.721, 229.972 39 C 229.912 29.715, 219.130 19.961, 209 20.028 C 204.630 20.056, 198.415 23.623, 194.433 28.386 L 190.576 33 120.202 33 L 49.828 33 44.664 27.590 C 37.456 20.039, 30.477 18.237, 22.491 21.865 M 180.250 60.057 C 178.463 61.660, 177 63.344, 177 63.799 C 177 64.254, 178.313 65.884, 179.918 67.421 L 182.835 70.217 186.349 67.413 C 190.166 64.367, 190.098 63.281, 185.842 59.322 L 183.500 57.143 180.250 60.057 M 60.021 66.629 L 56.713 70.397 60.069 73.198 C 61.914 74.739, 63.695 76, 64.025 76 C 64.356 76, 65.929 74.639, 67.523 72.976 L 70.419 69.953 66.874 66.407 L 63.328 62.862 60.021 66.629 M 165.102 73.386 L 161.705 76.900 164.763 80.383 L 167.821 83.866 171.427 80.683 L 175.032 77.500 171.766 73.686 L 168.500 69.873 165.102 73.386 M 74.675 80.359 L 72.114 83.718 75.358 86.862 L 78.602 90.006 82.051 86.433 L 85.500 82.861 82.234 79.930 C 80.438 78.319, 78.579 77, 78.103 77 C 77.627 77, 76.085 78.511, 74.675 80.359 M 150.034 86.830 L 146.644 89.661 149.572 93.330 C 151.182 95.349, 152.749 97, 153.054 97 C 153.358 97, 155.017 95.537, 156.739 93.750 L 159.870 90.500 156.949 87.250 C 155.343 85.463, 153.892 84, 153.726 84 C 153.560 84, 151.899 85.274, 150.034 86.830 M 89.688 93.531 L 86.876 96.917 90.188 99.929 C 92.009 101.586, 93.725 102.922, 94 102.898 C 94.275 102.875, 95.803 101.288, 97.396 99.373 L 100.293 95.890 96.896 92.986 C 95.028 91.388, 93.275 90.095, 93 90.113 C 92.725 90.130, 91.234 91.668, 89.688 93.531 M 135.173 100.106 L 131.846 103.109 134.474 106.555 C 135.919 108.450, 137.416 109.982, 137.801 109.959 C 138.185 109.937, 140.063 108.583, 141.974 106.950 L 145.447 103.981 141.974 100.541 L 138.500 97.102 135.173 100.106 M 104.949 106.582 L 101.500 110.170 104.962 113.085 C 106.866 114.688, 108.726 116, 109.094 116 C 109.462 116, 110.915 114.489, 112.325 112.641 L 114.886 109.282 111.642 106.138 L 108.398 102.994 104.949 106.582 M 120.058 113.440 C 117.221 116.367, 116.890 117.162, 117.966 118.459 C 119.005 119.710, 119.005 120.290, 117.966 121.541 C 116.889 122.838, 117.226 123.638, 120.094 126.599 L 123.500 130.116 126.821 126.496 C 129.499 123.576, 129.910 122.597, 128.948 121.438 C 128.020 120.319, 128.042 119.654, 129.050 118.439 C 130.149 117.115, 129.822 116.355, 126.887 113.421 L 123.429 109.962 120.058 113.440 M 104.962 126.933 L 101.500 129.866 105.036 133.452 L 108.571 137.038 111.749 133.759 L 114.927 130.480 112.391 127.240 C 110.996 125.458, 109.533 124, 109.140 124 C 108.746 124, 106.866 125.320, 104.962 126.933 M 134.474 133.445 L 131.846 136.891 135.173 139.894 L 138.500 142.898 141.974 139.459 L 145.447 136.019 141.974 133.050 C 140.063 131.417, 138.185 130.063, 137.801 130.041 C 137.416 130.018, 135.919 131.550, 134.474 133.445 M 90.219 140.043 L 86.937 143.028 89.719 146.514 C 91.248 148.431, 92.725 149.982, 93 149.959 C 93.275 149.937, 95.012 148.625, 96.860 147.044 L 100.221 144.170 97.360 140.585 C 95.787 138.613, 94.275 137.013, 94 137.029 C 93.725 137.045, 92.023 138.402, 90.219 140.043 M 149.750 146.447 C 148.238 148.342, 147 150.119, 147 150.396 C 147 150.672, 148.550 152.081, 150.445 153.526 L 153.891 156.154 156.881 152.827 L 159.870 149.500 156.739 146.250 C 155.017 144.463, 153.358 143, 153.054 143 C 152.749 143, 151.262 144.551, 149.750 146.447 M 75.219 153.274 L 72.009 156.586 74.805 159.935 C 77.861 163.597, 79.491 163.430, 83.453 159.051 C 85.376 156.927, 85.370 156.903, 81.907 153.440 L 78.429 149.962 75.219 153.274 M 164.477 160.024 L 161.581 163.047 165.140 166.607 L 168.700 170.167 171.858 166.179 L 175.016 162.192 171.931 159.596 C 170.235 158.168, 168.515 157, 168.110 157 C 167.705 157, 166.071 158.361, 164.477 160.024 M 60.039 166.826 L 56.654 169.652 60.077 173.384 L 63.500 177.116 66.942 173.563 L 70.383 170.009 67.505 167.005 C 65.921 165.352, 64.356 164, 64.025 164 C 63.695 164, 61.901 165.272, 60.039 166.826 M 179.687 172.805 C 178.209 174.347, 177.032 176.035, 177.072 176.555 C 177.112 177.075, 178.647 178.747, 180.483 180.270 L 183.821 183.041 186.886 179.322 L 189.951 175.604 186.725 172.843 C 184.951 171.324, 183.247 170.063, 182.937 170.041 C 182.627 170.018, 181.165 171.262, 179.687 172.805 M 45.157 180.098 C 41.867 183.090, 41.843 183.171, 43.657 185.284 C 44.968 186.810, 44.552 186.656, 42.219 184.753 C 36.311 179.934, 29.074 178.874, 22.491 181.865 C 15.277 185.143, 9.977 193.279, 10.028 201 C 10.088 210.285, 20.870 220.039, 31 219.972 C 35.370 219.944, 41.585 216.377, 45.567 211.614 L 49.424 207 119.798 207 L 190.172 207 195.336 212.410 C 202.544 219.961, 209.523 221.763, 217.509 218.135 C 224.723 214.857, 230.023 206.721, 229.972 199 C 229.928 192.145, 222.487 183.062, 215.277 181.060 C 210.076 179.616, 208.210 179.723, 202.300 181.804 C 196.043 184.008, 194.647 185.116, 192.542 189.553 L 190.900 193.013 119.822 192.757 L 48.744 192.500 47.134 190 C 45.833 187.980, 45.809 187.721, 47.012 188.653 C 48.196 189.570, 49.197 189.221, 51.905 186.950 L 55.310 184.095 52.604 180.548 C 51.116 178.596, 49.584 177.013, 49.199 177.029 C 48.815 177.045, 46.996 178.426, 45.157 180.098 " stroke="none" fill="black" fill-rule="evenodd"/>
    </svg></a>
    </span>
    <br>
    <span class="grouping">
    <a href="javascript:dispatch('heuristic');" title="heuristic">
    <svg xmlns="http://www.w3.org/2000/svg" class="solve" width="24" height="24" viewBox="0 0 240 240" version="1.1">
      <path fill-opacity="1.000" d="M 98 4.490 C 88.254 6.159, 79.206 8.554, 73.647 10.937 C 61.102 16.315, 49.108 26.653, 42.941 37.406 C 33.830 53.289, 30.398 79.901, 35.726 93.349 C 38.616 100.646, 46.103 110.089, 54.194 116.643 C 65.785 126.031, 71.280 132.029, 74.677 139 C 81.197 152.378, 83 165.216, 83 198.256 C 83 224.180, 83.452 226.851, 88.516 230.834 C 93.231 234.543, 100.591 236.146, 115.500 236.710 C 136.929 237.522, 149.173 234.679, 154.395 227.679 C 156.390 225.006, 156.534 223.262, 157.153 194.179 C 157.839 161.933, 158.617 155.449, 163.195 143.783 C 166.881 134.392, 171.845 128.134, 182.489 119.459 C 193.616 110.390, 201.586 100.749, 204.540 92.784 C 207.305 85.330, 207.100 66.744, 204.128 55.500 C 197.928 32.034, 182.158 15.498, 159.160 8.345 C 142.746 3.240, 115.372 1.514, 98 4.490 M 103.500 18.156 C 81.510 20.616, 66.190 28.475, 57.229 41.895 C 52.185 49.448, 49.402 57.773, 47.889 69.830 C 46.015 84.761, 48.411 91.568, 59.274 102.175 C 61.598 104.444, 66.010 108.146, 69.078 110.401 C 82.840 120.514, 92.224 137.677, 95.513 158.750 L 96.176 163 119.985 163 L 143.795 163 144.964 156.250 C 148.434 136.210, 157.449 120.397, 171.155 110.307 C 179.449 104.201, 186.618 96.607, 189.852 90.500 C 192.218 86.032, 192.486 84.490, 192.371 75.996 C 192.137 58.797, 187.055 45.055, 177.334 35.334 C 162.877 20.877, 135.703 14.555, 103.500 18.156 M 113 54 C 113 61.700, 112.769 68, 112.487 68 C 112.204 68, 105.631 64.823, 97.880 60.940 C 90.129 57.057, 83.663 54.019, 83.512 54.190 C 83.361 54.360, 81.868 57.231, 80.196 60.569 L 77.154 66.638 90.077 73.038 C 97.185 76.558, 103 79.691, 103 80 C 103 80.309, 97.185 83.442, 90.077 86.962 L 77.154 93.362 80.196 99.431 C 81.868 102.769, 83.361 105.640, 83.512 105.810 C 83.663 105.981, 90.129 102.943, 97.880 99.060 C 105.631 95.177, 112.204 92, 112.487 92 C 112.769 92, 113 98.300, 113 106 L 113 120 120 120 L 127 120 127 106 C 127 98.300, 127.231 92, 127.513 92 C 127.796 92, 134.369 95.177, 142.120 99.060 C 149.871 102.943, 156.337 105.981, 156.488 105.810 C 156.639 105.640, 158.132 102.769, 159.804 99.431 L 162.846 93.362 149.923 86.962 C 142.815 83.442, 137 80.309, 137 80 C 137 79.691, 142.815 76.558, 149.923 73.038 L 162.846 66.638 159.804 60.569 C 158.132 57.231, 156.639 54.360, 156.488 54.190 C 156.337 54.019, 149.871 57.057, 142.120 60.940 C 134.369 64.823, 127.796 68, 127.513 68 C 127.231 68, 127 61.700, 127 54 L 127 40 120 40 L 113 40 113 54 M 111.500 178.543 C 96.403 181.067, 97 180.861, 97 183.545 C 97 186.696, 97.006 186.696, 119.347 182.983 C 142.427 179.146, 143 179.024, 143 177.921 C 143 176.556, 120.755 176.995, 111.500 178.543 M 120 187.056 C 110.925 188.621, 102.037 190.169, 100.250 190.496 C 97.628 190.976, 97 191.565, 97 193.545 C 97 196.696, 97.006 196.696, 119.347 192.983 C 144.642 188.778, 143 189.234, 143 186.421 C 143 183.299, 141.560 183.339, 120 187.056 M 120 197.056 C 110.925 198.621, 102.037 200.169, 100.250 200.496 C 97.628 200.976, 97 201.565, 97 203.545 C 97 206.696, 97.006 206.696, 119.347 202.983 C 144.642 198.778, 143 199.234, 143 196.421 C 143 193.299, 141.560 193.339, 120 197.056 M 120 207.056 C 110.925 208.621, 102.037 210.169, 100.250 210.496 C 97.628 210.976, 97 211.565, 97 213.545 C 97 216.696, 97.006 216.696, 119.347 212.983 C 144.642 208.778, 143 209.234, 143 206.421 C 143 203.299, 141.560 203.339, 120 207.056 M 118.665 217.274 C 104.510 219.695, 101.208 220.548, 102.665 221.405 C 105.278 222.943, 133.409 222.772, 138.750 221.185 C 142.509 220.069, 143 219.581, 143 216.961 C 143 214.264, 142.710 214.010, 139.750 214.112 C 137.963 214.173, 128.474 215.596, 118.665 217.274 " stroke="none" fill="black" fill-rule="evenodd"/>
    </svg>
    </a>
    <a href="javascript:dispatch('tidy');" title="tidy">
    <svg width="24" height="24" viewBox="0 0 6.3500004 6.3499998" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"> <rect x="49.384789" y="2.6351275" width="20.998407" height="33.791702" id="rect1400" /> <linearGradient id="linearGradient4589"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop4587" /> </linearGradient> <linearGradient id="linearGradient2621"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop2619" /> </linearGradient> </defs> <text xml:space="preserve" style="font-size:3.21502px;fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.608577" x="3.9980211" y="6.1156888" id="text1222" transform="scale(0.9967304,1.0032803)"><tspan id="tspan1220" style="stroke-width:0.608576" x="3.9980211" y="6.1156888" /></text> <text xml:space="preserve" style="font-size:3.21502px;fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.608577" x="4.1855493" y="5.8531489" id="text1276" transform="scale(0.9967304,1.0032803)"><tspan id="tspan1274" style="stroke-width:0.608576" x="4.1855493" y="5.8531489" /></text> <text xml:space="preserve" transform="matrix(0.26704261,0,0,0.26879745,0.10550286,0.0383962)" id="text1398" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:32px;font-family:'DejaVu Serif';-inkscape-font-specification:'DejaVu Serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;white-space:pre;shape-inside:url(#rect1400);display:inline;fill:#000000;fill-opacity:0.99;fill-rule:evenodd;stroke:none;stroke-width:2.2715" /> <path style="fill:#bfbfbf;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.406164;stroke-miterlimit:1.9;stroke-dasharray:none;stroke-opacity:1" d="M 12.674805,6.0607157 17.980066,1.9371681" id="path1036" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.33459;stroke-linecap:round" d="M 5.9412368,0.27740919 2.7769031,3.8766871" id="path376" /> <g id="g513" transform="matrix(0.7593228,0.66927923,-0.66490983,0.76431263,3.2595847,-1.062463)"> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121" d="M 1.6180093,5.8813839 C 1.6089604,5.2977285 1.5999073,4.7138044 1.8150499,4.4171789 2.0301925,4.1205533 2.4692582,4.1115005 2.6865361,4.1069766 c 0.2172778,-0.00452 0.2127478,-0.00452 0.2079568,-0.00452" id="path432" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121" d="M 4.117467,5.8813839 C 4.1265158,5.2977285 4.1355688,4.7138044 3.9204262,4.4171789 3.7052835,4.1205533 3.2662178,4.1115005 3.0489399,4.1069766 2.8316621,4.1024528 2.8361921,4.1024528 2.8409831,4.1024528" id="path436" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.250749" d="M 1.7332736,4.774652 4.0149161,4.788214" id="path496" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121" d="M 2.0728969,4.8631802 2.0593169,5.881652" id="path498" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121" d="M 2.6020636,4.8631802 2.5884836,5.881652" id="path500" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121" d="M 3.1312303,4.8631802 3.1176503,5.881652" id="path502" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121" d="M 3.660397,4.8631802 3.646817,5.881652" id="path504" /> </g> </svg>
    </a>
    <a href="javascript:dispatch('mutate2way');" title="mutate">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="order" viewBox="0 0 240 240" version="1.1">
	    <path fill-opacity="1.000" d="M 56.174 10.729 C 52.960 11.124, 52.866 11.263, 53.397 14.819 C 53.699 16.844, 54.221 20.750, 54.556 23.500 C 58.229 53.601, 66.620 79.861, 78.500 98.432 C 82.983 105.441, 94.010 116.454, 99.189 119.097 L 103.235 121.161 98.315 124.474 C 84.734 133.620, 73.667 150.693, 66.212 174 C 61.094 190.001, 54.399 226.733, 56.261 228.595 C 56.577 228.910, 58.604 229.405, 60.766 229.695 L 64.697 230.223 65.598 222.861 L 66.500 215.500 118.687 215.241 L 170.875 214.982 171.502 219.741 C 171.847 222.359, 172.373 225.795, 172.672 227.377 L 173.215 230.254 179.824 229.577 C 183.459 229.205, 186.560 228.773, 186.714 228.619 C 187.236 228.097, 184.085 206.233, 182.048 196.235 C 175.911 166.118, 166.139 144.525, 152.270 130.428 C 148.272 126.366, 143.148 122.096, 140.883 120.940 L 136.765 118.839 141.685 115.526 C 155.266 106.380, 166.333 89.307, 173.788 66 C 178.906 49.999, 185.601 13.267, 183.739 11.405 C 183.423 11.090, 181.396 10.595, 179.234 10.305 L 175.303 9.777 174.402 17.139 L 173.500 24.500 121.313 24.759 L 69.125 25.018 68.498 20.259 C 67.124 9.828, 67.206 9.984, 63.171 10.160 C 61.152 10.248, 58.003 10.504, 56.174 10.729 M 71.488 39.250 C 71.853 41.587, 72.851 46.087, 73.707 49.250 L 75.264 55 121.157 55 L 167.050 55 167.977 52.560 C 168.487 51.218, 169.547 46.718, 170.332 42.560 L 171.760 35 121.292 35 L 70.824 35 71.488 39.250 M 79.897 69.750 C 80.937 72.362, 82.826 76.868, 84.097 79.763 L 86.408 85.025 121.441 84.763 L 156.475 84.500 159.639 77 C 161.378 72.875, 163.102 68.487, 163.468 67.250 L 164.135 65 121.071 65 L 78.008 65 79.897 69.750 M 96.012 97.750 C 100.799 103.852, 109.268 109.221, 118.704 112.136 L 124.937 114.061 131.095 110.952 C 137.123 107.909, 146.207 100.350, 148.111 96.792 C 149.022 95.089, 147.692 95, 121.463 95 L 93.855 95 96.012 97.750 M 107.795 129.634 C 103.873 131.727, 98.893 135.553, 95.795 138.855 L 90.500 144.500 104.189 144.778 C 111.719 144.931, 124.284 144.931, 132.113 144.778 L 146.347 144.500 141.688 139.844 C 136.171 134.329, 129.734 130.529, 121.500 127.924 C 118.200 126.880, 115.275 126.033, 115 126.042 C 114.725 126.051, 111.483 127.667, 107.795 129.634 M 82.430 158.136 C 80.859 161.174, 76 173.557, 76 174.523 C 76 174.785, 95.348 175, 118.996 175 L 161.992 175 160.103 170.250 C 159.063 167.637, 157.176 163.137, 155.908 160.250 L 153.603 155 118.827 155 L 84.051 155 82.430 158.136 M 72.023 187.440 C 71.513 188.782, 70.453 193.282, 69.668 197.440 L 68.240 205 118.708 205 L 169.176 205 168.512 200.750 C 168.147 198.412, 167.149 193.912, 166.293 190.750 L 164.736 185 118.843 185 L 72.950 185 72.023 187.440 " stroke="none" fill="black" fill-rule="evenodd"/>
    </svg></a>

    <a href="javascript:dispatch('disrupt');" title="disrupt random">
    <svg xmlns="http://www.w3.org/2000/svg" class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1">
      <path fill-opacity="1.000" d="M 10 10 L 3 10 3 63.435 C 3 107.361, 3.270 118.152, 4.517 124.080 C 5.351 128.046, 7.203 133.439, 8.631 136.064 C 10.060 138.689, 12.976 142.601, 15.111 144.757 C 17.246 146.914, 21.231 149.896, 23.966 151.385 C 26.701 152.874, 31.990 154.738, 35.720 155.529 C 39.449 156.319, 45.733 156.973, 49.685 156.983 C 53.636 156.992, 60.114 156.317, 64.080 155.483 C 68.046 154.649, 73.439 152.797, 76.064 151.369 C 78.689 149.940, 82.601 147.024, 84.757 144.889 C 86.914 142.754, 89.896 138.769, 91.385 136.034 C 92.874 133.299, 94.738 128.010, 95.529 124.280 C 96.319 120.551, 96.973 115.160, 96.983 112.299 C 96.992 109.439, 97.493 104.800, 98.095 101.991 C 98.866 98.396, 100.273 95.754, 102.845 93.066 C 105.618 90.170, 107.779 88.977, 111.799 88.124 C 114.714 87.506, 118.404 87, 120 87 C 121.596 87, 125.200 87.493, 128.009 88.095 C 131.604 88.866, 134.246 90.273, 136.934 92.845 C 139.830 95.618, 141.023 97.779, 141.876 101.799 C 142.613 105.273, 143 122.559, 143 151.984 C 143 188.268, 143.291 198.251, 144.517 204.080 C 145.351 208.046, 147.203 213.439, 148.631 216.064 C 150.060 218.689, 152.976 222.601, 155.111 224.757 C 157.246 226.914, 161.231 229.896, 163.966 231.385 C 166.701 232.874, 171.990 234.738, 175.720 235.529 C 179.449 236.319, 185.733 236.973, 189.685 236.983 C 193.636 236.992, 200.114 236.317, 204.080 235.483 C 208.046 234.649, 213.439 232.797, 216.064 231.369 C 218.689 229.940, 222.601 227.024, 224.757 224.889 C 226.914 222.754, 229.896 218.769, 231.385 216.034 C 232.874 213.299, 234.738 208.010, 235.529 204.280 C 236.319 200.551, 236.973 195.813, 236.983 193.750 L 237 190 230.179 190 L 223.359 190 222.189 197.520 C 221.546 201.656, 220.157 206.718, 219.102 208.770 C 218.047 210.821, 215.904 213.686, 214.342 215.136 C 212.779 216.586, 210.053 218.502, 208.284 219.394 C 206.516 220.286, 201.678 221.543, 197.534 222.187 C 191.782 223.082, 188.222 223.082, 182.480 222.189 C 178.344 221.546, 173.282 220.157, 171.230 219.102 C 169.179 218.047, 166.314 215.904, 164.864 214.342 C 163.414 212.779, 161.544 210.141, 160.707 208.480 C 159.871 206.819, 158.694 202.799, 158.093 199.546 C 157.406 195.830, 157 176.938, 157 148.711 C 157 111.116, 156.744 102.800, 155.429 97.726 C 154.565 94.391, 152.486 89.567, 150.808 87.005 C 149.131 84.443, 145.676 80.935, 143.129 79.209 C 140.583 77.484, 135.818 75.381, 132.540 74.536 C 129.262 73.691, 123.702 73, 120.184 73 C 116.667 73, 111.060 73.707, 107.726 74.571 C 104.391 75.435, 99.567 77.514, 97.005 79.192 C 94.443 80.869, 90.935 84.324, 89.209 86.871 C 87.484 89.417, 85.381 94.182, 84.536 97.460 C 83.691 100.738, 83 105.718, 83 108.526 C 83 111.335, 82.509 116.289, 81.909 119.535 C 81.309 122.781, 80 127.026, 79.001 128.968 C 78.001 130.911, 75.904 133.686, 74.342 135.136 C 72.779 136.586, 70.053 138.502, 68.284 139.394 C 66.516 140.286, 61.678 141.543, 57.534 142.187 C 51.777 143.082, 48.223 143.082, 42.466 142.187 C 38.322 141.543, 33.484 140.286, 31.716 139.394 C 29.947 138.502, 27.221 136.586, 25.658 135.136 C 24.096 133.686, 21.999 130.911, 20.999 128.968 C 20 127.026, 18.691 122.781, 18.091 119.535 C 17.393 115.758, 17 94.970, 17 61.816 L 17 10 10 10 M 123.750 34.567 L 119 33.877 119 39.939 L 119 46 123.403 46 L 127.807 46 128.214 40.750 C 128.438 37.862, 128.594 35.445, 128.561 35.378 C 128.527 35.311, 126.362 34.946, 123.750 34.567 M 106.205 35.132 C 105.817 35.204, 103.925 35.545, 102 35.888 C 98.794 36.461, 98.513 36.790, 98.652 39.798 C 98.735 41.604, 99.064 44.119, 99.382 45.387 C 99.896 47.433, 100.384 47.623, 103.730 47.082 C 106.715 46.600, 107.570 45.980, 107.837 44.106 C 108.022 42.803, 107.889 40.222, 107.541 38.369 C 107.194 36.516, 106.592 35.059, 106.205 35.132 M 144.564 37.322 C 142.028 36.742, 139.796 36.544, 139.604 36.883 C 139.412 37.223, 138.951 39.598, 138.579 42.161 C 138.208 44.725, 138.263 47.035, 138.702 47.294 C 139.141 47.553, 140.960 48.078, 142.745 48.461 C 145.665 49.087, 146.098 48.873, 147.068 46.328 C 147.661 44.773, 148.377 42.347, 148.660 40.938 C 149.132 38.589, 148.792 38.289, 144.564 37.322 M 88.589 45.386 L 86.500 40.272 82.250 42.333 C 79.912 43.467, 78 44.764, 78 45.217 C 78 45.669, 79.131 47.831, 80.513 50.020 C 81.894 52.209, 83.357 53.981, 83.763 53.958 C 84.168 53.935, 85.890 53.148, 87.589 52.208 L 90.678 50.500 88.589 45.386 M 164.018 45.631 L 160.036 42.995 157.451 48.097 C 156.029 50.903, 155.008 53.300, 155.183 53.423 C 155.357 53.547, 156.922 54.629, 158.660 55.828 L 161.821 58.009 164.910 53.807 C 166.610 51.497, 168 49.304, 168 48.936 C 168 48.567, 166.208 47.080, 164.018 45.631 M 67.854 52.018 C 67.498 52.008, 65.794 53.609, 64.067 55.576 L 60.927 59.152 65.214 62.493 L 69.500 65.835 72.386 63.012 L 75.272 60.190 71.886 56.113 C 70.024 53.871, 68.209 52.028, 67.854 52.018 M 180.191 60.945 L 177.140 56.797 173.071 60.648 L 169.002 64.500 171.117 67.777 L 173.231 71.055 177.866 68.381 C 180.414 66.910, 182.667 65.569, 182.870 65.400 C 183.074 65.231, 181.868 63.226, 180.191 60.945 M 55 69.277 C 54.725 69.129, 53.659 71.053, 52.631 73.552 C 51.603 76.051, 50.928 78.234, 51.131 78.403 C 51.334 78.572, 53.714 79.449, 56.420 80.352 C 59.125 81.255, 61.389 81.883, 61.449 81.747 C 61.510 81.611, 62.293 79.882, 63.189 77.905 L 64.819 74.311 60.160 71.929 C 57.597 70.618, 55.275 69.425, 55 69.277 M 187.592 76.071 C 186.991 76.109, 184.540 77.011, 182.144 78.074 C 178.942 79.496, 177.950 80.428, 178.399 81.597 C 178.734 82.471, 179.287 84.296, 179.628 85.653 C 179.998 87.130, 180.771 87.918, 181.552 87.618 C 182.270 87.343, 184.470 86.815, 186.440 86.445 C 188.410 86.076, 190.263 85.384, 190.557 84.907 C 190.852 84.431, 190.551 82.232, 189.888 80.021 C 189.225 77.809, 188.192 76.032, 187.592 76.071 M 49.762 89.477 C 47.453 88.897, 47.249 89.165, 46.643 93.592 C 46.286 96.196, 46.159 98.492, 46.361 98.694 C 46.563 98.897, 48.973 99.328, 51.716 99.653 C 56.348 100.201, 56.748 100.075, 57.338 97.872 C 57.687 96.567, 57.979 94.544, 57.986 93.375 C 57.996 91.828, 57.215 91.093, 55.117 90.673 C 53.531 90.356, 51.121 89.818, 49.762 89.477 M 192.750 96.116 C 192.063 96.180, 190.600 96.422, 189.500 96.655 C 188.400 96.888, 186.488 97.294, 185.250 97.558 C 183.675 97.894, 183 98.758, 183 100.437 C 183 101.757, 183.273 103.548, 183.607 104.418 C 184.059 105.596, 185.623 106, 189.732 106 L 195.250 106 194.625 102.875 C 194.281 101.156, 194 98.906, 194 97.875 C 194 96.844, 193.438 96.052, 192.750 96.116 M 50.500 110 C 45.789 110, 45 110.269, 45 111.875 C 45 112.906, 44.719 115.156, 44.375 116.875 L 43.750 120 49.875 120 L 56 120 56 115 L 56 110 50.500 110 M 190 117 L 184 117 184 121.500 L 184 126 190 126 L 196 126 196 121.500 L 196 117 190 117 M 190 137 L 184 137 184 141.500 L 184 146 190 146 L 196 146 196 141.500 L 196 137 190 137 M 190 157 C 185.333 157, 184 157.333, 184 158.500 C 184 159.667, 185.333 160, 190 160 C 194.667 160, 196 159.667, 196 158.500 C 196 157.333, 194.667 157, 190 157 M 189.307 170.103 C 188.863 170.160, 186.738 170.672, 184.585 171.242 C 182.255 171.858, 178.984 173.963, 176.503 176.444 C 173.644 179.304, 171.964 182.086, 171.153 185.306 C 170.244 188.917, 170.244 191.083, 171.153 194.694 C 171.962 197.905, 173.642 200.695, 176.474 203.526 C 179.305 206.358, 182.095 208.038, 185.306 208.847 C 188.917 209.756, 191.083 209.756, 194.694 208.847 C 197.905 208.038, 200.695 206.358, 203.526 203.526 C 206.358 200.695, 208.038 197.905, 208.847 194.694 C 209.756 191.083, 209.756 188.917, 208.847 185.306 C 208.038 182.095, 206.358 179.305, 203.526 176.474 C 200.714 173.662, 197.902 171.961, 194.751 171.168 C 192.201 170.525, 189.751 170.047, 189.307 170.103 " stroke="none" fill-rule="evenodd"/>
    </svg>
    <a href="javascript:dispatch('multidisrupt');" title="multiple disrupt/mutate">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-repeat" viewBox="0 0 16 16">
      <path d="M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"/>
    </svg></a>
    <a href="javascript:dispatch('poke_acute_angles')" class="act"  title="poke acute angles">
    <svg width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:square;stroke-linejoin:round;stroke-dasharray:none" d="m 6.4084636,159.75438 c 40.1676274,0.1472 22.5227104,-0.30309 54.6470064,-0.49801 15.03911,-1.24843 33.232871,-9.20867 34.491791,-27.42363 1.07418,-20.23724 0.59995,-18.88272 0,-27.58191 -0.90408,-15.909323 0.70307,-18.151657 24.423359,-18.552662 25.09722,0.167055 26.34836,0.265092 47.87377,0 9.48317,-9.912701 8.93762,-21.861009 -1.5556,-30.029279 -25.17336,-1.112562 -30.77469,0.06028 -62.32313,0 -67.827858,-0.454079 -37.063487,-0.749523 -98.0631534,0" id="path625" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 192.22621,97.539499 27.00624,19.348261" id="path1183" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="M 192.22621,43.181282 219.23245,23.833021" id="path1185" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 199.08013,71.072174 33.2191,-0.427539" id="path1187" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="M 195.51998,150.79007 92.769594,211.8324 H 207.14202" id="path1283" /> </svg>
    </a>
    </span>
    <input type="file" id="fileInput" style="display:none;">
  <!--span class="grouping">
    <label for="search">run </label><select id="search">
      <option >nearest_first_n</option>
      <option >nearest_far_n</option>
      <option>twoway_n</option>
      <option >anneal</option>
      <option selected>brute_force</option>
    </select>
    <a href="javascript:runsearch();" title="search for path">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-play" viewBox="0 0 16 16">
    <path d="M10.804 8 5 4.633v6.734zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696z"/>
    </svg>
    </a>
    </span-->
    <br>
    <!--span class="grouping">
    <!--a href="javascript:topology(true)" class="act"  title="topology">
      <svg width="24" height="24" viewBox="0 0 10.583334 10.583333" version="1.1" id="svg5" inkscape:version="1.2.2 (b0a8486541, 2022-12-01)" sodipodi:docname="top.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview7" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" inkscape:document-units="mm" showgrid="false" inkscape:zoom="6.8132435" inkscape:cx="30.015073" inkscape:cy="23.777221" inkscape:window-width="1280" inkscape:window-height="648" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="layer1" /> <defs id="defs2"> <inkscape:path-effect effect="bspline" id="path-effect20051" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect19268" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect19264" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect19260" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect19202" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect18427" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect18423" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect18411" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect18407" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect16122" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect16118" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="spiro" id="path-effect14662" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="bspline" id="path-effect14654" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect14650" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect14646" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect11646" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect11642" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect11638" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect11634" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect11630" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect11626" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="spiro" id="path-effect4711" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="bspline" id="path-effect4651" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <linearGradient id="linearGradient4589" inkscape:swatch="solid"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop4587" /> </linearGradient> <linearGradient id="linearGradient2621" inkscape:swatch="solid"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop2619" /> </linearGradient> <inkscape:path-effect effect="bspline" id="path-effect2586" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect2582" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect2578" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="spiro" id="path-effect2574" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2570" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2566" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2562" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2558" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2558-3" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2562-6" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2566-7" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2570-5" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="spiro" id="path-effect2574-3" is_visible="true" lpeversion="1" /> <inkscape:path-effect effect="bspline" id="path-effect2578-5" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="bspline" id="path-effect2582-6" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> <inkscape:path-effect effect="spiro" id="path-effect4711-2" is_visible="true" lpeversion="1" /> </defs> <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(0.70652757,0.64974422)"> <circle style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.605;stroke-dasharray:none" id="path18403" cx="5.8693871" cy="3.0228522" r="4.979939" transform="rotate(18.131126)" /> <path style="fill:#bfbfbf;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.601001;stroke-dasharray:none" d="M 1.1681647,1.5408501 C 1.6700398,1.3010721 2.2852475,1.3520237 2.5826629,1.5750628 2.8800783,1.798102 2.8597741,2.1928462 2.6860713,2.5091168 2.5123684,2.8253874 2.1854242,3.0634197 2.0970338,3.3398842 2.0086434,3.6163487 2.158495,3.9310339 2.2257747,4.3293643 2.2930545,4.7276947 2.2779207,5.2095853 2.0894011,5.644835 1.9008816,6.0800846 1.539155,6.4688512 1.1728272,6.5561432 0.80649939,6.6434352 0.43524485,6.4293443 0.18642821,6.1424991 -0.06238843,5.855654 -0.18868161,5.4958447 -0.21775212,4.9334872 -0.24682263,4.3711298 -0.1785181,3.606234 0.04972981,2.9585655 0.27797771,2.310897 0.66628958,1.7806281 1.1681647,1.5408501 Z" id="path19258" inkscape:path-effect="#path-effect19260" inkscape:original-d="M 1.0547795,1.2501161 C 1.6700094,1.3014393 2.2852169,1.3523929 2.9004023,1.4029709 2.880117,1.798104 2.859816,2.1928484 2.8394887,2.5872268 2.512554,2.8256423 2.1856096,3.0636744 1.8586367,3.301338 2.0085166,3.6164091 2.1583683,3.9310942 2.3082005,4.2454122 2.2930885,4.7276958 2.2779548,5.2095864 2.2627984,5.6911134 1.9010803,6.0802695 1.539354,6.4690364 1.1775976,6.8574361 0.80634331,6.6437059 0.43508872,6.429615 0.06379062,6.2151381 -0.06248543,5.855688 -0.18877861,5.4958787 -0.31509695,5.1356873 -0.24676764,4.3711347 -0.17846294,3.6062389 -0.11017931,2.8409545 0.27817019,2.311038 0.66648206,1.7807691 1.0547795,1.2501161 Z" sodipodi:nodetypes="ccccccccccc" /> <path style="fill:#bfbfbf;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.601001;stroke-dasharray:none" d="M 7.2426179,0.81528306 C 6.6067744,0.65467963 5.7055134,0.6052955 5.14358,0.88315851 4.5816467,1.1610215 4.3594182,1.7659772 4.4151078,2.3216443 4.4707973,2.8773114 4.8041403,3.3834988 5.1806168,3.4574102 5.5570934,3.5313216 5.9768504,3.1732936 6.3226773,3.1240463 6.6685042,3.074799 6.9401169,3.3340659 6.8782359,3.6981692 6.8163549,4.0622725 6.4212896,4.5314129 6.3905425,4.9945446 6.3597953,5.4576762 6.6931314,5.9144701 6.9584493,5.9760933 7.2237671,6.0377165 7.4212999,5.7043807 7.6807552,5.574738 7.9402105,5.4450953 8.2612005,5.51917 8.3536231,5.8649355 8.4460456,6.210701 8.3102422,6.8279901 8.48314,6.9636858 8.6560377,7.0993815 9.1375333,6.7536925 9.4091197,6.0994709 9.680706,5.4452493 9.7424364,4.4822586 9.5758579,3.66743 9.4092794,2.8526013 9.014206,2.1859155 8.6315242,1.7167074 8.2488424,1.2474994 7.8784615,0.97588649 7.2426179,0.81528306 Z" id="path19266" inkscape:path-effect="#path-effect19268" inkscape:original-d="M 7.5077749,0.70404949 C 6.6067607,0.65492897 5.7054997,0.60554484 4.8039383,0.55589416 4.5819655,1.1611386 4.359737,1.7660943 4.1372394,2.3707976 4.4708604,2.8772699 4.8042034,3.3834573 5.1372884,3.8893903 5.5573354,3.5316054 5.9770925,3.1735774 6.3966101,2.8152635 6.6684981,3.0748053 6.9401108,3.3340722 7.2114643,3.5930797 6.81664,4.0625127 6.4215748,4.5316531 6.0262215,5.0005566 6.359842,5.4576421 6.6931781,5.914436 7.0262696,6.3709927 7.224079,6.0379013 7.4216118,5.7045655 7.618892,5.3709449 7.940166,5.4452886 8.2611559,5.5193632 8.5819006,5.5931778 8.4463535,6.2107687 8.3105501,6.8280579 8.1744738,7.4451195 8.6562531,7.0996814 9.1377487,6.7539924 9.618989,6.4080321 9.6809864,5.4452673 9.7427169,4.4822766 9.8041838,3.519002 9.4093591,2.8525541 9.0142859,2.1858682 8.6189399,1.5189044 8.2488087,1.2475453 7.8784278,0.97593239 7.5077749,0.70404949 Z" sodipodi:nodetypes="ccccccccccccccc" /> <path style="fill:#bfbfbf;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.601001;stroke-dasharray:none" d="M 5.3898896,6.7659753 C 5.5235282,7.0849228 5.6106992,7.5591147 5.4532411,7.8914865 5.2957831,8.2238583 4.8939089,8.4140994 4.4171651,8.495556 3.9404213,8.5770127 3.3889603,8.5498098 3.1584295,8.2398717 2.9278987,7.9299337 3.0179391,7.3373481 3.2851722,7.0713846 3.5524053,6.8054212 3.9971844,6.8660577 4.295482,6.7619542 4.5937797,6.6578506 4.7452465,6.3889212 4.9108088,6.3361455 5.0763711,6.2833698 5.256251,6.4470278 5.3898896,6.7659753 Z" id="path20049" inkscape:path-effect="#path-effect20051" inkscape:original-d="M 5.4363927,6.6109241 C 5.5232149,7.0849804 5.6103859,7.5591723 5.6979057,8.0334996 5.2956662,8.2236114 4.8937928,8.4138541 4.4922589,8.6042343 3.9404271,8.5768944 3.3889661,8.5496915 2.8378425,8.5226237 2.9275376,7.9298788 3.0175781,7.3372932 3.107969,6.7448314 3.5524171,6.8053347 3.9971962,6.8659711 4.4423327,6.9267446 4.5934571,6.6576689 4.7449238,6.3887394 4.8967424,6.1199403 c 0.1795382,0.163529 0.3594181,0.327187 0.5396503,0.4909838 z" /> </g>
      </svg>
     </a>
     <a href="javascript:showRings()" class="act"  title="rings">
     <svg width="24" height="24" viewBox="0 0 6.3500004 6.3499998" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"> <rect x="49.384789" y="2.6351275" width="20.998407" height="33.791702" id="rect1400" /> <linearGradient id="linearGradient4589"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop4587" /> </linearGradient> <linearGradient id="linearGradient2621"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop2619" /> </linearGradient> </defs> <text xml:space="preserve" style="font-size:3.46038px;fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.655021;stroke-linecap:square" x="3.8287318" y="5.5606661" id="text1222"><tspan id="tspan1220" style="stroke-width:0.65502;stroke-linecap:square" x="3.8287318" y="5.5606661" /></text> <text xml:space="preserve" style="font-size:3.46038px;fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.02645833;stroke-linecap:square;stroke-dasharray:none" x="4.0305715" y="5.278091" id="text1276"><tspan id="tspan1274" style="stroke-width:0.02645833;stroke-linecap:square;stroke-dasharray:none" x="4.0305715" y="5.278091" /></text> <text xml:space="preserve" transform="matrix(0.2883649,0,0,0.2883649,-0.36047298,-0.98055192)" id="text1398" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:32px;font-family:'DejaVu Serif';-inkscape-font-specification:'DejaVu Serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;white-space:pre;shape-inside:url(#rect1400);display:inline;fill:#000000;fill-opacity:0.99;fill-rule:evenodd;stroke:none;stroke-width:2.2715;stroke-linecap:square" /> <path id="path3308" style="fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.47;stroke-linecap:square;stroke-dasharray:none" d="M 1.852623,0.36708698 A 1.5752364,1.5752364 0 0 0 0.27700851,1.9421847 1.5752364,1.5752364 0 0 0 1.5963078,3.496095 1.5752364,1.5752364 0 0 0 1.214419,4.522389 1.5752364,1.5752364 0 0 0 2.7895167,6.0980034 1.5752364,1.5752364 0 0 0 4.3594467,4.6500298 1.5752364,1.5752364 0 0 0 4.5139593,4.658298 1.5752364,1.5752364 0 0 0 6.0890569,3.0832003 1.5752364,1.5752364 0 0 0 4.5139593,1.5081026 1.5752364,1.5752364 0 0 0 3.4277206,1.9432182 a 1.5752364,1.5752364 0 0 0 0,-0.00103 A 1.5752364,1.5752364 0 0 0 1.852623,0.36708698 Z" /> </svg>   
     </a>
    <a href="javascript:allConnections(true)" title="connections">
    <svg width="24" height="24" viewBox="0 0 6.3500004 6.3499998" version="1.1" id="svg5" sodipodi:docname="cons.svg" inkscape:version="1.2.2 (b0a8486541, 2022-12-01)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview204" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" showgrid="false" inkscape:zoom="19.916667" inkscape:cx="8.7112971" inkscape:cy="5.7740586" inkscape:window-width="1280" inkscape:window-height="648" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg5" /> <defs id="defs2"> <rect x="49.384789" y="2.6351275" width="20.998407" height="33.791702" id="rect1400" /> <linearGradient id="linearGradient4589"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop4587" /> </linearGradient> <linearGradient id="linearGradient2621"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop2619" /> </linearGradient> </defs> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.39687501;stroke-dasharray:none" d="M 3.5429688,1.7949219 1.2910156,3.4863281 1.4570312,3.7050781 3.3574219,2.2773438 3.71875,4.1621094 3.9882813,4.1113281 Z" id="path323" /> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.39687501;stroke-dasharray:none" d="M 1.2363281,1.1035156 V 3.6953125 L 3.7753906,4.1796875 3.8261719,3.9101563 1.5097656,3.46875 V 1.4863281 L 3.3808594,2.125 3.46875,1.8671875 Z" id="path329" /> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.39687501;stroke-dasharray:none" d="M 3.6152344,0.27734375 3.265625,2.0351563 3.5332031,2.0878906 3.8828125,0.33007813 Z" id="path333" /> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.396875;stroke-dasharray:none" d="M 1.3808594,3.5527344 1.1855469,3.7441406 3.09375,5.6875 3.2383804,5.4454116 Z" id="path335" sodipodi:nodetypes="ccccc" /> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.396875;stroke-dasharray:none" d="M 3.71875,4.0478265 3.0175781,5.3954828 3.1710721,5.6725295 3.9609375,4.1728265 Z" id="path337" sodipodi:nodetypes="ccccc" /> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.39687501;stroke-dasharray:none" d="M 3.5585938,1.9570312 3.421875,2.1933594 5.5019531,3.3925781 3.8730469,3.96875 3.9628906,4.2265625 6.1523437,3.453125 Z" id="path339" /> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.39687501;stroke-dasharray:none" d="M 0.62304687,0.16601562 0.41015625,0.33789063 1.2929687,1.4335937 1.5058594,1.2617187 Z" id="path341" /> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.396875;stroke-dasharray:none" d="M 1.21875,3.6416266 0.40820313,6.0283453 3.1825922,5.6845953 3.1347656,5.4131109 0.80859375,5.7021734 1.4765625,3.7295172 Z" id="path343" sodipodi:nodetypes="ccccccc" /> <path style="color:#000000;fill:#000000;fill-rule:evenodd;stroke-width:0.39687501;stroke-dasharray:none" d="m 3.9335938,4.0761719 -0.1875,0.1972656 1.8691406,1.7714844 0.1875,-0.1972657 z" id="path345" /> </svg>    </a>
     </a>
    <a href="javascript:uncross_segments()" title="prune segemnts">
    <svg width="24" height="24" viewBox="0 0 6.3500004 6.3499998" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"> <rect x="49.384789" y="2.6351275" width="20.998407" height="33.791702" id="rect1400" /> <linearGradient id="linearGradient4589"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop4587" /> </linearGradient> <linearGradient id="linearGradient2621"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop2619" /> </linearGradient> </defs> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121;stroke-linecap:round" d="M 3.0438696,6.1498351 3.0302906,1.600661" id="path354" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121;stroke-linecap:round" d="M 3.0438704,1.6549795 3.7771699,0.2970169" id="path356" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121;stroke-linecap:round" d="M 3.0167102,1.6006608 2.2562516,0.28343726" id="path358" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121;stroke-linecap:round" d="M 3.1253472,3.5968658 3.8858068,2.9043046" id="path360" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121;stroke-linecap:round" d="M 4.917858,2.0080496 5.7869544,1.2204317" id="path362" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121;stroke-linecap:round" d="M 3.0438699,4.6153378 1.4278946,2.9586233 1.4414744,1.5870809" id="path364" /> <path style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.247121;stroke-linecap:round" d="M 1.4957925,3.0401012 0.36868384,1.9944697" id="path366" /> <path id="rect574" style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.34541;stroke-linecap:round" d="M 6.0055979,3.2511781 C 5.0336706,4.1443333 6.0064947,3.2836968 5.010724,4.1755255 L 4.7798306,2.8928033 Z" /> </svg>    </a>
  
   
    <a href="javascript:findPaths()" title="find paths">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-compass" viewBox="0 0 16 16">
      <path d="M8 16.016a7.5 7.5 0 0 0 1.962-14.74A1 1 0 0 0 9 0H7a1 1 0 0 0-.962 1.276A7.5 7.5 0 0 0 8 16.016m6.5-7.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0"/>
      <path d="m6.94 7.44 4.95-2.83-2.83 4.95-4.949 2.83 2.828-4.95z"/>
    </svg>
    </a>
    <a href="javascript:dispatch('findAllSpurs')" title="find spurs">
    <svg width="24" height="24" viewBox="0 0 6.3500004 6.3499998" version="1.1" id="svg5" sodipodi:docname="spurs.svg" inkscape:version="1.2.2 (b0a8486541, 2022-12-01)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview150" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" showgrid="false" inkscape:zoom="18.583333" inkscape:cx="12.538117" inkscape:cy="9.6860988" inkscape:window-width="1280" inkscape:window-height="652" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg5" /> <defs id="defs2"> <rect x="49.384789" y="2.6351275" width="20.998407" height="33.791702" id="rect1400" /> <linearGradient id="linearGradient4589"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop4587" /> </linearGradient> <linearGradient id="linearGradient2621"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop2619" /> </linearGradient> </defs> <g id="g1906"> <text xml:space="preserve" style="font-size:3.46038px;fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.655021;stroke-linecap:square" x="3.9102094" y="5.6693034" id="text1222"><tspan id="tspan1220" style="stroke-width:0.65502;stroke-linecap:square" x="3.9102094" y="5.6693034" /></text> <text xml:space="preserve" style="font-size:3.46038px;fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.655021;stroke-linecap:square" x="4.1120491" y="5.3867283" id="text1276"><tspan id="tspan1274" style="stroke-width:0.65502;stroke-linecap:square" x="4.1120491" y="5.3867283" /></text> <text xml:space="preserve" transform="matrix(0.2883649,0,0,0.2883649,-0.27899526,-0.87191453)" id="text1398" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:32px;font-family:'DejaVu Serif';-inkscape-font-specification:'DejaVu Serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;white-space:pre;shape-inside:url(#rect1400);display:inline;fill:#000000;fill-opacity:0.99;fill-rule:evenodd;stroke:none;stroke-width:2.2715;stroke-linecap:square" /> <path style="fill:#b3b3b3;fill-rule:evenodd;stroke-width:0.423966;stroke-linecap:square" d="m 4.9845306,2.7618291 0.014802,0.014798" id="path1064" /> <path style="fill:#b3b3b3;fill-rule:evenodd;stroke:#000000;stroke-width:0.430365;stroke-linecap:square;stroke-opacity:1" d="M 0.35526714,3.2080463 6.0173461,3.1848457" id="path1794" /> <path style="fill:#b3b3b3;fill-rule:evenodd;stroke:#000000;stroke-width:0.430365;stroke-linecap:square;stroke-opacity:1" d="m 3.1747063,0.36540654 0.0232,5.66207896" id="path1796" /> <path style="fill:#b3b3b3;fill-rule:evenodd;stroke:#000000;stroke-width:0.430365;stroke-linecap:square;stroke-opacity:1" d="M 1.1774262,1.201623 5.1951868,5.1912691" id="path1802" /> <path style="fill:#b3b3b3;fill-rule:evenodd;stroke:#000000;stroke-width:0.430365;stroke-linecap:square;stroke-opacity:1" d="M 5.1811296,1.1875658 1.1914833,5.2053262" id="path1804" /> </g> </svg>
    </a>
    </span-->
    
    <span class="grouping">
    <a href="javascript:cluster();" title="cluster">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-arrows-angle-contract" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M.172 15.828a.5.5 0 0 0 .707 0l4.096-4.096V14.5a.5.5 0 1 0 1 0v-3.975a.5.5 0 0 0-.5-.5H1.5a.5.5 0 0 0 0 1h2.768L.172 15.121a.5.5 0 0 0 0 .707M15.828.172a.5.5 0 0 0-.707 0l-4.096 4.096V1.5a.5.5 0 1 0-1 0v3.975a.5.5 0 0 0 .5.5H14.5a.5.5 0 0 0 0-1h-2.768L15.828.879a.5.5 0 0 0 0-.707"/>
    </svg></a>
    <a href="javascript:popClusters();" title="uncluster">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-arrows-angle-expand" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707m4.344-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707"/></svg>
    </a>
    <a href="javascript:clusterbyvoids()" title="show clusters">
    <svg width="24" height="24" viewBox="0 0 6.3500004 6.3499998" version="1.1" id="svg5" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2"> <rect x="49.384789" y="2.6351275" width="20.998407" height="33.791702" id="rect1400" /> <linearGradient id="linearGradient4589"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop4587" /> </linearGradient> <linearGradient id="linearGradient2621"> <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop2619" /> </linearGradient> </defs> <text xml:space="preserve" style="font-size:3.175px;fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.601001" x="3.8437192" y="6.0017614" id="text1222"><tspan id="tspan1220" style="stroke-width:0.601" x="3.8437192" y="6.0017614" /></text> <text xml:space="preserve" style="font-size:3.175px;fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.601001" x="4.028913" y="5.7424903" id="text1276"><tspan id="tspan1274" style="stroke-width:0.601" x="4.028913" y="5.7424903" /></text> <text xml:space="preserve" transform="scale(0.26458333)" id="text1398" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:32px;font-family:'DejaVu Serif';-inkscape-font-specification:'DejaVu Serif, Normal';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;white-space:pre;shape-inside:url(#rect1400);display:inline;fill:#000000;fill-opacity:0.99;fill-rule:evenodd;stroke:none;stroke-width:2.2715" /> <path style="fill:#bfbfbf;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.401108;stroke-miterlimit:1.9;stroke-dasharray:none;stroke-opacity:1" d="M 12.453548,5.9279034 17.709951,1.8690035" id="path1036" /> <rect style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.3;stroke-dasharray:none" id="rect305" width="1.2629052" height="1.2764845" x="0.40976095" y="1.8500117" /> <rect style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.3;stroke-dasharray:none" id="rect971" width="2.0632241" height="2.0854084" x="1.4793828" y="3.9539714" /> <rect style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.24712084;stroke-dasharray:none" id="rect310" width="0.64283109" height="0.64974302" x="2.785094" y="0.29677078" /> <rect style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.3;stroke-dasharray:none" id="rect301" width="1.2629052" height="1.2764845" x="4.5530233" y="1.4318842" /> <rect style="fill:none;fill-opacity:0.99;fill-rule:evenodd;stroke:#000000;stroke-width:0.24712084;stroke-dasharray:none" id="rect303" width="0.64283109" height="0.64974302" x="5.0277777" y="4.4146924" /> </svg>
    </a>
    <a href="javascript:voidcost();" title="voids">
    <svg width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <circle style="fill:#d4aa00;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square" id="circle429" cx="182.76497" cy="149.87422" r="25.93446" /> <circle style="fill:#d4aa00;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square" id="circle431" cx="123.69202" cy="149.87422" r="25.93446" /> <circle style="fill:#d4aa00;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square" id="circle433" cx="64.619095" cy="149.87422" r="25.93446" /> <circle style="fill:#d4aa00;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square" id="circle469" cx="150.03815" cy="207.6575" r="25.93446" /> <circle style="fill:#9e841b;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square;fill-opacity:1" id="circle471" cx="90.965202" cy="207.6575" r="25.93446" /> <circle style="fill:#5f6836;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square;fill-opacity:1" id="circle475" cx="209.11108" cy="207.6575" r="25.93446" /> <circle style="fill:#d4aa00;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square" id="circle479" cx="150.03815" cy="92.090935" r="25.93446" /> <circle style="fill:#5f6836;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square;fill-opacity:1" id="circle483" cx="31.892271" cy="92.090935" r="25.93446" /> <circle style="fill:#d4aa00;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square" id="circle485" cx="209.11108" cy="92.090935" r="25.93446" /> <circle style="fill:#214c52;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square;fill-opacity:1" id="circle491" cx="62.329231" cy="34.307644" r="25.93446" /> <circle style="fill:#5f6836;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square;fill-opacity:1" id="circle495" cx="180.47511" cy="34.307644" r="25.93446" /> </svg> 
    </a>
  <a href="javascript:voidcost_inverted();" title="voids (inverted)">
  <svg width="24" height="24" class="invert" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <g id="g566" transform="matrix(1.0267857,0,0,1.0267857,-3.2277417,0.28710479)" style="fill:#000000;fill-opacity:1"> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle429" cx="181.14073" cy="145.68484" r="25.25791" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle431" cx="123.60882" cy="145.68484" r="25.25791" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle433" cx="66.07692" cy="145.68484" r="25.25791" /> </g> <g id="g571" transform="matrix(1.0267857,0,0,1.0267857,-3.2277417,-4.8264679)" style="fill:#ffffff;fill-opacity:1"> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle469" cx="149.26765" cy="206.94092" r="25.25791" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle471" cx="91.735741" cy="206.94092" r="25.25791" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle475" cx="206.79956" cy="206.94092" r="25.25791" /> </g> <g id="g561" transform="matrix(1.0267857,0,0,1.0267857,-3.2277417,-1.2469675)" style="fill:#ffffff;fill-opacity:1"> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle479" cx="149.26765" cy="90.903" r="25.25791" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle483" cx="34.203838" cy="90.903" r="25.25791" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle485" cx="206.79956" cy="90.903" r="25.25791" /> </g> <g id="g556" transform="matrix(1.0267857,0,0,1.0267857,-3.2277417,-4.8264679)" style="fill:#ffffff;fill-opacity:1"> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle491" cx="63.84679" cy="38.113224" r="25.25791" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:10.8054;stroke-linecap:square;fill-opacity:1" id="circle495" cx="178.91061" cy="38.113224" r="25.25791" /> </g> </svg>     
  </a>
      <!--a href="javascript:crossings_bw();" title="crossings">
<svg class="invert" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <path id="rect1213" style="fill:#ffffff;fill-rule:evenodd;stroke-width:1.91922;stroke-linecap:square;fill-opacity:1" d="M 4.5298585,4.4859958 H 63.477084 V 61.433226 h 56.841676 l 0.94723,-56.9472302 h 56.94722 l -0.10555,56.9472302 h 58 v 57.894454 l -58,-0.10555 c 0.46286,57.42766 0,115.89445 0,115.89445 l -56.84167,-0.94723 -0.94723,-56.94722 H 63.477084 v 56.94722 L 4.5298585,235.11658 V 177.22213 H 63.544847 l -0.747023,-58.82825 -58.2679655,0.9338 V 61.433226 Z" /> </svg>     
</a-->   
<!--a href="javascript:pruneByCost()" title="prune">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-scissors" viewBox="0 0 16 16">
     <path d="M3.5 3.5c-.614-.884-.074-1.962.858-2.5L8 7.226 11.642 1c.932.538 1.472 1.616.858 2.5L8.81 8.61l1.556 2.661a2.5 2.5 0 1 1-.794.637L8 9.73l-1.572 2.177a2.5 2.5 0 1 1-.794-.637L7.19 8.61zm2.5 10a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0m7 0a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
    </svg></a-->
    
    <input type="number" value="15" id="voidsize" class="number" title="void size" min="10" max="150">
    </span>
     <br>
  <span class="grouping">
  <a href="javascript:findPoint();" title="find point">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-search" viewBox="0 0 16 16">
  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
  </svg></a>
  <input type="number" id="findpoint" value="0" class="number" min="0" onblur="findPoint()">
  <!--a href="javascript:dispatch('poke_point')" class="act"  title="poke point">
  <svg width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:square;stroke-linejoin:round;stroke-dasharray:none" d="m 6.4084636,159.75438 c 40.1676274,0.1472 22.5227104,-0.30309 54.6470064,-0.49801 15.03911,-1.24843 33.232871,-9.20867 34.491791,-27.42363 1.07418,-20.23724 0.59995,-18.88272 0,-27.58191 -0.90408,-15.909323 0.70307,-18.151657 24.423359,-18.552662 25.09722,0.167055 26.34836,0.265092 47.87377,0 9.48317,-9.912701 8.93762,-21.861009 -1.5556,-30.029279 -25.17336,-1.112562 -30.77469,0.06028 -62.32313,0 -67.827858,-0.454079 -37.063487,-0.749523 -98.0631534,0" id="path625" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 192.22621,97.539499 27.00624,19.348261" id="path1183" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="M 192.22621,43.181282 219.23245,23.833021" id="path1185" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 199.08013,71.072174 33.2191,-0.427539" id="path1187" /> </svg>
  </a-->

<!--a href="javascript:bullseye()" class="act"  title="bullseye macro">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-bullseye" viewBox="0 0 16 16">
  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
  <path d="M8 13A5 5 0 1 1 8 3a5 5 0 0 1 0 10m0 1A6 6 0 1 0 8 2a6 6 0 0 0 0 12"/>
  <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8"/>
  <path d="M9.5 8a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
</svg></a>
<a href="javascript:showMarked()" class="act"  title="show marked">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-check-circle" viewBox="0 0 16 16">
  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
  <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
</svg></a-->

 <!--a href="javascript:dispatch('poke_voids')" class="act"  title="poke voids">
<svg width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <circle style="fill:#d4aa00;fill-rule:evenodd;stroke-width:11.0948;stroke-linecap:square" id="circle469" cx="160.99452" cy="192.71701" r="25.93446" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:square;stroke-linejoin:round;stroke-dasharray:none" d="m 6.578105,168.5235 c 40.167628,0.1472 22.522711,-0.30309 54.647007,-0.498 15.03911,-1.24844 33.232871,-9.20868 34.491791,-27.42364 1.07418,-20.23724 0.59995,-18.88272 0,-27.5819 -0.90408,-15.909326 0.70307,-18.151656 24.423367,-18.552666 25.09722,0.16706 26.34836,0.2651 47.87377,0 9.48317,-9.9127 8.93762,-21.861006 -1.5556,-30.029276 -25.17336,-1.112562 -30.77469,0.06028 -62.32313,0 -67.827866,-0.454079 -37.063495,-0.749523 -98.063162,0" id="path625" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 192.39586,106.30862 27.00624,19.34827" id="path1183" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="M 192.39586,51.950411 219.4021,32.60215" id="path1185" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:11.5276;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 199.24978,79.841303 33.2191,-0.427539" id="path1187" /> </svg>
</a-->
</span>
<span class="grouping">
<a href="javascript:hidePath()" class="act"  title="show/hide path">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-eye-slash" viewBox="0 0 16 16">
      <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z"/>
      <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829"/>
      <path d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z"/>
    </svg>
    </a>  
     </span>

  <span class="grouping">
    <a href="javascript:crossings_bw();" title="add guide points">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-node-plus" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M11 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8M6.025 7.5a5 5 0 1 1 0 1H4A1.5 1.5 0 0 1 2.5 10h-1A1.5 1.5 0 0 1 0 8.5v-1A1.5 1.5 0 0 1 1.5 6h1A1.5 1.5 0 0 1 4 7.5zM11 5a.5.5 0 0 1 .5.5v2h2a.5.5 0 0 1 0 1h-2v2a.5.5 0 0 1-1 0v-2h-2a.5.5 0 0 1 0-1h2v-2A.5.5 0 0 1 11 5M1.5 7a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
  </svg></a>

  <a href="javascript:removeGuidePoints()" class="act"  title="remove guide points">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-node-minus" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M11 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8M6.025 7.5a5 5 0 1 1 0 1H4A1.5 1.5 0 0 1 2.5 10h-1A1.5 1.5 0 0 1 0 8.5v-1A1.5 1.5 0 0 1 1.5 6h1A1.5 1.5 0 0 1 4 7.5zM1.5 7a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM8 8a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5A.5.5 0 0 1 8 8"/>
</svg></a>
  </span>
  <br>
  <span class="grouping">
    <a href="javascript:dispatch('simplify180')" class="act"  title="simplify 180ish">
    <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923"> <marker style="overflow:visible" id="TriangleStart" refX="0" refY="0" orient="auto-start-reverse" markerWidth="5.3244081" markerHeight="6.155385" viewBox="0 0 5.3244081 6.1553851" preserveAspectRatio="xMidYMid"> <path transform="scale(0.5)" style="fill:context-stroke;fill-rule:evenodd;stroke:context-stroke;stroke-width:1pt" d="M 5.77,0 -2.88,5 V -5 Z" id="path135" /> </marker> </defs> <path style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.96675;stroke-linecap:square;stroke-dasharray:none;stroke-opacity:1" d="m 235.0196,183.14427 c -76.65698,0.1615 -153.31549,0.32301 -229.9755715,0.48452" id="path903" /> <g id="g884" transform="translate(-1.4940592,0.4980306)"> <circle style="fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:6.46299;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1" id="path961" cx="123.27134" cy="182.8885" r="23.573496" /> <circle style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:21.5664;stroke-linecap:round;stroke-dasharray:none" id="circle1497" cx="35.122368" cy="182.8885" r="23.573496" /> <circle style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:21.5664;stroke-linecap:round;stroke-dasharray:none" id="circle1499" cx="211.42032" cy="182.8885" r="23.573496" /> </g> <path style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:15.2968;stroke-linecap:square;stroke-linejoin:round;stroke-opacity:1" d="M 170.62304,28.940865 76.164809,136.19473" id="path1852" /> <path style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:15.2968;stroke-linecap:square;stroke-linejoin:round;stroke-opacity:1" d="M 170.12252,136.76914 76.665336,28.366437" id="path1868" /> </svg>   </a>
    <a href="javascript:distributePoints()" class="act"  title="map to distribute">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-pin-map" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M3.1 11.2a.5.5 0 0 1 .4-.2H6a.5.5 0 0 1 0 1H3.75L1.5 15h13l-2.25-3H10a.5.5 0 0 1 0-1h2.5a.5.5 0 0 1 .4.2l3 4a.5.5 0 0 1-.4.8H.5a.5.5 0 0 1-.4-.8z"/>
      <path fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999z"/>
    </svg></a>
    <a href="javascript:maptoOffsetgrid()" class="act"  title="map to grid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-map" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.5.5 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103M10 1.91l-4-.8v12.98l4 .8zm1 12.98 4-.8V1.11l-4 .8zm-6-.8V1.11l-4 .8v12.98z"/>
    </svg></a>
    <a href="javascript:dispatch('smooth_5pt')" class="act"  title="smooth">
    <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <path id="path346" style="fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:13.0016;stroke-linecap:square;stroke-dasharray:none;stroke-opacity:1" d="M 215.83895,101.66035 C 203.03218,77.92424 190.22513,54.187661 177.80178,30.450595 165.37842,54.187666 152.57138,77.924248 139.9525,101.66035 127.33362,77.924238 114.52658,54.187665 101.3562,30.450595 88.185813,54.187663 75.378774,77.92425 62.759895,101.66035 50.141015,77.92424 37.333974,54.187662 24.526675,30.450594" /> <path id="path1128" style="fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:13.0016;stroke-linecap:round;stroke-dasharray:none;stroke-opacity:1" d="m 218.82705,197.20023 c -28.24528,0.66669 -11.66936,-27.89137 -38.03718,-28.22165 -32.34402,0.33027 -12.28195,27.89236 -42.58044,28.22165 -27.31037,-0.32934 -12.95668,-27.99538 -41.335409,-28.22165 -29.604956,0.82829 -12.530972,26.89629 -39.592317,28.22165 -29.053449,0.16871 -9.98742,-26.39733 -31.759017,-28.22165" /> </svg>
      </a>
    <a href="javascript:dispatch('polar')" class="act"  title="polar">
    <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <circle style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:13.0016;stroke-linecap:square" id="path347" cx="119.3989" cy="122.65215" r="84.662865" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:13.0016;stroke-linecap:square" d="M 220.63371,26.253759 V 219.05053" id="path476" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:13.0016;stroke-linecap:square" d="M 17.940888,26.253767 V 219.05052" id="path478" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:13.0016;stroke-linecap:square" d="m 19.546533,122.65214 c 66.578245,0 133.136487,0 199.704737,0" id="path538" /> </svg>
    </a>
    <a href="javascript:unmap()" class="act"  title="unmap">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" id="invert" class="invert" viewBox="0 0 16 16">
      <path d="M7.729 5.055a.5.5 0 0 0-.52.038l-3.5 2.5a.5.5 0 0 0 0 .814l3.5 2.5A.5.5 0 0 0 8 10.5V8.614l3.21 2.293A.5.5 0 0 0 12 10.5v-5a.5.5 0 0 0-.79-.407L8 7.386V5.5a.5.5 0 0 0-.271-.445"/>
      <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8"/>
    </svg></a>
     </span>
    <br>
  <span class="grouping">
    <!--a href="javascript:find_invags();" title="find invaginations">
   <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:17.0079;stroke-linecap:round;stroke-linejoin:miter;stroke-dasharray:none" d="m 51.758144,27.997441 c 17.130367,1.797647 20.919997,11.027277 28.483512,34.983146 8.370272,31.999762 0.171289,61.253473 40.706124,63.094553 38.03077,-3.97124 27.36415,-31.730823 35.68036,-66.665244 6.08831,-25.786857 9.03068,-31.635006 35.07048,-33.55277 15.83223,-1.166003 24.744,15.037163 28.65896,28.092378 8.77989,42.198987 24.94185,133.024336 -14.62509,157.013146 -32.41201,16.15813 -57.22934,20.05734 -83.95459,20.25954 C 96.600431,232.34564 77.626179,228.66264 52.677966,219.01684 -9.0989725,195.06202 10.233567,109.09971 16.392574,59.026189 22.713363,42.000549 32.296195,27.708302 51.758144,27.997441 Z" id="path446" /> </svg>
   </a-->


   <a href="javascript:rotations();" title="rotations: cw/ccw">
   <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-clock" viewBox="0 0 16 16">
    <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"/>
    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"/>
  </svg></a>
  <a href="javascript:in_out();" title="direction from cg">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-arrow-down-up" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5m-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5"/>
  </svg>
  </a>
  <a href="javascript:turnings();" title="turnings">
    <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:16.9322835;stroke-linecap:square;stroke-opacity:1;stroke-dasharray:none" d="M 151.7264,23.388989 23.041563,204.94337 216.06611,203.25182" id="path1235" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:16.7811024;stroke-linecap:square;stroke-opacity:1;stroke-dasharray:none" d="m 95.874154,104.97254 c 51.874476,27.43168 58.016656,38.487 64.742186,98.60732" id="path1245" /> </svg>
    </a>

  <a href="javascript:lengths();" title="segment lengths">
<svg width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:12.28724409;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none" d="M 50.28577,210.21502 16.406082,168.7975 190.45363,26.425922 224.33332,67.843431" id="path1283" /> </svg>  </a> 
  <!--a href="javascript:clouds();" title="clouds">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-cloud" viewBox="0 0 16 16">
  <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
</svg></a-->
<a href="javascript:close_passes()"" title="close passes">
  <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" sodipodi:docname="close_but.svg" inkscape:version="1.2.2 (b0a8486541, 2022-12-01)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview140" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" showgrid="false" inkscape:zoom="18.75" inkscape:cx="10.826667" inkscape:cy="9.0133333" inkscape:window-width="1280" inkscape:window-height="652" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg2919" /> <defs id="defs2923" /> <circle style="fill:#000000;fill-rule:evenodd;stroke-width:163.296;stroke-linecap:square" id="circle913" cx="81.40741" cy="119.41506" r="21.912748" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:13.0016;stroke-linecap:square;stroke-dasharray:none;stroke-opacity:1" d="m 14.673137,22.562167 c 71.214066,97.034143 0.639096,1.009747 72.743941,96.917943 -69.829936,97.90023 -0.0053,1.51375 -70.751885,98.80264" id="path390" sodipodi:nodetypes="ccc" /> <circle style="fill:#000000;fill-rule:evenodd;stroke-width:163.296;stroke-linecap:square" id="circle1042" cx="-160.0285" cy="119.41506" r="21.912748" transform="scale(-1,1)" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:13.0016;stroke-linecap:square;stroke-dasharray:none;stroke-opacity:1" d="m 226.76277,22.562167 c -71.21406,97.034143 -0.63909,1.009747 -72.74394,96.917943 69.82994,97.90023 0.005,1.51375 70.75189,98.80264" id="path1044" sodipodi:nodetypes="ccc" /> </svg>
</a>
<a href="javascript:half_distance();" title="avg half distance">
  <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" sodipodi:docname="half.svg" inkscape:version="1.2.2 (b0a8486541, 2022-12-01)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <sodipodi:namedview id="namedview152" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" showgrid="false" inkscape:zoom="18.75" inkscape:cx="13.6" inkscape:cy="5.2266667" inkscape:window-width="1280" inkscape:window-height="652" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg2919" /> <defs id="defs2923"> <inkscape:path-effect effect="bspline" id="path-effect1273" is_visible="true" lpeversion="1" weight="33.333333" steps="2" helper_size="0" apply_no_weight="true" apply_with_weight="true" only_selected="false" /> </defs> <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:133.333px;font-family:FreeMono;-inkscape-font-specification:'FreeMono, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:10.2047;stroke-linecap:round;stroke-opacity:1" x="14.76088" y="101.60915" id="text903"><tspan sodipodi:role="line" id="tspan901" style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:133.3329964px;font-family:FreeMono;-inkscape-font-specification:'FreeMono, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:10.2047;stroke-opacity:1" x="14.76088" y="101.60915">1</tspan></text> <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:133.333px;font-family:FreeMono;-inkscape-font-specification:'FreeMono, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:10.2047;stroke-linecap:round;stroke-opacity:1" x="144.74326" y="212.67462" id="text1165"><tspan sodipodi:role="line" id="tspan1163" style="stroke-width:10.2047;-inkscape-font-specification:'FreeMono, Bold';font-family:FreeMono;font-weight:bold;font-style:normal;font-stretch:normal;font-variant:normal;font-size:133.3329964px;font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal" x="144.74326" y="212.67462">2</tspan></text> <path style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:10.2047;stroke-linecap:round;stroke-opacity:1" d="M 32.689478,210.85498 C 92.783421,149.765 152.87745,88.674945 212.97155,27.584806" id="path1271" inkscape:path-effect="#path-effect1273" inkscape:original-d="M 32.689478,210.85498 C 92.793502,149.77492 152.88753,88.684864 212.97155,27.584806" /> </svg>
</a>
<a href="javascript:desirepaths()" title="desire paths">
<svg width="24" height="24" class="invert" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <path style="fill:none;fill-rule:evenodd;stroke:#ff60ff;stroke-width:12.2872;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none" d="M 50.783784,211.21106 21.884272,158.33916 88.304948,149.63918 40.181726,36.355665 111.58255,46.580307 195.93182,15.967589 224.83133,68.839476" id="path1283" /> <path style="fill:none;fill-rule:evenodd;stroke:#ff60ff;stroke-width:12.2872;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none" d="m 194.57513,16.730862 28.89951,52.8719 -37.03766,32.106768 30.0378,49.91852 -20.75991,72.82732 -61.9385,-43.09376 -84.349274,30.61272 -28.89951,-52.87188" id="path411" /> <path style="fill:none;fill-rule:evenodd;stroke:#ff60ff;stroke-width:7.55906;stroke-linecap:square;stroke-linejoin:round;stroke-dasharray:none" d="M 89.756673,150.43837 132.0881,180.56839 184.37987,105.11883 113.66148,48.842936 71.330062,99.640658" id="path467" /> </svg>
</a>
</span>
<br>
<span class="grouping">
   <input type="checkbox" class="lower" checked id="oib" title="only if better"/>
    <!--label for="oib" class="lower" title="only if better"></label-->
    <label for="oib" id="lowscore" class="lower" title="lowest score">(2e20)</label>
    <!--input type="checkbox" class="lower" id="notbidi" title="cost differs by direction"/>
    <label for="notbidi"  class="lower" title="cost differs by direction">&lt;&#x2260;&gt;
    </label-->
</span>
<span class="grouping">
    <input type="checkbox" class="lower" id="save_prev" title="copy to clipboard before change"/ checked>
    <label for="save_prev" class="lower" title="copy to clipboard before change">autosave</label>
    </span>
    <span class="grouping">
    <a href="javascript:setWeights()" class="act"  title="random weights">
    <svg width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <path id="rect326" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:18.8639;stroke-linecap:square;stroke-linejoin:round" d="M 60.806832,83.365344 H 183.58839 L 228.13806,228.7753 H 16.257167 Z" /> <circle style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:17.4992;stroke-linecap:square;stroke-linejoin:round;stroke-dasharray:none" id="path1767" cx="122.19762" cy="39.494724" r="29.382992" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:17.4992;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 82.814625,155.53263 78.765975,-0.498" id="path1877" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:17.4992;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 121.94861,115.90064 0.498,78.76598" id="path1905" /> </svg> 

    <a href="javascript:clearWeights()" class="act"  title="clear weights">
    <svg width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <path id="rect326" style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:18.8639;stroke-linecap:square;stroke-linejoin:round" d="M 60.806832,83.365344 H 183.58839 L 228.13806,228.7753 H 16.257167 Z" /> <circle style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:17.4992;stroke-linecap:square;stroke-linejoin:round;stroke-dasharray:none" id="path1767" cx="122.19762" cy="39.494724" r="29.382992" /> <path style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:17.4992;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none" d="m 82.814625,155.53263 78.765975,-0.498" id="path1877" /> </svg> 
    </a>
    </span>
<!--span class="grouping">
    <a href='javascript:showLog()' id="showLog" title="show log">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-spreadsheet" viewBox="0 0 16 16">
  <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v4h10V2a1 1 0 0 0-1-1zm9 6h-3v2h3zm0 3h-3v2h3zm0 3h-3v2h2a1 1 0 0 0 1-1zm-4 2v-2H6v2zm-4 0v-2H3v1a1 1 0 0 0 1 1zm-2-3h2v-2H3zm0-3h2V7H3zm3-2v2h3V7zm3 3H6v2h3z"/>
</svg></a>
<a href='javascript:clearLog()' id="clearLog" title="clear log">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-x" viewBox="0 0 16 16">
  <path d="M6.146 6.146a.5.5 0 0 1 .708 0L8 7.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 8l1.147 1.146a.5.5 0 0 1-.708.708L8 8.707 6.854 9.854a.5.5 0 0 1-.708-.708L7.293 8 6.146 6.854a.5.5 0 0 1 0-.708"/>
  <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1"/>
</svg></a>
</span-->
    <br>
    <span class="grouping">
    <a href='javascript:togglerecord()' id="record" title="start recording macro">
    <svg xmlns="http://www.w3.org/2000/svg" id="recordsvg" width="24" height="24" fill="black" class="nope" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
    <path d="M11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
    </svg>
    </a>
    <a href="javascript:playFunctions()" id="play" title="play recorded macro (when red)">
    <svg xmlns="http://www.w3.org/2000/svg" id="playsvg" width="24" height="24" fill="#707070" class="bi bi-bucket" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
    <path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445z"/>
    </svg>
    </a>
    <a href='javascript:stackToCode()' id="code" title="show code for macro">
    <svg xmlns="http://www.w3.org/2000/svg" id="codesvg" width="24" height="24" fill="#707070" class="bi bi-code-slash" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" id="path2" />
    <path d="M 9.9648918,2.9107776 A 0.40719501,0.40719501 0 1 0 9.1864797,2.6713915 L 5.9295257,13.256492 a 0.40719497,0.40719497 0 0 0 0.778412,0.239386 z M 5.3856144,4.9455597 a 0.40711925,0.40711925 0 0 1 0,0.5764808 L 2.8232058,8.0836348 5.3856144,10.645229 A 0.40763355,0.40763355 0 0 1 4.8091336,11.22171 L 1.9592987,8.3718753 a 0.40711925,0.40711925 0 0 1 0,-0.5764809 L 4.8091336,4.9455597 a 0.40711925,0.40711925 0 0 1 0.5764808,0 z m 5.1231886,0 a 0.40711925,0.40711925 0 0 0 0,0.5764808 l 2.562409,2.5615943 -2.562409,2.5615942 a 0.40763362,0.40763362 0 0 0 0.576481,0.576481 l 2.849835,-2.8498347 a 0.40711925,0.40711925 0 0 0 0,-0.5764809 L 11.085284,4.9455597 a 0.40711925,0.40711925 0 0 0 -0.576481,0 z"
    id="path4" style="stroke-width:0.96;stroke-miterlimit:4;stroke-dasharray:none" />
    </svg>
    </a>
    <select id="iterations" title="macro step iterations" style="Width:40pt;">
    <option>1</option>
    <option>2</option>
    <option>3</option>
    <option>5</option>
    <option>10</option>
    <option>25</option>
    <option>50</option>
    </select>
    &nbsp;<input type="checkbox" checked class="check" id="verbose" title="verbose macro log"/>
    <label for="verbose" title="verbose macro log">verbose</label>
    </span>
    <br>
    <span class="grouping">
    <a href="javascript:copyToClipboard();" title="copy to clipboard"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
    </svg></a>
    <a href="javascript:pasteFromClipboard();" title="paste from clipboard"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M8 11a.5.5 0 0 0 .5-.5V6.707l1.146 1.147a.5.5 0 0 0 .708-.708l-2-2a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L7.5 6.707V10.5a.5.5 0 0 0 .5.5z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
    </svg></a>
    <a href="javascript:swapWithClipboard();" title="swap with clipboard">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z" id="path2" />
    <path style="stroke-width:1.875" d="M 14.988281 9.3730469 A 0.9375 0.9375 0 0 0 14.634766 9.4492188 A 0.9375 0.9375 0 0 0 14.632812 9.4492188 A 0.9375 0.9375 0 0 0 14.34375 9.640625 C 14.336265 9.6477388 14.329505 9.6547598 14.322266 9.6621094 L 10.585938 13.398438 A 0.93868425 0.93868425 0 0 0 11.914062 14.726562 L 14.0625 12.576172 L 14.0625 19.421875 L 11.914062 17.271484 A 0.93868425 0.93868425 0 1 0 10.585938 18.599609 L 14.322266 22.335938 C 14.329505 22.343287 14.336265 22.350308 14.34375 22.357422 A 0.9375 0.9375 0 0 0 15.664062 22.349609 L 19.414062 18.599609 A 0.93868425 0.93868425 0 0 0 18.085938 17.271484 L 15.9375 19.421875 L 15.9375 12.576172 L 18.085938 14.726562 A 0.93868425 0.93868425 0 0 0 19.414062 13.398438 L 15.664062 9.6484375 A 0.9375 0.9375 0 0 0 14.988281 9.3730469 z " transform="scale(0.53333333)" id="path4" />
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z" id="path8" /></svg>
    </a>
    </span>
    
    <span class="grouping">
    <a href="javascript:openJSON();" id="fileopen"  title="open points file">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-folder2-open" viewBox="0 0 16 16">
    <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7z"/>
    </svg>
    </a>
    
    <a href="javascript:saveAs()" class="act"  title="save points to file">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-floppy" viewBox="0 0 16 16">
      <path d="M11 2H9v3h2z"/>
      <path d="M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0M1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v4.5A1.5 1.5 0 0 1 11.5 7h-7A1.5 1.5 0 0 1 3 5.5V1H1.5a.5.5 0 0 0-.5.5m3 4a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5V1H4zM3 15h10v-4.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5z"/>
      </svg></a>
    <a href="javascript:deletePoints();" title="delete all points">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-trash3" viewBox="0 0 16 16">
    <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
    </svg>
    </a>

    <a href="javascript:canvasfullscreen()" class="act"  title="fullscreen canvas">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-arrows-fullscreen" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707m4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707m0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707m-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707"/>
  </svg></a>
    </span> 
    <hr/>
    <span class="grouping">
   
    <a href="javascript:crossings_radial()" title="crossings radial">
    <svg class="invert" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <path style="fill:#d4aa00;fill-rule:evenodd;stroke-width:115.049;stroke-linecap:square" d="M 17.696265,49.469401 180.04974,98.773063" id="path671" /> <circle style="fill:none;fill-rule:evenodd;stroke-width:5.5;stroke-linecap:square" id="path474" r="89.080399" cy="125.32057" cx="124.75307" /> <path id="path1180" style="fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-width:17.5;stroke-linecap:square;stroke-dasharray:none" d="m 224.6169,120.63213 c 0,53.67406 -40.64307,98.62909 -94.04542,104.023 C 77.169133,230.04904 28.357304,194.1294 17.624104,141.53945 6.8909034,88.949499 37.723416,36.775076 88.96852,20.811249 140.21363,4.8474194 195.2224,30.280646 216.25523,79.66207" /> <path style="fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:#ffffff;stroke-width:12.5;stroke-linecap:square;stroke-dasharray:none;stroke-opacity:1" d="m 167.41792,67.652736 54.85478,22.035693 -2e-5,-58.605564 z" id="path1291" /> </svg>     
  </a>
    <a href="javascript:box_counts_points();" title="boxes points">
    <svg class="invert" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:146.595;stroke-linecap:square" id="path857" cx="62.233727" cy="43.965488" r="19.671667" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:146.595;stroke-linecap:square" id="circle911" cx="179.2677" cy="26.534901" r="19.671667" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:146.595;stroke-linecap:square" id="circle913" cx="106.05924" cy="125.64024" r="19.671667" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:146.595;stroke-linecap:square" id="circle915" cx="35.838852" cy="173.44986" r="19.671667" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:146.595;stroke-linecap:square" id="circle917" cx="126.97594" cy="209.80511" r="19.671667" /> <circle style="fill:#ffffff;fill-rule:evenodd;stroke-width:146.595;stroke-linecap:square" id="circle919" cx="200.18443" cy="113.68783" r="19.671667" /> </svg> 
    </a>
    <a href="javascript:box_counts_path();" title="boxes path">
      <svg class="invert" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <path style="fill:#d4aa00;fill-rule:evenodd;stroke-width:115.049;stroke-linecap:square" d="M 17.696265,49.469401 180.04974,98.773063" id="path671" /> <path style="fill:#ffffff;fill-rule:evenodd;stroke:none;stroke-width:5.5;stroke-linecap:square;stroke-linejoin:miter;stroke-dasharray:none;stroke-opacity:1;fill-opacity:1" d="M 48.206922,142.39952 22.306586,94.182374 33.842054,32.610986 75.39754,20.811284 l 14.36485,38.477292 -6.351582,42.128574 30.464022,36.87812 43.09456,-46.172735 -14.36486,-55.920336 56.9464,-14.877888 23.45054,57.051475 -3.44237,64.023724 -17.51684,41.16082 -38.93153,-11.62898 -24.61042,54.60517 -41.042431,-4.36076 -17.443037,-43.3511 -56.613555,9.54985 z" id="path1389" /> </svg>
    </a>
    <a href="javascript:showCG();" title="show center of gravity">
    <svg class="order" width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg2919" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs2923" /> <circle style="fill:#ff0000;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:18.2022;stroke-linecap:square;stroke-opacity:1" id="path373" cx="122.76706" cy="119.41503" r="52.291763" /> </svg>
    </a>
    
    <a href="javascript:invertColors();" title="invert colors">
      <svg width="24" height="24" fill="black" class="bi bi-square" viewBox="0 0 16 16" version="1.1" id="svg4" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"> <metadata id="metadata10"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> </cc:Work> </rdf:RDF> </metadata> <defs id="defs8" /> <path style="fill:#080907;fill-opacity:0.99041533;stroke:#000000;stroke-width:0.35413408;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="M 7.8490935,9.3582994 C 7.9125109,15.175258 8.0046144,15.190446 8.0046144,15.190446 4.6226405,15.292508 2.3125978,12.610557 2.3125978,9.5345523 2.3125978,6.458548 5.0547716,4.9796141 7.771333,0.99629336 7.7355147,6.4754756 7.8136598,6.1079957 7.8490935,9.3582994 Z" id="path868" /> <path id="path871" d="m 8.1290313,9.3898868 c -0.063417,5.8169592 -0.2799378,5.7847662 -0.2799378,5.7847662 3.3819755,0.102062 5.4431455,-2.564096 5.4431455,-5.6400996 0,-3.0760053 -2.446648,-4.4826064 -5.1632077,-8.465928 0.035818,5.479183 0.035433,5.0709575 0,8.3212614 z" style="fill:none;fill-opacity:0.99041533;stroke:#000000;stroke-width:0.40277886;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:0.99680511" /> </svg> 
    </a>
    </span>
  </div>
  <div class="column" style="width:500px;"> 
    <canvas id="myCanvas" width="500" height="500"></canvas>
  </div>
  
  <div class="column" style="width:380px;padding-left: 10px;">
    <span class="grouping">
       <a href="javascript:info();" title="path info">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-info-circle" viewBox="0 0 16 16">
      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
      <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
    </svg></a>
    <a href="javascript:log_path_length()" title="measure path">
    <svg width="24" height="24" viewBox="0 0 240 240" version="1.1" id="svg471" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs475" /> <rect style="fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:10.8721;stroke-linecap:square;stroke-dasharray:none" id="rect701" width="228.08932" height="99.992111" x="6.0431161" y="63.390415" transform="matrix(0.99999823,0.00188309,-0.00100386,0.9999995,0,0)" /> <g id="g867" transform="translate(-0.99719099)"> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 27.257291,140.10016 -0.02955,23.63099 6.31e-4,-0.50279" id="path1937" /> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 74.120055,140.10017 -0.02955,23.63098 6.3e-4,-0.50278" id="path1941" /> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 97.570288,109.53709 -0.06781,54.19209 0.0019,-1.15301" id="path1943" /> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 120.98277,140.10019 -0.0295,23.63098 6.2e-4,-0.50278" id="path1945" /> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 167.84548,140.10019 -0.0295,23.63098 6.2e-4,-0.50278" id="path1949" /> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 50.707526,109.53709 -0.06781,54.19209 0.0019,-1.15301" id="path2332" /> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 144.433,109.53709 -0.0678,54.19209 0.002,-1.15301" id="path2334" /> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 191.29571,109.53709 -0.0678,54.19209 0.002,-1.15301" id="path2336" /> <path style="fill:#ffee31;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:9.508;stroke-linecap:square;stroke-dasharray:none" d="m 214.70819,140.10018 -0.0295,23.63099 6.3e-4,-0.50279" id="path2338" /> </g> </svg> 
    </a>
    <a href="javascript:printPoints()" class="act"  title="print points">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-braces" viewBox="0 0 16 16">
      <path d="M2.114 8.063V7.9c1.005-.102 1.497-.615 1.497-1.6V4.503c0-1.094.39-1.538 1.354-1.538h.273V2h-.376C3.25 2 2.49 2.759 2.49 4.352v1.524c0 1.094-.376 1.456-1.49 1.456v1.299c1.114 0 1.49.362 1.49 1.456v1.524c0 1.593.759 2.352 2.372 2.352h.376v-.964h-.273c-.964 0-1.354-.444-1.354-1.538V9.663c0-.984-.492-1.497-1.497-1.6M13.886 7.9v.163c-1.005.103-1.497.616-1.497 1.6v1.798c0 1.094-.39 1.538-1.354 1.538h-.273v.964h.376c1.613 0 2.372-.759 2.372-2.352v-1.524c0-1.094.376-1.456 1.49-1.456V7.332c-1.114 0-1.49-.362-1.49-1.456V4.352C13.51 2.759 12.75 2 11.138 2h-.376v.964h.273c.964 0 1.354.444 1.354 1.538V6.3c0 .984.492 1.497 1.497 1.6"/>
    </svg>
    </a>
    <a href="javascript:showxy();" title="x, y values">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 240 240" version="1.1">
      <path fill-opacity="1.000" d="M 19.315 60.663 L 14.129 64.200 32.726 92.100 L 51.323 120 32.726 147.901 L 14.128 175.802 19.549 179.401 C 22.530 181.380, 25.357 183, 25.832 183 C 26.306 183, 34.032 171.975, 43 158.500 C 51.968 145.025, 59.618 134, 60 134 C 60.382 134, 68.032 145.025, 77 158.500 C 85.968 171.975, 93.694 183, 94.168 183 C 94.643 183, 97.470 181.380, 100.451 179.401 L 105.872 175.802 87.274 147.901 L 68.677 120 87.274 92.099 L 105.872 64.198 100.451 60.599 C 97.470 58.620, 94.643 57, 94.168 57 C 93.694 57, 85.968 68.025, 77 81.500 C 68.032 94.975, 60.382 106, 60 106 C 59.618 106, 51.968 94.975, 43 81.500 C 34.032 68.025, 26.201 57.028, 25.597 57.063 C 24.994 57.097, 22.167 58.717, 19.315 60.663 M 139.312 60.664 L 134.125 64.203 153.562 93.349 L 173 122.495 173 151.247 L 173 180 180 180 L 187 180 187 151.247 L 187 122.495 206.438 93.348 L 225.876 64.201 220.454 60.601 C 217.471 58.620, 214.643 57, 214.168 57 C 213.694 57, 205.968 68.025, 197 81.500 C 188.032 94.975, 180.382 106, 180 106 C 179.618 106, 171.968 94.975, 163 81.500 C 154.032 68.025, 146.201 57.028, 145.597 57.063 C 144.994 57.097, 142.166 58.718, 139.312 60.664 M 113.994 173.250 C 113.987 177.531, 112.157 184, 110.953 184 C 110.429 184, 110 186.709, 110 190.019 L 110 196.038 112.750 195.381 C 120.410 193.550, 123.978 187.956, 125.591 175.250 L 126.258 170 120.129 170 L 114 170 113.994 173.250 " stroke="none" fill="black" fill-rule="evenodd"/>
    </svg></a>
    <a href="javascript:ordering(true);" title="point order">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-hash" viewBox="0 0 16 16">
      <path d="M8.39 12.648a1 1 0 0 0-.015.18c0 .305.21.508.5.508.266 0 .492-.172.555-.477l.554-2.703h1.204c.421 0 .617-.234.617-.547 0-.312-.188-.53-.617-.53h-.985l.516-2.524h1.265c.43 0 .618-.227.618-.547 0-.313-.188-.524-.618-.524h-1.046l.476-2.304a1 1 0 0 0 .016-.164.51.51 0 0 0-.516-.516.54.54 0 0 0-.539.43l-.523 2.554H7.617l.477-2.304c.008-.04.015-.118.015-.164a.51.51 0 0 0-.523-.516.54.54 0 0 0-.531.43L6.53 5.484H5.414c-.43 0-.617.22-.617.532s.187.539.617.539h.906l-.515 2.523H4.609c-.421 0-.609.219-.609.531s.188.547.61.547h.976l-.516 2.492c-.008.04-.015.125-.015.18 0 .305.21.508.5.508.265 0 .492-.172.554-.477l.555-2.703h2.242zm-1-6.109h2.266l-.515 2.563H6.859l.532-2.563z"/>
    </svg></a>
    <a href="javascript:marklog();" title="mark log">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 240 240" version="1.1">
      <path fill-opacity="0.494" d="M 10.004 120 L 10.004 180.500 30.161 150.250 L 50.317 120 30.161 89.750 L 10.004 59.500 10.004 120 M 70 120 L 70 126 85 126 L 100 126 100 120 L 100 114 85 114 L 70 114 70 120 M 130 120 L 130 126 145 126 L 160 126 160 120 L 160 114 145 114 L 130 114 130 120 M 190 120 L 190 126 205 126 L 220 126 220 120 L 220 114 205 114 L 190 114 190 120 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.054" d="M 10.002 119.450 C 10.001 153.875, 10.373 178.996, 10.877 178.450 C 11.360 177.928, 20.397 164.512, 30.961 148.638 L 50.167 119.775 30.086 89.638 L 10.004 59.500 10.002 119.450 M 70 120 L 70 126 85 126 L 100 126 100 120 L 100 114 85 114 L 70 114 70 120 M 130 120 L 130 126 145 126 L 160 126 160 120 L 160 114 145 114 L 130 114 130 120 M 190 120 L 190 126 205 126 L 220 126 220 120 L 220 114 205 114 L 190 114 190 120 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="0.984" d="M 10.001 119.950 C 10 154.089, 10.373 178.996, 10.877 178.450 C 11.360 177.928, 20.324 164.622, 30.797 148.883 L 49.840 120.265 29.921 90.383 L 10.001 60.500 10.001 119.950 M 70 120 L 70 126 85 126 L 100 126 100 120 L 100 114 85 114 L 70 114 70 120 M 130 120 L 130 126 145 126 L 160 126 160 120 L 160 114 145 114 L 130 114 130 120 M 190 120 L 190 126 205 126 L 220 126 220 120 L 220 114 205 114 L 190 114 190 120 " stroke="none" fill="black" fill-rule="evenodd"/>
      <path fill-opacity="1.000" d="M 10 120 L 10 179.495 29.500 150.255 C 40.225 134.173, 49 120.559, 49 120 C 49 119.441, 40.225 105.827, 29.500 89.745 L 10 60.505 10 120 M 70 120 L 70 126 85 126 L 100 126 100 120 L 100 114 85 114 L 70 114 70 120 M 130 120 L 130 126 145 126 L 160 126 160 120 L 160 114 145 114 L 130 114 130 120 M 190 120 L 190 126 205 126 L 220 126 220 120 L 220 114 205 114 L 190 114 190 120 " stroke="none" fill="black" fill-rule="evenodd"/>
    </svg></a>
    <a href="javascript:savetextAs()" class="act"  title="save text to file">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-floppy" viewBox="0 0 16 16">
    <path d="M11 2H9v3h2z"/>
    <path d="M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0M1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v4.5A1.5 1.5 0 0 1 11.5 7h-7A1.5 1.5 0 0 1 3 5.5V1H1.5a.5.5 0 0 0-.5.5m3 4a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5V1H4zM3 15h10v-4.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5z"/>
    </svg></a>
  <a href="javascript:cleartext()" class="act"  title="clear text area">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-trash3" viewBox="0 0 16 16">
    <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
    </svg></a>
  <a href="javascript:tafullscreen()" class="act"  title="fullscreen text area">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-arrows-fullscreen" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707m4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707m0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707m-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707"/>
  </svg></a>
    <a href="javascript:openGrid();" title="open point editor">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-pencil" viewBox="0 0 16 16">
    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325"/>
    </svg></a>
  </span>
    <textarea id="textarea" width="450" rows="24" spellcheck="false"></textarea>
  </div>
</div>
</div>
<script>
let TEMPS = []
let CLUSTERS = []
let SEGMENTS = []
let points = []
let SHOWINGPATH = false
let LASTRUN = ""
let LOG = ""
let LOWSCORE = 2e20 
let NO_OIB = ["poke_point","poke_long_arms","poke_acute_angles","poke_close","poke_obtuse_angles","loadpoints","popClusters","cluster","segmentswap","cutLongestSegment","unmap",
"insert_run","swapAcross","swapAcrossCG","shuffle_points","uncross_paths"]

function point (x,y,i,w) {
  this.x = x
  this.y = y
  this.index = points.length
  this.angle = 0
  this.arms_length = 0
  this.mark = ""
  this.weight = 1
  //this.PEN = false
 // this.lin = 0
  this.neighbors = []
  this.segs = []
  this.spurs = []//-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] // 20 directions
}

function tafullscreen () {
  let ta = document.getElementById("textarea")
  ta.requestFullscreen();
}

function canvasfullscreen () {
  let mc = document.getElementById("myCanvas")
  mc.requestFullscreen();
}

function density () {
  if (points.length < 1)
    return
  let i = 0, boxes = 16, xoff = 500/4, yoff = xoff
  let density = 0, sum = 0
  let x = 0, y = 0
  for (; i < boxes; i++) {
    //console.log(x,y)
    // make boxes. test for points inside
    let j = 0
    sum = 0
    for (; j < points.length; j++) {
      if (points[j].x >= x && points[j].x < x+xoff && points[j].y >= y && points[j].y < y+yoff)
        sum = 1
    }
    if (sum > 0)
    density += 1
    x += xoff
    if (x >= 500) {
      x = 0
      y += yoff
    }
  }
  //console.log(density)
  return(Math.sqrt(125)*density *3)
}

function showLog () {
  if (LOG.length < 1)
    return
  let header = "N\tL\tD\txangle\txlength\tarea\tfunction\n"
  message(header+LOG)
}

function clearLog () {
  LOG = ""
}

function recordToLog (fn) { // info
  redrawPath()
  let asl = averageSegmentLength(points)
  let len = averageArmsLength()
  let m = round(measurePath(points,true))
  let area = round(calculatePolygonArea())
  let angle = avgCosAngle()
  line = points.length+"\t"+
        m+"\t"+
        Math.round(1000*fd())/1000+"\t"+
        angle+"\t"+
        len+"\t"+
        round2dp(area)+"\t"+
        //round2dp(m/area)+"\t"+
        fn+"\n"
    LOG = line + LOG
}

function arraysIntersect (a1, a2) {
  let i = 0, INTERSECT = false
  for (; i < a1.length; i++) {
    if (a2.includes(a1[i]))
      INTERSECT = true
  }
  return INTERSECT
}

function mergeArray (to, from) {
  let i = 0
  for (; i < from.length; i++) {
    if (!to.includes(from[i]))
      to.push(from[i])
  }
  return to
}

function half_distance (m) { // try 'mod distance' pt, pt+N/3, 4, 5
  if (points.length < 1) 
    return
  if (!m)
    m = 2
  let res = "", i = 0, j = 0, N = Math.floor(points.length), avg = 0
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.strokeStyle = 'red'
  ctx.lineWidth = 1
  let inflections = 0, d, d2, d3, dcg
  let cg = center(), found = []
  showCG()
  for (; i < points.length/2; i++) { 
    d = round(distance (points[i], points[Math.floor((i+N/m)%N)]))
    d2 = round(distance (points[(i+1)%N], points[Math.floor((i+1+N/m)%N)]))
    d3 = round(distance (points[(i+2)%N], points[Math.floor((i+2+N/m)%N)]))
    if ((d2 < d && d2 < d3) || (d2 > d && d2 > d3))
      inflections += 1
    j = 0
    for (; j < d/25; j++)
    ;//  res += "\u{2587}"
    //res += " ("+points[i].index+", "+points[Math.floor((i+N/m)%N)].index+ ")\n"
    avg += d
    found.push(d-d2)
  }
  avg = round(avg/N)
  let sd_ = sd(found)
  i = 0
  for (; i < points.length/2; i++) { 
    let d = round(distance (points[i], points[Math.floor((i+N/m)%N)]))
    if (d < avg*1.7) {
      ctx.beginPath()
      ctx.moveTo(points[i].x, points[i].y)
      ctx.lineTo(points[Math.floor((i+N/2)%N)].x, points[Math.floor((i+N/2)%N)].y)
      ctx.strokeStyle = 'red'
      ctx.stroke()
    }
  }
  ctx.fillStyle = '#00ffff60'
  let bp = boundingPoints()
  let extent = distance(bp[0], bp[1])
  //console.log(extent)
  i = 0
  for (; i < points.length; i++) { 
    dcg = distance(points[i], cg)
    if (dcg < extent*0.2) {
      ctx.beginPath()
      ctx.arc(points[i].x, points[i].y, 8, 0, 2*Math.PI)
      ctx.fill()
    }
  }
 // message(res)
  message("half_distances: x:"+avg+", :"+round(inflections) +", :"+round(sd_))
}

function cluster_alt () { // by .neighbors
  if (points.length < 6) {
     message("cluster (< 6 points)")
    return
  }
  if (points[0].neighbors.length === 0) {
    clusterbyvoids()
  }
  let initial = points.length
  let copy = copyOf(points), i = 0
//  cleanNeighbors()
  let clusters = [] // array of arrays of points indexes
  let used = [], temp
  let j = 0, k = 0
  for (; i < copy.length; i++) {
    temp = []
    if (copy[i].neighbors.length === 0) {
      used.push(copy[i].index)
    }
    if (!temp.includes(copy[i].neighbors))
      temp = (copy[i].neighbors)
    if (!temp.includes(copy[i].index))
      temp.push(copy[i].index)
    clusters.push(temp)
  }
  // merge neighbors with ANY in common
  clusters = mergeClusters(clusters)
  clusters = mergeClusters(clusters)
  
  let cleaned = []
  i = 0
  for (; i < clusters.length; i++) { // not really needed
    if (clusters[i].length > 0)
      cleaned.push(clusters[i])
  }
  clusters = cleaned
  let cgs = []
  i = 0
  for (; i < clusters.length; i++) {
    if (clusters[i].length > 0) {
      //smooth_a_cluster(clusters[i])
      cgs.push(CGfromIndicies (clusters[i]))
    }
  }

  // do something different. smooth points w/i each cluster 
  // set the index of each cgs stack depth plus i as string: 1.0, 1.2, etc
  i = 0
  for (; i < cgs.length; i++) {
   // cgs[i].index = (CLUSTERS.length+1)+"."+i // CLUSTERS.length+ "."+i
  }
  if (cgs.length < 6 || cgs.length === initial) {
    points = copy
    drawPath(points)
    message("cluster "+initial+" =>. "+points.length+"")
    return;
  }
  // push to CLUSTERS
  pushFunction('cluster')
  CLUSTERS.push(copyOf(points))
 // plotCGs(cgs)
  points = cgs//copyOf(cgs)
  drawPath(points)
  topology()
  message("cluster "+initial+" => "+points.length)
}

function cluster () { // by .neighbors
  if (points.length < 6) {
     message("cluster (< 6 points)")
    return
  }
  if (points[0].neighbors.length === 0) {
    clusterbyvoids()
  }
  let saved = measurePath()
  let initial = points.length
  let copy = copyOf(points), i = 0
//  cleanNeighbors()
  let clusters = [] // array of arrays of points indexes
  let used = [], temp
  let j = 0, k = 0
  for (; i < copy.length; i++) {
    temp = []
    if (copy[i].neighbors.length === 0) {
      used.push(copy[i].index)
    }
    if (!temp.includes(copy[i].neighbors))
      temp = (copy[i].neighbors)
    if (!temp.includes(copy[i].index))
      temp.push(copy[i].index)
    clusters.push(temp)
  }
  // merge neighbors with ANY in common
  clusters = mergeClusters(clusters)
  clusters = mergeClusters(clusters)
  let cgs = []
  i = 0
  for (; i < clusters.length; i++) {
    if (clusters[i].length > 0) {
      cgs.push(CGfromIndicies (clusters[i]))
    }
  }
  // do something different. smooth points w/i each cluster 
  // set the index of each cgs stack depth plus i as string: 1.0, 1.2, etc
  i = 0
  for (; i < cgs.length; i++) {
    cgs[i].index = (CLUSTERS.length+1)+"."+i // CLUSTERS.length+ "."+i
  }
  if (cgs.length < 6 || cgs.length === initial) {
    points = copy
    drawPath(points)
    message("cluster "+initial+" =>. "+points.length)
    return;
  }
  // push to CLUSTERS
  pushFunction('cluster')
  CLUSTERS.push(copyOf(points))
  plotCGs(cgs)
  points = cgs//copyOf(cgs)
  drawPath(points)
  topology()
  message("cluster "+initial+" => "+points.length+"  (was "+saved+")")
}

function popClusters () {
  let initial = points.length
  if (CLUSTERS.length > 0) {
    let copy = copyOf(points) // save previous clustering
    points = CLUSTERS.pop()
    // reorder points based on previous cluster's order
    reorder(points, copy)
    //cleanNeighbors()
    let m = measurePath()
    message("expand  "+initial+" => "+points.length +" "+m+" ")
  } else {
    //cleanNeighbors()
    message("expand  (nothing to expand!)")
  }
  let v = document.getElementById("textarea").value
  topology()
  document.getElementById("textarea").value = v
  pushFunction('popClusters')
  LOWSCORE = measurePath()
  document.getElementById("lowscore").innerText = " " + LOWSCORE+""
}

function cleanNeighbors () {
  let L = CLUSTERS.length
  let i = 0, j = 0, rep = []
  for (; i < points.length; i++) {
    j = 0, rep = []
    n = points[i].neighbors
    for (; j < n.length; j++) {
      if (!(n[j]+"").startsWith(L+1+".")) {
        rep.push(n[j])
      }
    }
    points[i].neighbors = rep
  }
  findNeighbors() // still needed for cluster
}

function clearNeighbors () {
  let i = 0
  for (; i < points.length; i++) {
    points[i].neighbors = []
  }
}

function reorder (pts, prev) {
  let i = 0, j = 0, temp = [], list = []
  for (; i < prev.length; i++) {
    let n = prev[i].neighbors
    let j = 0
    for (; j < points.length; j++) {
      if (n.includes(points[j].index) && !list.includes(points[j])) {
        temp.push(points[j])
        list.push(points[j])
      }
    }
  }
  points = temp
  drawPath()
}

function plotCGs (pts) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.strokeStyle = "#00ffff"
  ctx.lineWidth = 2
  let i = 0, r = 7
  for (; i < pts.length; i++) {
    ctx.beginPath()
    ctx.arc(pts[i].x, pts[i].y, r, 0, Math.PI*2)
    ctx.stroke()
  }
}

function CGfromIndicies (idx) {
  if (idx.length < 1)
    return;
  let i = 0, cx = 0, cy = 0, n = 0
  for (; i < points.length; i++) {
    if (idx.includes(points[i].index)) {
      cx += points[i].x
      cy += points[i].y
      n++
    }
  }
  let p = new point(cx/n, cy/n)
  p.neighbors = idx
  return (p)
}

function showClusters () {
  if (points.length < 1) {
    return
  }
  let initial = points.length
  let copy = copyOf(points), i = 0
  let clusters = [] // array of arrays of points indexes
  let used = [], temp
  let j = 0, k = 0
  for (; i < copy.length; i++) {
    temp = []
    if (copy[i].neighbors.length === 0) {
      used.push(copy[i].index)
    }
    if (!temp.includes(copy[i].neighbors))
      temp = (copy[i].neighbors)
    if (!temp.includes(copy[i].index))
      temp.push(copy[i].index)
    clusters.push(temp)
  }
  // merge neighbors with ANY in common
  clusters = mergeClusters(clusters)
  clusters = mergeClusters(clusters)
  showClusters_(clusters)
}

function closestSegs () {
  if (points.length < 1)
    return 0
  let i = 0, j = 0, segs, idxs
 //let copy = copyOf(points)
  for (; i < points.length; i++) {
   // copy = copyOf(points)
    segs = closestNeighbors(i, points)
    j = 0, idxs = []
    for (; j < segs.length; j++) {
      if (segs[j].index !== points[i].index)
      idxs.push(segs[j].index)
    }
    points[i].segs = idxs
  }
}

function pearsons (pts) {
  if (pts.length < 3)
    return 0
  let cov = covariance(pts)
  let xs = [], ys = []
  let sdx = 0, sdy = 0
  let i = 0
  for (; i < pts.length; i++) {
    xs.push(pts[i].x)
    ys.push(pts[i].y)
  }
  sdx = getStandardDeviation(xs)
  sdy = getStandardDeviation(ys)
  return round2dp(cov/(sdx*sdy))
}

function covariance (pts) { 
  if (pts.length < 2)
    return 0
  let avgx = 0, avgy = 0, i = 0, s = 0
  for (; i < pts.length; i++) {
    avgx += pts[i].x
    avgy += pts[i].y
  }
  avgx /= pts.length
  avgy /= pts.length
  i = 0
  for (; i < pts.length; i++) {
    s += (pts[i].x - avgx)*(pts[i].y - avgy)
  }
  s /= pts.length
  return s
}

function showClusters_ (c) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let colors = ["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]
  let text = ""
  ctx.strokeStyle = "#00ffff"
  ctx.lineWidth = 2
  let voidsize = +document.getElementById("voidsize").value
  let i = 0, pts = [], res = [], count = 0, j = 0
  for (; i < c.length; i++) {
    if (c[i].length > 0) {
      text += "> "+c[i]+"\n"
      pts = indiciesToPoints(c[i]) // use bounding box of cluster points
      bp = boundingPoints(pts)
      ctx.strokeStyle = colors[(i % colors.length)]
      ctx.strokeRect(bp[0].x-6, bp[0].y-6, bp[1].x-bp[0].x +12, bp[1].y-bp[0].y+12)
      j = 0
      for (; j < pts.length; j++) {
        ctx.beginPath()
        ctx.arc(pts[j].x, pts[j].y, 5, 0, 2*Math.PI)
        ctx.stroke()
      }
      count++
    }
  }
  ctx.lineWidth = 1
  message("clusters:"+count+" (voidsize:"+voidsize+")")
}

function indiciesToPoints (idxs) {
  let i = 0, pts = []
  for (; i < idxs.length; i++) {
    pts.push(pointByIndex(idxs[i]))
  }
  return pts
}
// return point given an index field
function pointByIndex (idx) { 
  let i = 0
  for (; i < points.length; i++) {
    if (points[i].index == idx)
      return points[i]
  }
}

function indexByPoint (point) {
  let i = 0
  for (; i < points.length; i++) {
    if (points.index === point)
      return i
  }
}

function mergeClusters (c) {
  let i = 0, j = 1
  let res = []
  for (; i < c.length; i++) {
    j = i+1
    for (; j < c.length; j++) {
      if (c[j].length > 0 && c[i].length > 0 && arraysIntersect(c[i], c[j])) {
        c[i] = mergeArray(c[i],c[j])
        res.push(c[i])
        //console.log("m")
        c[j] = []
      }
    }
  }
  //console.log(res[0],res.length)
  return c
}

function pen_score () { 
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, j = 0, c = 0, sum = 0, count = 0, path, path2, a, angles
  const n = points.length
  const bp = boundingPoints()
  const D = ((bp[1].x - bp[0].x) + (bp[1].y - bp[0].y))/2
  let den = density(), res = "\n"
  const r = D/Math.sqrt(n) * 0.9
 
  i = 0
  for (; i < points.length; i++) {
    path2 = new Path2D() 
    path2.arc(points[i].x,points[i].y,r, 0,Math.PI*2)
    ctx.lineWidth = 1
    
    j = 0, a = 0, angles = []
    for (; j < points.length; j++) {
      if(ctx.isPointInPath(path2, points[j].x, points[j].y)) //&& !ctx.isPointInPath(path, points[j].x, points[j].y))
        angles.push(points[j])
    }
    let p = round2dp(pearsons(angles))
    points[i].lin = p
    res += points[i].index+"["+p+"]\n"
    if (Math.abs(p) >= 0.67) {
      ctx.strokeStyle = "#ff00ff"
      ctx.beginPath()
      ctx.arc(points[i].x,points[i].y,r/5, 0,Math.PI*2)
      ctx.closePath()
      ctx.stroke()
    }
  }
  message("pen scores: "+res)
}

function findNeighbors () {  // rename this to ???
  let i = 0, c = 0, sum = 0, res = {}, count = 0
  const n = points.length
  const bp = boundingPoints()
  const D = ((bp[1].x - bp[0].x) + (bp[1].y - bp[0].y))/2
  let den = density()
  const r = D/Math.sqrt(n) * 0.6//0.8
 // console.log(r)
  i = 0
  for (; i < points.length; i++) {
    isNeighbor(points[i], r) //temp
  }
}

function isNeighbor (pt, r) {
  if (points.length < 1)
    return
  let bounds = [new point(0,0), new point(500,500)]
  let x = pt.x, y = pt.y, i = 0, angle = 0, inc = Math.PI/4, pt2, pt3
  let cost = 0
  for (; i < 8; i++) {
    x = pt.x
    y = pt.y
    pt2 = new point()
    pt2.x = x + r * Math.cos(angle)
    pt2.y = y + r * Math.sin(angle)
    pt3 = new point()
    pt3.x = x + r*1.3 * Math.cos(angle+inc)
    pt3.y = y + r*1.3 * Math.sin(angle+inc)
    cost += pointsInPath (pt,pt2,pt3)
    if (!pointInRect(pt2,0,0,500,500))
      cost -= 0.5
    angle += inc
  }
  return cost
}

function isPeninsulaSpurs (pt) {
  if (points.length < 1)
    return
  let spurs = pt.spurs, count = 0, i = 0
  for (; i < spurs.length; i++) {
    if (spurs[i] === -1) {
      count = 10
      break;
    }
    if (spurs[i] > 9) // 9 may vary as threshold w/ points.length
      count++
  }
  return (count < 7)
}

function spursCG (SILENT) { // find
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let r = averageSegmentLength(copyOf(points))*1.0
  let cellsize = 500/ROWS
  r = Math.round(cellsize* 20*Math.pow(points.length, -0.5)) * 1.5
  hidePath()
  showRings(points, 50)
  
 // drawPath()
  let cg = center()
  cg.spurs = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] // 20 directions
  let i = 0, pens = [], p

  let angle = 0, inc = Math.PI/10
  let a = 0
  for (; a < 20; a++) {
    i = 0
    //for (; i < points.length; i++) {
      findSpurs(cg, angle, a)//
   // }
    angle += inc
  }
  showCG()
  ctx.strokeStyle = "#ffaaff"
  ctx.lineWidth = 1
    j = 0, angle = 0
  pt = cg
  for (; j < 20; j++) {
    if (pt.spurs[j] > 0) {
      r = pt.spurs[j] * 1.8
      x = pt.x
      y = pt.y
      pt2 = new point()
      pt2.x = x + r * Math.cos(angle)
      pt2.y = y + r * Math.sin(angle)
      ctx.beginPath()
      ctx.moveTo(pt.x,pt.y)
      ctx.lineTo(pt2.x,pt2.y)
      ctx.stroke()
    }
    angle += inc
  }
}

function findAllSpurs (SILENT) { // find
  if (points.length < 1)
    return
  let r = averageSegmentLength(copyOf(points))*1.0
  let cellsize = 500/ROWS
  r = Math.round(cellsize* 20*Math.pow(points.length, -0.5)) * 1.5
 // topology()
  showRings()
  hidePath()
 // drawPath()
  let cg = center()
  cg.spurs = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] // 20 directions
  let i = 0, pens = [], p
  for (; i < points.length; i++) {
    points[i].spurs = [-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] // 20 directions
  }
  let angle = 0, inc = Math.PI/10
  let a = 0
  for (; a < 20; a++) {
    i = 0
    for (; i < points.length; i++) {
      findSpurs(points[i], angle, a)
    }
    angle += inc
  }

  if (!SILENT)
    showSpurs()
}

function findSpurs (pt, angle, index) {
  if (points.length < 1)
    return
  let pen = true, cnt = 0
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let cellsize = 500/ROWS
  let r = 250//cellsize*4
  let x = pt.x, y = pt.y, i = 0, pt2
  let cost = 0
  x = pt.x
  y = pt.y
  for (; i < 400; i++) {
    pt2 = new point()
    pt2.x = x + r * Math.cos(angle)
    pt2.y = y + r * Math.sin(angle)
    cost = TEMPS[ifromxy(Math.floor(pt2.x/cellsize), Math.floor(pt2.y/cellsize))] // void
    if (!pointInRect(pt2,0,0,500,500) || cost >= 3)
      break;
    cnt++
    r += 5
  }
  pt.spurs[index] = cnt
}

function showSpurs () {
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, j = 0, cellsize = 500/ROWS, angle = 0, inc = Math.PI/10
  let x, y, pt, pt2, r = averageSegmentLength(copyOf(points))/120
  let mult = 1
  ctx.strokeStyle = "#ffaaff"
  ctx.fillStyle = "#ffaaff"
  ctx.lineWidth = 1
 
  for (; i < points.length; i++) {
    j = 0, angle = 0
    pt = points[i]
    for (; j < 20; j++) {
      if (pt.spurs[j] > 12) {
        r = pt.spurs[j] * 1.8
        x = pt.x
        y = pt.y
        pt2 = new point()
        pt2.x = x + r * Math.cos(angle)
        pt2.y = y + r * Math.sin(angle)
        ctx.beginPath()
        ctx.moveTo(pt.x,pt.y)
        ctx.lineTo(pt2.x,pt2.y)
        ctx.strokeStyle = "#ffaaff"
        ctx.stroke()
      }
      angle += inc
    }
  }
}

function pointsInPath (p1,p2,p3) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, found = 0, count = 0
  let path = new Path2D() 
  path.moveTo(p1.x, p1.y)
  path.lineTo(p2.x, p2.y)
  path.lineTo(p3.x, p3.y)
  path.lineTo(p1.x, p1.y)
  ctx.beginPath()
  ctx.moveTo(p1.x, p1.y)
  ctx.lineTo(p2.x, p2.y)
  ctx.lineTo(p3.x, p3.y)
  ctx.lineTo(p1.x, p1.y)
 // ctx.stroke()
  ctx.globalAlpha = 1
  for (; i < points.length; i++) {
    if (points[i] !== p1 && ctx.isPointInPath(path, points[i].x, points[i].y)) {
      found = 1
      if (!p1.neighbors.includes(points[i].index))
        p1.neighbors.push(points[i].index)
      count++
    }
  }
  return found
}

function allConnections (REFRESH) {
  if (points.length < 1)
    return
  if (SEGMENTS.length > 0 && !REFRESH)
    return SEGMENTS
  let segments = []
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = 1
  ctx.lineWidth = 0.5
  ctx.strokeStyle = "#ff00ff"
  let r = 300
  let max = points.length*points.length, found = 0
  let i = 0, j = 0, ct = 0
  for (; i < points.length; i++) {
    j = (i+1)
    for (; j < points.length; j++) { //new Path2d
      if (points[i] != points[j]) {
        ct++
        if (distance(points[i],points[j]) < r || points.length <= 10 ) {
          found++
          ctx.beginPath()
          ctx.moveTo(points[i].x+4, points[i].y+4)
          ctx.lineTo(points[j].x+4, points[j].y+4)
          ctx.closePath()
          ctx.stroke()
          segments.push([points[i], points[j]])
        }
      }
    }
  }
  //message("connections: "+found+"/"+ct)
  ctx.globalAlpha = 1
  SEGMENTS = segments
  return segments
}

function unsegmentedPoints () {
  let segs = allConnections()
  let i = 0, j = 0, found = [], ct = 0
  for (; i < points.length; i++) {
    j = 0, ct = 0
    for (; j < segs.length; j++) {
      if (segs[j].includes(points[i])) 
        ct++
    }
    if (ct < 3)
      found.push(points[i])
  }
  console.log(found)
}

function collect_segs () {
  let segs = allConnections()
  let i = 0, j = 0, ct = 0, res = ""
  /* find all segemnts for each point
  */
  let copy = copyOf(segs), found = []
  for (; i < points.length;i++) {
    j = 0, found = []
    for (; j < segs.length; j++) {
      if (segs[j].includes(points[i])) {
        if (segs[j][0] !== points[i])
          found.push(segs[j][0].index)
        else
          found.push(segs[j][1].index)
      }
    }
    res += points[i].index+":["+found+"]\n"
    points[i].segs = found
  }
  //message(res)
}

function uncross_segments () {
  let segs = allConnections()
  let i = 0, j = 0, ct = 0
  let threshold = 12 + Math.floor(Math.sqrt(segs.length/13))
  //if (threshold < 5) 
    threshold = 5
 // console.log(threshold)
  for (; i < segs.length; i++) {
    j = (i+1)
    for (; j < segs.length; j++) {
      if (intersects(segs[i][0],segs[i][1],segs[j][0],segs[j][1])) {
        ct++
        if (distance(segs[i][0],segs[i][1]) < distance(segs[j][0],segs[j][1])) {
          if (cons(segs[j], segs) > threshold)
            segs.splice(j,1)
        } else {
          if (cons(segs[1], segs) > threshold)
            segs.splice(i,1)
        }
      }
    }
  }
  collect_segs()
  message("prune: "+segs.length+" ("+threshold+")")
  SEGMENTS = segs
  drawPath()
  drawSegments_old(segs)
}

function padSegs() {
  if (points.length < 1)
    return
  let i = 0, j = 0, l = points.length
  for (; i < points.length; i++) {
    j = 0
    for (; j < l; j++) {
    if (!points[i].segs.includes(j))
      points[i].segs.push(j)
    }
  }
}

function find_invags () {
  if (points.length < 1)
    return
  let cg = center()
  showCG()
  let i = 0, count = 0, found = []
  //copyToClipboard() 
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.fillStyle = "#00ffff60"
  let L = points.length
  for (; i < L; i++) {
    let prev =  (i === 0)? L-1: i-1
    let pprev = (i === 0)? L-2: i-2
    if (i === 1)
      pprev = L-1
    let dpp = distance(cg, points[pprev])
    let dp = distance(cg, points[prev])
    let d = distance(cg, points[i])
    if (d < dp && d < dpp) {
      ctx.beginPath()
      ctx.arc(points[i].x, points[i].y, 8, 0, 2*Math.PI)
      ctx.fill()
      count++
    }
  }
  console.log(count)
}

function findPaths () { // prune?
  if (points.length < 1)
    return
  let al = averageSegmentLength(points)*4
  let i = 0
  for (; i < points.length; i++)
    findPath(i, al)
}

function findPath (ii,al) {
  if (points.length < 1)
    return
  // populate segs
  closestSegs()
  
  let used = [ii], ct = 1, i = 0, idx = ii
  let pt = pointByIndex(ii)
  let path = [pt]
  while (path.length < points.length) {
    // pick index next, but check against used.
    // if used, pick next seg
    let j = 0
    for (; j < pt.segs.length; j++) {
      idx = pt.segs[j]
      if (!used.includes(idx))
        break;
    }
    // get point by index
    pt = pointByIndex(idx)
    if (!used.includes(idx)) {
      path.push(pt)
      used.push(idx)
    }
    i = idx
    ct++
    if (ct > points.length)
      break;
  }
 // points = path
  drawsegPath(path, al)
 // message("findPath: "+ ii)
}

function cons (s) {
  let i = 0, count = 0
  for (; i < SEGMENTS.length; i++) {
    if (SEGMENTS[i].includes(s[0]))
      count++
    if (SEGMENTS[i].includes(s[1]))
      count++
  }
  return count
}

function drawsegPath (path, al) {

al *= 1.2
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineWidth = 0.75
  ctx.globalAlpha /= 6
  ctx.strokeStyle = "#ff00ff"
  let i = 0, ct = 0
  let temps = TEMPS
 // ctx.beginPath()
 // ctx.moveTo(path[i].x+6, path[i].y+6)
  for (; i < path.length; i++) {
   if (distance(path[i], path[(i+1)%path.length]) < al) { // cost
   
      if (pairCost(path[i],points[(i+1)%path.length],temps) < 8) {
        ctx.lineWidth = 1
        ctx.strokeStyle = "#ff00ff"
        ctx.beginPath()
        ctx.moveTo(path[i].x+6, path[i].y+6)
        ctx.lineTo(path[(i+1)%path.length].x+6, path[(i+1)%path.length].y+6)
        ctx.closePath()
        ctx.stroke()
        ct++
      }
    }
  }
 // console.log(path.length, ct)
 // ctx.closePath()
 // ctx.stroke()
  ctx.globalAlpha = 1
}

function drawSegments_old () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineWidth = 0.75
  ctx.strokeStyle = "#ff00ff"
  let i = 0
  for (; i < SEGMENTS.length; i++) {
    ctx.beginPath()
    ctx.moveTo(SEGMENTS[i][0].x+4, SEGMENTS[i][0].y+4)
    ctx.lineTo(SEGMENTS[i][1].x+4, SEGMENTS[i][1].y+4)
    ctx.closePath()
    ctx.stroke()
  }
}

function pruneByCost () {
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.strokeStyle = "#ff00ff"
  clearNeighbors()
  let copy = copyOf(points)
  copy = shuffle(copy)
  let segs = [], unpaired = []
  let found = 0
  let noshow = true
  let vs = voids(noshow) // noshow
  let i = 0, j = 0, ct = 0, vc = 0
  for (; i < copy.length; i++) {
    j = (i+1)
    for (; j < copy.length; j++) { 
      if (copy[i] != copy[j]) {
        ct++
      vc = void_distance(copy[i],copy[j], vs)
      if (vc < 13 && copy[i].neighbors.length < 2 && copy[j].neighbors.length < 2) {
          found++
          copy[i].neighbors.push(copy[j].index)
          copy[j].neighbors.push(copy[i].index)
          segs.push([copy[i].index, copy[j].index])
        }
      }
    }
  }
  let unmatched = []
  i = 0
  for (; i < copy.length; i++) {
    if (copy[i].neighbors.length < 1)
      unmatched.push(copy[i].index)
  }
  console.log(unmatched)
 // clearNeighbors()
  copy = copyOf(points)
  copy = shuffle(copy)
  i = 11111111111111111, j = 0, ct = 0, vc = 0
  for (; i < copy.length; i++) {
    j = (i+1)
    for (; j < copy.length; j++) { 
      if (copy[i] != copy[j]) {
        ct++
      vc = void_distance(copy[i],copy[j], vs)
      if (vc < 3 && unmatched.includes(copy[i].index) && copy[j].neighbors.length === 1) {
          found++
          copy[i].neighbors.push(copy[j].index)
          copy[j].neighbors.push(copy[i].index)
          segs.push([copy[i].index, copy[j].index])
        }
      }
    }
  }
  console.log(segs.length) // may have dupes
  message("connections: "+found+"/"+ct)
  SEGMENTS = segs
  drawSegments()
  return segs
}

function drawSegments () {
  if (SEGMENTS.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.strokeStyle = "#ff00ff"
  ctx.lineWidth = 2
  let i = 0, idx1, idx2, pt
  
  for (; i < SEGMENTS.length; i++) {
    ctx.beginPath()
    idx1 = SEGMENTS[i][0] 
    idx2 = SEGMENTS[i][1]
    pt1 = pointByIndex(idx1)
    pt2 = pointByIndex(idx2)
    ctx.moveTo(pt1.x+4, pt1.y+4)
    ctx.lineTo(pt2.x+4, pt2.y+4)
    ctx.closePath()
    ctx.stroke()
  }
}

function random () { // rename this
  let n = +document.getElementById("numpoints").value, i = 0
  points = []
  
  for (; i < n; i++) {
    points.push(new point(7+Math.random() * 486, 7+Math.random() * 486))
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}

let mappers = ["polar", "smooth_5pt", "simplify180"] // other mappers are NOT dispatched

function dispatch (fn, args) {
  if (points.length < 1)
    loadpoints()
  if (mappers.includes(fn)) {
    console.log(fn)
    document.getElementById("save_prev").checked = false
  }
  let star = ""
  let LS = LOWSCORE
  let t1 = new Date()
  let m1 = measurePath(points,true)
  let copy = copyOf(points)
  
  let OIB = document.getElementById("oib").checked
  if (NO_OIB.includes(fn))
    OIB = false
  let stack = copyOf(functionStack)
  let v = document.getElementById("textarea").value
  window [fn] (args)
  functionStack = stack
  pushFunction("dispatch", fn)
  let m = measurePath(points,true)
  if (OIB && m > m1) {
    points = copy
    drawPath()
    m = m1
  }
  let t2 = round((new Date()-t1)/1000)
  if (m < LS) {
    star = "*"
    recordToLog(fn)
    //console.log(fd())
  }
 // showMarked()
 let flag = ""
 if (mappers.includes(fn))
  flag = " "
  showCG()
  document.getElementById("textarea").value = m +star+" "+ fn+ " \t("+t2+" [s])"+flag+"\n"+v
  document.getElementById("textarea").scroll(0,0)
}

function currentFunction () {
  let f = document.getElementById("search").value
  // only one of the _n functions
  if (!f.endsWith("_n")) {
    f = "twoway_n"
    document.getElementById("search").value = f
  }
  return f
}

function costal () {
  let n = +document.getElementById("numpoints").value, i = 0
  let center = new point(250,250)
  points = []
  
  while (i < n) {
    let np = new point(Math.random() * 500, Math.random() * 500)
    if (distance(np,center) < 250) {
      if (distance(np,center) < 180 && Math.random() > 0.8) {
        points.push(np)
        i++
      } else
      if (distance(np,center) >= 180) {
        points.push(np)
        i++
      }
    }
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}
function disc () {
  let n = +document.getElementById("numpoints").value, i = 0
  let center = new point(250,250)
  points = []
  
  while (i < n) {
    let np = new point(Math.random() * 500, Math.random() * 500)
    if (distance(np,center) < 250) {
      points.push(np)
      i++
    }
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}

function radial () {
  let n = +document.getElementById("numpoints").value, i = 0
  let center = new point(250,250)
  points = []
  while (i < n) { // distance from center
    let np = new point(Math.random() * 500, Math.random() * 500)
    if (distance(np,center)/275 < Math.random()) {
      points.push(np)
      i++
    }
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}

function cresent () {
  let n = +document.getElementById("numpoints").value, i = 0
  let center = new point(250,250)
  let center2 = new point(250,120)
  points = []
  
  while (i < n) {
    let np = new point(Math.random() * 500, Math.random() * 500)
    if (distance(np,center) < 250 && !(distance(np,center2) < 120)) {
      points.push(np)
      i++
    }
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}

function diffusion () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let n = +document.getElementById("numpoints").value, i = 0
  let center = new point(250,250)
  points = []
 
  while (i < n) {
    let np = new point(Math.random() * 500, Math.random() * 500)
    if (/*np.y/500*/ 20/np.y > Math.random()) {
      points.push(np)
      i++
    }
  }
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}

function ellipse () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let n = +document.getElementById("numpoints").value, i = 0
  let center = new point(250,250)
  points = []
  let path = new Path2D()
  path.ellipse(250,250,275,150,Math.PI*0.25, 0, Math.PI*2)
  while (i < n) {
    let np = new point(Math.random() * 500, Math.random() * 500)
    if (ctx.isPointInPath(path, np.x, np.y)) {
      points.push(np)
      i++
    }
  }
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}

function small_disc () {
  let n = +document.getElementById("numpoints").value, i = 0
  let center = new point(250,250)
  points = []
  
  while (i < n) {
    let np = new point(Math.random() * 500, Math.random() * 500)
    if (distance(np,center) < 170) {
      points.push(np)
      i++
    }
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}

function anglefromcenter () {
  let cg = new point(250,250)
  let i = 0, a = 0, d = 0
  for (; i < points.length; i++) {
    a = angle(points[i],cg)
    points[i].angle = a
    d = distance(points[i],cg)
    points[i].distance = d
  }
}

function highlightPoint (pt) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let fs = ctx.fillStyle
  ctx.globalAlpha /= 3
  ctx.fillStyle = "#ff00ff"
  ctx.beginPath()
  ctx.arc(pt.x,pt.y,8,0,Math.PI*2)
  ctx.closePath()
  ctx.fill()
  ctx.globalAlpha *= 3
  ctx.fillStyle = fs
}

function calcAngle(opposite, adjacent) {
  return Math.atan(opposite / adjacent);
}

function ordering (verbose) {
   if (points.length < 1)
    return
  let order = "", i = 0, vector = []
  for (; i < points.length; i++) {
    if (+points[i].index < 10)
      order+="0"
    order+=points[i].index+" "
    vector.push(+points[i].index)
  }
  if (verbose) {
    marklog()
    message(order)
    marklog()
  }
  return vector
}
function shuffled_h () {
  let min = 2e20, minindex = 0, i = 0, m = 2e20, d = 0
  let old = measurePath(points, true), news = -2e20
  let funcs = ['segmentswap', 'swapAcross', 'uncross_paths', 'insert_run']
  //while (old > news) {
  while (i < 21) {
    old = news
    let f = randomPick(funcs)
    window [f] ()
    news = measurePath(points, true)
    if (old < news)
      d++
    i++
  }
  //console.log(d)
}

function showMarked () {
  if (points.length < 1)
    return
  let i = 0
  for (; i < points.length; i++) {
    if (points[i].mark === "x")
      findPoint(points[i].index)
  }
}

function bullseye () {
  if (points.length < 1)
    return
  clearMarks()
  marklog()
  let i = 0
  for (; i < points.length; i++)
    macrox(i)
  i = 0
  for (; i < points.length; i++) {
    message(points[i].index+"\t"+points[i].mark+"\t"+round(points[i].angle)+"\t"+points[i].arms_length)
    if (points[i].mark === "x")
      findPoint(points[i].index)
  }
  message("i \t \tang  \tlen")
  marklog()
}

function macrox (i) {
  let v = document.getElementById("textarea").value
  tidy()
  let copy = copyOf(points)
  let m1 = measurePath(), m2
  let index = Math.floor(Math.random() * points.length)
  if (i)
    index = i
  setAngles()
  setArmsLength()
  poke_point(points[index].index)
  tidy()
  m2 = measurePath()
  document.getElementById("textarea").value = v
  if (m2 < m1) {
    //points[index].mark = "x"
  }
  points = copy // always reset
  drawPath()
}

function heuristic () {
  let min = 2e20, minindex = 0, i = 0, m = 2e20
  let old = measurePath(points, true), news = -1
  news = segmentswap()
  while (old > news) {
    old = news
    news = segmentswap()
  }
  news = swapAcross()
  while (old > news) {
    old = news
    news = swapAcross()
  }
  insert_run()
  uncross_paths()
  insert_run()
  news = swapAcross()
  while (old > news) {
    old = news
    news = swapAcross()
  }
  insert_run()
  uncross_paths()
  news = segmentswap()
  while (old > news) {
    old = news
    news = segmentswap()
    if (news === old)
      break;
  }
  insert_run()
  news = swapAcross()
  while (old > news) {
    old = news
    news = swapAcross()
  }
  untangle3()
}

function tidy () { 
  if (document.getElementById("save_prev").checked)
    copyToClipboard()
  let m1 = measurePath()
  let i = 0
  for (; i < 3; i++) {
    swapAcross()
    insert_run()
    segmentswap()
    uncross_paths()
    swapAcross()
    insert_run()
    segmentswap()
  }
  drawPath(points)
  let m2 = measurePath()
  if (m2 < m1)
    setAngles()
}

function mini_tidy () { 
  swapAcross()
  insert_run()
  segmentswap()
  uncross_paths()
  swapAcross()
  insert_run()
  segmentswap()
 // let funcs = shuffle(["swapAcross","insert_run","segmentswap"])
 // window [funcs[0]] ()
 // window [funcs[1]] ()
 // window [funcs[2]] ()
}

function averageDistanceFromCG () {
  if (points.length < 1)
    return
  let cg = center(), sum = 0, i = 0
  for (; i < points.length; i++) {
    sum += distance(points[i], cg)
  }
  return sum/points.length
}

function elongated () {
  let n = +document.getElementById("numpoints").value, i = 0
  points = []
  
  for (; i < n; i++) {
    points.push(new point(Math.random() * 500, 150 + Math.random() * 100))
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints ()
}

function deletePoints () {
  points = []
  TEMPS = []
  CLUSTERS = []
  SEGMENTS = []
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints ()
  document.getElementById("textarea").value = ""
}

function cleartext () {
  document.getElementById("textarea").value = ""
}
/***
0: [0, 1, 2] 0<1, 0<2, 1<2
1: [0, 2, 1] 0<2, 0<1, 2>1*
2: [1, 0, 2] 1>0, 1<2, 0<2
3: [1, 2, 0]
4: [2, 0, 1]
5: [2, 1, 0] 2>1, 2>0, 1>0

0 1 2 -> 0 (3*0 + 2*1 + 1*2) => 4
0 2 1 -> 1 (3*0 + 2*2 + 1*1) => 5
1 0 2 -> 2 (3*1 + 2*0 + 1*2) => 5
1 2 0 -> 3
2 0 1 -> 4
2 1 0 -> 5
0 1 2 3 4 5 6 7 -> 0
0 1 2 3 4 5 7 6 -> 1
0 1 2 3 4 6 5 7 -> 2
1 3 5 17        -> 0
****/
function testnumbering () {
  let perms = permutator([0,1,2,3])
  let i = 0, n = 0, res = []
  for (; i < perms.length; i++) {
   // console.log(perms[i])
    n = lehmerCode(perms[i])//100*perms[i][0] +10*perms[i][1] + 1*perms[i][2]
    res.push(n)
  }
  console.log(res.sort())
}

function testpermsdistance () {
  let perms = permutator([0,1,2,3])
  let i = 0, j = 0, n = 0, res = [], d
  let min = 2e20, max = -1, maxidi = 0, maxidj = 0, minidi = 2e20, minidj = 2e20
  for (; i < 1; i++) {
    j = i+1
    for (; j < perms.length; j++) {
      d = vectordistance(perms[i], perms[j])
      console.log(perms[i], perms[j], d)
      if (d < min) {
        min = d
        minidi = i
        minidj = j
      }
      if (d > max) {
        max = d
        maxidi = i
        maxidj = j
      }
    }
  }
  console.log(max, perms[maxidi], perms[maxidj],min, perms[minidi], perms[minidj])
}

function lcPoints () {
  if (points.length < 1)
    return -1
  let perm = [], i = 0
  for (; i < points.length; i++)
    perm.push(points[i].index)
  console.log(perm)
  return lehmerCode(perm)
}

function lehmerCode (perm) { 
  let n = perm.length
  let i = 0, sum = 0, m, small
  let fact = []
  while (perm.length > 1) {
    m = smallestIdx(perm)
    small = perm[m]
    sum = 0, i = 0
    for (; i < m; i++) {
      if (perm[i] > small)
        sum++
    }
    perm.splice(m,1)
    fact.push(sum)
  }
  return (parseInt(fact.join(""), 10))
}

function smallestIdx (a) {
  let i = 0, idx = -1, min = 2e20
  for (; i < a.length; i++) {
    if (a[i] < min) {
      min = a[i]
      idx = i
    }
  }
  return idx
}

function integerToCode(int, permSize) {
    if (permSize <= 1) {
        return [0];
    }
    var multiplier = factorial(permSize-1);
    var digit = Math.floor(int / multiplier);
    return [digit].concat(
        integerToCode(
            int % multiplier,
            permSize-1));
}

 function int2num (n, a) {
  let A = [], i = 0
  for (; i < n-2; i++) {
    A.push((a%(n-1)))
    a = a/(n-1)
  }
  return A
 }
/*
 Int2Num(n, ) { conversion from integer to w-system }
for i  0 to n  2 do
A[i]   mod (n  i)
   div (n  i)
end for
return A
*/

function brute_force (NOSHOW) { // brute force 
  if (points.length < 1)
    return
  let pts = copyOf(points)
  if (pts.length > 10) {
    // 10 points takes about 45 sec
    alert("No more that 10 points.\n")
    return
  }
  let pmin = [], i = 0
  let L_min = 1e20, l = 0
  let perms = permutator(pts)
  starttime = new Date()
  for (; i < perms.length; i++) { //perms.length
    l = measurePath(perms[i],true)
    if (l < L_min) {
      L_min = l
      pmin = perms[i]
    }
  }
  let endtime = new Date()
  //console.log((endtime-starttime)/1000,"[s]")
  points = pmin
  drawPath(pmin)
}

let GP = [0,1,2,3]
function nextPerm_ () {
  //console.log(GP)
  points = nextPermutation(GP)
  console.log(GP)
}

function mapOrder (array, order, key) {
  array.sort( function (a, b) {
    var A = a[key], B = b[key];
    if (order.indexOf(A) > order.indexOf(B)) {
      return 1;
    } else {
      return -1;
    }
  });
  return array;
};

// show (highlight) segments where the more costly path was used where <!=>
// at least list them distance
function costlySegments () {
  if (points.length < 1)
    return
  let i = 0, res = "", L = points.length, count = 0
  for (; i < points.length; i++) {
    if (points[i].index < points[(i+1)%L].index) {
      res += points[i].index +","+ points[(i+1)%L].index + "\n"
      count++
    }
  }
  marklog()
  message(res)
  message(count+" costly segemnts (if <\u{2260}>)")
  marklog()

  let icon = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="23" fill="currentColor" class="bi bi-currency-dollar" viewBox="0 0 16 16"><path d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73z"/></svg>'
}

let MUT = [0,1,2,3,4]

function chunkify () {
  if (points.length < 5)
    return
  let P = []
  let n = Math.floor(points.length/5), i = 0, k = 0
  let rem = points.length%n, d = 0
  let copy = copyOf(points)
  for (; i < (MUT.length-1); i++) {
    d = (rem-- > 0)?1:0;
    a = copy.splice(0, n+d);
    P.push(a)
  }
  P.push(copy) // leftovers
  return (P)
}

function chunkify_rev () {
  if (points.length < 5)
    return
  let P = []
  let n = Math.floor(points.length/5), i = 0, k = 0
  let rem = points.length%n, d = 0
  let copy = copyOf(points)
  for (; i < (MUT.length-1); i++) {
    d = (rem-- > 0)?1:0;
    a = copy.splice(0, n+d);
    P.push(a)
  }
  P.push(copy) // leftovers
  i = 0
  for (; i < P.length; i++) {
    P[i].reverse()
  }
  return (P)
}

function mutate2way () {
  if (document.getElementById("save_prev").checked)
    copyToClipboard()
  let m1 = measurePath()
  mutate ()
  mutate_rev()
  let m2 = measurePath()
  if (m2 < m1)
    setAngles()
}

function mutate () {
  let chunks = chunkify() // was chunkify
  MUT = nexPermutation(MUT) // global MUT = [0,1,2,3,4]
  // sort chunks by perm
  let k = 0, temp = []
  for (; k < MUT.length; k++)
    temp.push(chunks[MUT[k]])
  chunks = temp
  // join the chunks
  let i = 0, j = 0, copy = []
  for (; i < chunks.length; i++) {
    j = 0
    for (; j < chunks[i].length; j++)
      copy.push(chunks[i][j])
  }
  points = copy
  m = drawPath()
  heuristic()
}

function mutate_rev () {
  let chunks = chunkify_rev() 
  MUT = nexPermutation(MUT) // global MUT = [0,1,2,3,4]
  // sort chunks by perm
  let k = 0, temp = []
  for (; k < MUT.length; k++)
    temp.push(chunks[MUT[k]])
  chunks = temp
  // join the chunks
  let i = 0, j = 0, copy = []
  for (; i < chunks.length; i++) {
    j = 0
    for (; j < chunks[i].length; j++)
      copy.push(chunks[i][j])
  }
  points = copy
  m = drawPath()
  heuristic()
}

function nPermsHence () {
  if (points.length < 1)
    return
  let v1 = ordering()
  let n = 10000 * document.getElementById("iterations").value
  let i = 0, INT // get n from a number field * 10000
  for (; i < n; i++) {
    applyNextPerm()
  }
  console.log(i)
  console.log(vectordistance(v1, ordering()))
  drawPath()
  ordering(true)
  pushFunction("nPermsHence")
  let m = round(drawPath(points, true))
  message(m + " "+n+" nPermsHence")
}

function nextPerm () {
  if (points.length < 1)
    return
 // points = nextPermutation(points)
  applyNextPerm()
  pushFunction("nextPerm")
  let m = round(drawPath(points, true))
  message(m + " nextPerm")
}

const nextPermutation = function (N) {
  const swap = (i, j) =>
      [N[i],N[j]] = [N[j],N[i]]
  let len = N.length - 1, i
  for (i = len - 1; N[i].index >= N[i+1].index;) {
    i-- // index of undefined
  }
  let j = i + 1, k = len
  while (j < k) swap(j++,k--)
  if (i >= 0) {
    for (j = i + 1; N[i].index >= N[j].index;) j++
    swap(i,j)
  }
  return N
};

function applyNextPerm () {
   if (points.length < 1)
    return
  let curr = ordering()
  let next = nexPermutation(curr)
  points.sort(function(a,b){
    return next.indexOf(a.index) - next.indexOf(b.index);
  });
}

const nexPermutation = function (N) {
  const swap = (i, j) =>
      [N[i],N[j]] = [N[j],N[i]]
  let len = N.length - 1, i
  for (i = len - 1; N[i] >= N[i+1];) i-- 
  let j = i + 1, k = len
  while (j < k) swap(j++,k--)
  if (i >= 0) {
    for (j = i + 1; N[i] >= N[j];) j++
    swap(i,j)
  }
  return N
};

function perms () { // brute force 
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let j = 0, S = 44
  ctx.lineJoin = "miter"
  ctx.fillStyle = "#ffffff"
  let pts = [], pts_pf = [], ct = 0
  let i = 0, x = 0, y = 0, l = 0
  for (; i < 5; i++) {
    pts.push(new point(Math.random()*S, Math.random()*S))
  }
  let W = H = S
  let pt0 = new point(Math.random()*S, Math.random()*S)//pts.shift()
  let pts2 = copyOf(pts)
  pts2.push(pt0)
  let bf = brute_force(pts2)
  ctx.clearRect(0,0,canvas.width, canvas.height)
  let perms = []
  let perms_ = permutator(pts)
  perms.push(points)
  j = 0
  for (; j < perms_.length; j++) {
    //if (perms_[j][0] === pt0) 
      perms_[j].push(pt0)
      perms.push(perms_[j])
      ct++
  }
 // console.log(perms)
  let max = (perms.length > 400)? 400: perms.length;
  i = 0
  for (; i < max; i++) {
    ctx.strokeStyle = "#ffffff"
    ct++
    drawPathAt(perms[i], x, y)
    x += S
    if (x >= 480) {
      x = 0
      y += S
    }
  }
  console.log(ct)
}

function printPoints () {
  if (points.length < 1)
    return
  ta = document.getElementById("textarea")
  let str = JSON.stringify(points, null, 2);
  str = str.replace(new RegExp("\\n\\s+(-?[0-9]+,)",'gm'), "$1")
  console.log(str)
  ta.value = str//JSON.stringify(points, null, 2);
}

function log_path_length () {
  if (points.length < 1)
    return
  message("path length:"+measurePath())
}

function measurePath (pts,NOSHOW) {
  if (!pts)
    pts = points
  let i = 0, D = 0
  for (; i < pts.length-1; i++) {
    D += distance_weighted(pts[i],pts[i+1])
  }
  D += distance_weighted(pts[i],pts[0])
  D = round(D)
   if (!NOSHOW) {
     let canvas = document.getElementById("myCanvas")
     let ctx = canvas.getContext("2d")
     ctx.font = "13px sans-serif"
     ctx.fillStyle = "#ffffcc"
     ctx.fillText(D, 450,490)
     ctx.fillStyle = "#000000"
     if (D < LOWSCORE) {
      LOWSCORE = round(D)
      document.getElementById("lowscore").innerText = "" + round(D)+""
    }
  }
  return round(D)
}

function chunkswap (a) { // testing 
  let w = 2+Math.floor(Math.random() * a.length/2), wc=0
  let si = Math.floor(Math.random() * a.length)
  let temp = [], ids = []
  while (wc < w) {
    temp.push(a[(si+1)%a.length])
    si = (si + 1) % a.length
    ids.push(si)
    wc++
  }
  // remove all of temp from a
  let leftovers = []
  let i = 0
  for (; i < a.length; i++) {
    if (!ids.includes(i))
      leftovers.push(a[i])
  }
  // splice temp's items into leftover at a random index
  let insert = Math.floor(Math.random() * leftovers.length)
  let count = 0 // splice at insert+count
  i = 0
  for (; i < temp.length; i++) {
    leftovers.splice(insert+count++,0,temp[i])
  }
  return(leftovers)
}

function chunkswap_run  () {
  if (points.length < 1)
    return
  let copy = copyOf(points), res
  let i = 0, j
  for (; i < copy.length; i++) {
    j = 0
    for (; j < copy.length; j++) {
      if (i !== j) {
        res = chunkswap_ij(copy, i, j)
        if (measurePath(res,true) < measurePath(copy,true)) {
          copy = res
        }
      }
    }
  }
  //drawPath()
  points = copy
  return points
}

function chunkswap_ij (a, w, si) { 
  let temp = [], ids = [], wc = 0
  while (wc < w) {
    temp.push(a[(si+1)%a.length])
    si = (si + 1) % a.length
    ids.push(si)
    wc++
  }
  // remove all of temp from a
  let leftovers = []
  let i = 0
  for (; i < a.length; i++) {
    if (!ids.includes(i))
      leftovers.push(a[i])
  }
  // splice temp's items into leftover at a random index
  let insert = Math.floor(Math.random() * leftovers.length)
  let count = 0 // splice at insert+count
  i = 0
  for (; i < temp.length; i++) {
    leftovers.splice(insert+count++,0,temp[i])
  }
  return(leftovers)
}

function anneal () {
  let i = 0, t = 0.99, N = 2000
  let delta = 1/N
  while (i < N) {
    jiggle(t)
    t -= delta
    i++
  }
  //console.log(A,B)
  A = 0, B = 0
  drawPath()
}

let A = 0, B = 0

function segmentswap () {
  let copy = copyOf(points)
  copy = chunkswap_run(copy)
  points = copy
  let m = drawPath(points)
  return m
}

function f (t,index) { 
  if (!index) 
    index = Math.floor(Math.random() * points.length)
  let i = 0, OL = measurePath(points,true), d = 0
  let L = points.length, offset = randomPick([1,Math.floor(L/2)])//Math.floor(Math.random() * L/4)
  let res = points
  let copy = copyOf(points)
  let temp = copy[index]
  let r = randomPick([0,1,2,3])
  if (r === 0) { // swap at distance
    copy[index] = copy[(index+offset)%L]
    copy[(index+offset)%L] = temp
  } else 
  if (r === 1) {
    copy.splice(index,1) // insert
    copy.splice(Math.floor(Math.random()*copy.length),0,temp)
  } else 
  if (r === 2) {
    copy[index] = copy[(index+1)%L] // swap neighbors
    copy[(index+1)%L] = temp
  } else {
    copy = chunkswap(copy)
  }
  d = measurePath(copy,true)
  res = copyOf(copy)
  let e = 2.7182
  let p = Math.pow(e,-((d-OL)/OL))
  if (d < OL) {
    points = res
    B++
  }
  else 
  if (t > p && d < OL*1.02) {
    points = res
    A++
  } 
  showPoints()
}

function jiggle (t,index) { 
  if (!index) 
    index = Math.floor(Math.random() * points.length)
  let i = 0, OL = measurePath(points,true), d = 0
  let L = points.length, offset = randomPick([1,Math.floor(L/2)])//Math.floor(Math.random() * L/4)
  let res = points
  let copy = copyOf(points)
  let temp = copy[index]
  let r = randomPick([0,1,2,3])
  if (r === 0) { // swap at distance
    copy[index] = copy[(index+offset)%L]
    copy[(index+offset)%L] = temp
  } else 
  if (r === 1) {
    copy.splice(index,1) // insert
    copy.splice(Math.floor(Math.random()*copy.length),0,temp)
  } else 
  if (r === 2) {
    copy[index] = copy[(index+1)%L] // swap neighbors
    copy[(index+1)%L] = temp
  } else {
    copy = chunkswap(copy)
  }
  d = measurePath(copy,true)
  res = copyOf(copy)
  let e = 2.7182
  let p = Math.pow(e,-((d-OL)/OL))
  if (d < OL) {
    points = res
    B++
  }
  else 
  if (t > p && d < OL*1.02) {
    points = res
    A++
  } 
  showPoints()
}

function insert_run () {
  //if (points.length < 1)
  //  return
  let v = document.getElementById("textarea").value
  let i = 0, j = 0
  for (; i < points.length; i++) {
    j = 0
    for (; j < points.length; j++) {
      if (i !== j)
        insert_inner(i,j)
    }
  }
  drawPath(points)
  //document.getElementById("textarea").value = Math.round(10*measurePath(points,true))/10 + " insert\n" + v
  //pushFunction("insert_run")
}

function insert_inner (i,j) { 
  if (points.length < 1)
    return
  let OL = measurePath(points,true), d = 0
  let L = points.length
  let res = points
  let copy = copyOf(points)
  let temp = copy[i]
  let r = Math.random()
  copy.splice(i,1) // insert
  copy.splice(j,0,temp)
  d = measurePath(copy,true)
  res = copyOf(copy)
  if (d < OL) {
    points = res
  }
  //showPoints()
}

function insertAt (i, offset) {
  if (points.length < 1)
    return
  let ip = 0
  if (offset > 0) {
    ip = (i + offset) % points.length
  } else {
    ip = (i + offset < 0)? (points.length)+(i+offset):(i+offset) ;
  }
  swap(i,ip)
  return (ip)
}

function untangle () {
  if (points.length < 1)
    return
  let v = document.getElementById("textarea").value
  let n = points.length, i = 0
  for (; i < n; i++)
    jiggleswap(i)
  i = 0
  for (; i < n; i++)
    jiggleswap(i)
  drawPath()
  document.getElementById("textarea").value = Math.round(10*measurePath(points,true))/10+" untangle\n" + v
}

function untangle3 () { // 3 points
  if (points.length < 1)
    return
  let v = document.getElementById("textarea").value
  let n = points.length, i = 0
  for (; i < n; i++)
    jiggleswap3(i)
  i = 0
  for (; i < n; i++)
    jiggleswap3(i)
  drawPath()
  document.getElementById("textarea").value = Math.round(10*measurePath(points,true))/10+" untangle\n" + v
}

function untangle2 () {
  if (points.length < 1)
    return
  let v = document.getElementById("textarea").value
  let n = points.length, i = 0
  for (; i < n; i++)
    jiggleswapfar(i)
  i = 0
  for (; i < n; i++)
    jiggleswapfar(i)
  drawPath()
  document.getElementById("textarea").value = Math.round(10*measurePath(points,true))/10+" untangle\n" + v
}

function jiggleswapfar (index) { 
  if (!index) 
    index = Math.floor(Math.random() * points.length)
  let i = 0, OL = measurePath(points,true), d = 0
  let L = points.length, offset = randomPick([2,Math.floor(L/2)])//Math.floor(Math.random() * L/4)
  let res = points
  let copy = copyOf(points)
  let temp = copy[index]
  let r = Math.random()
  if (true) {
    copy[index] = copy[(index+offset)%L]
    copy[(index+offset)%L] = temp
  } 
  d = measurePath(copy,true)
  res = copyOf(copy)
  if (d < OL) {
    points = res
    B++
  }
}

function jiggleswap (index) { 
  if (!index) 
    index = Math.floor(Math.random() * points.length)
  let i = 0, OL = measurePath(points,true), d = 0
  let L = points.length, offset = randomPick([1,Math.floor(L/2)])//Math.floor(Math.random() * L/4)
  let res = points
  let copy = copyOf(points)
  let temp = copy[index]
  let r = Math.random()
  if (true) {
    copy[index] = copy[(index+1)%L] // swap neighbors
    copy[(index+1)%L] = temp
  } 
  d = measurePath(copy,true)
  res = copyOf(copy)
  if (d < OL) {
    points = res
    B++
  }
}

function jiggleswap3 (index) { 
  if (!index) 
    index = Math.floor(Math.random() * points.length)
  let i = 0, OL = measurePath(points,true), d = 0
  let L = points.length, offset = randomPick([1,Math.floor(L/2)])//Math.floor(Math.random() * L/4)
  let res = points
  let copy = copyOf(points)
  let temp = copy[index]
  copy[index] = copy[(index+2)%L] // swap neighbors
  copy[(index+2)%L] = temp
  d = measurePath(copy,true)
  res = copyOf(copy)
  if (d < OL) {
    points = res
    B++
  }
}

function deletePoint (index) { 
  if (points.length < 1)
    return
  points.splice(index,1)
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints()
}

function copyOf (a) {
  let i = 0, copy = []
  for (; i < a.length; i++) {
    copy.push(a[i])
  }
  return copy
}

function message (m) {
  let v = document.getElementById("textarea").value
  document.getElementById("textarea").value = m + "\n" + v
  document.getElementById("textarea").scroll(0,0)

}

function simplify_solve () {
  let copy = copyOf(points)
  let saved = LOWSCORE
  heuristic()
  copyToClipboard()
  let m0 = round(measurePath(points,true))
  let n = 1 + Math.floor(points.length/7)
  let i = 0
  for (; i < n; i++)
    simplify()
  // don't record as lowest score
  heuristic()
  LOWSCORE = saved
  unmap()
  tidy()
  pushFunction("simplify_solve")
  let m = round(measurePath(points,true))
  if (m < m0 && m < LOWSCORE) {
    LOWSCORE = m
  }
}

function pad (n) {
  // to 5 with spaces
  let s = ""+n, i = 0
  for (; i < 5-s.length; i++) {
    s += " "
  }
  return s
}

function showxy () {
  if (points.length < 1)
    return
  let i = 0, res = "----------------------\nx    \ty    \tindex\n", x, y 
  for (; i < points.length; i++) {
    let x = round(points[i].x), y = round(points[i].y)
    x = pad(x)
    y = pad(y)
    res += x + "\t" + y + "\t" + points[i].index+"\n"
  }
  res += "----------------------"
  message(res)
}

function unmap () {
  if (CLIPBOARD.length < 1)
    return
  let  dest = JSON.parse(CLIPBOARD)
  if (dest.length === points.length)
    copyOrder(points, dest)
  drawPath()
  topology()
  let v = document.getElementById("textarea").value
  let m = measurePath()
  document.getElementById("textarea").value = "unmap points "+m+" \n" + v
  pushFunction("unmap")
}

function copyOrder (src, dest) {
  let i = 0, j = 0,temp = []
  for (; i < src.length; i++) {
    j = 0
    for (; j < dest.length; j++) {
      if (dest[j].index === src[i].index) {
        temp.push(dest[j])
        break;
      }
    }
  }
  points = temp
  drawPath()
}

// index of closest point
function nearestPoint (pt) {
  if (points.length < 1)
    return
  let i = 0, d
  let mind = 2e20, mini = -1
  for (; i < points.length; i++) {
    d = distance (points[i], pt)
    if (d < mind) {
      mind = d
      mini = i
    }
  }
  return (mini)
}
/* fractal dimension ref ... 
A simple but useful equation was found to be: 
D = log(n)/[log(n) + log(d/L)], 
where the n is the number of intervals in the trajectory, 
d is the planar extent of the curve and 
L is the length of the trajectory
D = 1.61, d computed from bounding box
D = log(n)/[log(n) + log(d/L)] // start
D/log(n) = 1/(log(n) + log(d/L))
1/(D/log(n)) - log(n) = log(d/L)
exp(1/(D/log(n)) - log(n)) = d/L
(exp(1/(D/log(n)) - log(n)))/d = 1/L
*/

function L_ () {
  if (points.length < 1)
    return 0
  let bp = boundingPoints()
  let D = 1.5 //fd()
  d = distance(bp[0], bp[1])
  L = measurePath(points,true)
  n = points.length
  let ln = Math.log(n)
  //console.log(1/((Math.exp(1/(D/Math.log(n)) - Math.log(n)))/d))
  return (1/((Math.exp(1/(D/Math.log(n)) - Math.log(n)))/d))
}

function fd () {
  if (points.length < 1)
    return 0
  let bp = boundingPoints()
  
  d = distance(bp[0], bp[1])
  L = measurePath(points,true)
  n = points.length
  //console.log(Math.log(L)/Math.log(d))
  return (Math.log(n)/(Math.log(n) + Math.log(d/L)))
}

function compareNumbers(a, b) {
  return a - b;
}

function spacing () {
  if (points.length < 1)
    return 0
  let T = 0, i = 0, cn
  for (; i < points.length; i++) {
    cn = closestNeighbors(i, points)
    //console.log(cn)
    T += distance(cn[1], cn[2])
  }
  return (T/points.length)
}

function angle_deg(p1,p2) {
  return angle(p1,p2) * 180/Math.PI
}

function signOf (n) {
  return (n < 0)?-1:1;
}

function angleT_ (cx, cy, ex, ey) {
  var dy = ey - cy;
  var dx = ex - cx;
  var theta = Math.atan2(dy, dx); // range (-PI, PI]
  theta *= 180 / Math.PI; // rads to degs, range (-180, 180]
  //if (theta < 0) theta = 360 + theta; // range [0, 360)
  return theta;
}

function angleT(originX, originY, targetX, targetY) {
    var dx = originX - targetX;
    var dy = originY - targetY;

    // var theta = Math.atan2(dy, dx);  // [0, ] then [-, 0]; clockwise; 0 = west
    // theta *= 180 / Math.PI;          // [0, 180] then [-180, 0]; clockwise; 0 = west
    // if (theta < 0) theta += 360;     // [0, 360]; clockwise; 0 = west

    // var theta = Math.atan2(-dy, dx); // [0, ] then [-, 0]; anticlockwise; 0 = west
    // theta *= 180 / Math.PI;          // [0, 180] then [-180, 0]; anticlockwise; 0 = west
    // if (theta < 0) theta += 360;     // [0, 360]; anticlockwise; 0 = west

    // var theta = Math.atan2(dy, -dx); // [0, ] then [-, 0]; anticlockwise; 0 = east
    // theta *= 180 / Math.PI;          // [0, 180] then [-180, 0]; anticlockwise; 0 = east
    // if (theta < 0) theta += 360;     // [0, 360]; anticlockwise; 0 = east

    var theta = Math.atan2(-dy, -dx); // [0, ] then [-, 0]; clockwise; 0 = east
  //  theta *= 180 / Math.PI;           // [0, 180] then [-180, 0]; clockwise; 0 = east
 //   if (theta < 0) theta += 360;      // [0, 360]; clockwise; 0 = east

    return theta;
}

function angle_cos (p2,p1,p3) {
  let p12 = distance_euclid(p1,p2)
  let p13 = distance_euclid(p1,p3)
  let p23 = distance_euclid(p2,p3)
  return 180 *(1* Math.acos(((Math.pow(p12, 2)) + (Math.pow(p13, 2)) - (Math.pow(p23, 2))) / (2 * p12 * p13)))/Math.PI
}

function sortedByAngle_cos (pts) {
  setAngles()
  let copy = copyOf(points)
  copy.sort((a, b) => a.angle > b.angle ? 1 : -1);
  return copy
}

function sortedByArmsLength () {
  setArmsLength()
  let copy = copyOf(points)
  copy.sort((a, b) => a.arms_length > b.arms_length ? -1 : 1);
  return copy
}

function is_clockwise (cg, pt1, pt2) { 
  // crossing 360 adjustment???
 // intersects
  
  if (pt2.angle > pt1.angle)
    return true
  else
    return false
} 

function crossesMidline (p1,p2) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let cg = center()
  let p3 = new point(0, cg.y)
  let p4 = new point(500, cg.y)
  ctx.beginPath()
  ctx.moveTo(0, cg.y)
  ctx.lineTo(500, cg.y)
  ctx.strokeStyle = 'red'
  ctx.lineWidth = 0.5
  ctx.stroke()
  let ix = intersects(p1,p2,p3,p4)
  let ixrev = intersects(p2,p1,p3,p4)
 // if (ix && p2.x > cg.x)
   // console.log(p2.index, ix)
  //if(ixrev && p1.x > cg.x)
  //  console.log(p1.index, ixrev)
  return (ix && p2.x > cg.x)
}

function rotations () {
  if (points.length < 1)
    return 0
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let cg = center(), cw = 0, ccw = 0
  showCG()
  let result = ""
  let i = 0, a = 0, j, switches = 0
  let prev = 0
  let L = points.length
  for (; i < L; i++) {
    a = angle(cg, points[i]) * 180/Math.PI
    if (a < 0)
      a += 360
    points[i].angle = a
  }
  let prev_i = 0
  i = 0
  for (; i < L; i++) {
    prev_i = (i === 0)? L-1: i-1;
    let p = points[i]
    a = is_clockwise(cg, points[prev_i], points[i])
    rightcross = crossesMidline(points[prev_i], points[i])
    if(rightcross)
      a = !a
    if (a) {
      cw++
      ctx.fillStyle = "#ff000060"
    } else {
      ccw++
      ctx.fillStyle = "#00ff0060"
    }
    ctx.beginPath()
    ctx.arc(points[i].x, points[i].y, 8, 0, 2*Math.PI)
    ctx.fill()
    prev = a
  }
  message("rotations: :" +cw+", :"+ccw)
}

function in_out () {
  if (points.length < 1)
    return 0
  let result = ""
  let i = 0, iprev = 0, a = 0, j, outcount = 0, mean_dist = 0, distances = []
    IN = true, inflections = 0
  let sum = 0, L = points.length, last = 0, latest = 0, found = []
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let cg = center()
  showPoints()
  showCG()
  ctx.globalAlpha = 0.5
  
  for (; i < points.length; i++) {
    iprev = (i === 0)? L-1: i-1;
    last = distance(cg, points[iprev])
    latest = distance(cg, points[i])
    
    if (last < latest) {
      ctx.fillStyle = "orange"
      outcount++
      mean_dist += latest
      found.push(points[i])
      distances.push(latest)
    } else {
      ctx.fillStyle = "blue"
   // found.push(points[i])
    }
    ctx.beginPath()
    ctx.arc(points[i].x, points[i].y, 7, 0, 2*Math.PI)
    ctx.fill()
    sum += latest
  }
  ctx.globalAlpha = 1
 // console.log(mean(distances), sd(distances))
 // console.log(Math.pow(sd(distances)/mean(distances), 2))
  result += "in/out:" 
  //result += "x dist(,cg):"+round(mean_dist/outcount)
  result += "lucanarity dist(,cg):"+Math.round(1000*Math.pow(sd(distances)/mean(distances), 2))/1000
  message(result)
  return (found)
}

function void_distance (p1, p2, vs) {
  let voids_ = vs[0], costs = vs[1]
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let voidsize = document.getElementById("voidsize").value
  ctx.lineWidth = voidsize * 1.2
  path = new Path2D() 
  path.moveTo(p1.x,p1.y)
  path.lineTo(p2.x,p2.y)
  let j = 0, cost = 0
  let bp = boundingPoints([p1,p2])
  let xmin = bp[0].x-voidsize*2, ymin = bp[0].y-voidsize*2,
      xmax = bp[1].x+voidsize*2, ymax = bp[1].y+voidsize*2
  // optimze by finding bounding box of p1,p2 to get start & end for voids to test
  for (; j < voids_.length; j++) {
    if (pointInRect2(voids_[j], xmin, ymin, xmax, ymax)) {
      if (ctx.isPointInStroke(path, voids_[j].x, voids_[j].y)) {
        cost += costs[j]
      }
    }
  }
  return cost
}

function clusterbyvoids () { 
  if (points.length < 1)    // use same logic as local cluster func. w/ void distance measure
    return 0
  let clusters = [], i = 0, d = 0, j = 0
  let found = []
  clearNeighbors()
  let vs = voids(true) // NOSHOW

  let voids_ = vs[0], costs = vs[1] // set up neighbors
  let L = points.length
  for (; i < L; i++) {
    points[i].neighbors = []
    j = 0
    for (; j < L; j++) {
      d = 0
      if (i !== j) {
        d = void_distance(points[i], points[j], vs)
        if (d < 1)
          points[i].neighbors.push(points[j].index)
      }
    }
  }
  showClusters()
}

function turnings () {
  if (points.length < 1)
    return 0
  let result = ""
  let i = 0, iprev = 0, a = 0, j, acute = 0
  let sum = 0, L = points.length
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  showPoints()
  showCG()
  ctx.globalAlpha = 0.5
  for (; i < points.length; i++) {
    iprev = (i === 0)? L-1: i-1;
    a = angle_cos(points[iprev], points[i], points[(i+1)%L])
    points[i].angle = a
    if (a < 90) {
      ctx.fillStyle = "orange"
      acute++
      
    } else {
     // points[i].weight = 0.8
      ctx.fillStyle = "blue"
    }
    ctx.beginPath()
    ctx.arc(points[i].x, points[i].y, 7, 0, 2*Math.PI)
    ctx.fill()
    sum += a
  }
  console.log(sum)
  ctx.globalAlpha = 1
  result += "turning: x:"+round(sum/L)
  result+=", :"+acute+", :"+(L-acute)
  message(result)
  return sum
}

function polar () {
  if (points.length < 1)
    return 0
  copyToClipboard()
  let i = 0, cg = center(points), dy, a = 0
  let polarized = sortedByAngle(copyOf(points)) // around cg
  points = polarized
  // sort by angle 0 - 2*Math.PI
  for (; i < polarized.length; i++) {
    let p = polarized[i]
    dy = distance(p, cg)
    a = angle(cg, p)
    if (a < 0) {
      a += 2*Math.PI
    //  console.log(p.index, Math.floor(100*a)/100)
    }
   // console.log(p.index, Math.floor(100*a)/100)
    p.x = (a) * 500/(2*Math.PI)
    // p.y == distance from cg
    p.y = dy
    
  }
  drawPath(polarized) 
  // draw cg
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.fillStyle = "red"
  ctx.beginPath()
  ctx.arc(cg.x, cg.y, 4, 0, 2*Math.PI)
  ctx.fill()
}

function showCG () {
  if (points.length < 1)
    return 0
  let cg = center()
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.fillStyle = "red"
  ctx.beginPath()
  ctx.arc(cg.x, cg.y, 4, 0, 2*Math.PI)
  ctx.fill()
  ctx.lineWidth = 1
  ctx.strokeStyle = "white"
  ctx.beginPath()
  ctx.arc(cg.x, cg.y, 5, 0, 2*Math.PI)
  ctx.stroke()
  ctx.strokeStyle = "black"
  ctx.beginPath()
  ctx.arc(cg.x, cg.y, 6.2, 0, 2*Math.PI)
  ctx.stroke()
}

function smooth_a_cluster (pts) {
  if (pts.length < 5)
    return 0
  //copyToClipboard()
  let i = 0, cn, wt = 1
  let smoothed = [], avgx = 0, avgy = 0, j = 0
  let pts_ = copyOf(pts)
  for (; i < pts_.length; i++) {
    cn = closestNeighbors(i, pts_)
    console.log(cn) // indexs
    
    avgx = 0, avgy = 0, j = 0
    for (; j < cn.length; j++) {
      
      wt = 1
      let pt = pointByIndex(cn[j])
      console.log(pt)
      avgx += pt.x*wt
      avgy += pt.y*wt
    }
    let p = new point(avgx/cn.length,avgy/cn.length)
    p.index = pts_[i].index
    smoothed.push(p)
  }
  points = smoothed // loop to replace
  drawPath(smoothed)
} 

function smooth_5pt () {
  if (points.length < 5)
    return 0
  copyToClipboard()
  let i = 0, cn, wt = 1
  let smoothed = [], avgx = 0, avgy = 0, j = 0
  let pts = copyOf(points)
  for (; i < pts.length; i++) {
    cn = closestNeighbors(i, pts)
    avgx = 0, avgy = 0, j = 0
    for (; j < 5; j++) {
      if (j === 0) 
        wt = 1.25
      if (j > 0)
        wt = 0.5
      if (j > 2)
        wt = 0.25
      avgx += cn[j].x*wt
      avgy += cn[j].y*wt
    }
    let p = new point(avgx/2.75,avgy/2.75)
    p.index = pts[i].index
    smoothed.push(p)
  }
  points = smoothed
  drawPath(smoothed)
}

function longestSegment () {
  if (points.length < 1)
    return 0
  let d = 0, dmax = 0, i = 0, seg = []
  for (; i < points.length; i++)  {
    d = distance(points[i], points[(i+1)%points.length])
    if (d > dmax) {
      dmax = d
      seg = [points[i], points[(i+1)%points.length]]
    }
  }
  return (seg)
}
function longestSegmentidx () {
  if (points.length < 1)
    return 0
  let d = 0, dmax = 0, i = 0, seg = []
  for (; i < points.length; i++)  {
    d = distance(points[i], points[(i+1)%points.length])
    if (d > dmax) {
      dmax = d
      seg = [i, (i+1)%points.length]
    }
  }
  return (seg)
}

function cutLongestSegment () {
 // if (points.length < 1)
//    return 0
//  let v = document.getElementById("textarea").value
  let seg = longestSegmentidx()
  //seg[0] -= 1
  //if (seg[0] < 0)
   // seg[0] = points.length - 1
  //seg[1] = (seg[1]+1)%points.length
  let p = points[seg[1]]
  points[seg[1]] = points[seg[0]]
  points[seg[0]] = p
  drawPath()
  //document.getElementById("textarea").value = Math.round(10*measurePath(points,true))/10 + " cutLongestSegment\n" + v
  //pushFunction("cutLongestSegment")
}

function optimalL () {
  if (points.length < 1)
    return 0
  let N = points.length, dist = []
  let i = 0, j = 0

  let bp = boundingPoints(points)
  let a = Math.abs(bp[0].x - bp[1].x)
  let b = Math.abs(bp[0].y - bp[1].y)
  let A = a*b
  let L = Math.sqrt(2*(N-1)*A) + 2*(a+b)
//  L = Math.sqrt(A/2)*(Math.sqrt(N)-1/Math.sqrt(N))
  L = (0.75*Math.sqrt(N*A))
  let sum = 0
  i = 0
  for (; i < N+1; i++) {
    sum += dist[i]
  }
  return (Math.round(L) + " estimated min length")
}

function boundingBox () {
  if (points.length < 1)
    return
  let bp = boundingPoints(points)
  let bd = distance(bp[0], bp[1])
  let w = round(Math.abs(bp[0].x - bp[1].x))
  let h = round(Math.abs(bp[0].y - bp[1].y))
  return "w "+w+", h "+h
}

function mean (array) {
  let i = 0, m = 0
  for (; i < array.length; i++)
    m += array[i]
  return m/array.length
}

function sd (array) {
  const n = array.length
  const mean = array.reduce((a, b) => a + b) / n
  return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)
}

function closestpointin (pt, pts) {
  let i = 0, d
  let mind = 2e20, mini = -1
  for (; i < pts.length; i++) {
    d = distance(pts[i], pt)
    if (d < mind) {
      mind = d
      mini = i
    }
  }
  return (pts[mini])
}

let INDEX = 0
let CLIPBOARD = ""

function swapWithClipboard () {
  if (CLIPBOARD.length < 1 || points.length < 1)
    return
  TEMPS = []
  CLUSTERS = []
  SEGMENTS = []
  if (points.length > 0 && CLIPBOARD.length > 0) {
    let temp = JSON.stringify(points, null, 4)
    offpts = CLIPBOARD
    CLIPBOARD = temp
    points = JSON.parse(offpts)
    redrawPath()
  }
  let v = document.getElementById("textarea").value
  document.getElementById("textarea").value = Math.round(10*measurePath(points,true))/10+" swap with clipboard\n" + v
  pushFunction("swapWithClipboard")
}

function copyToClipboard (pts) {
  if (pts)
    points = pts
  if (points.length > 0) {
    CLIPBOARD = JSON.stringify(points, null, 4)
  }
  pushFunction("copyToClipboard", pts)
}

function pasteFromClipboard () {
  if (CLIPBOARD.length > 1) {
    TEMPS = []
    CLUSTERS = []
    SEGMENTS = []
    let jobj = JSON.parse(CLIPBOARD)
    points = jobj
    let canvas = document.getElementById("myCanvas")
    let ctx = canvas.getContext("2d")
   // ctx.fillStyle = "#000000"
   // ctx.fillRect(0,0,canvas.width, canvas.height)
    showPoints(points)
    redrawPath()
    let v = document.getElementById("textarea").value
    document.getElementById("textarea").value = Math.round(10*measurePath(points,true))/10+" paste from clipboard\n" + v
  }
  pushFunction("pasteFromClipboard")
}

function nearest_first_n (pz) {
  let pts = copyOf(points)
  if (pz)
    pts = copyOf(pz)
  let i = 0
  let minlength = 2E20, minindex = 0
  for (; i < pts.length; i++) {
    let length = nearest_first(copyOf(pts),i,true)
    if (length < minlength) {
      minlength = length
      minindex = i
    }
  }
  return nearest_first(copyOf(pts),minindex)
}

function shortestLength () {
  let tc = document.getElementById("testcases").value
  let best = -1
  if (tc === "offset" || tc === "square") {
    best = points.length * distance(points[0], points[1])
  }
  return best
}

function stochastic_walk () {
  if (points.length < 1)
    return
  let i = 0, L = points.length, ns = []
  let copy = (copyOf(points))
  for (; i < L; i++) {
    //console.log(copy[i])
    ns = closestNeighbors(i, copy).slice(1,5)
    let p2 = randomPick(ns)
    let j = positionOf(p2, copy)
    if (Math.random() > 0.8)
      copy = swap(i, j)
  }
  points = copy
  drawPath()
  let m = measurePath()
  message(m+" stochastic_walk")
}

function run_test_gp () {
  let i = 0, bestGPs = []
  let v = document.getElementById("textarea").value
  maptoOffsetgrid()
  let gps = shuffle(offsetgridPAD(144))
  //gps = gps.slice(0, 1+Math.floor(Math.random() *35))
  let minscore = measurePath(points, true), idx = 0
  savedscore = minscore
  console.log("starting...")
  console.log(Math.round(minscore))
  let saved = points
  
  for (; i < gps.length; i++) {
    let res = test_gp ([gps[i]])
    if (res[0] < minscore) {
      minscore = res[0]
      idx = bestGPs.length
      bestGPs.push(res[1])
      break;
    }
  }
  i = 0
  if (bestGPs.length > 1) {
    for (; i < bestGPs[idx].length; i++)
      points.push(bestGPs[idx][i])
    nearest_far_n(points)
    removeGuidePoints()
  }
  
  if (measurePath(points, true) > savedscore) {
    points = saved
    drawPath()
  }
  document.getElementById("textarea").value = Math.round(measurePath(points, true)) + " run_test_gp\n" + v
  console.log(Math.round(measurePath(points, true)))
  console.log("... done")
}

function nearest_far_n (pz) {
  let pts = copyOf(points)
  if (pz)
    pts = copyOf(pz)
  let i = 0
  let minlength = 2E20, minindex = 0
  for (; i < pts.length; i++) {
    let length = nearest_far(copyOf(pts),i,true)
    if (length < minlength) {
      minlength = length
      minindex = i
    }
  }
  return nearest_far(copyOf(pts),minindex)
}

function nearest_far (pts,idx,P) { // average
  if (!pts) {
    pts = points // copy
    idx = Math.floor(Math.random() * pts.length)
  }
  let res = []
  let index = idx
  res.push(pts[index])
  let sorted = closestNeighbors(index, pts)
  let i = 0, L = sorted.length-1
  let avg = averagedistanceIn()
  while (i < L) {
    sorted = closestNeighbors(0, sorted)
    // code for more distant from cg first
    // find closest neighbors with greatest dist_cg
    let j = 1, d = Math.round(distance(sorted[0],sorted[1])), mindist = 0, minindex = 1
    for (; j < sorted.length; j++) {
      if (Math.round(distance(sorted[0],sorted[j])) <= d*Math.pow(2,0.5)) {
        if (sorted[j].dist_cg > mindist) {
          mindist = sorted[j].dist_cg
          minindex = j
        }
      }
    }
    let best = sorted[1] // save for swap
    sorted[1] = sorted[minindex]
    sorted[minindex] = best
    res.push(sorted[1])
    sorted = sorted.slice(1)
    i++
  }
  points = res
  return drawPath(res, P)
}

function far_first (pts,idx,P) { 
  if (!pts) {
    pts = points // copy
    idx = Math.floor(Math.random() * pts.length)
  }
  let res = []
  let index = idx
  res.push(pts[index])
  let sorted = closestNeighbors(index, pts)
  let i = 0, L = sorted.length-1
  let avg = averagedistanceIn()
  while (i < L) {
    sorted = closestNeighbors(0, sorted)
    // code for more distant from cg first
    // find closest neighbors with greatest dist_cg
    let j = 1, d = Math.round(distance(sorted[0],sorted[1])), mindist = 0, minindex = 1
    for (; j < sorted.length; j++) {
      if (Math.round(distance(sorted[0],sorted[j])) <= d*Math.pow(2,0.5)) {
        if (sorted[j].dist_cg > mindist) {
          mindist = sorted[j].dist_cg
          minindex = j
        }
      }
    }
    let best = sorted[1] // save for swap
    sorted[1] = sorted[minindex]
    sorted[minindex] = best
    res.push(sorted[1])
    sorted = sorted.slice(1)
    i++
  }
  points = res
  return drawPath(res, P)
}


function pointongrid (pt) {
  if (points.length < 1)
    return
  let i = 0, ONX = false, ONY = false
  for (; i < points.length;i++) {
    if (pt.x === points[i].x)
      ONX = true
    if (pt.y === points[i].y)
      ONY = true
      if (ONX && ONY)
        return true
  }
  return false
}


function nearest_first (pts,idx,P) {
  if (!pts) {
    pts = points // copy
    idx = Math.floor(Math.random() * pts.length)
  }
  let res = []
  let index = idx
  res.push(pts[index])
  let sorted = closestNeighbors(index, pts)
  let i = 0, L = sorted.length-1
  while (i < L) {
    sorted = closestNeighbors(0, sorted)
    res.push(sorted[1])
    sorted = sorted.slice(1)
    i++
  }
  points = res
  return drawPath(res, P)
}


function farest_first_n (pz) {
  let pts = copyOf(points)
  if (pz)
    pts = copyOf(pz)
  let i = 0
  let maxlength = -1, maxindex = 0
  for (; i < pts.length; i++) {
    let length = farest_first(copyOf(pts),i,true)
    if (length > maxlength) {
      maxlength = length
      maxindex = i
    }
  }
  return farest_first(copyOf(pts),maxindex)
}

function farest_first (pts,idx,P) {
  if (!pts) {
    pts = points 
    idx = Math.floor(Math.random() * pts.length)
  }
  let res = []
  let index = idx
  //console.log(pts[index])
  //res.push(pts[index])
  let sorted = farthestNeighbors(index, pts)
  //console.log(res, sorted)
  let i = 0, L = sorted.length
  while (i < L) {
    res.push(sorted[0])
    sorted.shift()
    sorted = farthestNeighbors(0, sorted)
    i++
  }
 // console.log(res)
  points = res
  return drawPath(res, P)
}

function twoway_n (pz) {
  let pts = copyOf(points)
  if (pz)
    pts = copyOf(pz)
  let i = 0
  let minlength = 2E20, minindex = 0
  for (; i < pts.length; i++) {
    let length = twoway(copyOf(pts),i,true)
    if (length < minlength) {
      minlength = length
      minindex = i
    }
  }
  return (twoway(copyOf(pts),minindex))
}
/* start w/ random point
  find closets neighbors & connect to the 2 closest
  continue until closed
*/
function twoway (pts,idx,P) {
  if (!pts) {
    pts = points // copy
    idx = Math.floor(Math.random() * pts.length)
  }
  let res = []
  let index = idx
  res.push(pts[index])
  let sorted = closestNeighbors(index, pts)
  res.push(sorted[1])
  sorted = sorted.slice(1)
  if (sorted.length > 0) {
    res.splice(0,0,sorted[1])
    sorted = sorted.slice(1)
  }
  sorted = sorted.slice(1)
  let i = 0, L = sorted.length-1
  while (i < L) {
    if (i % 2 === 1) {
      sorted = closestTo(res[0], sorted)
      res.splice(0,0,sorted[0])
      sorted = sorted.slice(1)
    } else {
      sorted = closestTo(res[res.length-1], sorted)
      if (i < L && sorted.length > 0) {
        res.push(sorted[0])
        sorted = sorted.slice(1)
      }
    }
    i++
  }
  res.push(sorted[0])
  points = res
  return drawPath(res, P)
}

function drawPath2 (pts) {
  if (points.length < 1)
    return
  if (!pts)
    pts = points
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")

  let ss = ctx.fillStyle
 // ctx.fillStyle = "#000000"
 // ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.fillStyle = ss

 // ctx.clearRect(0,0,canvas.width, canvas.height)
  ctx.strokeStyle= "#00aa00"
  let nwpts = [], k = 0
  for (; k < pts.length; k++) {
    nwpts.push(pts[k])
  }
  let i = 1
  ctx.lineWidth = 2
  ctx.beginPath()
  ctx.moveTo(nwpts[0].x, nwpts[0].y)
  for (; i < nwpts.length; i +=1) {
    ctx.lineTo(nwpts[i].x, nwpts[i].y)
  }
  ctx.lineTo(nwpts[0].x, nwpts[0].y)
  ctx.stroke()
  showPoints(pts, "#000000")
  ctx.globalAlpha = 1
}

function drawPath (pts,NOSHOW) {
  if (points.length < 1)
    return
  if (!pts)
    pts = points
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")

  let ss = ctx.fillStyle
  ctx.fillStyle = "#000000"
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.fillStyle = ss

 // ctx.clearRect(0,0,canvas.width, canvas.height)
  ctx.strokeStyle= "#00aa00"
  let nwpts = [], k = 0
  for (; k < pts.length; k++) {
    nwpts.push(pts[k])
  }
  let i = 1
  ctx.lineWidth = 2
  ctx.beginPath()
  ctx.moveTo(nwpts[0].x, nwpts[0].y)
  for (; i < nwpts.length; i +=1) {
    ctx.lineTo(nwpts[i].x, nwpts[i].y)
  }
  ctx.lineTo(nwpts[0].x, nwpts[0].y)
  
  ctx.globalAlpha = 0.15
  ctx.fillStyle = "#ccee00"
  ctx.fill()
  ctx.globalAlpha = 1
  ctx.stroke()

  showPoints(pts)
  ctx.globalAlpha = 1
  return measurePath(nwpts, NOSHOW)
}

function drawPath_light (ctx) {
  if (points.length < 1)
    return
  let i = 1
  ctx.beginPath()
  ctx.moveTo(points[0].x, points[0].y)
  for (; i < points.length; i +=1) {
    ctx.lineTo(points[i].x, points[i].y)
  }
  ctx.lineTo(points[0].x, points[0].y)
  ctx.stroke()
}

function bandwPath (pts,NOSHOW) {
  if (points.length < 1)
    return
  if (!pts)
    pts = points
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.fillStyle = "#000000"
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.lineJoin = "bevel"
  ctx.strokeStyle= "#ffffff"
  ctx.fillStyle= "#ffffff"
  let nwpts = [], k = 0
  for (; k < pts.length; k++) {
    nwpts.push(pts[k])
  }
  let i = 1
  //ctx.lineWidth = 4
  ctx.beginPath()
  ctx.moveTo(nwpts[0].x, nwpts[0].y)
  for (; i < nwpts.length; i +=1) {
    ctx.lineTo(nwpts[i].x, nwpts[i].y)
  }
  ctx.lineTo(nwpts[0].x, nwpts[0].y)
  ctx.fill()
 // ctx.stroke()
}

function bandwPoints (pts,NOSHOW) {
  if (points.length < 1)
    return
  if (!pts)
    pts = points
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.fillStyle = "#000000"
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.lineJoin = "bevel"
 
  let i = 0
  ctx.fillStyle = "#ffffff"
  for (; i < pts.length; i +=1) {
    ctx.beginPath()
    ctx.arc(pts[i].x, pts[i].y, 4, 0, 2*Math.PI)
    ctx.fill()
  }
}

function calculatePolygonArea () {
  let vertices = points
 	if (vertices.length < 3) return 0;
 	 	let area = 0;
 	const n = vertices.length;
 	 	for (let i = 0; i < n; i++) {
 	 	const j = (i + 1) % n;
 	 	area += vertices[i].x * vertices[j].y;
 	 	area -= vertices[j].x * vertices[i].y;
 	}
 	 	return Math.abs(area / 2);
}

function zoomin () {
  if (points.length < 1)
    return
  let temp = [], i = 0
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  const f = 1.1
  for (; i < points.length; i++) {
    points[i].x *= f
    points[i].y *= f
    points[i].x -= 250*f - 250
    points[i].y -= 250*f - 250
  }
  drawPath()
}

function zoomout () {
  if (points.length < 1)
    return
  let temp = [], i = 0
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  const f = 1.1
  for (; i < points.length; i++) {
    points[i].x += 250*f - 250
    points[i].y += 250*f - 250
    points[i].x /= f
    points[i].y /= f
  }
  drawPath()
}

function length_vs_d () {
  let v = document.getElementById("textarea").value
  shuffle_points()
  disrupt()
  let m = measurePath()
  document.getElementById("textarea").value = v
  message(Math.round(1000*fd())/1000+","+m+","+points.length)
}

function multidisrupt () {
  let i = 0
  for (; i < 5; i++) {
    dispatch('disrupt')
    dispatch('mutate2way')
  }
  //document.getElementById("textarea").value = v
  //message("FD "+Math.round(1000*fd())/1000+", "+points.length+" points, "+document.getElementById("testcases").value)
}

function fd_macro () {
  let i = 0
  let v = document.getElementById("textarea").value
  loadpoints()
  //dispatch('loadpoints')
  dispatch('disrupt')
  dispatch('mutate2way')
  dispatch('disrupt')
  dispatch('mutate2way')
  dispatch('mutate2way')
  dispatch('disrupt')
  dispatch('disrupt')
  dispatch('mutate2way')
  dispatch('mutate2way')
  dispatch('mutate2way')
  dispatch('disrupt')
  dispatch('disrupt')
  dispatch('disrupt')
  dispatch('mutate2way')
  dispatch('mutate2way')
  dispatch('mutate2way')
  document.getElementById("textarea").value = v
  message("FD "+Math.round(1000*fd())/1000+", "+points.length+" points, "+document.getElementById("testcases").value)
}

function showfd () {
  if (points.length < 1)
      return
  let D = fd()
  message("D: "+ Math.round(D*1000)/1000)
  redrawPath()
  pushFunction("showfd")
}

function info () {
  if (points.length < 1)
    return
  marklog()
  box_counts_path()
  half_distance()
  turnings()
  rotations()
  in_out()
  redrawPath()
  let asl = averageSegmentLength(points)
  let s = longestSegment()
  let la = showlongArms()
  let l = round(distance(s[0], s[1]))
  let m = round(measurePath(points,true))
  let area = calculatePolygonArea()
  let circumfrence = Math.sqrt(area/Math.PI)*2*Math.PI
//  console.log(round2dp(circumfrence)+"="+m)
  area /= (500*500)
  message("----------------------\n"+points.length+" points\nlength: "+m+"\n"+la+
  "\nD: "+Math.round(1000*fd())/1000 +
  "\narea:"+round(100*area)+"%"+
  "\ncompactness:"+round2dp(circumfrence/m)+"")
  redrawPath()
  pushFunction("info")
}

function marklog () {
  message("----------------------")
  pushFunction("marklog")
}

function distributionOfBest () {
  if (points.length < 1 || points.length > 10)
    return
  let WINNERS = [], i = 0, m
  let max = factorial(points.length)
  brute_force()
  let BEST = measurePath(points,true)
  //let next = nextPermutation()
  //order points to next
  let prev = [], ord
  for (; i < max; i++) {
    applyNextPerm()
    if (measurePath(points,true) <= BEST) {
      WINNERS.push(i)
      ord = ordering()
      dist = vectordistance(ord, prev)
      WINNERS.push(ord+" | "+Math.round(100*dist)/100)
      prev = ord
    }
  }
  let res = ""
  i = 0
  res += WINNERS.length/2+" matches\n"
  for (; i < WINNERS.length; i += 2) 
    res += WINNERS[i] + " ["+WINNERS[i+1]+"]\n"
  message(res)
  marklog()
}

function redrawPath (PTSONLY) {
  if (points.length < 1)
    return
  let pts = points
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
    ctx.fillStyle = "#000000"
  ctx.fillRect(0,0,500,500)
////  ctx.clearRect(0,0,canvas.width, canvas.height)
  ctx.strokeStyle= "#00aa00"
  let nwpts = [], k = 0
  for (; k < pts.length; k++) {
    nwpts.push(pts[k])
  }
  let i = 1
  ctx.lineWidth = 2
  if (!PTSONLY) {
    ctx.beginPath()
    ctx.moveTo(nwpts[0].x, nwpts[0].y)
    for (; i < nwpts.length; i +=1) {
      ctx.lineTo(nwpts[i].x, nwpts[i].y)
    }
    ctx.lineTo(nwpts[0].x, nwpts[0].y)
    ctx.stroke()
  }
  showPoints(pts)
 
  return measurePath(nwpts, true)
}

function showTip (msg, item) {
  var e = document.getElementById("tip")
  e.innerHTML = msg;
  e.style.display = "block"
  e.style.zIndex = "5"
  let rect = document.getElementById(item).getBoundingClientRect()
  let top = -24 + Math.floor(rect.top + window.scrollY)+"px"
  let left = 450 + Math.floor(rect.left + window.scrollX)+"px"
  if (top)
    e.style.top = top
  if (left)
    e.style.left = left
  else
    e.style.left = "66px"
  setTimeout(function() {
    e.style.display = "none"
    e.innerHTML = ""
  }, 3000);
}

const ROWS = 50

function topology (show) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  topology_ish(ctx)
  return
  
  if (points.length < 1)
    return
  
  let i = 0, max = ROWS*ROWS 
  const cellsize = 500/ROWS
  let fills = ["#761313", "#CC2500", "#Ed6202", "#F68D00"]
  let x, y
  if (true) { //always
    TEMPS = []
    for (; i < max; i++)
      TEMPS[i] = 0
    ctx.strokeStyle = "orange"
    let n = points.length
    let r = 500/Math.sqrt(n) * 0.33
    let radii = [r*3,r*2,r,r/2]
    x = Math.random()*500, y = Math.random()*500
    i = 0
    let j = 0, EMPTY = true
    let path = new Path2D() 
    const offset = cellsize/2
    let k = 0, count = 0
    for (; k < 4; k++) {
      i = 0, r = radii[k]
      for (; i < TEMPS.length; i++) {
        x = xfromindex(i)+offset, y = yfromindex(i)+offset
        path = new Path2D() 
        path.arc(x,y,r,0,Math.PI*2)
        j = 0, EMPTY = true, count = 0
        for (; j < points.length; j++) {
          if (ctx.isPointInPath(path, points[j].x, points[j].y)) {
            EMPTY = false
            count++
            break;
          }
        }
        if (EMPTY) {
          TEMPS[ifromxy(Math.floor(x/cellsize), Math.floor(y/cellsize))] += 1
        }
      }
    }
  }
  ctx.globalCompositeOperation = "lighten"
  showPoints()
  i = 0
  let d = 0
  for (; i < TEMPS.length; i++) {
    x = xfromindex(i)
    y = yfromindex(i)
    if (TEMPS[i] > 0) {
      d = 0
      for (; d < TEMPS[i]; d++) {
        ctx.fillStyle = fills[TEMPS[i] - 1] 
        ctx.fillRect(x,y, cellsize, cellsize)
      }
    }
  }
  let cost = heatCost(TEMPS)
  let v = document.getElementById("textarea").value
  document.getElementById("textarea").value = "topology: cost "+cost+" \u{1F702}\n" + v
  ctx.globalAlpha = 1
  ctx.globalCompositeOperation = "source-over"
  if (show === undefined) {
    hidePath()
    drawPath()
  }
}

// topology-ish. just sample off color in rect samples of cellsize
// point.TEMP = 5 if orange
//  let color = colorOf(ctx,x,y,width)

function topology_ish (ctx) {
  if (points.length < 1)
    return
 // let canvas = document.getElementById("myCanvas")
 //   let ctx = canvas.getContext("2d")
  let i = 0, max = ROWS*ROWS 
  const cellsize = 500/ROWS
 // console.log(cellsize, max, TEMPS.length)
  let x, y, count = 0
  TEMPS = []
  for (; i < max; i++)
    TEMPS[i] = 0
  let color = "#000000"
  const offset = cellsize/2
  i = 0
  for (; i < TEMPS.length; i++) {
    x = xfromindex(i)+offset, y = yfromindex(i)+offset
    color = colorOf(ctx,x,y,cellsize)
    if (color === "#ffa500") {
      TEMPS[i] = 5
      count++
    }
  }
  //console.log(count)
 // hidePath()
 // drawPath()
}

function colorOf (ctx,x,y,d) { // d X d pixels
  d = Math.floor(d)
  let imgData = ctx.getImageData(Math.floor(x),Math.floor(y),d,d)
  let pixels = imgData.data;
  let i = 0, R = 0, G = 0, B = 0
  for (;i < pixels.length; i+=4) {
    let color = 0// R = 0, G = 0, B = 0
    R += Math.round(pixels[i]),
    G += Math.round(pixels[i+1]),
    B += Math.round(pixels[i+2]);
  }
  R = ('0'+(Math.round(R/(pixels.length/4))).toString(16)).slice(-2),
  G = ('0'+(Math.round(G/(pixels.length/4))).toString(16)).slice(-2),
  B = ('0'+(Math.round(B/(pixels.length/4))).toString(16)).slice(-2);
  color = "#"+R+G+B
  return color
}

function heatCost (temps) {
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineJoin = 'bevel'
  let path = new Path2D()
  path.lineWidth = 1 + Math.floor(500/ROWS * 0.8)
  ctx.lineWidth = path.lineWidth
  path.moveTo(points[0].x, points[0].y)
  let i = 1
  for (; i < points.length; i++) {
    path.lineTo(points[i].x, points[i].y)
  }
  path.lineTo(points[0].x, points[0].y)
  ctx.globalAlpha /= 10
  ctx.stroke(path)
  ctx.globalAlpha = 1
  let cost = 0, cnt = 0
  i = 0
  for (; i < temps.length; i++) {
    x = xfromindex(i)
    y = yfromindex(i)
    if (ctx.isPointInStroke(path, x, y)) {
      cost += +temps[i]
      cnt++
    }
  }
  return cost
}


function pairCosts (temps) {
  if (!temps)
    temps = TEMPS
  if (points.length < 1)
    return
  let i = 0, costs = {}, segment = []
  for (; i < points.length; i++) {
    segment = [points[i], points[(i+i)%points.length]]
   // costs[points[i] +","+ points[(i+i)%points.length]] = pairCost(points[i], points[(i+i)%points.length], temps)
    costs[i+","+(i+1)%points.length] = pairCost(points[i], points[(i+1)%points.length], temps)
  }

  const sorted = Object.entries(costs)
  .sort(([, a], [, b]) => b-a)
  
  ids = sorted[0][0].split(",")
  ids2 = sorted[1][0].split(",")
  ids3 = sorted[2][0].split(",")
  insertAt(parseInt(ids[0]), -Math.floor(Math.random()*points.length) )
  insertAt(parseInt(ids[1]),  Math.floor(Math.random()*points.length) )

 // insertAt(parseInt(ids2[0]), -5)
 // insertAt(parseInt(ids2[1]), 5)

 // insertAt(parseInt(ids3[0]), -5)
 // insertAt(parseInt(ids3[1]), 5)
 // return
  drawPath()

  let m = measurePath()
  message(m+" pair costs")
  // then pass to disruptive swaper
}

function testPairCost () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineJoin = 'bevel'
  ctx.strokeStyle = "#ccccff"
  ctx.globalAlpha = 0.0
  ctx.lineWidth = 10
  let i = 0, j = 0
  for (; i < points.length; i++) {
    j = 0
    for (; j < points.length; j++) {
      if (i !== j)
        pairCostL2(points[i], points[j], TEMPS, ctx)
    }
  }
  console.log("pc<--")
}

function pairCost (p1,p2,temps) { // pass indicies? 
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineJoin = 'bevel'
  let path = new Path2D
  path.lineWidth = 10 //+ Math.floor(500/ROWS * 0.8)
  ctx.lineWidth = path.lineWidth
  path.moveTo(p1.x, p1.y)
  path.lineTo(p2.x, p2.y)
  ctx.strokeStyle = "#ccccff"
  ctx.globalAlpha = 0.0
  ctx.stroke(path)
  ctx.globalAlpha = 1
  ctx.lineWidth = 10
  path.lineWidth = 10
  let cost = 0, cnt = 0
  i = 0
  for (; i < temps.length; i++) {
    x = xfromindex(i)
    y = yfromindex(i)
    if (ctx.isPointInStroke(path, x, y)) {
      cost += +temps[i]
     // cnt++
    }
  }
  return cost
}

function pairCostsNeighbors () {

}

function pairCostL2 (p1,p2,temps) { // less than 2
  if (points.length < 1)
    return
  
  let canvas = document.getElementById("myCanvas")
  if (distance(p1,p2 > canvas.width/3))
    return false
  let ctx = canvas.getContext("2d")
  ctx.lineJoin = 'bevel'
  ctx.strokeStyle = "#ccccff"
  ctx.globalAlpha = 0.0
  ctx.lineWidth = 10
  
  let path = new Path2D
  path.lineWidth = 10 //+ Math.floor(500/ROWS * 0.8)
  path.moveTo(p1.x, p1.y)
  path.lineTo(p2.x, p2.y)
  
  ctx.stroke(path)
  ctx.globalAlpha = 1
  let LT2 = true
  i = 0
  for (; i < temps.length; i++) {
    x = xfromindex(i)
    y = yfromindex(i)
    if (ctx.isPointInStroke(path, x, y) && temps[i] > 1) {
      LT2 = false
    }
  }
  return LT2
}

function sortByValue (obj) {
  let i = 0, result = []
  let keys = Object.keys(obj)

  let objSorted = {}
  obj.forEach(function(item){
      objSorted[item[0]]=item[1]
  })
 // console.log(objSorted)
  return objSorted
}

function xfromindex (i) {return ((i % ROWS)*500/ROWS)}
function yfromindex (i) {return (Math.floor(i/ROWS)*500/ROWS)}
function ifromxy (x,y) {return (x+y*ROWS)}

function hidePath () {
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.fillStyle = "#000000"
  ctx.fillRect(0,0,canvas.width, canvas.height)
  if (SHOWINGPATH) 
    showPoints()
  else
    drawPath()
  SHOWINGPATH = !SHOWINGPATH
}

function showPoints (pts, fc) {
  if (!pts)
    pts = points
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.fillStyle = "#ffffff"
  if (fc)
    ctx.fillStyle = fc
  ctx.font = "12px sans-serif"
  let i = 0, xoff = 0, yoff = 0
  for (; i < pts.length; i++) {
    xoff = yoff = 0
    if (pts[i].x > 480)
      xoff = 16
    if (pts[i].y > 480)
      yoff = 15
    ctx.beginPath()
    if ((pts[i].index+"").startsWith("g"))
      ctx.fillStyle = "#00ffff"
    else
      ctx.fillStyle = "#ffffff"
    if (i === 0)
       ctx.arc(pts[i].x, pts[i].y,5, 0, Math.PI*2)
    else
      ctx.arc(pts[i].x, pts[i].y,3, 0, Math.PI*2)
    ctx.closePath()
    ctx.fill()
    ctx.fillText(points[i].index, Math.floor(pts[i].x+5)-xoff, Math.floor(pts[i].y+10)-yoff)
  }
  ctx.fillStyle= "#000000"
}

function poke_close () {
  if (points.length < 1)
    return
  let i = 0
  let found = close_passes()
  i = 0
  let max = found.length
  if (max > 10)
    max /= 2
  for (; i < max; i++) {
    macrox_LA(found[i].index)
  }
  message(measurePath()+" poke close passes")
}

function poke_acute_angles () {
  if (points.length < 1)
    return
  let i = 0
  let copy = copyOf(points)
  copy = sortedByAngle_cos(copy)
  let all_acute = []
  i = 0
  for (; i < copy.length; i++) {
    if (copy[i].angle < 90)
      all_acute.push(copy[i])
  }
  i = 0
  let max = all_acute.length
  if (max > 10)
    max /= 2
  for (; i < max; i++) {
    if (all_acute[i].angle < 90)
      macrox_LA(all_acute[i].index)
  }
  message(measurePath()+" poke long")
}

function clearMarks () {
  if (points.length < 1)
    return
  let L = points.length, i = 0
  for (; i < L; i++) 
    points[i].mark = ""
}

function avgCosAngle () {
  if (points.length < 1)
    return
  let L = points.length, AVG = 0
  let a = 0, i = 0, prev = 0, found = []
  for (; i < L; i++) {
    prev = (i === 0)? L-1: i-1;
    a = round(angle_cos(points[prev], points[i], points[(i+1)%L]))
    AVG += a
    points[i].angle = a
  }
  return (round(AVG/L))
}

function setAngles () {
  if (points.length < 1)
    return
  let L = points.length
  let a = 0, i = 0, prev = 0, found = []
  for (; i < L; i++) {
    prev = (i === 0)? L-1: i-1;
    a = round(angle_cos(points[prev], points[i], points[(i+1)%L]))
    if (points[i].angle !== a) {
      found.push(points[i].index)
     // points[i].mark = "x"
    } else
    points[i].mark = ""
    points[i].angle = a
  }
  i = 0
 // for (; i < found.length; i++)
 //   findPoint(found[i])
}

function poke_long_arms () {
  if (points.length < 1)
    return
  let i = 0
  let avg_len = averageArmsLength() // info
  avg_len *= 1.25
  let copy = sortedByArmsLength()
  let all_long = []
  i = 0
  for (; i < copy.length; i++) {
    if (copy[i].arms_length > avg_len)
      all_long.push(copy[i])
  }
  i = 0
  let max = all_long.length
  if (max > 10)
    max /= 2

  for (; i < max; i++) {
    if (all_long[i].arms_length > avg_len)
      macrox_LA(all_long[i].index)
  }
  message(measurePath()+" poke long")
}

function macrox_LA (index) { 
  let v = document.getElementById("textarea").value
  let copy = copyOf(points)
  let m1 = measurePath(), m2
//  let index = Math.floor(Math.random() * points.length)
  let pt = pointByIndex(index)
  poke_point(pt.index)
  tidy()
  m2 = measurePath()
  document.getElementById("textarea").value = v
  if (m2 < m1) {
    //pt.mark = "x"
  } else
  points = copy // oib
  drawPath()
}

function averageArmsLength () {
  if (points.length < 1)
    return
  setArmsLength()
  let L = points.length, i = 0, avg = 0, min = 2e20, max = -2e20
  for (; i < L; i++) {
    a = points[i].arms_length
    avg += a
    min = (min < a)? min: a;
    max = (max > a)? max: a;
  }
  return(round(avg/L))
}

function lengths () {
  message(showlongArms())
}

function showlongArms () {
  if (points.length < 1)
    return
  setArmsLength()
  let L = points.length, i = 0, avg = 0, min = 2e20, max = -2e20
  for (; i < L; i++) {
    a = points[i].arms_length
    avg += a
    min = (min < a)? min: a;
    max = (max > a)? max: a;
  }
  avg /= L
  return ("lengths: ["+round(min)+ "-"+ round(max)+"] x:"+round(avg))
}

function setArmsLength () {
  if (points.length < 1)
    return
  let L = points.length
  let al = 0, alr = 0,i = 0, prev = 0
  for (; i < L; i++) {
    al = 0, alr = 0
    prev = (i === 0)? L-1: i-1;
    al =  distance(points[prev], points[i])
    alr = distance(points[i], points[(i+1)%L])
    points[i].arms_length = round(Math.max(alr))
  }
}

function poke_point (index) {
  if (points.length < 1)
    return
  if (!index)
    index = +document.getElementById("findpoint").value
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.strokeStyle = "#00ffff"
  let p = pointByIndex(index)
  if (p) {
    let i = 0, found = 0
    for (; i < points.length; i++) {
      if (points[i] === p) {
        found = i
        break;
      }
    }
    let j = Math.floor(Math.random() * points.length)
    if (j === found)
      j = (j*1)%points.length
   // console.log(found,j)
    points = swap(found,j)
  }
  drawPath(points)
}

function findPoint (index) {
  if (points.length < 1)
    return
  if (!index)
    index = +document.getElementById("findpoint").value
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
 // ctx.globalAlpha = 0.75
  ctx.strokeStyle = "#00ffff"
  ctx.lineWidth = 1
  let p = pointByIndex(index)
  if (p) {
    ctx.beginPath()
    ctx.arc(p.x, p.y, 13, 0, 2*Math.PI) // pointFromIndex
    ctx.stroke()
  }
  ctx.globalAlpha = 1
}

function testHeatMap () { // topology_ish
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, max = ROWS*ROWS 
  const cellsize = 500/ROWS
  console.log(cellsize, max, TEMPS.length)
  let x, y, count = 0
  let color = "#000000"
  const offset = cellsize/2
  i = 0
  for (; i < TEMPS.length; i++) {
    x = xfromindex(i)+offset, y = yfromindex(i)+offset
    ctx.fillStyle = (TEMPS[i] > 0)? "red": 'black';
    ctx.fillRect(x,y,cellsize,cellsize)
  }
}

function box_counts_path () {//-0.37x+251.5
  if (points.length < 1)
    return
  let sizes = [250, 125, 100,  50,  25].reverse()
  let nboxes = [4,  16,  25,  100, 400].reverse()
  marklog()
  bandwPath()
  let avg = 0
  let results = "ln_size\t("+document.getElementById("testcases").value+")", i = 0, r, j
  for (; i < sizes.length; i++) {
    r = box_count_bw(sizes[i])
    results += "\n"+round(Math.log(sizes[i]))+"\t"/*+r[0]+"\t"+Math.round(1000*r[1])/1000+"\t"*/+
     roundto(Math.log((Math.pow(r[1],2)/Math.pow(r[0],2))+1),4)// 4 dec places
     avg += (Math.log((Math.pow(r[1],2)/Math.pow(r[0],2))+1))
     //  Math.log(Math.round(1000*Math.pow(r[1],2)/Math.pow(r[0],2))/1000 +1)// 4 dec places
  }
  message(results +"\navg:"+roundto(avg/sizes.length,4))
  marklog()
}

function box_counts_points (pts) {
  if (points.length < 1)
    return
  let sizes = [250, 125, 100, 50, 25].reverse()
  let nboxes = [4,  16,  25, 100, 400].reverse()
  marklog()

  let avg = 0
  let results = "ln_size\t("+document.getElementById("testcases").value+")", i = 0, r, j
  for (; i < sizes.length; i++) {
    r = box_count(sizes[i])
    results += "\n"+round(Math.log(sizes[i]))+"\t"/*+r[0]+"\t"+Math.round(1000*r[1])/1000+"\t"*/+
     roundto(Math.log((Math.pow(r[1],2)/Math.pow(r[0],2))+1),4)// 4 dec places
     avg += (Math.log((Math.pow(r[1],2)/Math.pow(r[0],2))+1))
     //  Math.log(Math.round(1000*Math.pow(r[1],2)/Math.pow(r[0],2))/1000 +1)// 4 dec places
  }
  console.log(avg/sizes.length)

  message(results +"\navg:"+roundto(avg/sizes.length,4))
  marklog()
}

function whitePixelCount (x,y,w,h, ctx) {
  let imgData = ctx.getImageData(x, y, w, h)
  let pixels = imgData.data, whitecount = 0
  let i = 0, r = 0, g = 0, b = 0, threshold = 230*3
  for (; i < pixels.length; i += 4) {
    r += parseInt(pixels[i])
    g += parseInt(pixels[i+1])
    b += parseInt(pixels[i+2])
    if (r+b+g > threshold) // less than for black
      whitecount++
  }
  r /= pixels.length/4
  g /= pixels.length/4
  b /= pixels.length/4
  let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
    G = ('0'+(Math.round(g)).toString(16)).slice(-2),
    B = ('0'+(Math.round(b)).toString(16)).slice(-2);
  return (whitecount)
}

function sampleRectColor (x,y,w,h, ctx) {
  let imgData = ctx.getImageData(x, y, w, h)
  let pixels = imgData.data
  let i = 0, r = 0, g = 0, b = 0
  for (; i < pixels.length; i += 4) {
    r += parseInt(pixels[i])
    g += parseInt(pixels[i+1])
    b += parseInt(pixels[i+2])
  }
  r /= pixels.length/4
  g /= pixels.length/4
  b /= pixels.length/4
  let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
    G = ('0'+(Math.round(g)).toString(16)).slice(-2),
    B = ('0'+(Math.round(b)).toString(16)).slice(-2);
  return ("#"+R+G+B)
}

function crossings_bw (cs) { 
  if (points.length < 1)
    return
  //bandwPath()
  voidcost_inverted()
  //sigil()
 // radial
  let L = points.length
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, j = 0
  let cellsize = +document.getElementById("voidsize").value
  
  let space = cellsize
  let threshold = (cellsize*cellsize)/2
  let N = 500/cellsize*500/cellsize, dots = [], p
  let x = 0, y = space, count = 0, pt, color, colors = [],wpc = 0, last_wpc = 0
  let counts = [], changesH = 0, changesV = 0, H = [], V = []
  ctx.strokeStyle = "red"
  i = 0, changesH = 0

  let max = (500/(space-1))*(500/(space-1))
  for (; i < max; i++) {
    wpc = whitePixelCount(x, y, cellsize, cellsize, ctx)
    wpc = (wpc > threshold)? 1: 0;
    if (wpc !== last_wpc) {
      changesH += 1
      p = new point(x,y)
      dots.push(p)
    }
    x += space
    last_wpc = wpc
    if (x >= 500+space) {
      H.push(changesH)
      changesH = 0
      x = 0
      y += space
      last_wpc = 0
    }
  }
  changesV = 0
  i = 0, x = space, y = 0,last_wpc = 0
  for (; i < max; i++) {
    wpc = whitePixelCount(x, y, cellsize, cellsize, ctx)
    wpc = (wpc > threshold)? 1:0;
    if (wpc !== last_wpc) {
      changesV += 1
      p = new point(x,y)
      dots.push(p)
    }
    y += space
    last_wpc = wpc
    if (y > 500) {
      V.push(changesV)
      changesV = 0
      y = 0
      x += space
      last_wpc = 0
    }
  }
  message("edges:"+(dots.length)+", length:"+(dots.length*cellsize))
  let temp = copyOf(points)
  copyToClipboard(temp)
  document.getElementById("save_prev").checked = false
  i = 0
  let mod = Math.floor(dots.length/(L*0.3)) // div = L * 0.3
  let added = 0, idx
  let copy = copyOf(points)
  for (; i < dots.length; i++) {
    if (i % mod === 0) {
      dots[i].index = "g"+(L+added)
      let ip = (closestTo(dots[i], copy))[0]
      //insertAt
      idx = placeOf(ip, points)
      points.splice(idx,0,dots[i])
      added++
    }
  }
  let m = measurePath()
  message (added+' points added  '+m)
  drawPath()
  //drawPath2()
  //edge_overlay(dots)
}

function placeOf (pt, pts) {
  let i = 0
  for (; i < pts.length; i++) {
    if (pt.index === pts[i].index)
      return i
  }
}

function setWeights () {
  if (points.length < 1)
    return
  let i = 0, d
 // turnings()
  let cg = center()
  for (; i < points.length; i++) {
    points[i].weight = fx(0,1, 250,3, distance(cg, points[i]))//1.5+(-0.004*distance(cg, points[i]))
    /*
    if (points[i].angle < 90)
      points[i].weight = 1.5
    else
      points[i].weight = 0.5*/
  }
  message(" set weights ("+measurePath()+")")
}

function clearWeights () {
  if (points.length < 1)
    return
  let i = 0
  for (; i < points.length; i++)
    points[i].weight = 1
  message(" reset weights ("+measurePath()+")")
}

function removeGuidePoints () {
  if (points.length < 1)
    return
  let temp = [], i = 0, removed = 0
  for (; i < points.length; i++) {
    if ((points[i].index+"").startsWith("g"))
      removed++
    else
      temp.push(points[i])
  }
  points = temp
  drawPath()
  let m = measurePath()
  message("removed guide points:"+removed+"  "+m)
}

function crossings_radial (cs) { 
  if (points.length < 1)
    return
  bandwPath()
  //voidcost_inverted()
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let cellsize = 10
  if (cs)           // if not a multiple, you need to pad N
    cellsize = cs
    let halfsize = cellsize/2
  let pt, wpc = 0, last_wpc = 0
  let changesH = 0, H = [], dots = []
  let cg = center(), angle = 0, r = 5
  let x = cg.x, y = cg.y
  let initial = whitePixelCount(x-halfsize, y-halfsize, cellsize, cellsize, ctx)
  initial = (initial > 50)? 1: 0;
  last_wpc = initial
  let i = 0, N = 16
  for (; i < N; i++) {
    r = 5
    last_wpc = initial
    x = cg.x + r * Math.cos(angle)
    y = cg.y + r * Math.sin(angle)
    pt = new point(x,y)
    while (pointInRect(pt,0,0,500,500)) {
      wpc = whitePixelCount(x-halfsize, y-halfsize, cellsize, cellsize, ctx)
      wpc = (wpc > 50)? 1: 0;
      if (wpc !== last_wpc) {
        changesH += 1
        dots.push(new point(x,y))
      }
      last_wpc = wpc
      r += 5
      //console.log(r, angle)
      x = cg.x + r * Math.cos(angle)
      y = cg.y + r * Math.sin(angle)
      pt = new point(x,y)
    }
    if (initial === 1 && last_wpc === 1) {
      changesH += 1 // don't bother drawing the dot
      //console.log(x,y)
    }
    ctx.fillStyle = 'red'
    ctx.font = "800 14pt sans-serif"
    x = cg.x + 200 * Math.cos(angle)
    y = cg.y + 200 * Math.sin(angle)
    ctx.fillText(changesH, x, y)
    H.push(changesH)
    changesH = 0
    angle += Math.PI/(N/2)
  }
 // message("h:("+filter_reps(H)+")")
  message("H:("+H+"), sd:"+roundto(sd(H),2))
 // drawPath2()
  edge_overlay(dots)
  showCG()
}

function filter_reps (array) {
  let i = 1, filtered = [], prev = array[0]
  filtered.push(array[0])
  for (; i < array.length; i++) {
    if (array[i] !== prev)
      filtered.push(array[i])
    prev = array[i]
  }
  return filtered
}

function filter_dupes (dots, ctx) {
  let i = 0, j = 0, res = []
  return
  i = 0
  for (; i < H.length; i++) {
    res.push([H[i],V[i]])
  }
//  console.log(res)
  let prev = res[0], res2 = []
  res2.push(res[0])
  i = 1
  for (; i < res.length; i++) {
   // if (res[i][0] === prev[0] && res[i][1] === prev[1])
   //   ;
   // else
      res2.push(res[i])
    prev = res[i]
  }
  return(res2)
}

function edge_overlay (dots) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0
  ctx.fillStyle = "#00a0ff"
  for (; i < dots.length; i++) {
    ctx.beginPath()
    ctx.arc(dots[i].x, dots[i].y, 3, 0, 2*Math.PI)
    ctx.fill()
  }
  return 
}

function box_count_bw (cs) { 
  if (points.length < 1)
    return
  let L = points.length
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, max = ROWS*ROWS , j = 0
  let cellsize = 50 // multiple of 500: 4,5,10,20,25,40,50,...
  if (cs)           // if not a multiple, you need to pad N
    cellsize = cs
  let N = 500/cellsize*500/cellsize
  let x = 0, y = 0, count = 0, pt, color, colors = [],wpc = 0
  let counts = []
  i = 0
  for (; i < N; i++) {
    wpc = whitePixelCount(x, y, cellsize, cellsize, ctx)
    colors.push(wpc)
    x += cellsize
    if (x >= 500) {
      x = 0
      y += cellsize
    }
  }
  return ([mean(colors), sd(colors)])
}

function sigil () {
  if (points.length < 1)
    return
  bandwPath()
//  let L = pts.length
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, max = ROWS*ROWS , j = 0
  let cellsize = +document.getElementById("voidsize").value
  let N = 500/cellsize*500/cellsize
  let x = 0, y = 0, count = 0, pt
  let counts = []

  i = 0
  for (; i < N; i++) {
    ct = whitePixelCount(x,y,cellsize,cellsize,ctx)
    counts.push(ct)
    x += cellsize
    if (x > 500) {
      x = 0
      y += cellsize
    }
  }
  // 2500 is white at cs of 50 
  // 400 at 20
  let threshold = (cellsize*cellsize)/2
  //console.log(counts)
  ctx.strokeStyle = 'red'
  i = 0, x = 0, y = 0, ct = 0
  for (; i < N; i++) {
    ctx.fillStyle = (counts[i] > threshold)? "#ffffff": "#000000"
    if (counts[i] > threshold)
      ct++
    ctx.fillRect(x,y,cellsize,cellsize)
   //// ctx.strokeRect(x,y,cellsize,cellsize)
    x += cellsize
    if (x > 500) {
      x = 0
      y += cellsize
    }
  }
  drawPath2()
  //console.log(ct, cellsize*cellsize)
}

function box_count (cs, pts) { 
  if (points.length < 1)
    return
  if (!pts)
    pts = points
  let L = pts.length
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, max = ROWS*ROWS , j = 0
  let cellsize = 50 // multiple of 500: 4,5,10,20,25,40,50,...
  if (cs)           // if not a multiple, you need to pad N
    cellsize = cs
  let N = 500/cellsize*500/cellsize
  let x = 0, y = 0, count = 0, pt
  let counts = []
  ctx.strokeStyle='red'
  bandwPoints(pts)
  i = 0
  for (; i < N; i++) {
    ct = whitePixelCount(x,y,cellsize,cellsize,ctx)
    counts.push(ct)
    x += cellsize
    if (x >= 500) {
      x = 0
      y += cellsize
    }
  }
  console.log(counts)
  return ([mean(counts), sd(counts)])
}

function boxes (cs) { // topology_ish
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, max = ROWS*ROWS 
  let cellsize = 25 // multiple of 500: 4,5,10,20,25,40,50,...
  if (cs)           // if not a multiple, you need to pad N
    cellsize = cs
  let N = 500/cellsize*500/cellsize
  let x = 0, y = 0, count = 0, pt
  ctx.fillStyle = "#dda000ff"
  ctx.strokeStyle = "#dd9000ff"
  ctx.lineWidth = 1
  ctx.globalCompositeOperation = "lighten"
  i = 0
  for (; i < N; i++) {
    pt = new point()
    pt.x = x+cellsize/2
    pt.y = y+cellsize/2
    let idx =  nearestPoint(pt)
    if (distance(pt, points[idx]) > cellsize*1.414) {
      ctx.beginPath()
      ctx.moveTo(x,y)
      ctx.lineTo(x+cellsize,y)
      ctx.lineTo(x+cellsize,y+cellsize)
      ctx.lineTo(x,y+cellsize)
      ctx.lineTo(x,y)
      ctx.fill()
    }
    x += cellsize
    if (x >= 500) {
      x = 0
      y += cellsize
    }
  }
  ctx.globalCompositeOperation = "source-over"
}

function poke_voids () {
  if (points.length < 1)
    return
  let i = 0
  let copy = copyOf(points)
  let found = voidcost()
  i = 0
  let max = found.length
  if (max > 10)
    max /= 2
  for (; i < max; i++) {
    macrox_LA(found[i].index)
  }
  message(measurePath()+" poke voids")
}

function voidcost () {
  if (points.length < 1)
    return
  showPoints()
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineWidth = +document.getElementById("voidsize").value
  let i = 0, voids_ = [], L = points.length, totalcost = 0, count = 0
  let prev_i, p1, p2, bp, j = 0, cost = 0, pointcost = 0, path, found = []
  let vs = voids()
  voids_ = vs[0], costs = vs[1]
  for (; i < L; i++) {
    p1 = points[i]
    p2 = points[(i+1)%L]
    cost = void_distance(p1, p2, vs)
    totalcost += cost
    if (cost > 4) {
     // findPoint(p1.index)
     // findPoint(p2.index)
      found.push(p1)
      found.push(p2)
      count++
    }
  }
  ctx.lineWidth = 1
  message("void crossings:"+count+", cost:"+totalcost)
  return (found)
}

function voidcost_inverted () {
  if (points.length < 1)
    return
  showPoints()
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineWidth = +document.getElementById("voidsize").value
  let i = 0, voids_ = [], L = points.length, totalcost = 0, count = 0
  let prev_i, p1, p2, bp, j = 0, cost = 0, pointcost = 0, path, found = []
  let vs = voids_inverted()
  voids_ = vs[0], costs = vs[1]
  for (; i < L; i++) {
    p1 = points[i]
    p2 = points[(i+1)%L]
    cost = void_distance(p1, p2, vs)
    totalcost += cost
    if (cost > 4) {
      found.push(p1)
      found.push(p2)
      count++
    }
  }
  ctx.lineWidth = 1
  message("void crossings:"+count+", cost:"+totalcost)
  return (found)
}

function voids (NOSHOW) { 
  if (points.length < 1)
    return
  let voidsize = +document.getElementById("voidsize").value
  let i = 0, max = ROWS*ROWS /* 21*21*/, voids = []
  let cellsize = 25//, r = cellsize/2.1
  max = Math.pow((500/voidsize+1),2)
  cellsize = voidsize//, r = cellsize/2.1
  let x = 0, y = 0, count = 0, pt, offset = 0
  i = 0
  for (; i < max; i++) {
    pt = new point()
    pt.x = x
    pt.y = y
    let idx =  nearestPoint(pt)
    if (distance(pt, points[idx]) > cellsize) {
      voids.push(pt)
    }
    x += cellsize
    if (x > 500) {
      y += cellsize
      offset = (offset === 0)? cellsize/2: 0;
      x = offset
    }
  }
  let scores = score_voids(voids, NOSHOW)
  return ([voids,scores])
}

function voids_inverted (NOSHOW) { 
  if (points.length < 1)
    return
  let voidsize = +document.getElementById("voidsize").value
  let i = 0, max = ROWS*ROWS, voids = []
  let cellsize = 25
  max = Math.pow((500/voidsize+1),2)
  cellsize = voidsize
  let x = 0, y = 0, count = 0, pt, offset = 0
  i = 0
  for (; i < max; i++) {
    pt = new point()
    pt.x = x
    pt.y = y
    let idx =  nearestPoint(pt)
    if (distance(pt, points[idx]) <= cellsize) {
      voids.push(pt)
    }
    x += cellsize
    if (x > 500+cellsize/2) {
      y += cellsize
      offset = (offset === 0)? cellsize/2: 0;
      x = offset
    }
  }
  let scores = score_voids_bw(voids, NOSHOW)
  return ([voids,scores])
}


function score_voids (v, NOSHOW) {
  let scores = {}, i = 0
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  colors = ["#023F60","#214C52","#405A44",/*"#5F6836",*/"#7F7629","#9E841B","#BD920D","#DDA000"]
  let voidsize = document.getElementById("voidsize").value
  let r = 38, path
  r = voidsize*1.5
  for (; i < v.length; i++) {
    path = new Path2D() 
    path.arc(v[i].x,v[i].y,r, 0,Math.PI*2)
    ctx.lineWidth = 1
    
    j = 0, a = 0, score = 0
    for (; j < v.length; j++) {
      if (ctx.isPointInPath(path, v[j].x, v[j].y)) 
        score++
    }
    if (!NOSHOW) {
      ctx.beginPath()
      ctx.arc(v[i].x, v[i].y, voidsize/2, 0, 2*Math.PI)
      ctx.fillStyle = colors[score-1]
      ctx.fill()
    }
    scores[i] = score
  }
  ctx.globalCompositeOperation = "source-over"
  return scores
}


function score_voids_bw (v, NOSHOW) { // need to fill w/ black befor drawng the white dots
  let scores = {}, i = 0             
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let voidsize = +document.getElementById("voidsize").value
  let r = 38, path
  r = voidsize*1.5
  ctx.fillStyle = "#000000"
  ctx.fillRect(0,0,500,500)
  for (; i < v.length; i++) {
    path = new Path2D() 
    path.arc(v[i].x,v[i].y,r, 0,Math.PI*2)
    ctx.lineWidth = 1
    
    j = 0, a = 0, score = 0
    for (; j < v.length; j++) {
      if (ctx.isPointInPath(path, v[j].x, v[j].y)) 
        score++
    }
    if (!NOSHOW) {
      ctx.fillStyle = "#ffffff"
    //ctx.fillRect(v[i].x-voidsize/2, v[i].y-voidsize/2, voidsize+1, voidsize+1)
      ctx.beginPath()
      ctx.arc(v[i].x, v[i].y, voidsize/1.6, 0, 2*Math.PI)
      ctx.fill()
    }
    scores[i] = score
  }
  ctx.globalCompositeOperation = "source-over"
  return scores
}

async function invertColors (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.willReadFrequently = true
  let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height)
  let pixels = imgData.data
  let i = 0
  for (; i < pixels.length; i += 4) {
    var r = pixels[i]; // Red color lies between 0 and 255
    var g = pixels[i + 1]; // Green color lies between 0 and 255
    var b = pixels[i + 2]; // Blue color lies between 0 and 255
    var a = pixels[i + 3]; // Transparency lies between 0 and 255
    var invertedRed = 255 - r
    var invertedGreen = 255 - g
    var invertedBlue = 255 - b
    pixels[i] = invertedRed
    pixels[i + 1] = invertedGreen
    pixels[i + 2] = invertedBlue
  }
  await ctx.putImageData(imgData, 0, 0)
  return true
}

function clouds () { // topology_ish
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, max = ROWS*ROWS 
  let cellsize = 75, base = 1100/points.length
  let x, y, count = 0, pt
  ctx.fillStyle = "#dda000ff"
  ctx.strokeStyle = "#dd9000ff"
  ctx.globalAlpha = 0.3
  i = 0
  for (; i < 5000; i++) {
    cellsize = base + Math.random()* (base*2)
    x = Math.random() * 500, y = Math.random()*500
    pt = new point()
    pt.x = x
    pt.y = y
    let idx =  nearestPoint(pt)
    if (distance(pt, points[idx]) > cellsize) {
      ctx.beginPath()
      ctx.arc(x,y,cellsize/2,0,2*Math.PI)
      ctx.stroke()
    }
  }
  ctx.globalAlpha = 1
}


function close_passes () {
  if (points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0, L = points.length, prev_i, neighbors, j = 0, count = 0, found = []
  let r = 0.009*Math.pow(points.length,2) - 1.58*points.length + 100
  r *= 1.0
  showPoints()
  showCG()
  ctx.strokeStyle = "#ffffff"
  ctx.fillStyle = "#ffffff"
  ctx.font = "800 italic 16pt Garamond"
  ctx.fillText("r", 10+r/2-2, 480) // show the r value with scale
  ctx.lineWidth = 2
  ctx.beginPath()
  ctx.moveTo(10, 480)
  ctx.lineTo(10, 490)
  ctx.lineTo(10, 485)
  ctx.lineTo(10+r, 485)
  ctx.lineTo(10+r, 490)
  ctx.lineTo(10+r, 480)
  ctx.stroke()
 // console.log(r)
  for (; i < L; i++) {
    prev_i = (i === 0)? L-1: i-1;
    next_i = (i+1)%L
    neighbors = closestNeighbors(i, points)
    j = 1
    for (; j < L; j++) {
      let d = distance(points[i], points[j])
      if (d < r && (points[i] !== points[j] && points[j] !== points[prev_i] && points[j] !== points[next_i])) {
        if (order_distance(points[i], points[j]) > 4) {
          if (!found.includes(points[i])) {
            findPoint(points[i].index)
            found.push(points[i])
            count++
          }
        }
      }
    }
  }
 // console.log(count, found)
  message("close passes: "+count+" (r = "+round(r)+")")
  return (found)
}

function order_distance (pt1, pt2) {
  if (points.length < 1)
    return
  let pt1_i = 0, pt2_i = 0
  let i = 0, dist = 0
  for (; i < points.length; i++) {
    if (points[i] === pt1)
      pt1_i = i
    if (points[i] === pt2)
      pt2_i = i
  }
  let d = Math.abs(pt1_i - pt2_i)
  if (d > points.length/2)
    d = points.length - d
  return (d)
}

function showRings (pts, R) {
  if (!pts)
    pts = points
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  let ctxoff = off.getContext("2d")
  off.width = 500, off.height = 500
  ctxoff.fillStyle = "#ffa500"
  ctxoff.fillRect(0,0,off.width,off.height)
  // Spurs
  let i = 0
  let r = 0.009*Math.pow(pts.length,2) - 1.58*pts.length +100
  if (R)
    r = R
console.log(r, R)
  for (; i < pts.length; i++) {
    ctxoff.beginPath()
    ctxoff.arc(pts[i].x, pts[i].y, r, 0, Math.PI*2)
    ctxoff.closePath()
    ctxoff.fill()
  }
  i = 0
  for (; i < pts.length; i++) {
    ctxoff.save()
    ctxoff.beginPath()
    ctxoff.arc(pts[i].x, pts[i].y, r-2, 0, Math.PI*2)
    ctxoff.closePath()
    ctxoff.clip()
    ctxoff.clearRect(pts[i].x-r, pts[i].y-r, r*2, r*2)
    ctxoff.restore()
  }
  ctx.drawImage(off, 0, 0, canvas.width, canvas.height)

  ctxoff.fillStyle = "#cc2000"
  i = 0
  r /=2
  for (; i < pts.length; i++) {
    ctxoff.beginPath()
    ctxoff.arc(pts[i].x, pts[i].y, r, 0, Math.PI*2)
    ctxoff.closePath()
    ctxoff.fill()
  }
  i = 0
  for (; i < pts.length; i++) {
    ctxoff.save()
    ctxoff.beginPath()
    ctxoff.arc(pts[i].x, pts[i].y, r-2, 0, Math.PI*2)
    ctxoff.closePath()
    ctxoff.clip()
    ctxoff.clearRect(pts[i].x-r, pts[i].y-r, r*2, r*2)
    ctxoff.restore()
  }
  ctx.drawImage(off, 0, 0, canvas.width, canvas.height) 
  topology_ish(ctxoff)
  drawPeninsulas(pts)
}

function drawPeninsulas (pts) { 
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let i = 0
  ctx.strokeStyle = "#ff0000"
  ctx.lineWidth = 2
  for (; i < pts.length; i++) {
    if (isPeninsulaSpurs(pts[i])) {
      pts[i].PEN = true
      ctx.beginPath()
      ctx.arc(pts[i].x, pts[i].y, 2.2, 0, 2*Math.PI)
      ctx.stroke()
    } else
      pts[i].PEN = false
  }
}

function showPoint (p) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.fillStyle= "#ffffff"
  ctx.font = "9px sans-serif"
  ctx.beginPath()
  ctx.arc(p.x, p.y,3, 0, Math.PI*2)
  ctx.closePath()
  ctx.fill()
  ctx.fillText(points.length-1, Math.floor(p.x), Math.floor(p.y+15))
}

let G
function openGrid() {
  if (!G || G.closed)
    G = window.open("./mouse-grid.html","mousegrid","toolbar=no, location=yes, directories=no, status=no, menubar=no, scrollbars=yes, resizable=no, copyhistory=yes, width=520, height=560")
  G.focus()
}

function averageSegmentLength (pts) {
  let copy = copyOf(points)
  let res = nearest_first_n(pts) // should be path length as found  
  points = copy
  drawPath()
  return res/pts.length
}

function averagedistanceIn () {
  if (points.length < 2)
    return -1
  let pts = points
  let i = 0, j = 0, total = 0, n = 0
  for (; i < pts.length; i++) {
    j = 0
    for (; j < pts.length; j++) {
      if (i !== j) {
        total += distance(pts[i],pts[j])
        n++
      }
    }
  }
  return total/n
}

function averagedistance (cp,pts) {
  let i = 0, total = 0
  for (; i < pts.length; i++) {
    total += distance(cp,pts[i])
  }
  return total/pts.length
}

function filterDupes () {
  if (points.length < 1)
    return
  let temp = [], i = 0
  let l = points.length
  for (; i < points.length; i++) {
    if (!pointsVeryNear(temp, points[i].x, points[i].y) || !points[i].guide)
    temp.push(points[i])
  }
  points = temp
  redrawPath(true) // no path lines
  let v = document.getElementById("textarea").value
  document.getElementById("textarea").value = "filtered dupes: "+l+" -> "+points.length+" points\n" + v
}

function pointsVeryNear(pts, x, y) {
  let i = 0, found = false
  for (; i < pts.length; i++) {
    if (Math.abs(pts[i].x - x) <= 1 && Math.abs(pts[i].y - y) <= 1) {
      found = true
      break
    }
  }
  return found
}

function pointsIncludes(pts, x, y) {
  let i = 0, found = false
  for (; i < pts.length; i++) {
    if (pts[i].x === x && pts[i].y === y) {
      found = true
      break
    }
  }
  return found
}

function randomPick (a) {
  return (a[Math.floor(Math.random() * a.length)])
}

function shuffle_points (NODRAW) {
  points = shuffle(points)
  if (!NODRAW)
  drawPath(points)
}

function shuffle_a_few () {
  let n = Math.floor(points.length/5)
  let i = 0
  for (; i < n; i++) {
    swap(randomIndex(points),randomIndex(points))
  }
  drawPath(points)
}

function testvectors () {
  let v1 = ordering()
  swapAcross()
  let v2 = ordering()
  console.log(vectordistance(v1,v2))
}

function vectordistance (v1,v2) {
  let d = 0, sum = 0, norm = 0
  let i = 0, L = v1.length
  for (; i < v1.length; i++) {
    norm += v1[i] * v1[i]
  }
  norm = Math.pow(norm, 0.5)
  i = 0
  for (; i < v1.length; i++) {
    sum += Math.pow((v1[i]/norm-v2[i]/norm), 2)
  }
  return Math.round(100*Math.pow(sum, 0.5))/100
}

function compare_functions () {
  let v = document.getElementById("textarea").value
  let stack = copyOf(functionStack)
  loadpoints()
  copyToClipboard()
  let copy = copyOf(points)
  runsearch("brute_force")
  let m1 = round(measurePath(points, true))
  swapWithClipboard()
  heuristic()
  let m2 = round(measurePath(points, true))
  let json = ""
  let diff = (m2-m1)
  if (m1 < m2) {
    json = "\n"+JSON.stringify(copy, null, 2)
  }
  functionStack = stack
  pushFunction("compare_functions")
  document.getElementById("textarea").value = round(diff) + " compare_functions " + json +"\n"+v
}

function findFails () {
  loadpoints()
  document.getElementById("oib").checked = false
  if (points.length < 3 || points.length > 10) {
    alert("3 to 10 points")
    return
  }
  let v = document.getElementById("textarea").value
  let stack = copyOf(functionStack)
  let failed = ""
  copyToClipboard()
  let copy = copyOf(points)
  runsearch("brute_force")
  let m1 = round(measurePath(points, true))
  let i = 0, diff = 0
  for (; i < 10; i++) {
    shuffle_points()
    heuristic()
    let m2 = round(measurePath(points, true))
    diff = (m2-m1)
    if (m1 < m2) {
      alert(m1 +" < " + m2)
      failed = " failed"
      break;
    }
  }
  functionStack = stack
  pushFunction("findFails")
  document.getElementById("textarea").value = round(diff) + failed+" findFails "  +"\n"
}

function compare () {
  let R = 0, N = 0, i = 0
  for (;i < 10; i++)
    R += testPath()
  i = 0
  for (;i < 10; i++)
    N += nearestFirst()
}

// 1708 * Math.exp(0.0098, n)
function macroFD () { // must be NO_OIB
  if (document.getElementById("oib").checked) {
    alert("OIB must be unchecked")
    document.getElementById("oib").checked = false
  }
  let i = 0
  loadpoints()
  i = 0
  for (; i < 5;i++)
    disrupt()
  i = 0
  for (; i < 5;i++)
    mutate2way()
  i = 0
  for (; i < 5;i++)
    disrupt()
  i = 0
  for (; i < 5;i++)
    mutate2way()
  drawPath()
}

function uncross_paths () {
  let result = checkIntersects(points)
  let ct = 0
  while(result[1].length > 0) {
    points = uncross(result[0], result[1])
    result = checkIntersects(points)
    ct++
    if (ct > 20) 
      break;
  }
  let m = drawPath(points)
}

function uncross (pts,found) {
  if (found[0]) {
    let i = 0, M = measurePath(pts,true), t, m = 0 
    for (;i < found.length; i+=1) {
      t = pts[found[i][2]]
      pts[found[i][2]] = pts[found[i][1]]
      pts[found[i][1]] = t
    }
  }
  return pts
}

function swap_points (i,j) {
  if (points.length < 1)
    return
  let temp = points[i]
  points[i] = points[j]
  points[j] = temp
  let m = measurePath()
  drawPath(points,false)
  let v = document.getElementById("textarea").value
  pushFunction("swap_points")
  document.getElementById("textarea").value = m + " swap_points (" + points[i].index +","+ points[j].index +")\n" + v
}

function orderof (idx, pts) {
  if (!pts)
    pts = points
  let i = 0
  for (; i < points.length; i++) {
    if (points[i].index == idx)
      return i
  }
  return -1 // error
}


function swap (i,j) {
  let temp = points[i]
  points[i] = points[j]
  points[j] = temp
  return points
}

function testT () {
  let k = 0, kmax = 10
  let i = 0, imax = 100
  let t = 0
  let res = []
  i = 0
  for (; i < imax; i++) {
    res.push(1 - (t+1)/(imax))
    t++
  }
  return res
}

function secondsToYMDH (s) {
  let result = "", r = 0
  const to_year = 31556952
  const to_month = to_year/12
  const to_day = to_year/365
  const to_hour = to_day/24
  const to_min = to_hour/60
  r = (s/to_year)
  if (r >= 1) {
    result += r + " years"
    s -= r * to_year
  }
  r = (s/to_month)
  if (r >= 1) {
    result += ", " + r + " months"
    s -= r * to_month
  }
  r = (s/to_day)
  if (r >= 1) {
    result += ", " + r + " days"
    s -= r * to_day
  }
  r = (s/to_hour)
  if (r >= 1) {
    result += ", " + r + " hours"
    s -= r * to_hour
  }
  
  r = (s/to_min)
  if (r >= 1) {
    result += ", " + r + " min"
    s -= r * to_min
  }
  return result
}

function spiral () { // make like skinny Rings
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let W = canvas.width, H = canvas.height
  var n = document.getElementById("numpoints").value
  ctx.lineWidth = 2
  let ab = 2/Math.log2(n)
  let x = W/2, y = H/2, a = ab, b = ab
  let angle = 0
  let increase = W/(70), ct = 0
  points = []
  
  while (ct < n) {
    x = x + (a + b * angle) * Math.cos(angle)
    y = y + (a + b * angle) * Math.sin(angle)
    points.push(new point(x,y))
    angle += increase
    ct++
  }
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
}

function checkIntersects (pts) {
  if (!pts)
    pts = points
  let i = 0, p1,p2,p3,p4, ct=0
  let found = []
  for (; i < pts.length; i++) {
    let j = i+1
    p1 = pts[i], p2 = (pts[i+1] || pts[0])
    for (; j < pts.length; j++) {
      p3 = pts[j], p4 = (pts[j+1] || pts[0])
      let k = intersects(p1,p2,p3,p4)
      if (k) {
        if (p2 !== p3) {
          ct++
          found.push([i,(i+1) % pts.length,j,(j+1)%pts.length])
        }
      }
    }
  }
  return([pts,found])
}

function intersection (p1,p2,q1,q2) {
  let mp = (p2.y-p1.y)/(p2.x-p1.x)
  let mq = (q2.y-q1.y)/(q2.x-q1.x)
  // y = m*x + b
  let bp = p1.y - mp * p1.x
  let bq = p2.y - mq * p2.x
  //  ---/---
}

function line_intersect (p1,p2,q1,q2)
{
  let x1 = p1.x, y1 = p1.y, x2 = p2.x, y2 = p2.y, 
      x3 = q1.x, y3 = q1.y, x4 = q2.x3, y4 = q2.y
    var ua, ub, denom = (y4 - y3)*(x2 - x1) - (x4 - x3)*(y2 - y1);
    if (denom == 0) {
        return null;
    }
    ua = ((x4 - x3)*(y1 - y3) - (y4 - y3)*(x1 - x3))/denom;
    ub = ((x2 - x1)*(y1 - y3) - (y2 - y1)*(x1 - x3))/denom;
    return {
        x: x1 + ua * (x2 - x1),
        y: y1 + ua * (y2 - y1),
        seg1: ua >= 0 && ua <= 1,
        seg2: ub >= 0 && ub <= 1
    };
}

// returns true if the line from (a,b)->(c,d) intersects with (p,q)->(r,s)
function intersects (p1,p2,p3,p4) {//a,b,c,d,p,q,r,s) {
  let a = p1.x, b = p1.y, c = p2.x, d = p2.y
  let p = p3.x, q = p3.y, r = p4.x, s = p4.y
  
  let det, gamma, lambda;
  det = (c - a) * (s - q) - (r - p) * (d - b);
  if (det === 0) {
    return false;
  } else {
    lambda = ((s - q) * (r - a) + (p - r) * (s - b)) / det;
    gamma = ((b - d) * (r - a) + (c - a) * (s - b)) / det;
    return (0 < lambda && lambda < 1) && (0 < gamma && gamma < 1);
  }
}

/* permute code */
const permutator = (inputArr) => {
  let result = [];
  const permute = (arr, m = []) => {
    if (arr.length === 0) {
      result.push(m)
    } else {
      for (let i = 0; i < arr.length; i++) {
        let curr = arr.slice();
        let next = curr.splice(i, 1);
        permute(curr.slice(), m.concat(next))
     }
   }
 }
 permute(inputArr)
 return result;
}

let DIST = []

function populateDistances () {
  DIST = []
  let i = 0, j = 0, d
  for (; i < points.length; i++) {
    j = 0
    DIST.push([])
    for (; j < points.length; j++) {
      d = distance_(points[i],points[j])
      DIST[+points[i].index].push(d)
    }
  }
  return DIST
}

function distance_weighted (p1, p2) { // only used by measurePath
  let d = Math.pow((Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2)),0.5)
  d *= p1.weight
  d *= p2.weight
  return d
}

function distance_euclid (p1, p2) {
  let d = Math.pow((Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2)),0.5)
  return d
}

function distance (p1, p2) {
  let d = Math.pow((Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2)),0.5)
  return d
}

function distance_ (p1,p2) {
  return DIST[p1.index][p2.index]
}

function shuffle (array) {
  return array.sort(() => Math.random() - 0.5);
}

function center (pts) { // center of gravity
  if (!pts)
    pts = points
  let i = 0, xm = 0, ym = 0
  for (; i < pts.length; i++) {
    xm += pts[i].x
    ym += pts[i].y
  }
  return (new point(xm/pts.length, ym/pts.length))
}

function randomIndex (array) {
  return (Math.floor(Math.random() * array.length))
}

function angle (cp, pt) {
  return Math.atan2(pt.y - cp.y, pt.x - cp.x)
}

function closestTo (point, points) {
  const sortByDistance = (pts, pt) => {
    const sorter = (a, b) => distance(a, pt) - distance(b, pt)
    pts.sort(sorter)
  }
  sortByDistance(points, point)
  return points
} 

function closestNeighbors (index, points) {
  const sortByDistance = (pts, pt) => {
    const sorter = (a, b) => distance(a, pt) - distance(b, pt)
    pts.sort(sorter)
  }
  let copy = copyOf(points)
  sortByDistance(copy, copy[index])
  return copy
}

function sortedByAngle (points) {
  let cg = center(points)
  const sortByAngle = (pts, cg) => {
    const sorter = (a, b) => angle(cg, a) - angle(cg, b)
    pts.sort(sorter)
  }
  let copy = copyOf(points)
  sortByAngle(copy, cg)
  return copy
}

function farthestNeighbors (index, points) {
  const sortByDistance = (pts, pt) => {
    const sorter = (a, b) => distance(b, pt) - distance(a, pt)
    pts.sort(sorter)
  }
  sortByDistance(points, points[index])
  return points
}

function swapAcross () {
 // if (points.length < 1)
 //   return
  let copy = copyOf(points)
  let score = measurePath(copy, true)
  let i = 0, ct = 0
  for (; i < copy.length; i++) {
    j = 0
    for (; j < copy.length; j++) {
      if (i !== j ) {
        let temp = copy[i]
        copy[i] = copy[j]
        copy[j] = temp
        score2 = measurePath(copy, true)
        if (score2 < score) {
          points = copy
          score = measurePath(copy, true)
        } else {
          temp = copy[i] // swap back
          copy[i] = copy[j]
          copy[j] = temp
        }
      }
    }
  }
  let m = drawPath()
  return m
}

/* 
foreach pont (p)
find closest neighbor (cn)
if not next or previous, make next
tidy up the path and measure
accept change if better
*/
function swap_closest () {
  if (points.length < 1)
    return
  let idxs = shortestChunk()
  let copy = copyOf(points)
  let score = measurePath(copy, true)
  let i = 0, ct = 0
  for (; i < copy.length; i++) {
    let cn = closestNeighbors(i,copyOf(copy))[1]
   // let idx = cn.index
    let idx = copy.indexOf(cn)
    let idn = (i - 1 < 0)? copy.length-1: i-1
    // swap cn and pnext
    let temp = copy[idn]
    copy[idn] = copy[idx]
    copy[idx] = temp
    score2 = measurePath(copy, true)
    if (score2 < score) {
      console.log("**",score2, score)
      
      points = copy
      break; // or ???
    } else { // swap back
      temp = copy[idn]
      copy[idn] = copy[idx]
      copy[idx] = temp
    }
  }
  let m = drawPath()
  return m
}


function round (m) {
  return (Math.round(m*10)/10)
}

function roundto (m, dp) {
  let d = Math.pow(10,dp)
  return (Math.round(m*d)/d)
}

function round2dp (m) {
  return (Math.round(m*100)/100)
}

function simplify () {
  let idxs = shortestChunk()
  let i = 0, ct = 0
  for (; i < idxs.length; i++) {
    ct += mergeIndex(idxs[i])
  }
  drawPath()
}

function simplify180 () { // map to
  if (points.length < 1)
    return
  let i = 0, ct = 0, prev, next
  copyToClipboard()
  for (; i < points.length; i++) {
    prev = (i === 0)? points.length-1: i-1;
    next = (i+1) % points.length
    if (points[i].angle < 200 && points[i].angle > 160) {
      points[i].x = points[prev].x
      points[i].y = points[prev].y
      ct++
    }
  }
  drawPath()
  let m = measurePath()
  message("simplify 180: -" +ct+" ("+m+") ")
}

function mergeIndex (index) {
  if (points.length < 4)
    return 0
  if (!(points[index[0]].x === points[index[1]].x) &&
      !(points[index[0]].y === points[index[1]].y)) {
    points[index[0]].x = points[index[1]].x
    points[index[0]].y = points[index[1]].y
    return 1
  } else  
    return 0
}

function shortestChunk () {
  let result = []
  if (points.length < 1)
    return -1
  let i = 0, idx = 0, idx2 = 0, min = 2e20
  let bp = boundingPoints()
  for (;i < points.length; i++) {
    if (distance(points[i], points[(i+1)%points.length]) > 0 && distance(points[i], points[(i+1)%points.length]) < min) {
      min = distance(points[i], points[(i+1)%points.length])
    }
  }
  min *= 3
  i = 0
  for (;i < points.length; i++) {
    if (distance(points[i], points[(i+1)%points.length]) > 0 && distance(points[i], points[(i+1)%points.length]) < min) {
      idx = i
      idx2 = (i+1)%points.length
      result.push([idx,idx2])
    }
  }
  return result
}

function longestChunk () {
  let result = []
  if (points.length < 1)
    return -1
  let i = 0, idx = 0, idx2 = 0, max = 0
  for (;i < points.length; i++) {
    if (distance(points[i], points[(i+1)%points.length]) > 0 && distance(points[i], points[(i+1)%points.length]) > max) {
      max = distance(points[i], points[(i+1)%points.length])
      idx = i
      idx2 = (i+1)%points.length
    }
  }
  result.push([idx,idx2,max])
  return result
}

function loadpoints (f) {
  if (!f)
    f = document.getElementById("testcases").value
  window [f] ()
  TEMPS = []
  CLUSTERS = []
  SEGMENTS = []
  LOG = ""
  //populateDistances()
  let v = document.getElementById("textarea").value
  let n = document.getElementById("numpoints").value
  pushFunction('loadpoints')
  LOWSCORE = 2e20
  document.getElementById("lowscore").innerText = "(2e20)"
  let m = measurePath(points, false)
  document.getElementById("textarea").value = f + " "+n+" points ("+m+")\n" + v
  recordToLog(f)
  SHOWINGPATH = true
  hidePath()
}

function runsearch (f) {
  if (points.length < 1)
    loadpoints()
  if (!f)
    f = document.getElementById("search").value
  LASTRUN = f
  window [f] ()
  let m = measurePath(points,true)
  pushFunction("runsearch", f)
  message(m + " " + f)
}

function removePoints () { // remove non guide points
  if (points.length < 1)
    return
  let v = document.getElementById("textarea").value
  let pts = copyOf(points), temp = []
  let minlength = 2E20, minindex = 0
  let i = 0, n = 9, div = 500/n, x = y = 10
  let cnt = 0
  for (; i < points.length; i++) {
    if (pts[i].guide === true) {
      temp.push(pts[i])
    }
  }
  points = temp
  //nearest_far_n(points)
  //removeGuidePoints()
  let pl = Math.round(measurePath(points,true)*10)/10
  document.getElementById("textarea").value = temp.length +" remove points\n" + v
  drawPath()
}

let POINTSTACK = []
let BIDI = false //bi-directional: costs differ by direction

window.onload = function () {
  let fp = document.getElementById("findpoint")
  fp.addEventListener("keydown", (event) => {
    if (event.key === "Enter")
      findPoint()
  })
/*
  document.addEventListener('keydown', function(event) {
    console.log('Key pressed:', event.key);
    console.log('Key code:', event.code);
    console.log('Which key:', event.which); // Backup for older browsers
});*/
  /*
  let bidi = document.getElementById("notbidi") // bi-directional
  bidi.addEventListener('change', function() {
    if (this.checked) {
      BIDI = true
      message(" <\u{2260}>")
      populateDistances()
    } else {
      BIDI = false
      message(" <=>")
      populateDistances()
    }
  });*/
  let filePicker = document.getElementById("fileInput")
  filePicker.addEventListener("click", function(){this.value = null;}, false);
  filePicker.addEventListener("change", function(){processFiles(this.files);}, false);
  myCanvas.addEventListener('click', function(event) { // mouse clicks
    var rect = myCanvas.getBoundingClientRect();
    var x = event.clientX - rect.left;
    var y = event.clientY - rect.top;
    let p = new point(x,y)
    //console.log(x,y)
    let index = nearestPoint(p)
    let cellsize = 500/ROWS
    if (index || index === 0) {
      message(JSON.stringify(points[index], null, 2), "myCanvas")
      document.getElementById("findpoint").value = points[index].index
      if (event.ctrlKey) {
        poke_point(points[index].index)
      }
    }
  }, false);

  let np = document.getElementById("numpoints")
  np.addEventListener('change', function(event) {
      loadpoints()   
  }, false);

  let tc = document.getElementById("testcases")
  tc.addEventListener('change', function(event) {
      loadpoints()   
  }, false);
  /*
  let s = document.getElementById("search")
  s.addEventListener('change', function(event) {
      runsearch()   
  }, false);*/
}

function indexOf (pt) {
  if (points.length < 1)
    return
  let i = 0, idx = 0
  for (; i < points.length; i++) {
    if (pt.index === points[i].index) {
      return points[i].index
    }
  }
  return 10
}

function processFiles (files) {
  var file = files[0];
  var temptext = "";
  if (file === undefined)
    return;
  var reader = new FileReader();
  reader.onload = function(e) {
    temptext = e.target.result;
    let jobj = JSON.parse(temptext)
    points = jobj
    let canvas = document.getElementById("myCanvas")
    let ctx = canvas.getContext("2d")
    ctx.clearRect(0,0,canvas.width, canvas.height)
    showPoints(points)
    let v = document.getElementById("textarea").value
    document.getElementById("textarea").value = file.name+" file loaded\n" + v
    LOWSCORE = 2e20
    document.getElementById("lowscore").innerText = "(2e20)"
  };
  reader.readAsText(file);
}

async function getNewFileHandle() {
  const opts = {
    types: [
      {
        description: "Text file",
        accept: { "text/plain": [".txt"] },
      },
    ],
  };
  return await window.showSaveFilePicker(opts);
}

function saveAs () {
  var textToWrite = JSON.stringify(points, null, 4);
  var blob = new Blob([textToWrite], {type:'text/plain'});
  saveFile(blob,"untitled.json")
}

function savetextAs () {
  var textToWrite = document.getElementById("textarea").value
  var blob = new Blob([textToWrite], {type:'text/plain'});
  saveFile(blob, "untitled.txt")
}

const saveFile = async (blob, suggestedName) => {
  // Feature detection. The API needs to be supported
  // and the app not run in an iframe.
  const supportsFileSystemAccess =
    'showSaveFilePicker' in window &&
    (() => {
      try {
        return window.self === window.top;
      } catch {
        return false;
      }
    })();
  // If the File System Access API is supported
  if (supportsFileSystemAccess) {
    try {
      // Show the file save dialog.
      const handle = await showSaveFilePicker({
        suggestedName
      });
      // Write the blob to the file.
      const writable = await handle.createWritable();
      await writable.write(blob);
      await writable.close();
    } catch (err) {
      // Fail silently if the user has simply canceled the dialog.
      //console.error(err.name, err.message);
      if (err.name !== 'AbortError') {
        //console.error(err.name, err.message);
        return;
      }
    }
  } else {
    // Fallback if the File System Access API is not supported
    // Create the blob URL.
    const blobURL = URL.createObjectURL(blob);
    // Create the `` element and append it invisibly.
    const a = document.createElement('a');
    a.href = blobURL;
    a.download = suggestedName;
    a.style.display = 'none';
    document.body.append(a);
    // Click the element.
    a.click();
    // Revoke the blob URL and remove the element.
    setTimeout(() => {
      URL.revokeObjectURL(blobURL);
      a.remove();
    }, 1000);
  }
};

function openJSON () {
  document.getElementById('fileInput').click();
  TEMPS = []
  CLUSTERS = []
  SEGMENTS = []
}

function boundingPoints (pts) {
  if (!pts)
    pts = points
  let minx = 2e20, miny = 2e20,
      maxx = -2e20, maxy = -2e20
  let i = 0, x, y
  for (; i < pts.length; i++) {
    if (pts[i]) {
      x = pts[i].x, y = pts[i].y
      minx = (x < minx)? x: minx;
      miny = (y < miny)? y: miny;
      maxx = (x > maxx)? x: maxx;
      maxy = (y > maxy)? y: maxy;
    }
  }
  return ([new point(minx-1,miny-1), new point(maxx+1,maxy+1)])
}

function corners () {
  points = []
  let i = 0
  let x = 0, y = 0
  let N = document.getElementById("numpoints").value
  for (; i < N; i++) {
    if (Math.random() > 0.5) {
      if (Math.random() > 0.5) {
        x = 10+Math.random() * 140
        y = 10+Math.random() * 140
      } else {
        x = 350+Math.random() * 140
        y = 350+Math.random() * 140
      }
    } else {
      if (Math.random() > 0.5) {
        x = 10+Math.random() * 140
        y = 350+Math.random() * 140
      } else {
        x = 350+Math.random() * 140
        y = 10+Math.random() * 140
      }
    }
    points.push(new point(x,y))
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
}

function cat_ears () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  document.getElementById("numpoints").value = 8
  ctx.clearRect(0,0,canvas.width, canvas.height)
  
  points = [
  {
    "x": 125,
    "y": 41.666666666666664,
    "index": 0
  },
  {
    "x": 145,
    "y": 370,
    "index": 1
  },
  {
    "x": 250,
    "y": 375,
    "index": 2
  },
  {
    "x": 333.3333333333333,
    "y": 375,
    "index": 3
  },
  {
    "x": 458.3333333333333,
    "y": 187.5,
    "index": 4
  },
  {
    "x": 375,
    "y": 41.666666666666664,
    "index": 5
  },
  {
    "x": 320.6666666666667,
    "y": 187.5,
    "index": 6
  },
  {
    "x": 250,
    "y": 187.5,
    "index": 7
  }
  ]
  showPoints (points)
}

function dumbell () {
  points = []
  
  let i = 0
  let x = 0, y = 0
  let N = document.getElementById("numpoints").value
  for (; i < N; i++) {
    if (Math.random() > 0.5) {
      x = 10+Math.random() * 140
      y = 10+Math.random() * 140
    } else {
      x = 350+Math.random() * 140
      y = 350+Math.random() * 140
    }
    points.push(new point(x,y))
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
}

function circle () {
  points = []
  let i = 0, r = 200, a = 0
  let x = 0, y = 0, cx = 250, cy = 250
  let N = document.getElementById("numpoints").value
  for (; i < N; i++) {
    a = Math.random() * Math.PI * 2
    x = cx + r * Math.cos(a),
    y = cy + r * Math.sin(a)
    points.push(new point(x,y))
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
}

function atom () {
  points = []
  let i = 0, r, r1 = 230, a = 0, r2 = 90
  let x = 0, y = 0, cx = 250, cy = 250
  let N = 12
  for (; i < N; i++) {
    r = r1
    x = cx + r * Math.cos(a),
    y = cy + r * Math.sin(a)
    a += (2*Math.PI/N)
    points.push(new point(x,y))
  }
  i = 0
  a = Math.random() * Math.PI*2
  N = 9
  for (; i < N; i++) {
    r = r2
    x = cx + r * Math.cos(a),
    y = cy + r * Math.sin(a)
    a += (2*Math.PI/N)
    points.push(new point(x,y))
  }
 
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
}

function concentric () {
  points = []
  
  let i = 0, r, r1 = 230, a = 0, r2 = 160, r3 = 90
  let x = 0, y = 0, cx = 250, cy = 250
  let N = +document.getElementById("numpoints").value
  for (; i < N; i++) {
    a = Math.random() * Math.PI * 2
    r = randomPick([r1,r2,r3])
    x = cx + r * Math.cos(a),
    y = cy + r * Math.sin(a)
    points.push(new point(x,y))
  }
 
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
}

function concentric2 () {
  points = []
  let i = 0, r, r1 = 225, a = 0, r2 = 125, r3 = 90
  let x = 0, y = 0, cx = 250, cy = 250, d = 50
  let N = +document.getElementById("numpoints").value
  for (; i < N; i++) {
    a = Math.random() * Math.PI * 2
    r = randomPick([r1,r2]) + pet(d)
    x = cx + r * Math.cos(a),
    y = cy + r * Math.sin(a)
    points.push(new point(x,y))
  }
 
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
}

function pointInRect (pt,x0,y0,x2,y2) {
  let IN = true
  if (pt.x > x2 ||
      pt.x < x0 ||
      pt.y > y2 ||
      pt.y < y0) 
  IN = false
  return IN
}

function pointInRect2 (pt,x0,y0,x2,y2) {
  let IN = false
  if ((pt.x >= x0 && pt.x <= x2) && 
      (pt.y >= y0 && pt.y <= y2))
    IN = true
  return IN
}

function pointInCircle (pt,x,y,r) {
  let IN = false
  // (p  a)2 + (q  b)2 < r2
  if ((pt.x >= x0 && pt.x <= x2) && 
      (pt.y >= y0 && pt.y <= y2))
    IN = true
  return IN
}

let temperatures = []

function heatmap () {
  if (!points || points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let bp = boundingPoints(points)
  let i = 0, div = 2, j = 0
  let ss = ctx.strokeStyle
  ctx.lineWidth = 1
  ctx.strokeStyle = "yellow"
  ctx.fillStyle = "orange"
  ctx.globalAlpha = 1/9

  temperatures = []
  for (; i < 625; i++)
    temperatures[i] = 0

  i = 0
  for (; i < points.length; i++) {
    j = 0
    let r = 15
    for (; j < 4; j++) {
      ctx.beginPath()
      ctx.fillRect((points[i].x-r/2),(points[i].y-r/2), r, r)
      ctx.closePath()
      ctx.fill()
      temperatures[ifromxy(Math.floor(points[i].x/25),Math.floor(points[i].y/25))]+=1
      r = r + 40
    }
  }
  ctx.globalAlpha = 1
}

function drawBoxes () {
  if (!points || points.length < 1)
    return
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let bp = boundingPoints(points)
  let i = 0, div = 2, ins = 0
  let x, y, w=150, h=150, y0 = y
  let ss = ctx.strokeStyle
  ctx.lineWidth = 1
  ctx.strokeStyle = "yellow"
  ctx.fillStyle = "orange"
  ctx.globalAlpha /= 10
  i = 0
  for (; i < points.length; i++) {
    points[i].degree = 0
  }
  i = 0
  for (; i < points.length; i++) {
    x = points[i].x
    y = points[i].y
    pointsInCircle(x,y,w)
  }
  let r = 5
  i = 0
  for (; i < points.length; i++) {
    let d = points[i].degree, j = 0
    x = points[i].x, y = points[i].y
    r = 5
    let max = (d-1 > 8)? 8: d-1
    for (; j < max; j++) {
      ctx.beginPath()
      ctx.arc(x,y,r,0,Math.PI*2)
      ctx.fill()
      if (r < 60)
      r *= 1.7
    }
  }
  ctx.globalAlpha *= 10
}

function pointsInCircle (x,y,w) {
  if (!points || points.length < 1)
    return
  let i = 0
  for (; i < points.length; i++) {
    if (points[i].guide === false && Math.sqrt((x - points[i].x) ** 2 + (y - points[i].y) ** 2) < w/2) {
      points[i].degree += 0.8
    }
  }
}

function disrupt () {
  if (document.getElementById("save_prev").checked)
    copyToClipboard()
  let m1 = measurePath()
  let i = 0
  for (; i < 2; i++) 
    shuffle_points()
  heuristic()
 // heuristic()
  let m2 = measurePath()
  drawPath(points)
  if (m2 < m1)
    setAngles()
}

function nearest_first_half (pts,idx,P) {
  if (!pts) {
    pts = points // copy
    idx = Math.floor(Math.random() * pts.length)
  }
  let res = []
  let index = idx
  res.push(pts[index])
  let sorted = closestNeighbors(index, pts)
  let i = 0, L = sorted.length-1
  while (i < L*0.75) {
    sorted = closestNeighbors(0, sorted)
    res.push(sorted[1])
    sorted = sorted.slice(1)
    i++
  }
  i = 0
  for (; i < pts.length; i++) {
    if (!res.includes(pts[i]))
      res.push(pts[i])
  }
  points = res
  return drawPath(res, P)
}

function desirepaths () {
  if (points.length < 1)
    return
  copyToClipboard()
  document.getElementById("oib").checked = false
  document.getElementById("save_prev").checked = false
  let ta = document.getElementById("textarea").value
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let t1 = new Date()
  let segarray = []
  let scorearray = []
  let segs = {}
  ctx.fillStyle = "#000000"
  ctx.fillRect(0,0,500,500)
  let i = 0, j = 0
  let max = 100//points.length?
  for (; j < max; j++) {
    shuffle_points()
    mini_tidy()
    //mutate2way()
    segs = {}
    segs = record_segemnts(points)
    segarray.push(segs)
    scorearray.push(measurePath())
  }
  // consolidate and score
  let allsegs = consolidate_segs(segarray, scorearray) 
  let conf = point_confidence(allsegs)
  let finalists = drawSegs(allsegs, ctx)
  // do something with finalists
  let res = segsToPoints(finalists, allsegs)
  let t2 = new Date()
  document.getElementById("textarea").value = ta
 // message(JSON.stringify(allsegs).replaceAll(",", ",\n"))
  marklog()
  let sortedarray = Object.entries(conf).sort(([, a], [, b]) => b - a)
  let str = ""
  sortedarray.forEach((element) => {if (element[1]>=0.75) {findPoint(element[0])}})
  sortedarray.forEach((element) => str += element.toString().replace(",",":")+"\n")
  let keys = Object.keys(allsegs)
  str = ""
  i = 0
  for (; i < keys.length; i++) {
    if (allsegs[keys[i]] > 4)
      str += keys[i]+":"+allsegs[keys[i]]+"\n"
  }
  message(res)
  message("desire paths "+ finalists.length + " "+round((t2-t1)/1000)+"[s]")
  document.getElementById("oib").checked = true
  document.getElementById("save_prev").checked = true
}

function segsToPoints(finalists, allsegs) {
  let i = 0, pts = [], found = [], c = 0, res = ""
  let f1 = (finalists[0])
  let id1 = f1.substring(0, f1.indexOf(">"))
  let id2 = f1.substring(f1.indexOf(">")+1, f1.length)
  let p1 = pointByIndex(id1)
  let p2 = pointByIndex(id2)
  for (; c < points.length; c++) {
    found = []
    i = 0
    for (; i < finalists.length; i++) {
      if (finalists[i].match(new RegExp("^"+c+">")) ||
          finalists[i].match(new RegExp(">"+c+"$")))
        found.push(finalists[i]+":"+allsegs[finalists[i]])
    }
    res += c + "::"+found+"\n"
  }
  return (res)
}

function consolidate_segs (segs, scores) {
  let lowscore = Math.min(...scores)
  let allsegs = {}, i = 0, j = 0
  for (; i < segs.length; i++) { // rescore
    j = 0
    let keys = Object.keys(segs[i])
    for (; j < keys.length; j++) {
      allsegs[keys[j]] = (allsegs[keys[j]] || 0) + segs[i][keys[j]] 
    }
  }
  let p1, p2
  j = 0
  let keys = Object.keys(allsegs)
  for (; j < keys.length; j++) {
    p1 = (keys[j].substring(0, keys[j].indexOf(">")))
    p2 = (keys[j].substring(keys[j].indexOf(">")+1, keys[j].length))
    let reversed = p2+">"+p1
    if (allsegs[reversed] > 0) {
      allsegs[p1+">"+p2] += allsegs[reversed]
      allsegs[reversed] = 0
    }
  }
  return allsegs
}

function point_confidence (segs) { // allsegs
  if (points.length < 1)
    return
  let i = 0, counts = {}, keys = Object.keys(segs) 
  for (; i < keys.length; i++) {
    let id1 = (keys[i].substring(0, keys[i].indexOf(">")))
    let id2 = (keys[i].substring(keys[i].indexOf(">")+1, keys[i].length))
    counts[id1] = (counts[id1] || 0) + 1
    counts[id2] = (counts[id2] || 0) + 1
  }
  keys = Object.keys(counts)
  let vals = Object.values(counts)
  let min = Math.min(...vals)
  i = 0
  for (; i < keys.length; i++) {
    counts[keys[i]] = round2dp(min/counts[keys[i]])
  }
  message(JSON.stringify(counts).replaceAll(",", ",\n"))
  return counts
}

function drawSegs (segs, ctx) {
  let keys = Object.keys(segs)
  let values = Object.values(segs)
  let finalists = []
  let T = +document.getElementById("voidsize").value
  ctx.fillStyle = "#000000"
  ctx.fillRect(0,0,500,500)
  pasteFromClipboard()

  ctx.strokeStyle = '#ff60ff'
  ctx.fillStyle = '#60ffff'
  let i = 0, j = 0, L = points.length, count = 0, p1, p2, found = [], idx = "", jdx = "", TOTAL = 0
  for (; i < L; i++) {
    j = 0, idx = points[i].index
    found = []
    for (; j < L; j++) {
      jdx = points[j].index
      if (segs[idx+">"+jdx])
        found.push(segs[idx+">"+jdx])
      if (segs[jdx+">"+idx])
        found.push(segs[jdx+">"+idx])
    }
    found = found.sort(function(a, b) {
      return a - b;
    }).reverse().slice(0,5)
    let threshold = (found[4] || found[0])
    ctx.font = "7pt sans-serif"
    ctx.lineWidth = 2
    let k = 0
    for (; k < L; k++) {
      jdx = points[k].index
      if (segs[idx+">"+jdx] >= threshold) {
        count = segs[idx+">"+jdx]
        if (count > T && !finalists.includes(idx+">"+jdx)) {
          finalists.push(idx+">"+jdx)
          p1 = pointByIndex(idx)
          p2 = pointByIndex(jdx)
          ctx.beginPath()
          ctx.moveTo(p1.x+9, p1.y+9)
          ctx.lineTo(p2.x+9, p2.y+9)
          ctx.stroke()
          let half = new point((p1.x+p2.x)/2+9, (p1.y+p2.y)/2+9)
          ctx.fillText(count, half.x, half.y)
          TOTAL++
        }
      } else 
      if (segs[jdx+">"+idx] >= threshold) {
        count = segs[jdx+">"+idx]
        if (count > T && !finalists.includes(jdx+">"+idx)) {
          finalists.push(jdx+">"+idx)
          p1 = pointByIndex(idx)
          p2 = pointByIndex(jdx)
          ctx.beginPath()
          ctx.moveTo(p1.x+9, p1.y+9)
          ctx.lineTo(p2.x+9, p2.y+9)
          ctx.stroke()
          let half = new point((p1.x+p2.x)/2+9, (p1.y+p2.y)/2+9)
          ctx.fillText(count, half.x, half.y)
          TOTAL++
        }
      }
    }
  }
  return finalists
}


function drawSegs_OG (segs, ctx) {
  let keys = Object.keys(segs)
  let values = Object.values(segs)
  let threshold = Math.floor(mean(values))
  let max = Math.max(...values)
  let avg = mean(values)
  pasteFromClipboard()
  ctx.strokeStyle = '#ff60ff'
  ctx.fillStyle = '#60ffff'
  let i = 0, L = keys.length, count = 0, p1, p2
  for (; i < L; i++) {
    count = segs[keys[i]]
    if (count > 3) {
      p1 = pointByIndex(keys[i].substring(0, keys[i].indexOf(">")))
      p2 = pointByIndex(keys[i].substring(keys[i].indexOf(">")+1, keys[i].length))
      ctx.beginPath()
      ctx.moveTo(p1.x+9, p1.y+9)
      ctx.lineTo(p2.x+9, p2.y+9)
      ctx.globalAlpha = Math.max(count/max, 0.5)
      ctx.stroke()
      ctx.globalAlpha = 1
      let half = new point((p1.x+p2.x)/2+9, (p1.y+p2.y)/2+9)
      ctx.font = "7pt sans-serif"
      ctx.fillText(count, half.x, half.y)
    }
  }
  ctx.globalAlpha = 1
}

function record_segemnts (pts) {
  let segs = {}
  let i = 0, L = pts.length, s
  for (; i < points.length; i++) {
    s = points[i].index+">"+points[(i+1)%L].index
    segs[s] = (segs[s] || 0) + 1
  }
  i = 0
  let keys = Object.keys(segs)
  for (; i < points.length; i++) { // one way
    if (segs[points[(i+1)%L].index+">"+points[i].index] &&// swapped
        segs[points[i].index+">"+points[(i+1)%L].index]) {
          segs[points[(i+1)%L].index+">"+points[i].index] += segs[points[i].index+">"+points[(i+1)%L].index]
          segs[points[i].index+">"+points[(i+1)%L].index] = 0
     }
  }
  return segs
}

function inversions () {
  if (points.length < 1)
    return
  let temp = []
  let copy = copyOf(points)
  let N = copy.length
  let half = Math.floor(copy.length/2)
  let i = Math.floor(Math.random()*N)
  let max = i + half
  for (; i < max; i++) {
    temp.push(copy[i % N])
  }
  temp = shuffle(temp)
 // i = half
  max = i + half
  if (N % 2 === 1)
    max += 1
  for (; i < max; i++) {
    temp.push(copy[i%N])
  }
  points = temp
  let v = document.getElementById("textarea").value
  let m = drawPath(points)
  document.getElementById("textarea").value = round(m) +" inversions\n" + v
  pushFunction("inversions")
}

function jigglepoints () {
  if (points.length < 1)
    return
  let pts = points
  let i = 0, p = 10
  for (; i < pts.length; i++) {
    pts[i].x += pet(p)
    pts[i].y += pet(p)
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
  let v = document.getElementById("textarea").value
  if (v.startsWith("+") || v.startsWith("jiggle"))
    document.getElementById("textarea").value = "+" + v
  else
    document.getElementById("textarea").value = "jiggled points\n" + v
  pushFunction("jigglepoints")
  drawPath()
}

function maptogrid () {
  if (points.length < 1)
    return
  copyToClipboard()
  let sd = Math.pow(averagedistanceIn(points),0.5)*3
  let g = Math.floor(480/sd)
  let result = []
  let gpoints = [] // fill with g points in square (not grid)
  gpoints = squaregrid(9)
  let i = 0, n = 9, div = 500/n, x = y = 0, c
  for (; i < points.length; i++) {
     // duplicates? treat as the same point?
      c = closestpointin(points[i], gpoints)
      points[i].x = c.x
      points[i].y = c.y
      result.push(points[i])
  }
  points = result
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints (points)
  let dim = Math.sqrt(gpoints.length)
  let v = document.getElementById("textarea").value
  document.getElementById("textarea").value = "map to grid: "+dim+"X"+dim+" points\n" + v
}

function maptoOffsetgrid () {
  if (points.length < 1)
    return
  copyToClipboard()
  let sr = Math.round(Math.sqrt(points.length))
  let space = Math.floor((490/(sr-0.7))*1)
  console.log(space)
  let sd = spacing()//Math.pow(averagedistanceIn(points),0.5)*3
  let g = Math.floor(480/sd)
  let result = []
  let gpoints = []
   gpoints = offsetgrid(g*g*4) // clipped at bottom  PAD
  let i = 0, x = y = 0, c
  for (; i < points.length; i++) {
      c = closestpointin(points[i], gpoints)
      points[i].x = c.x
      points[i].y = c.y
      result.push(points[i])
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints(points)
  let dim = Math.sqrt(gpoints.length)
  let v = document.getElementById("textarea").value
  document.getElementById("textarea").value = "map to offset grid \n" + v
  pushFunction("maptoOffsetgrid")
}

function maptoOffsetgridEQ () {
  if (points.length < 1)
    return
  copyToClipboard()
  let sr = Math.round(Math.sqrt(points.length))
  let space = Math.floor((490/(sr-0.7))*1)
  console.log(space)
  let sd = spacing()//Math.pow(averagedistanceIn(points),0.5)*3
  let g = Math.floor(480/sd)
  let result = []
  let gpoints = offsetgrid(points.length)
  let copy = copyOf(gpoints)
  let used = []
  let i = 0, x = y = 0, c
  for (; i < points.length; i++) {
      c = closestpointin(points[i], copy)
      let idx = copy.indexOf(c)
      copy.splice(idx,1)
      points[i].x = c.x
      points[i].y = c.y
    //  points[i].x += (c.x - points[i].x)/2
    //  points[i].y += (c.y - points[i].y)/2
      result.push(points[i])
  }
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints(points)
  let dim = Math.sqrt(gpoints.length)
  let v = document.getElementById("textarea").value
  document.getElementById("textarea").value = "map to offset grid\n" + v
  pushFunction("maptoOffsetgrid EQ")
}

function distributePoints (pts) { // a kind of smoothing
  if (!pts)
    pts = points
  copyToClipboard()
  let copy = copyOf(points)
  distributeH(pts)
  distributeV(pts)

  copyOrder(copy, pts)

  let v = document.getElementById("textarea").value
  document.getElementById("textarea").value = "distribute points \n" + v
  pushFunction("distributePoints")
}

function distributeH (pts) {
  let bp = boundingPoints(pts)
  let W = bp[1].x - bp[0].x
  let i = 1, w = W/(pts.length-1)
  // sort pts by x
  pts = pts.sort((a,b)=>a.x-b.x)
  for (; i < pts.length; i++)
    pts[i].x = pts[i-1].x + w
  drawPath()
}

function distributeV (pts) {
  let bp = boundingPoints(pts)
  let H = bp[1].y - bp[0].y
  let i = 1, h = H/(pts.length - 1)
  // sort by y
  pts = pts.sort((a,b)=>a.y-b.y)
  for (; i < pts.length; i++)
    pts[i].y = pts[i-1].y + h
  drawPath()
}

function maptoConcentric () {
  temp = []
  let i = 0
  let x = 0, y = 0, cx = 250, cy = 250
  let N = 24, a = 0
  let r = 0.009*Math.pow(points.length,2) - 1.58*points.length + 100
  let r1 = r*2, r2 = 4*r, r3 = 6*r
  for (; i < N; i++) {
    x = cx + r1 * Math.cos(a)
    y = cy + r1 * Math.sin(a)
    temp.push(new point(x,y))
    x = cx + r2 * Math.cos(a)
    y = cy + r2 * Math.sin(a)
    temp.push(new point(x,y))
    x = cx + r3 * Math.cos(a)
    y = cy + r3 * Math.sin(a)
    if (i % 2 === 0)
      temp.push(new point(x,y))
    a += Math.PI/12
  }
  let result = []
  i = 0
  for (; i < points.length; i++) {
    c = closestpointin(points[i], temp)
    points[i].x = c.x
    points[i].y = c.y
    result.push(points[i])
  }
  points = result
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints(points)
  pushFunction("maptoConcentric")
}

function offsetgrid (n) {
  let n2 = parseInt(document.getElementById("numpoints").value)
  let sr = Math.round(Math.sqrt(n))
  let result = []
  let i = 0
  let space = Math.floor((490/(sr-0.7))*1)
  let x0 = 10
  let y0 = 15
  let a = Math.PI * 1/3 ,wrap = 15+sr*space, L = 0, off = space/2
  let yinc = space * Math.sin(a)
  let x = x0, y = y0
  let add = sr // extra row
  if (n == n2)
    add = 0
  for (; i < parseInt(n+add); i++) {
    if (i > 0 && i % sr === 0) {
      L++
      if (L%2 === 1)
        off = space/2
      else
        off = 0
      x = x0+off
      y += yinc
      if (y > 500)
        break
    }
    let np = new point(x,y)
    np.index = i
   // if (Math.random() < 0.5) ////////////////////////// skip randomly
    result.push(np)
    x += space
  }
  return result
}

function offsetgridPAD (n) {
  let sr = Math.round(Math.sqrt(n))
  let result = []
  let i = 0
  let space = Math.floor((490/(sr-0.7))*1)
  let a = Math.PI * 1/3
  let yinc = space * Math.sin(a)
  let x = 10-space/2, y = 15-yinc, wrap = 15+sr*space, L = 0, off = space/2
  sr += 2
  n = sr*sr+sr
  for (; i < n; i++) {
    if (i > 0 && i % sr === 0) {
      L++
      if (L%2 === 1)
        off = 0
      else
        off = space/2
      x = 10-space+off
      y += yinc
    }
    let np = new point(x,y)
    np.index = i
    result.push(np)
    x += space
  }
  console.log(distance(result[0],result[1])+":"+distance(result[0],result[sr]))
  return result
}

function squaregrid (n) {
  let available = 480
  let space = 500/(n)
  result = []
  let i = 0, p
  let x = 10, y = 10
  for (; i < n*n; i++) {
    if (i > 0 && i % n === 0) {
      x = 10
      y += space
    }
    p = new point(x,y,i,false)
    p.index = i
    result.push(p)
    x += space
  }
  let cg = center(result)
  return result
}

function square () {
  let n = document.getElementById("numpoints").value 
  let sr = Math.round(Math.sqrt(n))
  points = []
  let i = 0
  let space = Math.floor(480/(sr-0.6)*0.90)
  let x = 25, y = 25, wrap = 25+sr*space
  for (; i < n; i++) {
    if (i > 0 && i % sr === 0) {
      x = 25
      y += space
    }
    points.push(new point(x,y))
    x += space
  }
  let cg = center(points)
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints(points)
}

function offset () {
  let n = document.getElementById("numpoints").value 
  let sr = Math.round(Math.sqrt(n))
  points = []
  
  let offsets = offsetgrid(parseInt(n))
  points = offsets
  let i = 0
  let space = Math.floor((490/(sr-0.7))*0.8)
  let a = Math.PI * 1/3
  let yinc = space * Math.sin(a)
  let x = 15, y = 15, wrap = 15+sr*space, L = 0, off = space/2
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height)
  showPoints(points)
}

function pet (v) {
  return (Math.random() -0.5) * v;
}

function testspeed () {
  let i = 0
  let pts = []
  let n = document.getElementById("numpoints").value
  for (; i < 100; i++) {
    pts.push(Math.random() * 500)
  }
  i = 0
  let starttime = new Date()
  for (; i < 1000; i++) 
    l = measurePath(pts,true)
  let endtime = new Date()
  return ((endtime - starttime)/100000) //average
}

const factorial = n => !(n > 1) ? 1 : factorial(n - 1) * n;

function fx (x1,y1,x2,y2,x3) {
  let slope = (y2-y1)/(x2-x1)
  let b = y1 - slope * x1
  return (slope*x3+b)
}

function timeForCalc () {
  let n = document.getElementById("numpoints").value
  let f = factorial(n)
  let r = testspeed()*n
  return Math.round(f*r/100/60)
}

function setNumPoints (n) {
  document.getElementById("numpoints").value = +n
}

// macro stuff below --------------------------------

let RECORDING = false
let LATESTFUNCTION = ""
let functionStack = []

function stackToCode () {
  if (functionStack.length <= 0)
    return
  let buff = "function macro () {\n"
  let i = 0
  for (; i < functionStack.length;i++) {
    if (functionStack[i][0] === "leti") {
      buff += "  let i = 0\n"
      continue;
    }
    if (functionStack[i][0] === "fori") {
      let m = +functionStack[i][1]//document.getElementById("iterations").value
      buff += "  i = 0\n"
      buff += "  for (; i < "+m+";i++)\n"
      continue;
    }
    else
    buff += "  "+functionStack[i][0] +"("
    if (functionStack[i][1]) {
        buff += "'"+functionStack[i][1]+"'"
    }
    buff += ")\n"
  }
  buff += "}"
  message(buff)
  //alert(buff)
}

function pushFunction (f,args) {
  if (!RECORDING)
    return false
  if (functionStack.length === 0)
    functionStack.push(["leti"])
  let it = +document.getElementById("iterations").value
  if (it > 1) {
    functionStack.push(["fori",it])
  }
  functionStack.push([f,args])
}

function togglerecord () {
  if (!RECORDING) {
    record()
  } else {
    stopRecording()
  }
}

function record () {
  document.getElementById("recordsvg").style.fill="#ff0000"
  document.getElementById("playsvg").style.fill="#707070"
  document.getElementById("codesvg").style.fill="#707070"
  clearFunctionStack()
  RECORDING = true
}

function stopRecording () {
  RECORDING = false
  document.getElementById("recordsvg").style.fill="#000000"
  if (functionStack.length > 0) {
    document.getElementById("playsvg").style.fill="#ff0000"
    document.getElementById("codesvg").style.fill="#000000"
  }
}

function playFunctions () {
  let copy = copyOf(points)
  let OIB = document.getElementById("oib").checked
  RECORDING = false
  let VERBOSE = document.getElementById("verbose").checked
  if (functionStack.length < 1)
    return
  let v = document.getElementById("textarea").value
  document.getElementById("recordsvg").style.fill="#000000"
  if (functionStack.length > 0) {
    document.getElementById("playsvg").style.fill="#ff0000"
    document.getElementById("codesvg").style.fill="#000000"
  }
  if (VERBOSE)
    marklog()
  let m1 = measurePath(points,true)
  let t0 = new Date()
  playAllFunctions()
  let tf = new Date()
  let time = round((tf-t0)/1000)
  let l = measurePath(points,true)
  if (OIB && l > m1) { // revert
    points = copy
    drawPath()
    l = m1
  }
  if (VERBOSE) {
    v = document.getElementById("textarea").value
    //console.log(v)
    document.getElementById("textarea").value = "macro ("+time+" s)\n" + v
    marklog()
  } else
    document.getElementById("textarea").value = (l) +" macro ("+time+" s)\n" + v
}

function clearFunctionStack () {
  functionStack = []
}

function playAllFunctions () {
  let i = 0, j = 0, n = 1
  for (; j < functionStack.length; j++) {
    if (functionStack[j][0] === "leti")
      continue
    if (functionStack[j][0] === "fori")
      n = +functionStack[j++][1]
    else 
      n = 1
    i = 0
    for (; i < n; i++) {
      window[functionStack[j][0]](functionStack[j][1])
    }
  }
}
</script>
</body>
