<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
<style>
  div[class=buttons] {margin-top:8px}
  body {background-color:#ccc;}
  button {background-color:#fff;
   border:none;
   border-radius:4px;
   min-width:24px;
   padding:4px 4px 2px 4px;
  }
  select {width:120px;}
  input, img, span, a{
    vertical-align: middle;
  }
  i {
    font-size: 12px;
  }
  input[id='lower'] {
   -webkit-transform: rotateY(180deg);
   -moz-transform: rotateY(180deg);
   -ms-transform: rotateY(180deg);
   -o-transform: rotateY(180deg);
   transform: rotateY(180deg);
  }
  #lower{
    transform: rotateY(180deg);
  }
  span[id='pointsta']
  {
    font-size:1em;
    display:inline-block;
    vertical-align:baseline;
  }
  textarea
  {
    font-size:1em;
    display:inline-block;
    vertical-align:middle;
  }
  input[type='text'] {
    width: 114px;
  }
  input[type='number'] {
    width: 44px;
  }
  span[class='sample'] {
    display:inline-block;
    width:32px;
    text-align:right;
  }
  input[type='color'] {
    display:inline-block;
    vertical-align: baseline;
  }
  canvas[id='palettecanvas'] {
    margin:4px;
  }
  div[id='background'] {
    background-color: #ffffff;
    opacity: 1.0;
    background-image:  repeating-linear-gradient(45deg, #aaaaaa 25%, transparent 25%, transparent 75%, #aaaaaa 75%, #aaaaaa), repeating-linear-gradient(45deg, #aaaaaa 25%, #ffffff 25%, #ffffff 75%, #aaaaaa 75%, #aaaaaa);
    background-position: 0 0, 10px 10px;
    background-size: 20px 20px;
  }
  svg {background-color:#ccc;}
  svg[class=white] { background-color:#fff;}
</style>
</head>
<body>
  
<div style='margin:4px;'>
  &nbsp;&nbsp;<a href="javascript:showtools()" title="show tools"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-sliders" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z"/>
</svg></a>
&nbsp;<input type='file' name='img' size='65' id='uploadimage' style="display:none;">
  <span onclick="openFile()" id="imgloader" title="open image file..."><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-upload" viewBox="0 0 16 16">
    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
    <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
  </svg></span>
&nbsp;
<a href="#" id="downloader" onclick="saveAs()" download="image.png" title="save as png file"
><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-download" viewBox="0 0 16 16">
  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
</svg></a>
&nbsp;
<input type="color" id="paintcolor" style="margin-bottom:6px;">
&nbsp;
<a href="javascript:randomPickColor()" title='random color'>
<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-palette" viewBox="0 0 16 16">
  <path d="M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
  <path d="M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"/>
</svg></a>
&nbsp;
<a href="javascript:fill()" title="fill"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-bucket" viewBox="0 0 16 16">
  <path d="M2.522 5H2a.5.5 0 0 0-.494.574l1.372 9.149A1.5 1.5 0 0 0 4.36 16h7.278a1.5 1.5 0 0 0 1.483-1.277l1.373-9.149A.5.5 0 0 0 14 5h-.522A5.5 5.5 0 0 0 2.522 5zm1.005 0a4.5 4.5 0 0 1 8.945 0H3.527zm9.892 1-1.286 8.574a.5.5 0 0 1-.494.426H4.36a.5.5 0 0 1-.494-.426L2.58 6h10.838z"/>
</svg></a>
&nbsp;
<a href="javascript:doAgain()" id="last" title="repeat last function">
<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
  <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
  <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
</svg></a>
&nbsp;
<a href="javascript:clearOff()" title="clear offscreen">
  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-clipboard-x" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M6.146 7.146a.5.5 0 0 1 .708 0L8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 0 1 0-.708z"/>
  <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
  <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
</svg></a>
&nbsp;
<span onclick="copyToOff()" id="copybutton" title="copy canvas offscreen"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-clipboard" viewBox="0 0 16 16">
  <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
  <path d="M8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5z"/>
  <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
</svg></span>
&nbsp;
 <span onclick="pasteFromOff()" id="pastebutton" title="paste from offscreen"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-clipboard" viewBox="0 0 16 16">
  <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
  <path d="M8 11a.5.5 0 0 0 .5-.5V6.707l1.146 1.147a.5.5 0 0 0 .708-.708l-2-2a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L7.5 6.707V10.5a.5.5 0 0 0 .5.5z"/>
  <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
</svg></span>
&nbsp;
<span onclick="swapWithOff()" id="swapbutton" title="swap with offscreen"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-clipboard" viewBox="0 0 16 16">
  <path
     d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"
     id="path2" />
  <path
     style="stroke-width:1.875"
     d="M 14.988281 9.3730469 A 0.9375 0.9375 0 0 0 14.634766 9.4492188 A 0.9375 0.9375 0 0 0 14.632812 9.4492188 A 0.9375 0.9375 0 0 0 14.34375 9.640625 C 14.336265 9.6477388 14.329505 9.6547598 14.322266 9.6621094 L 10.585938 13.398438 A 0.93868425 0.93868425 0 0 0 11.914062 14.726562 L 14.0625 12.576172 L 14.0625 19.421875 L 11.914062 17.271484 A 0.93868425 0.93868425 0 1 0 10.585938 18.599609 L 14.322266 22.335938 C 14.329505 22.343287 14.336265 22.350308 14.34375 22.357422 A 0.9375 0.9375 0 0 0 15.664062 22.349609 L 19.414062 18.599609 A 0.93868425 0.93868425 0 0 0 18.085938 17.271484 L 15.9375 19.421875 L 15.9375 12.576172 L 18.085938 14.726562 A 0.93868425 0.93868425 0 0 0 19.414062 13.398438 L 15.664062 9.6484375 A 0.9375 0.9375 0 0 0 14.988281 9.3730469 z "
     transform="scale(0.53333333)"
     id="path4" />
  <path
     d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"
     id="path8" /></svg>
</span>
&nbsp;
<a href="javascript:zoom_neg()" title="zoom canvas">
  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-arrows-angle-contract" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M.172 15.828a.5.5 0 0 0 .707 0l4.096-4.096V14.5a.5.5 0 1 0 1 0v-3.975a.5.5 0 0 0-.5-.5H1.5a.5.5 0 0 0 0 1h2.768L.172 15.121a.5.5 0 0 0 0 .707zM15.828.172a.5.5 0 0 0-.707 0l-4.096 4.096V1.5a.5.5 0 1 0-1 0v3.975a.5.5 0 0 0 .5.5H14.5a.5.5 0 0 0 0-1h-2.768L15.828.879a.5.5 0 0 0 0-.707z"/>
  </svg></a>
&nbsp;
<a href="javascript:zoom()" title="zoom canvas">
  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-arrows-angle-expand" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707z"/>
  </svg></a>
&nbsp;
<a href="javascript:flipH()">
  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-arrow-left-right" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"/>
</svg></a>
&nbsp;
<a href="javascript:flipV()">
  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-arrow-down-up" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5zm-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5z"/>
</svg></a>
&nbsp;
<a href="javascript:rc()" title="rotate clockwise">
  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-arrow-clockwise" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
    <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
  </svg></a>
&nbsp;
<a href="javascript:rcc()" title="rotate counter-clockwise">
<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
  <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
</svg></a>
&nbsp;
<a href="javascript:greyScale()" title="convert to greyscale">
<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="grey" class="bi bi-palette-fill" viewBox="0 0 16 16">
  <path d="M12.433 10.07C14.133 10.585 16 11.15 16 8a8 8 0 1 0-8 8c1.996 0 1.826-1.504 1.649-3.08-.124-1.101-.252-2.237.351-2.92.465-.527 1.42-.237 2.433.07zM8 5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm4.5 3a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM5 6.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
</svg></a>
&nbsp;
<a href="javascript:invertColors()" title="invert colors">
<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="30" height="30" fill="black" class="bi bi-square" viewBox="0 0 16 16" version="1.1" id="svg4" sodipodi:docname="spiral.svg" inkscape:version="0.92.4 (5da689c313, 2019-01-14)">
  <metadata   id="metadata10">  <rdf:RDF>    <cc:Work       rdf:about="">      <dc:format>image/svg+xml</dc:format>      <dc:type         rdf:resource="http://purl.org/dc/dcmitype/StillImage" />      <dc:title />    </cc:Work>  </rdf:RDF>
  </metadata>
  <defs   id="defs8" />
  <sodipodi:namedview   pagecolor="#ffffff"   bordercolor="#666666"   borderopacity="1"   objecttolerance="10"   gridtolerance="10"   guidetolerance="10"   inkscape:pageopacity="0"   inkscape:pageshadow="2"   inkscape:window-width="2072"   inkscape:window-height="1160"   id="namedview6"   showgrid="false"   inkscape:zoom="19.666667"   inkscape:cx="1.0038413"   inkscape:cy="12.028218"   inkscape:window-x="30"   inkscape:window-y="20"   inkscape:window-maximized="1"   inkscape:current-layer="svg4" />
  <path   style="fill:#080907;fill-opacity:0.99041533;stroke:#000000;stroke-width:0.35413408;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"   d="M 7.8490935,9.3582994 C 7.9125109,15.175258 8.0046144,15.190446 8.0046144,15.190446 4.6226405,15.292508 2.3125978,12.610557 2.3125978,9.5345523 2.3125978,6.458548 5.0547716,4.9796141 7.771333,0.99629336 7.7355147,6.4754756 7.8136598,6.1079957 7.8490935,9.3582994 Z"   id="path868"   inkscape:connector-curvature="0"   sodipodi:nodetypes="ssscs" />
  <path   sodipodi:nodetypes="ssscs"   inkscape:connector-curvature="0"   id="path871"   d="m 8.1290313,9.3898868 c -0.063417,5.8169592 -0.2799378,5.7847662 -0.2799378,5.7847662 3.3819755,0.102062 5.4431455,-2.564096 5.4431455,-5.6400996 0,-3.0760053 -2.446648,-4.4826064 -5.1632077,-8.465928 0.035818,5.479183 0.035433,5.0709575 0,8.3212614 z"   style="fill:none;fill-opacity:0.99041533;stroke:#000000;stroke-width:0.40277886;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:0.99680511" />
</svg></a>

&nbsp;
<a href="javascript:clearCanvas()" title="clear canvas">
  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="red" class="bi bi-x-circle" viewBox="0 0 16 16">
  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
  <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
</svg></a>
&nbsp;
<a href="info.html" title="info">
<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-info-circle" viewBox="0 0 16 16">
  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
  <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
</svg></a>

&nbsp;
 <a href="javascript:showCanvasSettings()" title="show canvas info">
<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-bug" viewBox="0 0 16 16">
  <path d="M4.355.522a.5.5 0 0 1 .623.333l.291.956A4.979 4.979 0 0 1 8 1c1.007 0 1.946.298 2.731.811l.29-.956a.5.5 0 1 1 .957.29l-.41 1.352A4.985 4.985 0 0 1 13 6h.5a.5.5 0 0 0 .5-.5V5a.5.5 0 0 1 1 0v.5A1.5 1.5 0 0 1 13.5 7H13v1h1.5a.5.5 0 0 1 0 1H13v1h.5a1.5 1.5 0 0 1 1.5 1.5v.5a.5.5 0 1 1-1 0v-.5a.5.5 0 0 0-.5-.5H13a5 5 0 0 1-10 0h-.5a.5.5 0 0 0-.5.5v.5a.5.5 0 1 1-1 0v-.5A1.5 1.5 0 0 1 2.5 10H3V9H1.5a.5.5 0 0 1 0-1H3V7h-.5A1.5 1.5 0 0 1 1 5.5V5a.5.5 0 0 1 1 0v.5a.5.5 0 0 0 .5.5H3c0-1.364.547-2.601 1.432-3.503l-.41-1.352a.5.5 0 0 1 .333-.623zM4 7v4a4 4 0 0 0 3.5 3.97V7H4zm4.5 0v7.97A4 4 0 0 0 12 11V7H8.5zM12 6a3.989 3.989 0 0 0-1.334-2.982A3.983 3.983 0 0 0 8 2a3.983 3.983 0 0 0-2.667 1.018A3.989 3.989 0 0 0 4 6h8z"/>
</svg></a>

&nbsp;
<a href="javascript:exposureInfo()" title="exposure info"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-image" viewBox="0 0 16 16">
  <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
  <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
</svg></a>
 </div>
 <div style="margin-left:8px;display:block;" id="tools">
 <table border="0" cellpadding="4" style="margin-left:6px;">
   <tr><td
style="text-align:right;"><button
onclick="resizeFromDialog()" id="resize" title="cuurent size" >resize</button></td><td>W: <input type="number"
id="canvaswidth" min="40" size="3" onchange="checkWidth()">
     H: <input
type="number" id="canvasheight" min="40" size="3"
onchange="checkHeight()">&nbsp;<span
id="aspectratio" ></span></td><td style="text-align:left;"></td><td>07-25-22
   </td><td>
   &nbsp;<button
id="ff" onclick="testImage('framefunctions')" title="frame functions"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" viewBox="0 0 16 16">
  <path d="M3.5.5A.5.5 0 0 1 4 1v13h13a.5.5 0 0 1 0 1h-2v2a.5.5 0 0 1-1 0v-2H3.5a.5.5 0 0 1-.5-.5V4H1a.5.5 0 0 1 0-1h2V1a.5.5 0 0 1 .5-.5zm2.5 3a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4H6.5a.5.5 0 0 1-.5-.5z"/>
</svg></button>
   <select id="framefunctions">
     <option value="zoomOutImage">zoom out</option>
     <option value="zoomImage">zoom in</option>
     <option value="dropFrame">drop shadow</option>

     <option value="rectFrame">rect frame</option>
     <option value="lineFrame">line frame</option>
     <option value="roundedFrame">rounded frame</option>
     <option value="frameCircle">circle frame</option>
     <option value="framePolaroid">polaroid frame</option>
     <option value="frameInstax">instax frame</option>
     <option value="frame">jaggy frame</option>
     <option value="ripFrame">rip frame</option>
     <option value="makeSquare">pad to square</option>
     <option value="cropSquare">crop to square</option>
     <option value="make4to5">pad to 4:5</option>
     <!--option value="cropInstaxMini">crop to instax</option-->
     <option value="leftCut" style="color:red">left cut</option>
     <option value="halfRip" style="color:red">left rip</option>
     <option value="leftClip" style="color:red">left clip</option>
     <option value="nudgeRight" style="color:red">nudge horizontal</option>
     <option value="nudgeDown" style="color:red">nudge vertcal</option>
     <option value="nudgehalfdown" style="color:red">nudge down right</option>
     <option value="nudgeCW" style="color:red">nudge angle</option>
     <!--option value="makeSquare2">pad bottom to square</option-->
     <option value="expandMarginsAll">expand margins</option>
     <option value="expandMarginsDown">expand bottom</option>
     
   </select>
   </td>
   <td rowspan='6'>
       filter by brightness range<br>
       lower: <input type="range" id="lower" style="width:8em;" min='0' max='100'
value="100" onchange="rangecheck()"> <span class='sample' id='lowsample' style="background-color:#000;">&nbsp;</span> <span id="lowerrange">0</span> %<br>
       upper: <input type="range" id="upper" style="width:8em;" min='0' max='100'
value="100" onchange="rangecheck()"> <span class='sample' id='highsample' style="background-color:#fff;">&nbsp;</span> <span id="upperrange">100</span> %<br>
     <div
style="border-style:solid;margin:1px;border-color:#a0a0a0;padding:2px;">
        <select id="palettechoice" onchange="randomPalette()">
          <option value="ramp">mixed ramp</option>
          <option value="light">light</option>
          <option value="dark">dark</option>
          <option value="mono">mono ramp</option>
          <option value="primary">primary</option>
          <option value="random">random</option>
          <option value="rainbow">rainbow</option>
          <option value="rust">rust</option>
          <option value="mod1">mod1</option>
          <!--option value="stary">stary night</option>
          <option value="scream">the scream</option-->
          <option value="nighthawks">nighthawks</option>
          <!--option value="venus">venus</option>
          <option value="marilyn">marilyn</option>
          <option value="earring">girl with pearl earring</option-->
          
          <option value="avocado">avocado</option>
          <option value="planet">planet</option>
          <option value="cherry">cherry</option>
          <option value="cloud">cloud</option>
          <option value="dark forest">dark forest</option>
          <option value="retro1" selected>retro1</option>
          <option value="retro2">retro2</option>
        </select><br>
       <input type='color' id='pal1'>
       <input type='color' id='pal2'>
       <input type='color' id='pal3'>
       <input type='color' id='pal4'>
       <input type='color' id='pal5'><br>
       <canvas id="palettecanvas" width="240" height="80"></canvas><br>
       <button  onclick="makePalette()">Remix</button>&nbsp;<button id="randompalette" onclick="randomPalette()">Load palette</button>&nbsp;<button onclick="extractPalette()">Extract</button>&nbsp;<a href="extractpalette.html">tool</a><br>
       
</div>
  </td>
</tr>
<tr><td style="text-align:right;">canvas size </td><td>
    <select id="canvassizes" onchange="resizeCanvas()">
      <option value="square">square</option>
      <option value="portrait" >portrait</option>
      <option value="landscape">landscape</option>
      <!--option value="instax">instax mini</option-->
    </select> &nbsp;<span id="redspan" style="color:red;">cut </span><input type="number" step="1" id="rednumber" style="color:red;" onchange="pushMarker()">
    <!--input type="range" id="canvas_size" class="range" min="1" max="5" value="5" onchange="resizeCanvas()"-->
  </td><td style="text-align:right;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-camera" viewBox="0 0 16 16">
    <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>
</svg></td><td><button onclick="sharpenCanvas()">+</button>&nbsp;&nbsp;<button onclick="blurCanvas()">-</button></td><td>
    &nbsp;<button onclick="testImage('transformfunctions')" title="transformations"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"/>
      <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"/>
    </svg></button>
    <select id="transformfunctions">
      <option value="impasto">impasto</option>
      <option value="dotblur" >dot blur</option>
      <option value="dirblur">dir blur</option>
      <option value="jaggyblur">jaggy blur</option>
      <option value="bokehs">bokeh</option>
      <option value="flares">flares</option>
      <option value="haloblur" style="color:red">halo dot</option>
      <option value="halojaggy" style="color:red">halo jaggy</option>
      <option value="mirror">mirror &varr;</option>
      <option value="distortion">fisheye</option>
      <option value="ripinhalf">rip in half</option>
      <option value="duplicate">duplicate</option>
      <option value="afold" selected>fold</option>
      <option value="trifold">tri-fold</option>
      <option value="crumple">crumple</option>
      <option value="fourbyfourplain">4x4</option>
      <option value="fourbyfour">warhol</option>
      <option value="smearside">smear right</option>
      <option value="motionblur">motion blur</option>
      <option value="tiltshift" >tilt-shift</option>
      <option value="reverse">reversible</option>
      <option value="pasta">pasta</option>
      <option value="blasco">blasco</option>
      <option value="shred">shred</option>
      <option value="shred2">shred+splice</option>
      <option value="slices">slices</option>
      <option value="pixelado">pixelado</option>
      <option value="checkerboard">checkerboard</option>
      <option value="diamonds">diamonds</option>
      <option value="dots">dots</option>
      <option value="dashes">dashes</option>
      <option value="holes">holes</option>
      <option value="holes2">holes2</option>
    </select>
  </td>
  
  </tr>
  <tr><td style="text-align:right;">feature size</td><td><input type="range" id="featuresize" min="0" max="500" value="25"></td><td style="text-align:right;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-droplet" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M7.21.8C7.69.295 8 0 8 0c.109.363.234.708.371 1.038.812 1.946 2.073 3.35 3.197 4.6C12.878 7.096 14 8.345 14 10a6 6 0 0 1-12 0C2 6.668 5.58 2.517 7.21.8zm.413 1.021A31.25 31.25 0 0 0 5.794 3.99c-.726.95-1.436 2.008-1.96 3.07C3.304 8.133 3 9.138 3 10a5 5 0 0 0 10 0c0-1.201-.796-2.157-2.181-3.7l-.03-.032C9.75 5.11 8.5 3.72 7.623 1.82z"/>
  <path fill-rule="evenodd" d="M4.553 7.776c.82-1.641 1.717-2.753 2.093-3.13l.708.708c-.29.29-1.128 1.311-1.907 2.87l-.894-.448z"/>
</svg></td><td><button onclick="saturationScale(1.1)">+</button>&nbsp;&nbsp;<button onclick="saturationScale(0.9)">-</button>
  </td><td>
    &nbsp;<button onclick="testImage('patternfunctions')" title="patterns"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" viewBox="0 0 16 16">
  <path d="M0 .5A.5.5 0 0 1 .5 0h15a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H14v2h1.5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H14v2h1.5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H.5a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5H2v-2H.5a.5.5 0 0 1-.5-.5v-3A.5.5 0 0 1 .5 6H2V4H.5a.5.5 0 0 1-.5-.5v-3zM3 4v2h4.5V4H3zm5.5 0v2H13V4H8.5zM3 10v2h4.5v-2H3zm5.5 0v2H13v-2H8.5zM1 1v2h3.5V1H1zm4.5 0v2h5V1h-5zm6 0v2H15V1h-3.5zM1 7v2h3.5V7H1zm4.5 0v2h5V7h-5zm6 0v2H15V7h-3.5zM1 13v2h3.5v-2H1zm4.5 0v2h5v-2h-5zm6 0v2H15v-2h-3.5z"/>
</svg></button>
    <select id="patternfunctions">
    <option value="diss" selected>distress</option>
    <option value="increaseGrain">increase grain</option>
    <option value="increaseGrainPrinty">printy grain</option>
    <option value="specksRadial">specks</option>
    <option value="blobs">blobs</option>
    <option value="fog">fog</option>
    <option value="smudge">smudges</option>
    <option value="smudgewatercolor" >watercolor</option>
    <option value="smudgestreaks">streaks</option>
    <option value="smudgestreaks2">streaks2</option>
    <option value="smudgehorizontal">horizontal</option>
    <option value="smudgehorizontal2">horizontal2</option>
    <option value="smudgearcs">arcs</option>
    <option value="smudgearcs2" >arcs2</option>
    <option value="smudgestars">stars</option>
    <option value="rays">rays</option>
    <option value="chips">chips</option>

    <option value="skinnyLines">horizontal3</option>
    <option value="slantedLines">slanted</option>
    <option value="skinnyRings">rings</option>
    <option value="linearSpiral">spiral</option>
    <option value="waves">waves</option>
    </select>
  </td>
   
  </tr>
  <tr><td style="text-align:right;">quantity</td><td><input type="range" id="number" min="9" max="20000" value="10000">
  </td><td style="text-align:right;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-circle-half" viewBox="0 0 16 16">
  <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
</svg></td><td><button onclick="contrastImage(5)">+</button>&nbsp;&nbsp;<button onclick="contrastImage(-5)">-</button></td>
  <td>
    &nbsp;<button onclick="testImage('fadefunctions')" title="fade, darken, blur, gray"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" viewBox="0 0 16 16">
      <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1z"/>
    </svg></button>
    <select id="fadefunctions">
    <option value="sobel">sobel</option>
    <option value="emboseCanvas">embose</option>
    <option value="edgeDarken" style="color:red">darken edges</option>
    <option value="edgeLighten" style="color:red">lighten edges</option>
    <option value="edgeBlur" style="color:red">blur edges</option>
    <option value="edgeGrey" style="color:red">gray edges</option>
    <option value="fadeCenter" style="color:red">fade center</option>
    <option value="haze">haze</option>
    <option value="transparenter">fade all</option>
    <option value="opaqueer">unfade all</option>
    <option value="fr">fade right</option>
    <option value="fd">fade dowm</option>
    <option value="chaze">edge haze</option>
    <option value="darkenSky">darken sky</option>
    <option value="tintSky">tint sky</option>
    <option value="decolorSky">decolor sky</option>
    <option value="lightleak">light leak</option>
    <option value="retro" selected>retro</option>
    <option value="pop">pop</option>
    <option value="adjustExposure">enhance exposure</option>
    <option value="tint">tint</option>
    <option value="rotateBrightness">shift colors</option>
    <option value="randomizeColors">randomize colors</option>
    </select>
  </td></tr>
  <tr>
    <td style="text-align:right;">opacity</td><td><input type="range" id="opacity" min="1" max="100" value="100" ></td>
    <td style="text-align:right;">&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-brightness-high" viewBox="0 0 16 16">
  <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
</svg>
</td><td>
  <button onclick="adjustBrightness(5)">+</button>&nbsp;&nbsp;<button onclick="adjustBrightness(-5)">-</button>
</td>
<td>
  &nbsp;<button id="cf" onclick="testImage('colorfunctions')" title="color functions"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" viewBox="0 0 16 16">
    <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2h-11z"/>
  </svg></button>
  <select id='colorfunctions'>
      <option value="colorFilterOut" >filter selected</option>
      <option value="colorFilter">filter unselected</option>
      <option value="alphaWhite">filter light</option>
      <option value="alphaBlack">filter dark</option>
      <option value="filterGrays">filter grays</option>
      <!--option value="filterRed">filter red</option>
      <option value="filterGreen">filter green</option>
      <option value="filterBlue">filter blue</option-->
      <option value="highContrast">high contrast</option>
      <option value="threshold">threshold</option>
      <option value="threshold_soft">threshold soft</option>
      <option value="posterize" >posterize</option>
      <option value="palettetint" selected>palette tint</option>
      <option value="colorSample">simplify colors</option>
      <option value="cymk">CYMK</option>
      <option value="stipple">stipple</option>
      <option value="etch">etch</option>
      <option value="hatches">hatches</option>
      <option value="hatchescolor">hatches color</option>
      <option value="sampleImageData">sample dark</option>
      <option value="sampleImageDataColor">sample colors</option>
      <option value="sampleImageDataColor2" >sample colors2</option>
      <option value="pointillism2">pointillism</option>
      <option value="mosaic">mosaic</option>
      <option value="nearest">squares mosaic</option>
      <option value="dotmosaic">dot mosaic</option>
      </select>
</td>
</tr>
<tr><td style="text-align:right;"> &nbsp;&nbsp;alt:<input type="checkbox" id="grungy" title="alternate behaviour"><!--color: <input type="color" id="paintcolor" style="margin-bottom:6px;"-->
</td><td style="text-align:right;">
  mode: <select id="mode">
    <option value="source-over" selected>source-over</option>
    <option value="source-in">source-in</option>
    <option value="source-out">source-out</option>
    <option value="source-atop">source-atop</option>
    <option value="destination-over">destination-over</option>
    <option value="destination-in">destination-in</option>
    <option value="destination-out">destination-out</option>
    <option value="destination-atop">destination-atop</option>
    <option value="difference">difference</option>
    <option value="exclusion">exclusion</option>
    <option value="color-dodge">color-dodge</option>
    <option value="color-burn">color-burn</option>
    <option value="screen">screen</option>
    <option value="overlay">overlay</option>
    <option value="darken">darken</option>
    <option value="lighten">lighten</option>
    <option value="color">color</option>
    <option value="hue">hue</option>
    <option value="saturation">saturation</option>
    <option value="luminosity">luminosity</option>
    <option value="xor">xor</option>
  </select>
 </td><td style="text-align:right;">&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black" class="bi bi-thermometer-high" viewBox="0 0 16 16">
  <path d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V2.5a.5.5 0 0 1 1 0v8.585a1.5 1.5 0 0 1 1 1.415z"/>
  <path d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z"/>
</svg></td>
  <td>
    <button onclick="adjustWarmth(5)">+</button>&nbsp;&nbsp;<button onclick="adjustWarmth(-5)">-</button>
</td><td>
  &nbsp;<button onclick="testImage('drawingfunctions')" title="drawing functions">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" viewBox="0 0 16 16">
      <path d="M15.825.12a.5.5 0 0 1 .132.584c-1.53 3.43-4.743 8.17-7.095 10.64a6.067 6.067 0 0 1-2.373 1.534c-.018.227-.06.538-.16.868-.201.659-.667 1.479-1.708 1.74a8.118 8.118 0 0 1-3.078.132 3.659 3.659 0 0 1-.562-.135 1.382 1.382 0 0 1-.466-.247.714.714 0 0 1-.204-.288.622.622 0 0 1 .004-.443c.095-.245.316-.38.461-.452.394-.197.625-.453.867-.826.095-.144.184-.297.287-.472l.117-.198c.151-.255.326-.54.546-.848.528-.739 1.201-.925 1.746-.896.126.007.243.025.348.048.062-.172.142-.38.238-.608.261-.619.658-1.419 1.187-2.069 2.176-2.67 6.18-6.206 9.117-8.104a.5.5 0 0 1 .596.04zM4.705 11.912a1.23 1.23 0 0 0-.419-.1c-.246-.013-.573.05-.879.479-.197.275-.355.532-.5.777l-.105.177c-.106.181-.213.362-.32.528a3.39 3.39 0 0 1-.76.861c.69.112 1.736.111 2.657-.12.559-.139.843-.569.993-1.06a3.122 3.122 0 0 0 .126-.75l-.793-.792zm1.44.026c.12-.04.277-.1.458-.183a5.068 5.068 0 0 0 1.535-1.1c1.9-1.996 4.412-5.57 6.052-8.631-2.59 1.927-5.566 4.66-7.302 6.792-.442.543-.795 1.243-1.042 1.826-.121.288-.214.54-.275.72v.001l.575.575zm-4.973 3.04.007-.005a.031.031 0 0 1-.007.004zm3.582-3.043.002.001h-.002z"/>
    </svg></button>
  <select id="drawingfunctions" >
    <option value="spiral4">scribble</option>
    <option value="script">script</option>
    <option value="randomTexture" >random texture</option>
    <option value="randomTexture2">random texture2</option>
    <!--option value="testPattern">test pattern</option>
    <option value="landscape2">landscape</option-->
    <option value="landscape3">landscape2</option>
    <option value="numberShow">numbers</option>
    <option value="coloringbook">coloring book</option>
    <option value="edgeSmear">streak left</option>
    <option value="smeardownOff">vertical streaks</option>
    <option value="neckerline">necker</option>
    <option value="necker">necker (fill)</option>
    <option value="house">house (fill)</option>
    <!--option value="quads" >quads</option-->
    <option value="atom" >atom</option>
    <!--option value="venn">venn</option-->
    <option value="network">network</option>
    <option value="core" >core</option>
    <option value="eclipse">eclipse</option>
    <option value="constellations" >constellations</option>
    <option value="seasons">seasons</option>
    <option value="tides">tides</option>
    <option value="phases">phases</option>
    <option value="comets" selected>comets</option>
    <option value="scraps">scraps</option>
    <option value="arch">arch</option>
    <option value="blocksX">blocks</option>
    <option value="pants">pants</option>
    <option value="buns">buns</option>
    <option value="venus">venus</option>
    <option value="user">user</option>
    <option value="glass_line" >glass</option>
    <option value="glass" >glass (fill)</option>
    <option value="labyrinth" >labyrinth</option>
    <!--option value="blobOutline">shape outline</option>
    <option value="bezRandom" >random bez</option-->
    <option value="scratchOut">scratch out</option>
    <option value="strokes">strokes</option>
    <option value="strokes2">strokes2</option>
    <option value="strokesH">strokes horizontal</option>
    <option value="scratch">scratch</option>
    <option value="chair">chair</option>
    <option value="nested">nested sqrs</option>
    <!--option value="birds">birds</option>
    <option value="grid">grid</option>
    <option value="rothko">rothko</option-->
  </select>
</td>
</tr>
</table>
</div>
<div style="margin-left:24px;">
 font: <input type="text" id="fontface" value="SnellRoundhand-Black"> caption: <input type="text" id="caption" value=""> <button onclick='caption()'>caption</button>

&nbsp;<button onclick="testImage('paperfunctions')" title="fade, darken, blur, gray"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="white" viewBox="0 0 16 16">
  <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
</svg></button>
    <select id="paperfunctions">
      <option value="roadmap">road map</option>
      <option value="datedue">date due</option>
      <option value="interdepartmental">interdepartmental</option>
      <option value="moleskine">moleskine</option>
      <option value="moleskine2" >moleskine 3D</option>
      <option value="sketchpad">sketch pad</option>
      <option value="floppyPage">stack of pages</option>
      <option value="gridpaper" >grid paper</option>
      <option value="linedPad">lined pad</option>
      <option value="messagepad">message</option>
      <option value="dividedPad" >divided pad</option>
      <option value="requirements" selected>requirements pad</option>
      <option value="postcard">postcard</option>
      <option value="indexcard">index card</option>
      <option value="thisSpace">this space</option>
      <option value="spiralbound">spiral bound</option>
      <option value="periodictable" >periodic table</option>
      <option value="calendar" >calendar</option>
      <option value="clock" >clock</option>
      <option value="planet" >planet</option>
      <option value="system" >system</option>
      <option value="rings" >rings</option>
      <option value="star">star</option>
      <option value="dayandnight" >day and night</option>
      <option value="photoBook">photo book</option>
    </select>
    
  &nbsp;
  <button onclick='drawShape()'><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" viewBox="0 0 16 16">
  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
</svg></button>
  &nbsp;
   <button onclick='drawShape(1)'><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" viewBox="0 0 16 16">
  <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
</svg></button>
  
  &nbsp;<textarea id="points" rows="1" cols="20" placeholder="points here"></textarea>&nbsp;<button onclick='clearPoints()'>x</button>
  
  &nbsp;<a href="mouse.html"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="black" class="white" style="padding:4px;" viewBox="0 0 18 18">
    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
  </svg></a>
</div>
<canvas id="marker" width='512' height='6' style="border:1px solid #000000;" title="touch canvas: red mark shows location of clip or rip"></canvas>
<div id="background" style="width:1024px;height:1024px;float:left;position:absolute;">
<canvas id="myCanvas" width="512" height="512" style="border:1px solid #000000;">
</canvas><canvas id="OC" width="512" height="512" style="border:1px solid #000000;display:none;"></canvas>
</div>
<div>
</div>
<br>
 <div sytle="display:none;">
   <canvas id="offscreen" width='512' height='512' hidden></canvas>
 </div>
  <div sytle="display:none;">
   <canvas id="off" width='512' height='512' sytle="visibility:hidden;"></canvas>
 </div>
 <br><br>

<script>
let BLACK = 0
let LASTCLICK = [512,512]
let OCISCLEAR = true

window.onload = function () {
  let myCanvas = document.getElementById("myCanvas")
  let ctx = myCanvas.getContext("2d")
  //ctx.imageSmoothingEnabled = false
  //document.getElementById("face").value = "monospace"
  resizeCanvas()
  LASTCLICK[0] = myCanvas.width/2
  LASTCLICK[1] = myCanvas.height/2
  
  myCanvas.addEventListener('click', function(event) {
    var rect = myCanvas.getBoundingClientRect();
    var x = event.clientX - rect.left;
    var y = event.clientY - rect.top;
    LASTCLICK = []
    LASTCLICK.push(x)
    LASTCLICK.push(y)
    syncMarker()
}, false);
let marker = document.getElementById("marker")
marker.addEventListener('click', function(event) {
    let rect = marker.getBoundingClientRect();
    let x = event.clientX - rect.left;
    LASTCLICK[0] = x
    syncMarker()
}, false);

  document.getElementById("mode").addEventListener ('change', function(event) {
    refreshMode()
  }, false);
  
  let result = document.getElementById("background")
  result.style.backgroundColor = "#fff";
  document.getElementById("paintcolor").value = randomColor()
  randomPalette()
  const selectElement = document.getElementById("mode");
  selectElement.addEventListener('change', (event) => {
  let ctx = document.getElementById("myCanvas").getContext("2d");
  ctx.globalCompositeOperation = selectElement.value
  let filePicker = document.getElementById("uploadimage");
  filePicker.addEventListener("click", function(){this.value = null;}, false);
  });
  rangecheck()
  syncMarker()
}

function printcanvas () {
   let canvas = document.getElementById("myCanvas")
   // Get URL beforehand to reduce delay between write and print
  // (probably unnecessary but just being on the safe side)
  let url = canvas.toDataURL();

  // New tab to isolate canvas for printing
  let win = window.open();

  // 'img' element will show url as image
  win.document.write("<img src='" + url + "'/>");

  // Print preview shows empty page... almost as if to be called before write
  //win.print();

  // Magically seems to cause print to be called after write
  win.setTimeout(() => win.print(), 0);
}
  

function adjustBrightnessC (col, amt) {
  if (col[0] == "#") {
      col = col.slice(1);
      usePound = true;
  }
  var R = parseInt(col.substring(0,2),16);
  var G = parseInt(col.substring(2,4),16);
  var B = parseInt(col.substring(4,6),16);
  // to make the colour less bright than the input
  // change the following three "+" symbols to "-"
  R = R + amt;
  G = G + amt;
  B = B + amt;
  if (R > 255) R = 255;
  else if (R < 0) R = 0;
  if (G > 255) G = 255;
  else if (G < 0) G = 0;
  if (B > 255) B = 255;
  else if (B < 0) B = 0;
  var RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
  var GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
  var BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));
  return "#" + RR + GG + BB;
}

function getCurrentPalette () {
  return ([document.getElementById("pal1").value,
    document.getElementById("pal2").value,
    document.getElementById("pal3").value,
    document.getElementById("pal4").value,
    document.getElementById("pal5").value])
}

function restorePalette (p) {
  document.getElementById("pal1").value = p[0]
  document.getElementById("pal2").value = p[1]
  document.getElementById("pal3").value = p[2]
  document.getElementById("pal4").value = p[3]
  document.getElementById("pal5").value = p[4]
}

function randomPalette () {
  let a = [], b = []
  let type = document.getElementById("palettechoice").value
  if (type === "ramp") {
    document.getElementById("pal1").value = randomColorVDark() //darkest
    document.getElementById("pal2").value = randomColorDark()
    document.getElementById("pal3").value = randomColorLight()
    document.getElementById("pal4").value = randomColorLight()
    document.getElementById("pal5").value = randomColorVLight() //lightest
    updateExtraColors(b)
    return
  } else
  if (type === "light") {
    document.getElementById("pal1").value = randomColorLight() //darkest
    document.getElementById("pal2").value = randomColorLight()
    document.getElementById("pal3").value = randomColorLight()
    document.getElementById("pal4").value = randomColorVLight()
    document.getElementById("pal5").value = randomColorVLight() //lightest
    updateExtraColors(b)
    return
  } else
  if (type === "dark") {
    document.getElementById("pal1").value = randomColorVDark() //darkest
    document.getElementById("pal2").value = randomColorVDark()
    document.getElementById("pal3").value = randomColorDark()
    document.getElementById("pal4").value = randomColorDark()
    document.getElementById("pal5").value = randomColorDark() //lightest
    updateExtraColors(b)
    return
  } else
  if (type === "random") {
    document.getElementById("pal1").value = randomColor()
    document.getElementById("pal2").value = randomColor()
    document.getElementById("pal3").value = randomColor()
    document.getElementById("pal4").value = randomColor()
    document.getElementById("pal5").value = randomColor()
    updateExtraColors(b)
    return
  } else
  if (type === "mono") {
    let c = randomColorVDark(), amt = 50
    document.getElementById("pal1").value = c
    document.getElementById("pal2").value = adjustBrightnessC(c, amt)
    document.getElementById("pal3").value = adjustBrightnessC(c, amt*2)
    document.getElementById("pal4").value = adjustBrightnessC(c, amt*3)
    document.getElementById("pal5").value = adjustBrightnessC(c, amt*3)
    updateExtraColors(b)
    return
  } else
  if (type === "rainbow") {
    let rb = [randomColorCool(),randomColorCool(),"#cccccc",randomColorWarm(),randomColorWarm()]
    //if (Math.random() > 0.75)
    //  rb.reverse()
    document.getElementById("pal1").value = rb[0]
    document.getElementById("pal2").value = rb[1]
    document.getElementById("pal3").value = "#cccccc"
    document.getElementById("pal4").value = rb[3]
    document.getElementById("pal5").value = rb[4]
    updateExtraColors(b)
    return
  } else
  if (type === "stary"){
    a = ['#030407', '#191e21', '#968824', '#aab8b3', '#d8d9be']
    b = ['#c5d3cc', '#bbb24f', '#a2afa1', '#8da7cd', '#978c29', '#778886', '#5a77a2', '#495860', '#395195', '#5d5111', '#2b3d6f', '#2a2619', '#171e28']
    updateExtraColors(b)
  } else
  if (type === "rust"){
    a = ['#120402', '#482519', '#837a4e', '#c0ab7c', '#f2efec']
    b = ['#120402', '#482519', '#837a4e', '#c0ab7c', '#f2efec']
    updateExtraColors(b)
  } else
  if (type === "scream"){
    a = ['#08120b', '#30362c', '#5b807f', '#f49f58', '#d9ba81']
    b = ['#f2c28b', '#f2a351', '#c29f69', '#7e9480', '#bd7b45', '#da631c', '#7b684a', '#526c6b', '#bc4e19', '#c83302', '#404335', '#152019', '#020904']
    updateExtraColors(b)
  } else
  if (type === "mod1") {
    a = ["#ffffff", "#7cf4fd", "#f5e8a8", "#292929", "#BC0000"]
    updateExtraColors(b)
  } else
  if (type === "avocado") {
    a = ["#ddd48f", "#cda989", "#6b8c21", "#4a7337", "#704010"]
    updateExtraColors(b)
  } else
  if (type === "planet") {
    a = ["#fdde55", "#6f8348", "#c94549", "#7a4945", "#1b4d3f"]
    updateExtraColors(b)
  } else
  if (type === "cherry") {
    a = ["#fff3d0", "#fa7e1e", "#d62976", "#4d1b7b", "#141d26"]
    updateExtraColors(b)
  } else
  if (type === "cloud") {
    a = ["#e3dec8", "#f2c665", "#99beb7", "#ef7546", "#ca3c4a"]

    updateExtraColors(b)
  } else
  if (type === "dark forest") {
    a = ["#556911", "#6a5c18", "#714b1e", "#296115", "#6e4024"]
    updateExtraColors(b)
  } else
  if (type === "retro1") {
    a = ["#f29b41", "#3d85c6", "#f64668", "#a6473f", "#274e13"]
    updateExtraColors(b)
  } else
  if (type === "retro2") {
    a = ["#f4c432", "#70a396", "#54877a", "#a32545", "#384054"]
    updateExtraColors(b)
  } else
  if (type === "primary") {
    a = ['#ff0000', '#0000ff', '#ffff00', '#008000', '#ffa500']
    updateExtraColors(b)
  } else
  if (type === "nighthawks") {
    a = ["#f9f5a4", "#e76d38", "#33745b", "#762016", "#003e39"]
    b = ['#e7e28e', '#deda7b', '#bbbe74', '#699474', '#888153', '#b57321', '#58856e', '#a05b21', '#2e6f61', '#4f5f4a', '#0c6244', '#4b281a', '#1f2b29']
    updateExtraColors(b)
  } else
  if (type === "venus") {
    a = ['#2b2920', '#4f3a2d', '#889682', '#d6d7c5', '#f5fbf8']
    b = ['#eeead8', '#e9d195', '#efc292', '#b8c3b3', '#dea041', '#b89d72', '#758270', '#99745b', '#a4723a', '#7a5d3b', '#813917', '#353125', '#050402']
    updateExtraColors(b)
  } else
  if (type === "marilyn") {
    a = ['#372e24', '#a62f1f', '#55a294', '#8dc7bf', '#d3cec3']
    b = ['#d3cec3', '#8dc7bf', '#dcb238', '#e68e95', '#b89631', '#55a294', '#9c756f', '#856b37', '#4e6860', '#cd3524', '#a62f1f', '#372e24']
    updateExtraColors(b)
  }else
  if (type === "earring") {
    a = ['#151518', '#232b4b', '#808aaf', '#e6cf94', '#eee6d9']
    b = ['#ebd7b3', '#c5bbbb', '#c3ad87', '#9ea7c8', '#9c907f', '#7a84aa', '#967f55', '#75675a', '#735b34', '#4e5b8e', '#4d433e', '#373031', '#151418']
    updateExtraColors(b)
  }
  document.getElementById("pal1").value = a[0]
  document.getElementById("pal2").value = a[1]
  document.getElementById("pal3").value = a[2]
  document.getElementById("pal4").value = a[3]
  document.getElementById("pal5").value = a[4]
}

function clearPoints () {
  document.getElementById("points").value = ""
}

function rangecheck () {
  let low = +document.getElementById("lower").value
  low = 100 - low
  let high = +document.getElementById("upper").value
  if (high < low) {
    document.getElementById("lower").value = high
    low = high
  }
  let dlow = parseInt(low*2.55)
  let dhigh = parseInt(high*2.55)
  dlow = dlow.toString(16)
  dhigh = dhigh.toString(16)
  let el = document.getElementById('lowsample')
  el.style.backgroundColor = "#"+dlow+dlow+dlow
  el = document.getElementById('highsample')
  el.style.backgroundColor = "#"+dhigh+dhigh+dhigh
  document.getElementById("upperrange").innerHTML = high
  document.getElementById("lowerrange").innerHTML = low
  return [low/100, high/100]
}

function showtools () {
  let d = document.getElementById("tools")
  if (d.style.display == "block")
    d.style.display = "none"
  else
    d.style.display = "block"
}

function showResize() {
  let canvas = document.getElementById("myCanvas");
  let d = document.getElementById("resize")
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  d.showModal()
}

// returns true if every pixel's uint32 representation is 0 (or "blank")
function isCanvasBlank(canvas) {
  const context = canvas.getContext('2d');
  const pixelBuffer = new Uint32Array(
    context.getImageData(0, 0, canvas.width, canvas.height).data.buffer
  );
  return !pixelBuffer.some(color => color !== 0);
}

function getRatio () {
  let canvas = document.getElementById("myCanvas");
  return canvas.width/canvas.height
}

function gcd (a,b) {
  return (b == 0)? a: gcd(b, a%b)
}

function displayRatio () {
  let canvas = document.getElementById("myCanvas");
  let w = canvas.width, h = canvas.height
  let d = gcd(w,h)
  document.getElementById("aspectratio").innerHTML = 1+":"+Math.round(1000*h/w)/1000
  document.getElementById("resize").setAttribute('title', Math.round(100*w/96)/100 + " X " + Math.round(100*h/96)/100 + " inches")
}

function checkWidth () {
  if (isCanvasBlank(document.getElementById("myCanvas")))
    return
  let ratio = getRatio()
  let w = document.getElementById('canvaswidth').value
  let h = document.getElementById('canvasheight').value
  if (isNaN(w) || w == 0)
    return
  // w centric
  if (w/h != ratio)
    h = w / ratio
   document.getElementById('canvasheight').value = Math.floor(h)
}

function checkHeight () {
  if (isCanvasBlank(document.getElementById("myCanvas")))
    return
  let ratio = getRatio()
  let w = document.getElementById('canvaswidth').value
  let h = document.getElementById('canvasheight').value
  if (isNaN(h) || h == 0)
    return
  // w centric
  if (w/h != ratio)
    w = h * ratio
   document.getElementById('canvaswidth').value = Math.floor(w)
}

function resizeFromDialog () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.drawImage(canvas, 0, 0)
  let h = document.getElementById("canvasheight").value
  let w = document.getElementById("canvaswidth").value
  if (h < 40 || w < 40) {
    alert("minimum dimension must 40 or larger")
    document.getElementById("canvasheight").value = canvas.height
    document.getElementById("canvaswidth").value = canvas.width
    return
  }
  canvas.width = w
  canvas.height = h
  syncBackground(canvas)
  ctx.drawImage(ocanvas,0,0,canvas.width,canvas.height)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.globalCompositeOperation = mode
}

function pushMarker() {
  let m = document.getElementById("marker")
  let w = document.getElementById("myCanvas").width
  let value = document.getElementById("rednumber").value
  let s = Math.floor(value)
  if (w <= value)
    value = w/3
  //if (value < 1)
  //  value = 1
  document.getElementById("rednumber").value = value
  LASTCLICK[0] = value
  m.width = w
  ctx = m.getContext("2d")
  ctx.fillStyle = "#ffffff"
  ctx.fillRect(0,0,m.width,m.height)
  let x = s
  m.title = s
  document.getElementById("rednumber").value = +s
  ctx.fillStyle = "#ff0000"
  ctx.beginPath()
  ctx.moveTo(0,0)
  ctx.lineTo(x,0)
  ctx.lineTo(x,6)
  ctx.lineTo(0,6)
  ctx.closePath()
  ctx.fill()
}

function syncMarker () {
  let m = document.getElementById("marker")
  let w = document.getElementById("myCanvas").width
  let s = Math.floor(LASTCLICK[0])
  m.width = w
  ctx = m.getContext("2d")
  ctx.fillStyle = "#ffffff"
  ctx.fillRect(0,0,m.width,m.height)
  let x = s
  m.title = s
  document.getElementById("rednumber").value = +s
  ctx.fillStyle = "#ff0000"
  ctx.beginPath()
  ctx.moveTo(0,0)
  ctx.lineTo(x,0)
  ctx.lineTo(x,6)
  ctx.lineTo(0,6)
  ctx.closePath()
  ctx.fill()
  displayRatio()
}

function showCanvasSettings () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  alert("y: "+LASTCLICK[1] +"\n"+objToString(ctx))
}

function objToString (obj) {
  let str = '';
  for (var p in obj) {
    str += p + '::' + obj[p] + '\n';
  }
  return str;
}

function setDate () {
  let d = document.getElementById("bdate")
  let date = new Date()
  d.innerHTML = date.toString().substring(0,25)
}

function swapDiag () {// number to divide height by, to match width's divisor
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let W = 2 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.globalAlpha = document.getElementById("opacity").value/100

  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = w
  let N = wdivs * hdivs
  let temp = document.createElement('CANVAS')
  let tempctx = temp.getContext("2d")
  temp.width = canvas.width
  temp.height = canvas.height
  tempctx.drawImage(canvas, 0, 0, temp.width, temp.height)
  let grunge = document.getElementById("grungy").checkd

  let sx = 0, sy = 0
  let dx = 0, dy = 0
  tempctx.imageSmoothingEnabled = false
  ctx.imageSmoothingEnabled = false
  for (; i < wdivs; i++) {
    let j = 0
    for (; j < wdivs; j++) {
      sx = i, sy = j
      dx = j, dy = i
      if (grunge)
        tempctx.translate(pt(20), pt(20))
      ctx.drawImage(temp, dx*w, dy*h, w, h, sx*w, sy*h, w, h)
      ctx.drawImage(temp, sx*w, sy*h, w, h, dx*w, dy*h, w, h)
    }
  }
}

function pointN (x, y, id) {
  this.x = x
  this.y = y
  this.neighbors = []
  this.center
  this.min
  this.max
  this.angles = []
  this.id = id
}

function getAngles (pt) {
  let angles = [], i = 0
  //console.log(pt.neighbors.length)
  let c = pt.center
  if (c)
  for (; i < pt.neighbors.length; i++) {
    pt.angles.push(Math.atan2(pt.neighbors[i].y-c.y, pt.neighbors[i].x-c.x))
  }
}

function findCenter (pts) {
  if (!pts || pts.length < 3)
    return []
  let centerx = -1, centery = -1, i = 0
  let minx = 1000000000, maxx = -1, miny = 1000000000, maxy = -1
  for (; i < pts.length; i++) {
    minx = (pts[i].x < minx)? pts[i].x: minx;
    miny = (pts[i].y < miny)? pts[i].y: miny;
    maxx = (pts[i].x > maxx)? pts[i].x: maxx;
    maxy = (pts[i].y > maxy)? pts[i].y: maxy;
  }
  centerx = minx + (maxx - minx)/2
  centery = miny + (maxy - miny)/2
  return ([new point(centerx, centery), new point(minx, miny), new point(maxx, maxy)])
}

function drawPointsN (ptsN) {
  let pts = ptsN.neighbors
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineWidth = 6
  ctx.strokeStyle ="#000000"
  let i = 0
  for (;i < pts.length; i++) {
    if (pts[i].neighbors && pts[i].neighbors.length > 3) {
      ctx.strokeStyle = randomColor()
      ctx.fillStyle = randomGradientRect(canvas, "#000000",  ptsN.min.x,  ptsN.min.y,  ptsN.max.x,  ptsN.max.y)
      ctx.globalAlpha = 0.05
      ctx.save()
    
      ctx.beginPath()
      ctx.moveTo(pts[i].neighbors[0].x, pts[i].neighbors[0].y)
      let j = 1
      for (; j < pts[i].neighbors.length; j++) {
        ctx.lineTo(pts[i].neighbors[j].x, pts[i].neighbors[j].y)
      }
      ctx.closePath()
      ctx.clip()
      ctx.fill()
      ctx.restore()
    }
  }
}

function facets (canvas) {
	let pointsN = []
	let x = 0,y = 0,p = 0
	let len = 40//maxX*maxY
	for (; p < len; p++) {
		pointsN.push( new pointN(Math.floor(Math.random() * 1000), Math.floor(Math.random() * 1000), p))
	}
	let mindistance = 300
	let i = 0
	for (; i < pointsN.length; i++) {
	  let j = 0
	  for (; j < pointsN.length; j++) {
	    if (i !== j) {
	      if (distance(pointsN[i].x, pointsN[i].y, pointsN[j].x, pointsN[j].y) < mindistance) {
	        pointsN[i].neighbors.push(pointsN[j])
	      }
	    }
	  }
	}
	i = 0
//	console.log(pointsN.length)
	for (; i < 2; i++) {
	  let c = findCenter(pointsN[i].neighbors)
	  pointsN[i].center = c[0]
	  pointsN[i].min = c[1]
	  pointsN[i].max = c[2]
	  getAngles(pointsN[i])

	  let N = pointsN[i].neighbors//, A = pointsN[i].angles
	  let A = pointsN[i].angles
	//  console.log(N)

   // a, b indicies of neighbors array
    //N.sort((a, b) => console.log(A[a] - A[b]));

    //  N.sort(function(a, b) {
     //console.log(N.indexOf(a), N.indexOf(b))
      //console.log(A[N.indexOf(a)], A[N.indexOf(b)])
     // console.log(A[N.indexOf(a)] - A[N.indexOf(b)])
    //  return (A[N.indexOf(a)] > A[N.indexOf(b)])? 1 : -1;
    //});
	  //console.log(N)
    pointsN[i].neighbors = N
	//}
  console.log(pointsN[i])
	drawPointsN(pointsN[i])//.slice(0,3))
}
	return
}


function diss () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let val = document.getElementById("opacity").value
  let num = document.getElementById("number").value
  let size = document.getElementById("featuresize").value
  let color = document.getElementById("paintcolor").value
  let mode = ctx.globalCompositeOperation
  functions = ["smudge", "smudge", "smudge", "rays", /*"specksRadial"*/]
  let args = ["", "streaks", "streaks2", "arcs", "arcs2", "stars", "horizontal"]
  document.getElementById("number").value = 3 + Math.random() * 10000
  document.getElementById("featuresize").value = 1 + Math.random() * 400
  document.getElementById("opacity").value = 15 + Math.random() + 45
  let nf = 3 + Math.floor(Math.random() * 5)
  ctx.globalCompositeOperation = "destination-out"
  let i = 0
  for (; i < nf; i++) {
    randomPickColor()
    let f = randomPick(functions)
    let a = ''
    if (f == "smudge")
      a = randomPick(args)
    document.getElementById("number").value = 3 + Math.random() * 10000
    document.getElementById("featuresize").value = 5 + Math.random() * 200
    document.getElementById("opacity").value = 25 + Math.random() + 55
    window[f](a)
  }
  document.getElementById("opacity").value = 5 + Math.random() + 5
  ctx.globalAlpha = document.getElementById("opacity").value/100
  document.getElementById("opacity").value = 5 + Math.random() + 5
  contrastImage(5 + Math.random() *11)
  document.getElementById("opacity").value = val
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.globalCompositeOperation = "destination-over"
  document.getElementById("paintcolor").value = color
  fillA()
  //restore values
  ctx.globalCompositeOperation = mode
  refreshMode()
  document.getElementById("opacity").value = val
  document.getElementById("number").value = num
  document.getElementById("featuresize").value = size
  document.getElementById("paintcolor").value = color
  ctx.globalAlpha = document.getElementById("opacity").value/100
}

function dissOver () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  functions = ["smudge", "smudge", "smudge"]
  let args = ["", "streaks", "streaks2", "arcs", "arcs2", "stars", "horizontal"]
  let nf = 3 + Math.floor(Math.random() * 5)
  let i = 0
  for (; i < nf; i++) {
    let f = randomPick(functions)
    let a = ''
    if (f == "smudge")
      a = randomPick(args)
    window[f](a)
  }
}

function pasteFromOffColor () {
  let OC = document.getElementById('OC')
  if (OC && OC.width > 0) {
    let canvas = document.getElementById('myCanvas')
    let ctx = canvas.getContext('2d')
    ctx.globalCompositeOperation = "source-atop"
    let OCctx = OC.getContext('2d')
    OCctx.globalAlpha = document.getElementById("opacity").value/100
    ctx.globalAlpha = 1
    ctx.drawImage(OC, 0, 0)
    return true
  }
  return true
}

function pasteFromOffColorC () {
  let OC = document.getElementById('OC')
  if (OC && OC.width > 0) {
    let canvas = document.getElementById('myCanvas')
    let ctx = canvas.getContext('2d')
    ctx.globalCompositeOperation = "color"
    document.getElementById("mode").value = "color"
    let OCctx = OC.getContext('2d')
    OCctx.globalAlpha = document.getElementById("opacity").value/100
    ctx.globalAlpha = 1
    ctx.drawImage(OC, 0, 0)
    return true
  }
  return true
}

function coloringbook () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  clearOff()
  let mode = ctx.globalCompositeOperation
  const myPromise = new Promise((copyToOff) => {
    setTimeout(() => {
      copyToOff()
    }, 300);
  });
  
  copyToOff()
  myPromise
    .then(sobel)
    .then(alphaWhite)
    .then(pasteFromOffColor)
    .then(c2)
    .then(pasteFromOffColorC)
  return true
}

function c2 () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = 1.0
  ctx.fillStyle = petColor("#dddddd", 120)
  ctx.globalCompositeOperation = "destination-over"
  ctx.fillRect(0,0,canvas.width,canvas.height)
  return true
}

function landscape () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let val = document.getElementById("opacity").value
  let num = document.getElementById("number").value
  let size = document.getElementById("featuresize").value
  let color = document.getElementById("paintcolor").value
  let mode = ctx.globalCompositeOperation
  functions = ["smudge", "smudge", "smudge", "rays", "blobs", "hrips", "fog", "tatter", "specksRadial"]
  let args = ["", "streaks", "arcs", "stars", "horizontal", "streaks2"]
  document.getElementById("number").value = 3 + Math.random() * 10000
  document.getElementById("featuresize").value = 1 + Math.random() * 400
  document.getElementById("opacity").value = 15 + Math.random() + 45
  if (Math.random() > 0.5) {
    randomPickColor()
    edgeSmear()
    rc()
  }
  let i = 0
  for (; i < 3; i++) {
    randomPickColor()
    ctx.fillStyle = randomColor()
    if (Math.random() > 0.4)
      shape()
    rc()
    document.getElementById("number").value = 3 + Math.random() * 10000
    document.getElementById("featuresize").value = 1 + Math.random() * 400
    document.getElementById("opacity").value = 15 + Math.random() + 75
  }
  if (document.getElementById("grungy").checked) {
    document.getElementById("opacity").value = 15 + Math.random() + 75
    ctx.fillStyle = randomColor()
    drawHouseAt(ctx, canvas.width/2, canvas.height/2+Math.random()*canvas.height/4, canvas.height/7 + Math.random()*canvas.height/5)
    if (Math.random() > 0.5)
      drawHouseAt(ctx, canvas.width/2, canvas.height/2+Math.random()*canvas.height/4, canvas.height/9 + Math.random()*canvas.height/9)
    if (Math.random() > 0.5)
      drawHouseAt(ctx, canvas.width/2-canvas.width/7, canvas.height/2+Math.random()*canvas.height/4, canvas.height/9 + Math.random()*canvas.height/9)
    if (Math.random() > 0.5)
      flipH()
    if (Math.random() > 0.5)
      rc()
  }
  let nf = 1 + Math.floor(Math.random() * 5)
  i = 0
  for (; i < nf; i++) {
    randomPickColor()
    let f = randomPick(functions)
    let a = ''
    if (f == "smudge")
      a = randomPick(args)
    document.getElementById("number").value = 3 + Math.random() * 10000
    document.getElementById("featuresize").value = 5 + Math.random() * 400
    document.getElementById("opacity").value = 15 + Math.random() + 60
    window[f](a)
  }
  
  document.getElementById("opacity").value = 5 + Math.random() + 5
  ctx.globalAlpha = document.getElementById("opacity").value/100
  smeardown()
  rcc()
  if (Math.random() > 0.5) {
    smeardown()
    rcc()
  }
  document.getElementById("opacity").value = 5 + Math.random() + 5
  smear()
  smear()
  rcc()
  contrastImage(5 + Math.random() *11)
  document.getElementById("opacity").value = val
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.globalCompositeOperation = "color"
  document.getElementById("paintcolor").value = color
  fill()
  //restore values
  ctx.globalCompositeOperation = mode
  refreshMode()
  document.getElementById("opacity").value = val
  document.getElementById("number").value = num
  document.getElementById("featuresize").value = size
  document.getElementById("paintcolor").value = color
  ctx.globalAlpha = document.getElementById("opacity").value/100
}

function landscape2 () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let val = document.getElementById("opacity").value
  let num = document.getElementById("number").value
  let size = document.getElementById("featuresize").value
  let color = document.getElementById("paintcolor").value
  let mode = ctx.globalCompositeOperation
  functions = ["smudge", "smudge", "smudge", "rays", "blobs", "birds", "hrips", "fog", "specksRadial"]
  let args = ["", "streaks", "arcs", "stars", "horizontal"]
  document.getElementById("number").value = 3 + Math.random() * 10000
  document.getElementById("featuresize").value = 1 + Math.random() * 400
  document.getElementById("opacity").value = 15 + Math.random() + 45
  if (Math.random() > 0.5) {
    randomPickColor()
    fill()
    rc()
  }
  let i = 0
  for (; i < 2; i++) {
    randomPickColor()
    ctx.fillStyle = randomColor()
    shape2()
    document.getElementById("number").value = 3 + Math.random() * 10000
    document.getElementById("featuresize").value = 1 + Math.random() * 400
    document.getElementById("opacity").value = 15 + Math.random() + 75
  }
  rc()
  
  if (document.getElementById("grungy").checked) {
    document.getElementById("opacity").value = 15 + Math.random() + 75
    ctx.fillStyle = randomColor()
    drawHouseAt(ctx, canvas.width/2 + pet(canvas.width/3), canvas.height/2+Math.random()*canvas.height/4, canvas.height/7 + Math.random()*canvas.height/5)
    if (Math.random() > 0.5)
      drawHouseAt(ctx, canvas.width/2, canvas.height/2+Math.random()*canvas.height/4, canvas.height/9 + Math.random()*canvas.height/9)
    if (Math.random() > 0.5)
      drawHouseAt(ctx, canvas.width/2-canvas.width/7, canvas.height/2+Math.random()*canvas.height/4, canvas.height/9 + Math.random()*canvas.height/9)
  }
  let nf = 2 + Math.floor(Math.random() * 5)
  i = 0
  for (; i < nf; i++) {
    randomPickColor()
    let f = randomPick(functions)
    let a = ''
    if (f == "smudge")
      a = randomPick(args)
    document.getElementById("number").value = 3 + Math.random() * 5000
    document.getElementById("featuresize").value = 5 + Math.random() * 100
    document.getElementById("opacity").value = 15 + Math.random() + 50
    window[f](a)
   // document.getElementById("opacity").value = 5 + Math.random() + 5
  }
  document.getElementById("opacity").value = 5 + Math.random() + 5
  ctx.globalAlpha = document.getElementById("opacity").value/100
  smeardown()
  rcc()
  document.getElementById("opacity").value = 5 + Math.random() + 5
  smear()
  //smear()
  rc()
  contrastImage(5 + Math.random() *11)
  document.getElementById("opacity").value = val
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.globalCompositeOperation = "color"
  document.getElementById("paintcolor").value = color
  fill()
  //restore values
  ctx.globalCompositeOperation = mode
  refreshMode()
  document.getElementById("opacity").value = val
  document.getElementById("number").value = num
  document.getElementById("featuresize").value = size
  document.getElementById("paintcolor").value = color
  ctx.globalAlpha = document.getElementById("opacity").value/100
}

function blobFill (fs) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let val = document.getElementById("opacity").value
  let num = document.getElementById("number").value
  let size = document.getElementById("featuresize").value
  let color = document.getElementById("paintcolor").value
  let mode = ctx.globalCompositeOperation

  document.getElementById("number").value = 2000
  document.getElementById("featuresize").value = 250
  document.getElementById("opacity").value = 100//15 + Math.random() + 75
  randomPickColor()
  document.getElementById("paintcolor").value = fs
  fill()
 
  let i = 0
  for (; i < 2; i++) {
    randomPickColor()
    
    blobs()
  }
  // restore
  document.getElementById("number").value = num
  document.getElementById("featuresize").value = size
  document.getElementById("opacity").value = val
}

function landscape3 () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let val = document.getElementById("opacity").value
  let num = document.getElementById("number").value
  let size = document.getElementById("featuresize").value
  let color = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  let mode = ctx.globalCompositeOperation
  functions = ["smudge", "smudge", "smudge", "rays", "blobs", "hrips", "fog", "specksRadial"]
  let args = ["", "streaks", "arcs", "arcs2", "stars", "horizontal", "horizontal2"]
  document.getElementById("number").value = 3 + Math.random() * 10000
  document.getElementById("featuresize").value = 1 + Math.random() * 400
  document.getElementById("opacity").value = 100//15 + Math.random() + 75
  randomPickColor()
  fill()
  document.getElementById("opacity").value = 15 + Math.random() + 75
  randomPickColor()
  fog()

  let i = 0
  for (; i < 2; i++) {
    document.getElementById("number").value = 3 + Math.random() * 10000
    document.getElementById("featuresize").value = 1 + Math.random() * 400
    document.getElementById("opacity").value = 15 + Math.random() + 65
    randomPickColor()
    ctx.fillStyle = randomColor()
    if (Math.random() > 0.8)
      diagonal()
    else
      land()
  }
  if (grunge) {
    flipV()
    i = 0
    for (; i < 2; i++) {
      randomPickColor()
      ctx.fillStyle = randomColor()
      if (Math.random() > 0.8)
        diagonal()
      else
        land()
      document.getElementById("number").value = 3 + Math.random() * 10000
      document.getElementById("featuresize").value = 1 + Math.random() * 400
      document.getElementById("opacity").value = 15 + Math.random() + 65
    }
  }
 // rc()
  diss()
  let nf = 2 + Math.floor(Math.random() * 5)
  i = 0
  
  for (; i < nf; i++) {
    randomPickColor()
    let f = randomPick(functions)
    let a = ''
    if (f == "smudge")
      a = randomPick(args)
    document.getElementById("number").value = 3 + Math.random() * 5000
    document.getElementById("featuresize").value = 5 + Math.random() * 100
    document.getElementById("opacity").value = 15 + Math.random() + 50
    window[f](a)
   // document.getElementById("opacity").value = 5 + Math.random() + 5
  }
  diss()
  //impasto()
  document.getElementById("opacity").value = 5 + Math.random() + 5
  ctx.globalAlpha = document.getElementById("opacity").value/100
  document.getElementById("opacity").value = 5 + Math.random() + 5
  contrastImage(5 + Math.random() *11)
  document.getElementById("opacity").value = val
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.globalCompositeOperation = "color"
  document.getElementById("paintcolor").value = color
  fill()
  //restore values
  ctx.globalCompositeOperation = mode
  refreshMode()
  document.getElementById("opacity").value = val
  document.getElementById("number").value = num
  document.getElementById("featuresize").value = size
  document.getElementById("paintcolor").value = color
  ctx.globalAlpha = document.getElementById("opacity").value/100
}

function impasto_smudge () {
  let soft = true
  impasto(soft)
}

function impasto (soft) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let val = document.getElementById("opacity").value
  let num = document.getElementById("number").value
  let size = document.getElementById("featuresize").value
  let checked = document.getElementById("grungy").checked
  document.getElementById("grungy").checked = false
  let mode = ctx.globalCompositeOperation
  functions = ["dotblur", "jaggyblur", "dirblur"]
  //document.getElementById("featuresize").value = 280 + pet(30)
  document.getElementById("opacity").value = 50 + pet(10)
  if (soft)
    document.getElementById("opacity").value = 25 + pet(10)
  let f = randomPick(functions)
  window[f](canvas)
  document.getElementById("featuresize").value = 33 + Math.random() * 4
  f = randomPick(functions)
  window[f](canvas)
  f = randomPick(functions)
  window[f](canvas)
  //restore values
  ctx.globalCompositeOperation = mode
  refreshMode()
  document.getElementById("opacity").value = val
  document.getElementById("number").value = num
  document.getElementById("featuresize").value = size
  document.getElementById("grungy").checked = checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
}

function randomTexture () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let val = document.getElementById("opacity").value
  let num = document.getElementById("number").value
  let size = document.getElementById("featuresize").value
  let color = document.getElementById("paintcolor").value
    let alt = document.getElementById("grungy").checked

  functions = ["smudge", "smudge", "smudge", "smudge", "smudge", "blobs", "specksRadial", "strokes2", "strokesH"]
  let args = ["", "streaks", "arcs", "arcs2", "stars", "horizontal"]
  let i = 0
  for (; i < 4; i++) {
    randomPickColor()
    let f = randomPick(functions)
    let a = ''
    if (f == "smudge")
      a = randomPick(args)
    document.getElementById("number").value = 3 + Math.random() * 10000
    document.getElementById("featuresize").value = 1 + Math.random() * 400
    document.getElementById("opacity").value = 15 + Math.random() + 75
    if (alt) {
      ctx.save()
      clipIrregular()
    }
    window[f](a)
    if (alt)
      ctx.restore()
  }
  sobel()
  document.getElementById("opacity").value = 50
  alphaWhite()
  if (Math.random() > 0.6)
    alphaBlack()
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-atop"
  ctx.fillStyle = color
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.globalCompositeOperation = "difference"//"destination-out"
  functions = functions.slice(0, -1)
  functions.push("rays")
  i = 0
  for (; i < 3; i++) {
    randomPickColor()
    let f = randomPick(functions)
    let a = ''
    if (f == "smudge")
      a = randomPick(args)
    document.getElementById("number").value = 3 + Math.random() * 10000
    document.getElementById("featuresize").value = 1 + Math.random() * 400
    document.getElementById("opacity").value = 25 + Math.random() + 70
    if (alt) {
      ctx.save()
      clipIrregular()
    }
    window[f](a)
    if (alt)
      ctx.restore()
  }
  document.getElementById("opacity").value = val
  document.getElementById("number").value = num
  document.getElementById("featuresize").value = size
  document.getElementById("paintcolor").value = color
  ctx.globalCompositeOperation = mode
  refreshMode()
}

function randomTexture2 () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let val = document.getElementById("opacity").value
  let num = document.getElementById("number").value
  let size = document.getElementById("featuresize").value
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let mode = ctx.globalCompositeOperation
  functions = ["smudge", "smudge", "smudge", "smudge", "smudge", "blobs", "rays", "strokes2", "strokesH"]
  let args = ["", "streaks", "arcs", "arcs2", "stars", "horizontal", "watercolor"]
  let i = 0
  ctx.globalAlpha = val/100
  ctx.fillStyle = color
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.globalCompositeOperation = "destination-out"
  for (; i < 6; i++) {
    let f = randomPick(functions)
    let a = ''
    if (f == "smudge")
      a = randomPick(args)
    document.getElementById("number").value = 33 + Math.random() * 10000
    document.getElementById("featuresize").value = 200 + Math.random() * 200
    document.getElementById("opacity").value = 50 + Math.random() + 30
    if (f == "strokes2" || f == "strokesH" || f == "blobs") {
      document.getElementById("opacity").value = 9 + Math.random() + 15
    }
    if (alt) {
      ctx.save()
      clipIrregular()
    }
    window[f](a)
    if (alt)
      ctx.restore()
  }
  document.getElementById("opacity").value = val
  document.getElementById("number").value = num
  document.getElementById("featuresize").value = size
  document.getElementById("paintcolor").value = color
  ctx.globalCompositeOperation = mode
  refreshMode()
}

function draw (canvas, ctx, temp, tempctx) {
  var img = new Image();
  img.onload = function () {
    ctx.drawImage(img, 0, 0);
  };
}

function swap () {// number to divide height by, to match width's divisor
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let W = 2 + Math.floor(document.getElementById("featuresize").value/10)
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = w
  let N = wdivs * hdivs
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let temp = document.createElement('CANVAS')
  let tempctx = temp.getContext("2d")
  temp.width = canvas.width
  temp.height = canvas.height
  let MAX = N/5
  if (MAX > 20)
    MAX = 20
  let src = Math.floor(Math.random() * N)
  let sx = src %W, sy = Math.floor(src/W)
  let dest = Math.floor(Math.random() * N)
  let dx = dest % W, dy = Math.floor(dest/W)
  tempctx.imageSmoothingEnabled = false
  ctx.imageSmoothingEnabled = false
  tempctx.drawImage(canvas, 0, 0, temp.width, temp.height)
  let grunge = document.getElementById("grungy").checkd
  for (; i < MAX; i++) {
    src = Math.floor(Math.random() * N)
    sx = src %W, sy = Math.floor(src/W)
    dest = Math.floor(Math.random() * N)
    dx = dest % W, dy = Math.floor(dest/W)
    if (grunge)
      tempctx.translate(pt(2), pt(2))
    ctx.drawImage(temp, sx*w, sy*h, w, h, dx*w, dy*h, w, h)
    ctx.drawImage(temp, dx*w, dy*h, w, h, sx*w, sy*h, w, h)
    tempctx.drawImage(canvas, 0, 0, temp.width, temp.height)
  }
}

function testHW () {// number to divide height by, to match width's divisor
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let wdivs = 20
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let diff  = (ch - (hdivs*h))
  let i = 0, x = w
  for (; i < wdivs; i++) {
    ctx.beginPath()
    ctx.moveTo(x, 0)
    ctx.lineTo(x,ch)
    ctx.closePath()
    ctx.stroke()
    x += w
  }
  i = 0, y = h
  for (; i < hdivs; i++) {
    ctx.beginPath()
    ctx.moveTo(0, y)
    ctx.lineTo(cw,y)
    ctx.closePath()
    ctx.stroke()
    y += h
  }
  ctx.fillRect(4*w, 4*h, w,h)
  ctx.fillRect(1*w, 4*h, w,h)
  ctx.fillRect(4*w, 1*h, w,h)
  let temp = document.createElement('CANVAS')
  let tempctx = temp.getContext("2d")
  temp.width = w
  temp.height = h
  tempctx.drawImage(canvas, 10*w, 10*h, w, h, 0, 0, temp.width, temp.height)
  ctx.drawImage(canvas, 9*w, 9*h, w, h, 10*w, 10*h, w, h)
  ctx.drawImage(temp, 0, 0, w, h, 9*w, 9*h, w, h)
}

function updateExtraColors (colors) {
  let i = 0, x = 0, y = 0
  let canvas = document.getElementById("palettecanvas")
  let ctx = canvas.getContext("2d");
  ctx.fillStyle = "#a0a0a0"
  ctx.fillRect(0,0,canvas.width, canvas.height)
  for (; i < colors.length; i++) {
    ctx.fillStyle = colors[i]
    ctx.fillRect(x,y,40,40)
    x += 40
    if (i > 0 && i % 6 === 0) {
      y += 40
      x = 0
    }
  }
}

function extractPalette (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  if (isCanvasBlank(canvas))
    return
  let colors = colorSamplePalette(canvas)
  colors.sort((a, b) => bright(b) - bright(a));
  if (colors.length >= 1) {
    let i = 0, x = 0, y = 0
    let canvas = document.getElementById("palettecanvas")
    let ctx = canvas.getContext("2d");
    ctx.globalAlpha = 1.0
    ctx.fillStyle = "#a0a0a0"
    ctx.fillRect(0,0,canvas.width, canvas.height)
    for (; i < colors.length; i++) {
      ctx.fillStyle = colors[i]
      ctx.fillRect(x,y,40,40)
      x += 40
      if (i > 0 && i % 6 === 0) {
        y += 40
        x = 0
      }
    }
    let sorted = []
    sorted.push(colors[colors.length-1])
    sorted.push(colors[colors.length-2])
    sorted.push(colors[Math.round(colors.length/2)-1])
    sorted.push(colors[1])
    sorted.push(colors[0])
    document.getElementById("pal1").value = sorted[0]
    document.getElementById("pal2").value = sorted[1]
    document.getElementById("pal3").value = sorted[2]
    document.getElementById("pal4").value = sorted[3]
    document.getElementById("pal5").value = sorted[4]
  }
  return (colors)
}

function colorSamplePalette (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d");
  let off = document.createElement('CANVAS')
  let offctx = off.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let alt = document.getElementById("grungy").checked
  let mind = 1000000
  let maxd = -1000000
  let pixels = imgData.data;
  let sample = []
  let i = 0, j = 0
  let skip = pixels.length/8000
  skip -= skip%4 // must be multiple of 4
  //skip = 128
  for (; i < pixels.length; i += skip) {
    let n = i
    let c = []
    c.push(pixels[n])
    c.push(pixels[n+1])
    c.push(pixels[n+2])
    if (pixels[n+3] > 0) // don't push transparent pixels
      sample.push(c)
  }
  i = 0, j = 1
  let m = 0
  for (; i < sample.length; i++) {
    j = i + 1
    for (; j < sample.length; j++) {
      m += dist3d(sample[i], sample[j])
      maxd = (maxd < m)? m: maxd
    }
  }
  let threshold = m/sample.length/sample.length * 0.6
  let bins = [], bc = 0
  i = 0
  for (;i < sample.length; i++) {
    if (sample[i]) {
      bins.push([sample[i]])
      let bc = bins.length - 1
      j = i + 1
      for (; j < sample.length; j++) {
        if (sample[j] && dist3d(sample[j], bins[bc][0]) < threshold) {
          bins[bc].push(sample[j])
          sample[j] = null
        }
      }
    }
  }
  bins.sort(function(a, b) { return b.length - a.length;});
  let count = bins.length;
  if (count > 13)
    count = 13
  let colors = [], clrs = []
  i = 0
  for (; i < count; i++) {
    colors.push(averageColor(bins[i]))
    clrs.push(averageColor(bins[i], true))
  }
  //resort clrs by interesting
  clrs.sort(function(a, b) { return interesting(b) - interesting(a);});
  let colors2 = []
  i = 0, j = 0
  for (; i < clrs.length; i++) {
    let rgb = clrs[i]
    let R = ('0'+(rgb[0]).toString(16)).slice(-2),
    G = ('0'+(rgb[1]).toString(16)).slice(-2),
    B = ('0'+(rgb[2]).toString(16)).slice(-2);
    colors2.push('#'+R+G+B)
  }
  return colors2
}

function showColors () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let colors = colorSample()
  let i = 0, x = 10, y = 10
  if (document.getElementById("grungy").checked) {
    ctx.clearRect(10,10,40,canvas.height)
    for (;i < colors.length; i++) {
      ctx.beginPath()
      ctx.moveTo(x, y)
      ctx.lineTo(x+40, y)
      ctx.lineTo(x+40, y+40)
      ctx.lineTo(x, y+40)
      ctx.closePath()
      ctx.fillStyle = colors[i]
      ctx.fill()
      y += 44
    }
  }
}

function exposureInfo () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let mind = 1000000
  let maxd = -1000000
  let minbright = 1, maxbright = 0, b = 0, colorfull = 0, averageb = 0
  let pixels = imgData.data;
  let sample = []
  let i = 0, j = 0
  for (; i < 2000; i++) {
    let n = 4 * Math.floor(Math.random() * pixels.length/4)
    let c = []
    c.push(pixels[n])
    c.push(pixels[n+1])
    c.push(pixels[n+2])
    colorfull += interesting(c)
    b = (pixels[n] + pixels[n+2] + pixels[n+2])/(3*255)
    averageb += b
    maxbright = (b > maxbright)? b: maxbright;
    minbright = (b < minbright)? b: minbright
    sample.push(c)
  }
  i = 0, j = 1, total = 0
  let m = 0, averaged = 0
  for (; i < sample.length; i++) {
    j = i + 1
    for (; j < sample.length; j++) {
      m = dist3d(sample[i], sample[j])
      averaged += m
      maxd = (maxd < m)? m: maxd
      total++
    }
  }
  averageb /= 2000
  averaged /= (total)
  averaged /= 441.6729559300637
  maxd /= 441.6729559300637
  colorfull /= (255*2000)
  alert("Exposure Info\n\nmin brightness: "+Math.round(100*minbright)/100+ ", max brightness: "+Math.round(maxbright*100)/100+"\naverage brightness: "+Math.round(100*averageb)/100+"\nrange: "+Math.round(100*(maxbright-minbright))/100+"\n\nmax tonal distance: "+Math.round(100*maxd)/100 + "\naverage tonal distance: "+Math.round(100*averaged)/100+"\ncolorfullness: "+Math.round(100*colorfull)/100)
}

function colorSample () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  //let alt = document.getElementById("alt").checked
  let mind = 1000000
  let maxd = -1000000
  let pixels = imgData.data;
  let sample = []
  let i = 0, j = 0
  let x = 1, y = 1
  let cnt = (canvas.width * canvas.height)
  for (; i < pixels.length; i+= 128) {
    let n = i//4 * Math.floor(Math.random() * pixels.length/4)
    let c = []
    c.push(pixels[n])
    c.push(pixels[n+1])
    c.push(pixels[n+2])
    sample.push(c)
  }
  i = 0, j = 1
  let m = 0
  for (; i < sample.length; i++) {
    j = i + 1
    for (; j < sample.length; j++) {
      m += dist3d(sample[i], sample[j])
      maxd = (maxd < m)? m: maxd
    }
  }
  let threshold = m/sample.length/sample.length * 0.6
  let bins = [], bc = 0
  i = 0
  for (;i < sample.length; i++) {
    if (sample[i]) {
      bins.push([sample[i]])
      let bc = bins.length - 1
      j = i + 1
      for (; j < sample.length; j++) {
        if (sample[j] && dist3d(sample[j], bins[bc][0]) < threshold) {
          bins[bc].push(sample[j])
          sample[j] = null
        }
      }
    }
  }
  //if (alt)
  //  bins.sort(function(a, b) { return interesting(b[0]) - interesting(a[0]);});
 // else
  bins.sort(function(a, b) { return b.length - a.length;});
  let count = bins.length;
  if (count > 21)
    count = 21
  let colors = [], clrs = []
  i = 0
  for (; i < count; i++) {
    colors.push(averageColor(bins[i]))
    clrs.push(averageColor(bins[i], true))
  }
  //resort clrs by interesting
  clrs.sort(function(a, b) { return interesting(b) - interesting(a);});
  let colors2 = []
  i = 0, j = 0
  for (; i < clrs.length; i++) {
    let rgb = clrs[i]
    let R = ('0'+(rgb[0]).toString(16)).slice(-2),
    G = ('0'+(rgb[1]).toString(16)).slice(-2),
    B = ('0'+(rgb[2]).toString(16)).slice(-2);
    colors2.push('#'+R+G+B)
  }
  return colors2
}

function averageColor (b, dec) {
  let aR = 0, aG = 0, aB = 0
  let i = 0
  for (; i < b.length; i++) {
    aR += b[i][0]
    aG += b[i][1]
    aB += b[i][2]
  }
  
  aR = Math.floor(aR/b.length)
  aG = Math.floor(aG/b.length)
  aB = Math.floor(aB/b.length)
  
  let R = ('0'+(aR).toString(16)).slice(-2),
  G = ('0'+(aG).toString(16)).slice(-2),
  B = ('0'+(aB).toString(16)).slice(-2);
  if (dec)
    return [aR,aG,aB]
  else
    return '#'+R+G+B;
}

function dist3d (p1, p2) {
  let rmean = (p1[0] + p2[0]) / 2;
  let r = p1[0] - p2[0]
  let g = p1[1] - p2[1]
  let b = p1[2] - p2[2]
  return Math.sqrt((((512+rmean)*r*r)>>8) + 4*g*g + (((767-rmean)*b*b)>>8));
}

function dist3dOG (p1, p2) {
  rmean = (p1[0] + p2[0])/2
  return Math.sqrt((2+rmean/256) * Math.pow(p1[0] - p2[0], 2) + 4 * Math.pow(p1[1] - p2[1], 2)  +  (2+(255-rmean)/256) * Math.pow(p1[2] - p2[2], 2))
}

function dist3d__ (p1, p2) {
  return Math.sqrt(Math.pow(p1[0] - p2[0], 2) + Math.pow(p1[1] - p2[1], 2) + Math.pow(p1[2] - p2[2], 2))
}

function interesting (color) {
  let average = (color[0] + color[1] + color[2])/3
  return Math.abs(color[0] - average) + Math.abs(color[1] - average) + Math.abs(color[2] - average)
}

function interestingB (color) {
  let average = (color[0] + color[1] + color[2])/3
//  let colorful = Math.abs(color[0] - average) + Math.abs(color[1] - average) + Math.abs(color[2] - average)
 // if (average > 190)
 //   colorful += 90
  return  average //+ colorful
}

function bright (c) { //-ness
  return (hexToR(c)*0.2126 + hexToG(c)*0.7152 + hexToB(c)*0.0722)
}

async function palettetint (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let grunge = document.getElementById("grungy").checked
  let colors = []
  
  colors.push(document.getElementById("pal1").value)
  colors.push(document.getElementById("pal2").value)
  colors.push(document.getElementById("pal3").value)
  colors.push(document.getElementById("pal4").value)
  colors.push(document.getElementById("pal5").value)
   // console.log(colors)
  let saved = document.getElementById("paintcolor").value
  document.getElementById("lower").value = 100
  document.getElementById("upper").value = 20
  let level = 20
  let i = 0
  for (; i < colors.length; i++) {
    document.getElementById("paintcolor").value = colors[i]
    tint()
    document.getElementById("lower").value -= +level
    document.getElementById("upper").value = level * (i+2)
  }
  document.getElementById("lower").value = 100
  document.getElementById("upper").value = 100
  rangecheck()
  document.getElementById("paintcolor").value = saved
  return true
}

async function posterize (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let threshold = 127 - document.getElementById("opacity").value * 1.27
  let grunge = document.getElementById("grungy").checked
  let t1 = 255 * 1/5
  let t2 = 255 * 2/5
  let t3 = 255 * 3/5
  let t4 = 255 * 4/5

  let colors = []
  colors.push(document.getElementById("pal1").value)
  colors.push(document.getElementById("pal2").value)
  colors.push(document.getElementById("pal3").value)
  colors.push(document.getElementById("pal4").value)
  colors.push(document.getElementById("pal5").value)
  let c = colors[0]
  
  let pixels = imgData.data;
  let i = 0
  for (; i < pixels.length; i += 4) {
    let lightness = pixels[i] * 0.2126 + pixels[i+1] * 0.7152 + pixels[i+2] * 0.0722;
    //let lightness = (pixels[i] + pixels[i+1] + pixels[i+2])/3;
    if (lightness < t1) {
      c = colors[0]
      pixels[i] =   hexToR(c)
      pixels[i+1] = hexToG(c)
      pixels[i+2] = hexToB(c)
    } else
    if (lightness >= t1 && lightness < t2) {
      c = colors[1]
      pixels[i] =   hexToR(c)
      pixels[i+1] = hexToG(c)
      pixels[i+2] = hexToB(c)
    } else
    if (lightness >= t2 && lightness < t3) {
      c = colors[2]
      pixels[i] =   hexToR(c)
      pixels[i+1] = hexToG(c)
      pixels[i+2] = hexToB(c)
    } else
    if (lightness >= t3 && lightness < t4) {
      c = colors[3]
      pixels[i] =   hexToR(c)
      pixels[i+1] = hexToG(c)
      pixels[i+2] = hexToB(c)
    } else
    if (lightness >= t4) {
      c = colors[4]
      pixels[i] =   hexToR(c)
      pixels[i+1] = hexToG(c)
      pixels[i+2] = hexToB(c)
    }
  }
  await ctx.putImageData(imgData, 0, 0);
  return true
}

async function posterize2 (canvas, outctx,x,y,w,h) {
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let threshold = 127 - document.getElementById("opacity").value * 1.27
  let t1 = 255 * 1/4
  let t2 = 255 * 1/2
  let t3 = 255 * 3/4
  let colors = []
  colors.push(document.getElementById("pal1").value)
  colors.push(document.getElementById("pal2").value)
  colors.push(document.getElementById("pal3").value)
  colors.push(document.getElementById("pal4").value)
  let c = colors[0]
  let pixels = imgData.data;
  let i = 0
  for (; i < pixels.length; i += 4) {
    let lightness = pixels[i] * 0.2126 + pixels[i+1] * 0.7152 + pixels[i+2] * 0.0722;
    if (lightness < t1) {
      c = colors[0]
      pixels[i] =   hexToR(c)/2
      pixels[i+1] = hexToG(c)/2
      pixels[i+2] = hexToB(c)/2
    } else
    if (lightness >= t1 && lightness < t2) {
      c = colors[1]
      pixels[i] =   hexToR(c) * 0.8
      pixels[i+1] = hexToG(c) * 0.8
      pixels[i+2] = hexToB(c) * 0.8
    } else
    if (lightness >= t2 && lightness < t3) {
      c = colors[2]
      pixels[i] =   Math.max(hexToR(c), (hexToR(c) * 1.2) % 256)
      pixels[i+1] = Math.max(hexToG(c), (hexToG(c) * 1.2) % 256)
      pixels[i+2] = Math.max(hexToB(c), (hexToB(c) * 1.2) % 256)
    } else
    if (lightness >= t3) {
      c = colors[3]
      pixels[i] =   Math.max(hexToR(c), (hexToR(c) * 2) % 256)
      pixels[i+1] = Math.max(hexToG(c), (hexToG(c) * 2) % 256)
      pixels[i+2] = Math.max(hexToB(c), (hexToB(c) * 2) % 256)
    }
  }
  await outctx.putImageData(imgData,x,y,0,0,w,h);
  return true
}

function leftCut () {
  const cut = true
  leftClip(cut)
  syncMarker()
}

function fourbyfour () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let H = canvas.height, W = canvas.width
  let off = document.createElement('CANVAS')
  off.height = H/2, off.width = W/2
  let offctx = off.getContext("2d")
  offctx.drawImage(canvas,0,0,W/2,H/2)
  //offctx.globalCompositeOperation = "overlay"
  let color = document.getElementById("paintcolor").value
  let warhol = document.getElementById("grungy").checked
  document.getElementById("paintcolor").value = randomColor()
  let D = (Math.floor(33+Math.random() * 255) % 256)
  let colors = []
  colors.push(randomColor())
  colors.push(randomColor())
  colors.push(randomColor())
  posterize2(off,ctx,0,0,W/2,H/2)
  .then(
    posterize2(off,ctx,W/2,0,W/2,H/2))
  .then(
    posterize2(off,ctx,0,H/2,W/2,H/2))
  .then(
    posterize2(off,ctx,W/2,H/2,W/2,H/2)
    )
  document.getElementById("paintcolor").value = color
  return true
}

function fourbyfourplain () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let H = canvas.height, W = canvas.width
  let off = document.createElement('CANVAS')
  off.height = H/2, off.width = W/2
  let offctx = off.getContext("2d")
  offctx.drawImage(canvas,0,0,W/2,H/2)
  //offctx.globalCompositeOperation = "overlay"
  let color = document.getElementById("paintcolor").value
  let warhol = document.getElementById("grungy").checked
  document.getElementById("paintcolor").value = randomColor()
  let D = (Math.floor(33+Math.random() * 255) % 256)
  let colors = []
  colors.push(randomColor())
  colors.push(randomColor())
  colors.push(randomColor())
  drawSome(ctx,off,0,0,W/2,H/2)
  .then(
    drawSome(ctx,off,W/2,0,W/2,H/2))
  .then(
    drawSome(ctx,off,0,H/2,W/2,H/2))
  .then(
    drawSome(ctx,off,W/2,H/2,W/2,H/2)
    )
  document.getElementById("paintcolor").value = color
  return true
}

async function drawSome (ctx,can,x,y,W,H) {
  await ctx.drawImage(can,x,y,W,H)
  return true
}

function shrinkBlur () {
  zoom_neg()
  zoom_neg()
  zoom_neg()
  zoom()
  zoom()
  zoom()
}

function distortion () {
  let canvas = document.getElementById("myCanvas")
  let alt = document.getElementById("grungy").checkd
  let ctx = canvas.getContext("2d")
  let cx = LASTCLICK[0]// canvas.width/2,
      cy = LASTCLICK[1]//canvas.height/2,
      sizew = canvas.width,
      sizeh = canvas.height
  let imgData = ctx.getImageData(0, 0, sizew, sizeh);
      pixels = imgData.data,
      pixelsCopy = [], index = 0, h = sizeh, w = sizew;
  let i = 0
  for (; i <= pixels.length; i+=4) {
    pixelsCopy[index] = [pixels[i], pixels[i+1], pixels[i+2], pixels[i+3]];
    index++;
  }
  let result = fisheye(pixelsCopy, w, h);
  i = 0
  for(; i < result.length; i++) {
    index = 4*i;
    if (result[i] != undefined) {
      pixels[index + 0] = result[i][0];
      pixels[index + 1] = result[i][1];
      pixels[index + 2] = result[i][2];
      pixels[index + 3] = result[i][3];
    }
  }
  if (alt) {
    ctx.fillStyle = document.getElementById("paintcolor").value
    ctx.fillRect(0,0,sizew, sizeh)
  }
  ctx.putImageData(imgData, 0, 0);
}

function fisheye (srcpixels, w, h) {
  let dstpixels = srcpixels.slice();
  let y = 0
  for (; y < h; y++) {
    let ny = ((2*y)/h)-1;
    let ny2 = ny*ny;
    let x = 0
    for (; x < w; x++) {
      let nx = ((2*x)/w)-1;
      let nx2 = nx*nx;
      let r = Math.sqrt(nx2+ny2);
      if (0.0 <= r && r <= 1.0) {
        let nr = Math.sqrt(1.0-r*r);
        nr = (r + (1.0-nr)) / 2.0;
        if (nr <= 1.0) {
          let theta = Math.atan2(ny,nx);
          let nxn = nr*Math.cos(theta);
          let nyn = nr*Math.sin(theta);
          let x2 = parseInt(((nxn+1)*w)/2);
          let y2 = parseInt(((nyn+1)*h)/2);
          let srcpos = parseInt(y2*w+x2);
          if (srcpos >= 0 & srcpos < w*h) {
            dstpixels[parseInt(y*w+x)] = srcpixels[srcpos];
          }
        }
      }
    }
  }
  return dstpixels;
}

function mirror () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  clearOff()
  flipV()
  copyToOff()
  flipV()
  bottomClip()
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "destination-over"
  pasteFromOff()
  ctx.globalCompositeOperation = mode
}

function bottomClip () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let H = canvas.height, W = canvas.width
  let s = LASTCLICK[1] // Y
  let x = 0, y = s
  ctx.save()
  ctx.beginPath()
  ctx.moveTo(x,y)
  ctx.lineTo(W, y)
  ctx.lineTo(W, H)
  ctx.lineTo(0, H)
  ctx.closePath()
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
}

function leftClip (cut) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  let H = canvas.height, W = canvas.width
  let grunge = document.getElementById("grungy").checked
  let s = LASTCLICK[0]
  if (W-s < 30 && cut) {
    alert("Cannot cut canvas width to less than 30px.")
    return
  }
  let x = 0, y = 0
  ctx.save()
  ctx.beginPath()
  ctx.moveTo(x,y)
  x = s
  ctx.lineTo(x, y)
  y += H+1
  ctx.lineTo(x, y)
  ctx.lineTo(0, y)
  ctx.closePath()
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  ctx.globalAlpha = 1
  let off = document.createElement('CANVAS')
  off.height = canvas.height
  off.width = canvas.width - x
  offctx = off.getContext("2d")
  offctx.drawImage(canvas, -x, 0)
  ctx.clearRect(0,0,W,H)
  if (cut)
    canvas.width -= x
  syncBackground(canvas)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  if (cut)
    ctx.drawImage(off, 0, 0)
  else
    ctx.drawImage(off, x, 0)
  ctx.globalCompositeOperation = mode

}

function halfCurve () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let H = canvas.height, W = canvas.width
  let grunge = document.getElementById("grungy").checked
  let s = document.getElementById("featuresize").value/500
  let half = W*s
  let lx = LASTCLICK[0]
  let offset = 2 + W/(5 + Math.random() * 10)
  let x = 0, y = 0
  if (Math.random() > 0.5)
    offset *= -1
  ctx.save()
  ctx.beginPath()
  ctx.moveTo(x,y)
  x = lx
  ctx.lineTo(x,y)
  ctx.bezierCurveTo(x-offset, H/2, x+offset, H/2, x, H);
  ctx.lineTo(0,H)
  ctx.closePath()
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
}

function halfRip () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let H = canvas.height, W = canvas.width
  let grunge = document.getElementById("grungy").checked
  let s = document.getElementById("featuresize").value/500
  let half = W*s
  let lx = LASTCLICK[0]
  const offset = 2 + W/100
  let x = 0, y = 0
  x = 0, y = 0
  ctx.save()
  ctx.beginPath()
  ctx.moveTo(x,y)
  x = lx//half-offset
  ctx.lineTo(x, y)
  while (y < H) {
    x += pet(9)
    y += 4 + pet(4)
    ctx.lineTo(x, y)
    if (Math.random() > 0.95)
      y += 9
  }
  ctx.lineTo(0, y)
  ctx.closePath()
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
}

function ripFrame () {
  let i = 0
  for (; i < 4;i++) {
    ripSide()
    rc()
  }
}

function ripSide () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let H = canvas.height, W = canvas.width
  let grunge = document.getElementById("grungy").checked
  const offset = 5 + Math.floor(document.getElementById("featuresize").value/2)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let x = 0, y = 0
  ctx.save()
  ctx.beginPath()
  ctx.moveTo(x,y)
  x = offset
  ctx.lineTo(x, y)
  while (y < H) {
    x += pet(4)
    y += 4 + pet(4)
    ctx.lineTo(x, y)
    if (Math.random() > 0.95)
      y += 9
  }
  ctx.lineTo(0, y)
  ctx.closePath()
  ctx.clip()
  ctx.fillStyle = document.getElementById("paintcolor").value
  if (grunge)
    ctx.clearRect(0,0,W,H)
  else
    ctx.fill()
  ctx.restore()
}

function bokehs () {
  findBrightSpots(false)
}

function flares () {
  findBrightSpots(true)
}

function findBrightSpots (FLARE) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.drawImage(canvas,0,0)
  offctx.fillStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  let cw = canvas.width
  let ch = canvas.height
  // hard coded h w
 // let h = ch/400
  let w = cw/400
  let percent = +document.getElementById("number").value/20000
  let i = 0, x = 0, y = 0
  let numsquares = (ch*cw)/100
  //console.log(numsquares,h,w)
  let radius = w, j = 0, linecount = 0
  let lightness = 0
  let points = []
  let colors = []
  let offsets = []
  let RADIUS = 1 + Math.floor(document.getElementById("featuresize").value)//radius*10
  for (; i < 6; i++)
    offsets.push((Math.random() - 0.5) * (1 + Math.random()*3))
  for (;j < numsquares; j++) {
    x = Math.floor(Math.random()*cw)
    y = Math.floor(Math.random()*ch)
    let imgData = ctx.getImageData(x, y, w, w) // keep square: w === w
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    i = 0, lightness = 0
    let r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
      lightness += parseInt((pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3)
    }
    lightness /= (pixels.length/4) //avg = 0 to 255
    if (lightness > 200) {
      r /= pixels.length/4
      g /= pixels.length/4
      b /= pixels.length/4
      let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
          G = ('0'+(Math.round(g)).toString(16)).slice(-2),
          B = ('0'+(Math.round(b)).toString(16)).slice(-2);
      points.push([x+w,y+w,"#"+R+G+B,RADIUS+pet(RADIUS/2)])
    }
  }
  // filter points that are too close togeteher
  points = shuffle(points)
  let filteredpoints = []
  let maxpoints = points.length * percent
  i = 0
  for (; i < maxpoints; i++) {
    if (i == 0 || distance(points[i-1][0], points[i-1][1], points[i][0], points[i][1] ) > 90)
      filteredpoints.push(points[i])
  }
  i = 0
  for (; i < filteredpoints.length; i++) {
    if (FLARE)
      flareAt(filteredpoints[i][0],filteredpoints[i][1],filteredpoints[i][3],filteredpoints[i][2],ctx.globalAlpha/5,offctx, offsets)
    else
      bokehAt(filteredpoints[i][0], filteredpoints[i][1], filteredpoints[i][3], filteredpoints[i][2], ctx.globalAlpha/10, offctx)
  }
  ctx.drawImage(off, 0, 0)
}

function sampleImageData () { // darkness
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  // set above as in rectify
  let W = 0.5 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 0.5
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w, j = 0, linecount = 0
  let lightness = 0
  // outer loop
  for (;j < numsquares; j++) {
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, lightness = 0
    for (; i < pixels.length; i += 4) {
      lightness += parseInt((pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3)
    }
    lightness /= (pixels.length/4) //avg = 0 to 255
    // invert scale
    lightness = 255 - lightness
    radius = lightness/255 * w/2
    offctx.beginPath()
    offctx.arc(x+w/2, y+h/2, radius, 0, Math.PI*2)
    offctx.closePath()
    offctx.fill()
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (!grunge && linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h
    }
  }
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}

function coloretch () {
  etch(true)
}

function etch (color) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.strokeStyle = document.getElementById("paintcolor").value
  offctx.lineCap = "round"
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let grunge = document.getElementById("grungy").checked
  // set above as in rectify
  let W = 0.5 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 0.5
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, j = 0, x = 0, y = 0, ct = 1+ Math.floor(Math.random() * 5)
  let angle = Math.PI * 2 * Math.random()
  let d = h/ct
  
  let numsquares = (1+wdivs) * (1+hdivs) * 1.2
  let radius = w/6, linecount = 0
  let r0 = radius
  let D = 0//radius * 6
  let lightness = 0
  
  let points = []
  for (;j < numsquares; j++) {
    points[j] = [x, y]
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (linecount % 2 == 1)
        x = 0
      y += h/2
    }
  }
  points = shuffle(points)
  let D8 = D/8
  j = 0
  let h2 = 0, w2 = w
 /* if (Math.random() > 0.5)
    w2 = 0
  else
    h2 = 0*/
  for (;j < points.length; j++) {
    x = points[j][0]
    y = points[j][1]
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, lightness = 0, r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
      lightness += parseInt((pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3)
    }
    if (color) {
      r /= pixels.length/4
      g /= pixels.length/4
      b /= pixels.length/4
      let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
        G = ('0'+(Math.round(g)).toString(16)).slice(-2),
        B = ('0'+(Math.round(b)).toString(16)).slice(-2);
      offctx.strokeStyle = "#"+R+G+B
    }
    lightness /= (pixels.length/4) //avg = 0 to 255
    // invert scale
    lightness = 255 - lightness
    radius = lightness/255 * h
    if(color)
      radius = h
    if (radius > 0) {
      offctx.lineWidth = radius
      offctx.beginPath()
      offctx.moveTo(x,y)
      offctx.lineTo(x+w2, y+h2)
      offctx.stroke()
    }
  }
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}

function hatchescolor() {
  hatches(true)
}

function hatches (color) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.strokeStyle = document.getElementById("paintcolor").value
  //offctx.lineCap = "round"
  
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let grunge = document.getElementById("grungy").checked
  // set above as in rectify
  let W = 0.5 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 0.5
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, j = 0, x = 0, y = 0, ct = 1+ Math.floor(Math.random() * 5)
  let angle = Math.PI * 2 * Math.random()
  let d = h/ct
  
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w/6, linecount = 0
  let r0 = radius
  let D = radius * 6
  let lightness = 0
  
  let points = []
  for (;j < numsquares; j++) {
    points[j] = [x, y]
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h
    }
  }
  if (grunge) {
    x = 0, y = 0
    j = 0, linecount = 0
    for (;j < numsquares; j++) {
      points.push([x, y])
      x += w
      if (x >= (wdivs)*w) {
        linecount++
        if (linecount % 2 == 1)
          x = -w/2
        else
          x = 0
        y += h
      }
    }
  }
  points = shuffle(points)
  let D8 = D/8
  j = 0
  let h2 = h
  let xf = 0, yf = 0
  if (Math.random() > 0.95)
        h2 *= -1
  for (;j < points.length; j++) {
    x = points[j][0]
    y = points[j][1]
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, lightness = 0, r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
      lightness += parseInt((pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3)
    }
    if (color) {
      r /= pixels.length/4
      g /= pixels.length/4
      b /= pixels.length/4
      let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
        G = ('0'+(Math.round(g)).toString(16)).slice(-2),
        B = ('0'+(Math.round(b)).toString(16)).slice(-2);
      offctx.strokeStyle = "#"+R+G+B
    }
    lightness /= (pixels.length/4) //avg = 0 to 255
    // invert scale
    lightness = 255 - lightness
    radius = lightness/255 * w/2
    if (color)
      radius = w/2
    if (radius > 0) {
      if (j % 2 == 0)
        h2 *= -1
      offctx.lineWidth = radius
      offctx.beginPath()
      offctx.moveTo(x,y+pet(D))
      xf = x+h2
      yf = y-h+pet(D)
     // offctx.bezierCurveTo(x+pet(D), y+pet(D), xf+pet(D), yf+pet(D), xf, yf)
      //offctx.quadraticCurveTo(x+pet(D/2), y+pet(D/2), xf, yf)
      offctx.lineTo(x+h2, y-h+pet(D))
      offctx.stroke()
    }
  }
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}

function stipple () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = document.getElementById("paintcolor").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let grunge = document.getElementById("grungy").checked
  // set above as in rectify
  let W = 0.5 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 0.5
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w/6, linecount = 0
  let r0 = radius
  let D = radius * 6
  let lightness = 0
  
  let points = [], j = 0
  for (;j < numsquares; j++) {
    points[j] = [x, y]
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h
    }
  }
  if (grunge) {
    x = 0, y = 0
    j = 0, linecount = 0
    for (;j < numsquares; j++) {
      points.push([x, y])
      x += w
      if (x >= (wdivs)*w) {
        linecount++
        if (linecount % 2 == 1)
          x = -w/2
        else
          x = 0
        y += h
      }
    }
  }
  points = shuffle(points)
  let D8 = D/8
  j = 0
  for (;j < points.length; j++) {
    x = points[j][0]
    y = points[j][1]
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, lightness = 0
    for (; i < pixels.length; i += 4) {
      lightness += parseInt((pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3)
    }
    lightness /= (pixels.length/4) //avg = 0 to 255
    // invert scale
    lightness = 255 - lightness
    radius = lightness/255 * w/2
    if (radius > 0) {
      offctx.beginPath()
      offctx.arc(x+w/2+pet(D), y+h/2+pet(D), radius+Math.random()*D8, 0, Math.PI*2)
      offctx.closePath()
      offctx.fill()
    }
  }
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}

function mosaic () { // 4 sided
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  // set above as in rectify
  let W = 2 + Math.floor(document.getElementById("featuresize").value/4)
  //invert range of W [2 - W] => [W - 2]
  W = 128 - W + 2
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w*0.475, j = 0
  let linecount = 0
  let r = 0, g = 0, b = 0
  let D = radius * 1
  let r0 = radius
  let points = []
  for (;j < numsquares; j++) {
    points[j] = [x, y]
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h
    }
  }
  points = shuffle(points)
  let angle = Math.random() * 2 * Math.PI
  j = 0
  for (;j < points.length; j++) {
    x = points[j][0]
    y = points[j][1]
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
    }
    r /= pixels.length/4
    g /= pixels.length/4
    b /= pixels.length/4
    let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
      G = ('0'+(Math.round(g)).toString(16)).slice(-2),
      B = ('0'+(Math.round(b)).toString(16)).slice(-2);
    offctx.fillStyle = "#"+R+G+B
    offctx.beginPath()
    let k = 0
    let x1 = x+w/2+pet(D)
    let y1 = y+h/2+pet(D)
    let sides = 4 + Math.floor(Math.random() * 2) // 4 or 5
    let inc = Math.PI/(sides/2)
    
    radius = r0 + Math.random()*D/2
    angle = Math.random() * 2 * Math.PI
    for (; k < sides; k++) {
      x = x1 + radius * Math.cos(angle);
      y = y1 + radius * Math.sin(angle);
      offctx.lineTo(x, y)
      angle += inc
    }
    offctx.closePath()
    offctx.fill()
  }
  //if (grunge)
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}


function pointillism2 () { // five sided
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  // set above as in rectify
  let W = 2 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 2
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w/4, j = 0
  let linecount = 0
  let r = 0, g = 0, b = 0
  let D = radius * 5
  let r0 = radius
  // outer loop
  let points = []
  for (;j < numsquares; j++) {
    points[j] = [x, y]
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      x = 0
      y += h
    }
  }
  points = shuffle(points)
  let inc = Math.PI/2.5
  let angle = Math.random() * 2 * Math.PI
  j = 0
  for (;j < points.length; j++) {
    x = points[j][0]
    y = points[j][1]
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
    }
    r /= pixels.length/4
    g /= pixels.length/4
    b /= pixels.length/4
    let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
      G = ('0'+(Math.round(g)).toString(16)).slice(-2),
      B = ('0'+(Math.round(b)).toString(16)).slice(-2);
    offctx.fillStyle = "#"+R+G+B
    //radius = w/2
    offctx.beginPath()
    
    let k = 0
    let x1 = x+w/2+pet(D)
    let y1 = y+h/2+pet(D)
    radius = r0 + Math.random()*D
    angle = Math.random() * 2 * Math.PI
    //offctx.moveTo (x1, y1)
    for (; k < 5; k++) {
      x = x1 + radius * Math.cos(angle);
      y = y1 + radius * Math.sin(angle);
      offctx.lineTo(x, y)
      //offctx.arc(x1, y1, radius+Math.random()*D/2, angle, inc)
      angle += inc
    }
    //offctx.arc(x+w/2+pet(D), y+h/2+pet(D), radius+Math.random()*D/2, 0, Math.PI*2)
    offctx.closePath()
    offctx.fill()
  }
  if (grunge)
    ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}

function pointillism () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  // set above as in rectify
  let W = 2 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 2
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w/4, j = 0
  let lightness = 0, linecount = 0
  let r = 0, g = 0, b = 0
  let D = radius * 5
  // outer loop
  let points = []
  for (;j < numsquares; j++) {
    points[j] = [x, y]
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      x = 0
      y += h
    }
  }
  points = shuffle(points)
  j = 0
  for (;j < points.length; j++) {
    x = points[j][0]
    y = points[j][1]
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
    }
    r /= pixels.length/4
    g /= pixels.length/4
    b /= pixels.length/4
    let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
      G = ('0'+(Math.round(g)).toString(16)).slice(-2),
      B = ('0'+(Math.round(b)).toString(16)).slice(-2);
    offctx.fillStyle = "#"+R+G+B
    //radius = w/2
    offctx.beginPath()
    offctx.arc(x+w/2+pet(D), y+h/2+pet(D), radius+Math.random()*D/2, 0, Math.PI*2)
    offctx.closePath()
    offctx.fill()
  }
  if (grunge)
    ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}

function dotmosaic () {
  let off = document.createElement('CANVAS')
  let offctx = off.getContext('2d')
  let canvas = document.getElementById('myCanvas')
  off.width = canvas.width
  off.height = canvas.height
  let ctx = canvas.getContext('2d'),
      cw = canvas.width,
      ch = canvas.height
      
  let W = 2 + Math.floor(document.getElementById("featuresize").value/25)
  //invert range of W [2 - W] => [W - 2]
  W = 50 - W + 2
  let wdivs = W
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let dotCount = (1+wdivs) * (1+hdivs)
  let dotRadius = w/2
  let halfRadius = dotRadius/2
  let twoPi = Math.PI * 2,
      dotColor = '#0AA594',
      samples = 33, // candidate dots attempted, higher is better
      placedDots = [], // a dot is represented as [x, y]
      initialize = function () {
        let dotsDrawn = 0,
        interval = setInterval(function () {
            placeNewDot();
            dotsDrawn++;
            if (dotsDrawn === dotCount) {
              clearInterval(interval);
              ctx.clearRect(0,0,canvas.width,canvas.height)
              ctx.drawImage(off,0,0)
            }
        }, 0);
      },

      generateRandomPosition = function () {
        return [
        Math.round(Math.random() * cw),
        Math.round(Math.random() * ch),
        1];
      },

      getDistanceToNearestDot = function (dot) {
        let shortest;
        for (let i = placedDots.length - 1; i >= 0; i--) {
          let distance = getDistance(placedDots[i], dot);
          if (!shortest || distance < shortest)
            shortest = distance;
        }
        return shortest;
      },

      getDistance = function (dot1, dot2) {
        let xDistance = Math.abs(dot1[0] - dot2[0]),
            yDistance = Math.abs(dot1[1] - dot2[1]),
            distance = Math.sqrt(Math.pow(xDistance, 2) + Math.pow(yDistance, 2));
        return Math.floor(distance);
      },

      generateBestDot = function () {
        var bestDot, bestDotDistance;
        for (var i = 0; i < samples; i++) {
          var candidateDot = generateRandomPosition(),
              distance;
          if (!placedDots.length) return candidateDot;
          distance = getDistanceToNearestDot(candidateDot);
          if (!bestDot || distance > bestDotDistance) {
              bestDot = candidateDot;
              bestDotDistance = distance;
          }
        }
        bestDot[2] = dotRadius
        return bestDot;
      },

      placeNewDot = function () {
        var dot = generateBestDot();
        placedDots.push(dot);
        drawDot(dot);
      },

      drawDot = function (dot) {
        offctx.beginPath();
        offctx.arc(dot[0], dot[1], dotRadius+pet(halfRadius), 0, twoPi);
        offctx.fillStyle = sampleRectColor(dot, ctx)//randomColor()
        offctx.fill();
      };
      
    initialize();
}

function neighbors (points, canvas) {
  let i = 0, j = 0
  let min_dist = 5//Math.sqrt(canvas.height * canvas.width)/50
  for (; i < points.length; i++) {
    j = 0
    let close = 1000000// +canvas.height * +canvas.width
    for (; j < points.length; j++) {
      if (i !== j) {
        let d = distance (points[i][0], points[i][1], points[j][0], points[j][1])
        if (d < close) {
          points[i][2] = d * 0.84
          close = d
        }
      }
    }
  }
  /*
  let points2 = []
  i = 0
  for (; i < points.length; i++) {
    if (points[i][2] > min_dist) {
      points2.push(points[i])
    }
  }
  i = 0
  for (; i < points2.length; i++) {
    j = 0
    let close = 1000000// +canvas.height * +canvas.width
    for (; j < points2.length; j++) {
      if (i !== j) {
        let d = distance (points2[i][0], points2[i][1], points2[j][0], points2[j][1])
        if (d < close) {
          points2[i][2] = d
          close = d
        }
      }
    }
  }*/
  return points//2
}

function sampleRectColor (p, ctx) {
  let x = p[0], y = p[1], w = p[2], h = w
  let imgData = ctx.getImageData(x, y, w, h)
  let pixels = imgData.data
  let i = 0, r = 0, g = 0, b = 0
  for (; i < pixels.length; i += 4) {
    r += parseInt(pixels[i])
    g += parseInt(pixels[i+1])
    b += parseInt(pixels[i+2])
  }
  r /= pixels.length/4
  g /= pixels.length/4
  b /= pixels.length/4
  let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
    G = ('0'+(Math.round(g)).toString(16)).slice(-2),
    B = ('0'+(Math.round(b)).toString(16)).slice(-2);
  return ("#"+R+G+B)
}
    

function nearest () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  // set above as in rectify
  let W = 2 + Math.floor(document.getElementById("featuresize").value/4)
  //invert range of W [2 - W] => [W - 2]
  W = 128 - W + 2
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w/4, j = 0
  let lightness = 0, linecount = 0
  let r = 0, g = 0, b = 0
  let D = radius * 5
  let angle = Math.random() * 2 * Math.PI
  // outer loop
  let points = []
  for (;j < numsquares; j++) {
    points[j] = [x+Math.random()*D/3, y+Math.random()*D/3, r]
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h
    }
  }
  points = neighbors(points, canvas)
  j = 0
  for (;j < points.length; j++) {
    x = points[j][0]
    y = points[j][1]
    radius = points[j][2]*0.9
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
    }
    r /= pixels.length/4
    g /= pixels.length/4
    b /= pixels.length/4
    let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
      G = ('0'+(Math.round(g)).toString(16)).slice(-2),
      B = ('0'+(Math.round(b)).toString(16)).slice(-2);
    offctx.fillStyle = "#"+R+G+B
    offctx.beginPath()
    let sides = 4 //+ Math.floor(Math.random() * 2) // 4 or 5
    let inc = Math.PI/(sides/2)
    let x1 = x, y1 = y
    let k = 0
    for (; k < sides; k++) {
      x = x1 + radius * Math.cos(angle);
      y = y1 + radius * Math.sin(angle);
      offctx.lineTo(x, y)
      angle += inc
    }
    offctx.closePath()
    offctx.fill()
  }
 // if (grunge)
    ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}
/*
function randomBokeh () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  let offctx = off.getContext("2d")
  off.width = canvas.width
  off.height = canvas.height
  let alpha = document.getElementById("opacity").value/100
  let grunge = document.getElementById("grungy").checked
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "lighten"
  let baser = 4 + Math.floor(document.getElementById("featuresize").value/4)
  let W = 500
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = ((1+wdivs) * (1+hdivs))/4
  let radius = w, j = 0
  let lightness = 0, linecount = 0
  let r = 0, g = 0, b = 0
  let flares = []
  let threshold = 170
  if (grunge)
    threshold = 140
  for (;j < numsquares; j++) {
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
    }
    r /= pixels.length/4
    g /= pixels.length/4
    b /= pixels.length/4
    let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
      G = ('0'+(Math.round(g)).toString(16)).slice(-2),
      B = ('0'+(Math.round(b)).toString(16)).slice(-2);
    let IN = (r+g+b)/3
    if (Math.random() > 0.90 && IN > threshold) {
      flares.push([x+w/2+pet(21), y+h/2+pet(21) ,baser*IN/40,"#"+R+G+B])
    }
    x += w * 2
    if (x >= (wdivs)*w) {
      linecount++
      if (!grunge && linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h * 2
    }
    if (y > ch)
      break
  }
  flares = shuffle(flares)
  i = 0
  for ( ; i < flares.length; i++)
    bokehAt(flares[i][0], flares[i][1], flares[i][2], flares[i][3], alpha, offctx)
  ctx.drawImage(off, 0, 0)
  ctx.globalCompositeOperation = mode
}
*/
function sampleImageDataColor () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  // set above as in rectify
  let W = 2 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 2
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w, j = 0
  let lightness = 0, linecount = 0
  let r = 0, g = 0, b = 0
  // outer loop
  for (;j < numsquares; j++) {
    let imgData = ctx.getImageData(x, y, w, h)
    let threshold = 127 - document.getElementById("opacity").value * 1.27
    let pixels = imgData.data
    let i = 0, r = 0, g = 0, b = 0
    for (; i < pixels.length; i += 4) {
      r += parseInt(pixels[i])
      g += parseInt(pixels[i+1])
      b += parseInt(pixels[i+2])
    }
    r /= pixels.length/4
    g /= pixels.length/4
    b /= pixels.length/4
    let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
      G = ('0'+(Math.round(g)).toString(16)).slice(-2),
      B = ('0'+(Math.round(b)).toString(16)).slice(-2);
    offctx.fillStyle = "#"+R+G+B
    radius = w/2
    offctx.beginPath()
    offctx.arc(x+w/2, y+h/2, radius, 0, Math.PI*2)
    offctx.closePath()
    offctx.fill()
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (!grunge && linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h
    }
  }
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}

function cymk () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let w2 = canvas.width/2
  let h2 = canvas.height/2
  let mode = ctx.globalCompositeOperation
  let targets = shuffle(["#FF00FF", "#00FFFF", "#FFFF00"])
  let i = 0
  let offs = []
  for (;i < targets.length; i++)
    offs.push(sampleAColor(targets[i]))
  let black = sampleAColor("#000000")
  ctx.globalAlpha = 1.0
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.globalCompositeOperation = "darken"
  let W = 1 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 1
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs * 2
  i = 0
  offs = shuffle(offs)
  for (;i < offs.length; i++) {
    if (i == 0) {
      ctx.save()
      ctx.translate(w2, h2);
      ctx.rotate(Math.random()/30);
      ctx.translate(-w2, -h2);
      ctx.drawImage(offs[i], pet(w),pet(w))
      ctx.restore()
    }
    if (i == 1) {
      ctx.drawImage(offs[i], pet(w),pet(w))
    }
    if (i == 2) {
      ctx.save()
      ctx.translate(w2, h2);
      ctx.rotate(-(Math.random()/30));
      ctx.translate(-w2, -h2);
      ctx.drawImage(offs[i], pet(w),pet(w))
      ctx.restore()
    }
  }
  ctx.globalCompositeOperation = "destination-over"
  ctx.save()
  ctx.translate(w2, h2);
  ctx.rotate(Math.random()/30);
  ctx.translate(-w2, -h2);
  ctx.drawImage(black, pet(w),pet(w))
  ctx.restore()
  ctx.fillStyle = "#FFFFFF"
  ctx.fillRect(0,0,canvas.width,canvas.height)
  ctx.globalCompositeOperation = mode
}

function sampleAColor (targetcolor, small) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = targetcolor
  offctx.globalAlpha = 1.0
  let tr = hexToR(targetcolor)
  let tg = hexToG(targetcolor)
  let tb = hexToB(targetcolor)
  let targ = [tr,tg,tb]
  let maxdist = 441// dist3d([0,0,0], [255,255,255])
  let grunge = document.getElementById("grungy").checked
  let radiusmultiplier = (grunge)? 1.7: 1.2;
  // set above as in rectify
  let W = 2 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 2
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs * 1.3
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w, j = 0
  let lightness = 0, linecount = 0, dist = 0, wdist = 0
  let r = 0, g = 0, b = 0
  for (;j < numsquares; j++) {
    let imgData = ctx.getImageData(x, y, w, h)
    let pixels = imgData.data
    let i = 0, r = 0, g = 0, b = 0, dist = 0, wdist = 0
    for (; i < pixels.length; i += 4) { // compare colors w/ target
      dist += dist3d(targ, [pixels[i], pixels[i+1], pixels[i+2]])
      wdist += dist3d([pixels[i], pixels[i+1], pixels[i+2]], [255,255,255])
    }
    dist /= pixels.length/4
    wdist /= pixels.length/4
    offctx.fillStyle = targetcolor
    radius = w/2 * (1-(dist/maxdist))
    radius *= wdist/(0.5*maxdist)
    if (radius > 0) {
      radius *= radiusmultiplier
      offctx.beginPath()
      offctx.arc(x+w/2, y+h/2, radius, 0, Math.PI*2)
      offctx.closePath()
      offctx.fill()
    }
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h
    }
  }
  return off
}

function sampleImageDataColor2 () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width
  off.height = canvas.height
  let offctx = off.getContext("2d")
  offctx.fillStyle = document.getElementById("paintcolor").value
  let targetcolor = document.getElementById("paintcolor").value
  let tr = hexToR(targetcolor)
  let tg = hexToG(targetcolor)
  let tb = hexToB(targetcolor)
  let targ = [tr,tg,tb]
  let maxd = []
  if (tr > 127)
    maxd.push(0)
  else
    maxd.push(255)
  if (tg > 127)
    maxd.push(0)
  else
    maxd.push(255)
  if (tb > 127)
    maxd.push(0)
  else
    maxd.push(255)
  let maxdist = dist3d(maxd, targ)
  let grunge = document.getElementById("grungy").checked
  // set above as in rectify
  let W = 2 + Math.floor(document.getElementById("featuresize").value/2)
  //invert range of W [2- 102] => [102 - 2]
  W = 251 - W + 2
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = 0, y = 0
  let numsquares = (1+wdivs) * (1+hdivs)
  let radius = w, j = 0
  let lightness = 0, linecount = 0, dist = 0
  let r = 0, g = 0, b = 0
  // outer loop
  for (;j < numsquares; j++) {
    let imgData = ctx.getImageData(x, y, w, h)
    let pixels = imgData.data
    let i = 0, r = 0, g = 0, b = 0, dist = 0
    for (; i < pixels.length; i += 4) { // compare colors w/ target
      dist += dist3d(targ, [pixels[i], pixels[i+1], pixels[i+2]])
    }
    dist /= pixels.length/4
    offctx.fillStyle = targetcolor
    radius = w/2 * (1-(dist/maxdist))
    if (radius < 0)
      radius = 0.01
    if (radius > 0) {
      offctx.beginPath()
      offctx.arc(x+w/2, y+h/2, radius, 0, Math.PI*2)
      offctx.closePath()
      offctx.fill()
    }
    x += w
    if (x >= (wdivs)*w) {
      linecount++
      if (!grunge && linecount % 2 == 1)
        x = -w/2
      else
        x = 0
      y += h
    }
  }
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(off, 0, 0)
}

function filterGrays () {
  let ctx = document.getElementById("myCanvas").getContext("2d")
  let op = document.getElementById("opacity").value
  //document.getElementById("opacity").value = 42
  alphaBlack()
  //document.getElementById("opacity").value = 63
  alphaWhite()
  document.getElementById("opacity").value = op
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "destination-over"
  if (document.getElementById("grungy").checked)
    fill()
  ctx.globalCompositeOperation = mode
  refreshMode()
}

function filterGrays2 () {
  let ctx = document.getElementById("myCanvas").getContext("2d")
  let op = document.getElementById("opacity").value
  let oc = document.getElementById("paintcolor").value
 // document.getElementById("opacity").value = 50
  document.getElementById("paintcolor").value = "#000000"
  colorFilterOut()
 // document.getElementById("opacity").value = 50
  document.getElementById("paintcolor").value = "#7f7f7f"
  colorFilterOut()
  document.getElementById("paintcolor").value = "#ffffff"
  colorFilterOut()
  document.getElementById("opacity").value = op
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "destination-over"
  if (document.getElementById("grungy").checked)
    fill()
  ctx.globalCompositeOperation = mode
  refreshMode()
  document.getElementById("paintcolor").value = oc
}

function alphaBlack () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  let threshold = 127 - document.getElementById("opacity").value * 1.27
  let pixels = imgData.data
  let i = 0
  for (; i < pixels.length; i += 4) {
    let lightness = parseInt((pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3)
    if (lightness < threshold)
      pixels[i+3] = lightness/255
  }
  ctx.putImageData(imgData, 0, 0)
}

function alphaWhite () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let threshold = 127 + document.getElementById("opacity").value * 1.27
  let pixels = imgData.data
  let i = 0
  for (; i < pixels.length; i += 4) {
    let lightness = parseInt((pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3)
    if (lightness > threshold)
      pixels[i+3] = 1-lightness/255
  }
  ctx.putImageData(imgData, 0, 0)
  return true
}

function filterRed () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data
  let i = 0
  for (; i < pixels.length; i += 4) {
    pixels[i] *= 0.9
  }
  ctx.putImageData(imgData, 0, 0)
}

function filterGreen () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data
  let i = 0
  for (; i < pixels.length; i += 4) {
    pixels[i+1] *= 0.9
  }
  ctx.putImageData(imgData, 0, 0)
}

function filterBlue () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data
  let i = 0
  for (; i < pixels.length; i += 4) {
    pixels[i+2] *= 0.9
  }
  ctx.putImageData(imgData, 0, 0)
}

let LATESTFUNCTION = ""

function testImage (id) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let gco = ctx.globalCompositeOperation
  let sel = document.getElementById("mode").value
  if (gco !== sel) {
    alert(LATESTFUNCTION+" "+gco+" !== "+sel)
    ctx.globalCompositeOperation = sel
  }
  let f = document.getElementById(id).value
  window[f]()
  LATESTFUNCTION = f
  document.getElementById("last").title = "repeat: "+f
}

function doAgain () {
  if (LATESTFUNCTION.length > 0)
    window[LATESTFUNCTION]()
}

async function invertColors (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height)
  let pixels = imgData.data
  let i = 0
  for (; i < pixels.length; i += 4) {
    var r = pixels[i]; // Red color lies between 0 and 255
    var g = pixels[i + 1]; // Green color lies between 0 and 255
    var b = pixels[i + 2]; // Blue color lies between 0 and 255
    var a = pixels[i + 3]; // Transparency lies between 0 and 255
    var invertedRed = 255 - r
    var invertedGreen = 255 - g
    var invertedBlue = 255 - b
    pixels[i] = invertedRed
    pixels[i + 1] = invertedGreen
    pixels[i + 2] = invertedBlue
  }
  await ctx.putImageData(imgData, 0, 0)
  return true
}

function lightleak () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  off.width = canvas.width, off.height = canvas.height
  let offctx = off.getContext("2d")
  let alpha = document.getElementById("opacity").value
  offctx.fillStyle = randomGradient(canvas, randomColorMedium())
  let cw = canvas.width, ch  = canvas.height
  let y = ch/4*Math.random(), x = 0
  if (Math.random() > 0.5)
    y = ch-y/3
  offctx.globalAlpha = 0.1
  if (document.getElementById("grungy").checked)
    offctx.globalAlpha = 0.2
  let i = 0
  for (; i < 5; i++) {
    offctx.fillStyle = randomGradient(canvas, randomColorLight())
    ellipseFill(offctx, cw/2 + pet(cw/3), y+pet(100), cw+cw/2*Math.random(), ch/10*Math.random())
  }
  document.getElementById("rednumber").value = 4
  document.getElementById("opacity").value = 9
  saturationScale(5, off)
  motionblur(off)
  motionblur(off)
  ctx.drawImage(off,0+pet(21),0+pet(21),canvas.width, canvas.height)
  document.getElementById("opacity").value = alpha
}

function ellipseFill (ctx, x, y, rx, ry) {
  let r = (Math.random() - 0.5)/5
  ctx.beginPath()
 // ctx.moveTo(p1_x, p1_y);
  ctx.ellipse(x, y, rx, ry, r, 0, Math.PI*2);
  ctx.closePath()
  ctx.fill()
}
/*
function ellipseFill (ctx, x, y, rx, ry) {
  ry*=4/3;
  let p1_x=x-rx, p1_y=y,
      p2_x=x+rx, p2_y=y,
      cp1_x, cp1_y,
      cp2_x, cp2_y,
      cp3_x, cp3_y,
      cp4_x, cp4_y,
      p1n_x, p1n_y, dx, dy;
  
  cp1_x=p1_x;
  cp1_y=p1_y-ry;
  cp4_x=p1_x;
  cp4_y=p1_y+ry;
  //
  cp2_x=p2_x;
  cp2_y=p2_y-ry;
  cp3_x=p2_x;
  cp3_y=p2_y+ry;
  
  ctx.beginPath()
  ctx.moveTo(p1_x, p1_y);
  ctx.bezierCurveTo(cp1_x, cp1_y, cp2_x, cp2_y, p2_x, p2_y);
  ctx.bezierCurveTo(cp3_x, cp3_y, cp4_x, cp4_y, p1_x, p1_y);
  ctx.closePath()
  ctx.fill()
}*/


function ellipse1 (ctx, x, y, rx, ry, rot) {
  ry*=4/3;
  var p1_x=x-rx, p1_y=y,
      p2_x=x+rx, p2_y=y,
      cp1_x, cp1_y,
      cp2_x, cp2_y,
      cp3_x, cp3_y,
      cp4_x, cp4_y,
      p1n_x, p1n_y, dx, dy;
  //
  if (rot) {
      //
      p1n_x=rx*Math.cos(rot) + x;
      p1n_y=rx*Math.sin(rot) + y;
      //
      p2_x-=p1n_x-p1_x;
      p2_y-=p1n_y-p1_y;
      //
      p1_x=p1n_x;
      p1_y=p1n_y;
      //
      dx=ry*Math.sin(rot);
      dy=ry*Math.cos(rot);
      //
      cp1_x=p1_x+dx;
      cp1_y=p1_y-dy;
      cp4_x=p1_x-dx;
      cp4_y=p1_y+dy;
      //
      cp2_x=p2_x+dx;
      cp2_y=p2_y-dy;
      cp3_x=p2_x-dx;
      cp3_y=p2_y+dy;
  } else {
      cp1_x=p1_x;
      cp1_y=p1_y-ry;
      cp4_x=p1_x;
      cp4_y=p1_y+ry;
      //
      cp2_x=p2_x;
      cp2_y=p2_y-ry;
      cp3_x=p2_x;
      cp3_y=p2_y+ry;
  }
  ctx.moveTo(p1_x, p1_y);
  ctx.bezierCurveTo(cp1_x, cp1_y, cp2_x, cp2_y, p2_x, p2_y);
  ctx.bezierCurveTo(cp3_x, cp3_y, cp4_x, cp4_y, p1_x, p1_y);
}

function blockish () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let color = document.getElementById("paintcolor").value
  ctx.fillStyle = document.getElementById("paintcolor").value
  let i = 0, x = Math.random() *canvas.width, y = Math.random() *canvas.height
  let w = canvas.width/(2+Math.random()*10)
  let h = w / 2
  for (; i < 7; i++) {
    w = canvas.width/(2+Math.random()*10)
    h = w / 3
    x = Math.random() *canvas.width - w/2, y = Math.random() *canvas.height - h/2
    ctx.beginPath()
    ctx.moveTo(x+pet(120), y+pet(120))

    ctx.lineTo(x+w+pet(120), y+pet(120))
    ctx.lineTo(x+w+pet(120), y+h+pet(120))
    ctx.lineTo(x+pet(120), y+h+pet(120))

    ctx.closePath()
    ctx.fillStyle - petColor(color, 60)
    ctx.fill()
  }
}

function paperish () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let a0 = document.getElementById("opacity").value
  let n0 = document.getElementById("number").value
  let color0 = document.getElementById("paintcolor").value
  let mode = ctx.globalCompositeOperation
  let size0 = document.getElementById("featuresize").value
  let shapes = ["hrips", "land", "diagonal"]
  let i = 0
  let nf = 1
  let j = 0
  ctx.save()
 // clearOff()
  for (; j < 3; j++) {
    i = 0
    ctx.globalCompositeOperation = "source-over"
    for (; i < nf; i++) {
      document.getElementById("paintcolor").value = petColor(color0, 90)
      let f = randomPick(shapes)
      document.getElementById("opacity").value = 30 + Math.random() + 25
      window[f]()
      if (Math.random() > 0.5)
        flipV()
      if (Math.random() > 0.5)
        flipH()
    }
    functions = ["smudge", "smudge", "smudge"]
    let args = [ "streaks", "streaks2", "arcs", "arcs2", "stars", "horizontal"]
    ctx.globalCompositeOperation = "destination-out"
    i = 0
    nf = 1
    for (; i < nf; i++) {
      //randomPickColor()
      document.getElementById("paintcolor").value = petColor(color0, 60)
      let f = randomPick(functions)
      let a = ''
      if (f == "smudge")
        a = randomPick(args)
      document.getElementById("number").value = 10000 + Math.random() * 10000
      document.getElementById("featuresize").value = 250 + Math.random() * 200
      document.getElementById("opacity").value = 50 + Math.random() + 50
      window[f](a)
    }
  }
  ctx.restore()
  document.getElementById("opacity").value = a0
  ctx.globalCompositeOperation = mode
  document.getElementById("featuresize").value = size0
  document.getElementById("number").value = n0
}

function dotted (canvas, source, jaggy, dir) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let ch = canvas.height, cw = canvas.width
  let dir2 = dir + Math.PI/2
  // calculate h based on canvas dims
  let minsize = cw/200
  if (ch > cw) {
    minsize = ch/200
  }
  if (minsize < 4)
    minsize = 4
  if (dir)
    minsize *= 2
  let h = 4 + Math.floor(document.getElementById("featuresize").value/10)
  h = Math.floor(minsize/4 * h)
  let w = h
  let off = h/3
  let r = w/1.2
  let t = w*2
  let rd2 = r/3, rt2 = r*2, wd4 = w/4, wt4 = w*9
  ctx.save()
  ctx.beginPath()
  let count = canvas.height/h * canvas.width/w
  let newline = Math.floor(canvas.width/w)
  let counter = 0
  let x = w/3 + pet(11), y = h/3 + pet(11)
  let xo = 0, yo = 0, i = 0
  let inc = Math.PI*2/5, a = Math.random()*Math.PI*2
  ctx.save()
  ctx.beginPath()
  for (;i < count; i++) {
    x0 = x+w/2+pet(t)
    y0 = y+h/2+pet(t)
    ctx.moveTo(x0, y0)
    if (dir) {
      ellipse1(ctx, x0, y0, rd2, rt2, dir)
    } else
    if (jaggy) {
      ctx.arc(x0+pet(w),y0+pet(w),r,a,a+Math.PI/2)
      a += inc
    } else
       ctx.arc(x0+pet(w),y0+pet(w),r+pet(w),0,Math.PI*2)
    x += w*1.3
    xo += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = w
      y += 1.3*h
      off *= -1
      x =+ off
    }
  }
  ctx.closePath()
  ctx.clip()
  ctx.drawImage(source, pet(r*3), pet(r*3), canvas.width, canvas.height)
  ctx.restore()
  refreshMode()
}

function dottedhalo (canvas, source, jaggy, dir) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let ch = canvas.height, cw = canvas.width
  let cx = cw/2, cy = ch/2
  cx = LASTCLICK[0]
  cy = LASTCLICK[1]
  let dir2 = dir + Math.PI/2
  // calculate h based on canvas dims
  let minsize = cw/200
  if (ch > cw) {
    minsize = ch/200
  }
  if (minsize < 4)
    minsize = 4
  if (dir)
    minsize *= 2
  let h = 4 + Math.floor(document.getElementById("featuresize").value/10)
  h = Math.floor(minsize/4 * h)
  let w = h
  let off = h/3
  let r = w/1.2
  let t = w
  let rd2 = r/3, rt2 = r*2, wd4 = w/4, wt4 = w*9
  ctx.save()
  ctx.beginPath()
  let count = canvas.height/h * canvas.width/w * 2
  let newline = Math.floor(canvas.width/w) + w
  let counter = 0
  let x = w/2//w/3 + pet(11),
  let y = 0// h/3 + pet(11)
  let xo = 0, yo = 0, i = 0
  let inc = 5, a = Math.random()*Math.PI*2
  ctx.save()
  ctx.beginPath()
  let dist = 0, max_dist = distance(cx, cy, 0, 0), r0 = r
  while (y < canvas.height) {
    x0 = x + w/2+pet(t)
    y0 = y + h/2+pet(t)
    ctx.moveTo(x0,y0)
    dist = distance(x0, y0, cx, cy)/max_dist
    r = r0 * dist
    a = Math.random() * 6.28
    if (dist * Math.random() > 0.02) {

      if (dir) {
        ellipse1(ctx, x0, y0, rd2, rt2, dir)
      } else
      if (jaggy) {
        ctx.arc(x0+pet(w),y0+pet(w),r,a,a+Math.PI/2)
       // a += inc
      } else
         ctx.arc(x0+pet(w),y0+pet(w),r,0,Math.PI*2)
    }
    x += w*1.3
    xo += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = 0
      y += 1.3*h
      off *= -1
      x =+ off
    }
    i++
  }
  ctx.closePath()
  ctx.clip()
  ctx.drawImage(source, pet(r*3), pet(r*3), canvas.width, canvas.height)
  ctx.restore()
  refreshMode()
}


function qBlur () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.drawImage(canvas, 0, 0, canvas.width / 4, canvas.height / 4);
  ctx.drawImage(canvas, 0, 0, canvas.width / 4, canvas.height / 4, 0, 0, canvas.width, canvas.height);
}

function jaggyblur (canvas) {
  let jaggy = true
  dotblur(canvas, jaggy, false)
}

function dirblur (canvas) {
  let jaggy = false
  let dir = Math.random() * Math.PI * 2
  dotblur(canvas, jaggy, dir)
}

function halojaggy () {
  let jaggy = true
  haloblur(jaggy)
}

function haloblur (jaggy, dir) {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  let offctx = off.getContext("2d")
  off.height = canvas.height
  off.width = canvas.width
  let grunge = document.getElementById("grungy").checked
  offctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let i = 0
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  if (grunge)
    ctx.clearRect(0,0,canvas.width, canvas.height)
  for (; i < 3; i++) {
    offctx.clearRect(0,0,canvas.width, canvas.height)
    offctx.putImageData(imgData, pet(17), pet(17))
    dottedhalo(canvas, off, jaggy, dir)
  }
  refreshMode()
}

function dotblur (canvas, jaggy, dir) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  let offctx = off.getContext("2d")
  off.height = canvas.height
  off.width = canvas.width
  let grunge = document.getElementById("grungy").checked
  offctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let i = 0
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  if (grunge)
    ctx.clearRect(0,0,canvas.width, canvas.height)
  for (; i < 3; i++) {
    offctx.clearRect(0,0,canvas.width, canvas.height)
    offctx.putImageData(imgData, pet(17), pet(17))
    dotted(canvas, off, jaggy, dir)
  }
  refreshMode()
}

function colorFilterOut () { // filter unselected color
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  let target = document.getElementById("paintcolor").value
  let threshold = +document.getElementById("opacity").value * 2.55
  threshold = 255 - threshold
  let grunge = document.getElementById("grungy").checked
  let mode = ctx.globalCompositeOperation
  let r = hexToR(target)
  let g = hexToG(target)
  let b = hexToB(target)
  let pixels = imgData.data
  let i = 0
  let d = imgData.data
  let dist = 0
  for( ;i < d.length; i +=4) {
    dist = Math.sqrt(Math.pow(d[i] - r, 2) + Math.pow(d[i+1] - g, 2) + Math.pow(d[i+2] - b, 2))
    if (dist <= threshold) {
      if (grunge) {
        d[i + 3] *= 0.8
      } else
        d[i + 3] = 0.0
    }
  }
  ctx.putImageData(imgData, 0, 0)
  refreshMode()
}
/*
function colorFilterOff () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let off = document.createElement('CANVAS')
  let offctx = off.getContext("2d")
  off.height = canvas.height
  off.width = canvas.width
  let off2 = document.createElement('CANVAS')
  let off2ctx = off2.getContext("2d")
  off2.height = canvas.height
  off2.width = canvas.width
  offctx.globalAlpha = 0.8
  off2ctx.globalAlpha = 0.8
  // red
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  let target = "#ff5555"//document.getElementById("paintcolor").value
  let threshold = document.getElementById("opacity").value
  let tclose = threshold * 0.95
  let r = hexToR(target)
  let g = hexToG(target)
  let b = hexToB(target)
  let pixels = imgData.data
  let i = 0
  let d = imgData.data
  let dist = 0
  for( ;i < d.length; i +=4) {
    dist = 0
    dist += Math.abs(d[i] - r)
    dist += Math.abs(d[i+1] - g)
    dist += Math.abs(d[i+2] - b)
    let lightness = parseInt((d[i] + d[i + 1] + d[i + 2]) / 3);
    
    if (dist/3 > threshold) {
        d[i + 3] = 0.0
    }
  }
  offctx.clearRect(0,0,canvas.width, canvas.height)
  offctx.putImageData(imgData, 0, 0)
  offctx.globalCompositeOperation = "destination-out"
  dashes(off)
  offctx.globalCompositeOperation = "source-over"
  off2ctx.drawImage(off, -6,6,off2.width,off2.height)
  
  // blue
  imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  target = "#5555ff"//document.getElementById("paintcolor").value
  threshold = document.getElementById("opacity").value
  tclose = threshold * 0.95
  r = hexToR(target)
  g = hexToG(target)
  b = hexToB(target)
  pixels = imgData.data
  i = 0
  d = imgData.data
  dist = 0
  for( ;i < d.length; i +=4) {
    dist = 0
    dist += Math.abs(d[i] - r)
    dist += Math.abs(d[i+1] - g)
    dist += Math.abs(d[i+2] - b)
  //  let lightness = parseInt((d[i] + d[i + 1] + d[i + 2]) / 3);
    if (dist/3 > threshold) {
        d[i + 3] = 0.0
    }
  }
  offctx.clearRect(0,0,canvas.width, canvas.height)
  offctx.putImageData(imgData, 0, 0)
  offctx.globalCompositeOperation = "destination-out"
  dashes(off)
  offctx.globalCompositeOperation = "source-over"
  off2ctx.drawImage(off, 0,6,off2.width,off2.height)
  
  // green
  imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  target = "#55ff55"//document.getElementById("paintcolor").value
  threshold = document.getElementById("opacity").value
  tclose = threshold * 0.95
  r = hexToR(target)
  g = hexToG(target)
  b = hexToB(target)
  pixels = imgData.data
  i = 0
  d = imgData.data
  dist = 0
  for( ;i < d.length; i +=4) {
    dist = 0
    dist += Math.abs(d[i] - r)
    dist += Math.abs(d[i+1] - g)
    dist += Math.abs(d[i+2] - b)
    let lightness = parseInt((d[i] + d[i + 1] + d[i + 2]) / 3);
    if (dist/3 > threshold) {
        d[i + 3] = 0.0
    }
  }
  offctx.clearRect(0,0,canvas.width, canvas.height)
  offctx.putImageData(imgData, 0, 0)
  offctx.globalCompositeOperation = "destination-out"
  dashes(off)
  offctx.globalCompositeOperation = "source-over"
  refreshMode()
  off2ctx.drawImage(off, -6,0,off2.width,off2.height)
  
  ctx.clearRect(0,0,canvas.width, canvas.height)
  ctx.drawImage(off2, 0,0,off2.width,off2.height)
}*/

function colorFilter () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  let target = document.getElementById("paintcolor").value
  let threshold = +document.getElementById("opacity").value * 2.55
  let grunge = document.getElementById("grungy").checked
  let r = hexToR(target)
  let g = hexToG(target)
  let b = hexToB(target)
  let pixels = imgData.data
  let i = 0, ct = 0
  let d = imgData.data
  let dist = 0, lightness
  for( ;i < d.length; i +=4) {
    dist = Math.sqrt(Math.pow(d[i] - r, 2) + Math.pow(d[i+1] - g, 2) + Math.pow(d[i+2] - b, 2))
    if (dist >= threshold) {
      if (grunge) {
        lightness = parseInt((d[i] + d[i + 1] + d[i + 2]) / 3);
        d[i] = lightness
        d[i + 1] = lightness
        d[i + 2] = lightness
      } else
        d[i + 3] = 0.0
    }
  }
  ctx.putImageData(imgData, 0, 0)
}

function highContrast () {
  let canvas = document.getElementById("myCanvas")
  greyScale(canvas)
  contrastImage(40, canvas)
  adjustBrightness(-30, canvas)
  if (document.getElementById("grungy").checked) {
    sharpenCanvas()
  }
}

function mapRanges (start, end, startF, endF, val) { // F is full range 0 to 255*3
 // r = (endF - startF)/(end - start)
  return(((val-start)*(endF-startF))/(end-start) + startF)
}

function retro () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let alpha = document.getElementById("opacity").value
  let feature_size = document.getElementById("featuresize").value
  let number = document.getElementById("number").value
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let pal = getCurrentPalette()
  document.getElementById("number").value = 1500 + pet(500)
  document.getElementById("opacity").value = 100
  LASTCLICK[0] = canvas.width/2
  LASTCLICK[1] = canvas.height/2
  increaseGrain()
  
  let type = document.getElementById("palettechoice").value
  document.getElementById("palettechoice").value = "rainbow"
  randomPalette()
  palettetint()
  contrastImage(-5)
  adjustBrightness(5)
  edgeDarken(canvas)
  if (Math.random() > 0.3 && alt) {
    ctx.save()
    clipIrregular()
    lightleak()
    ctx.restore()
  }
  
  if (Math.random() > 0.3 && alt) {
    document.getElementById("paintcolor").value = randomPick(["#d4f595", "#80dfff", "#ffee80", "#ff80aa", "#45de45"])
    document.getElementById("opacity").value = 25 + Math.random() * 10
    haze()
  }
  if (Math.random() > 0.3 && alt) {
    document.getElementById("paintcolor").value = randomPick(["#7f7e60", "#707060", "#507070", "#505070"])
    document.getElementById("opacity").value = 30
    document.getElementById("number").value = 6000
    document.getElementById("featuresize").value = 300
    if (Math.random() > 0.5)
      smudgewatercolor()
    else
      fog()
  }
  if (Math.random() > 0.3 && alt) {
    ctx.save()
    clipIrregular()
    document.getElementById("paintcolor").value = "#ffffff"
    document.getElementById("opacity").value = 70 + Math.random() * 20
    document.getElementById("number").value = 3000 + Math.random() * 3000
    document.getElementById("featuresize").value = 400
    let r = Math.random()
    if (r > 0.67)
      rays()
    else
    if (r > 0.33 && r < 0.67)
      smudgestreaks()
    else
    if (r <= 0.33)
      smudgestars()
    ctx.restore()
  }
  restorePalette(pal)
  document.getElementById("opacity").value = alpha
  document.getElementById("featuresize").value = feature_size
  document.getElementById("number").value = number
  document.getElementById("paintcolor").value = color
  document.getElementById("palettechoice").value = type
}

function adjustExposure (n, canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0, maxb = -1, minb = 100000, avg = 0
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/3
    maxb = (maxb > brightness)? maxb : brightness;
    minb = (minb < brightness)? minb : brightness;
    avg += brightness
  }
  avg /= pixels.length/4
  if (minb > 0 || avg > 127 * 1.2) {
    adjustBrightness(-10)
    contrastImage(10)
  }
  if (maxb < 255 || avg < 0.8 * 127) {
    adjustBrightness(10)
    contrastImage(10)
  }
}

function contrastImage (contrast, canvas) {  //input range [-100..100]
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  let pixels = imgData.data
  let i = 0
  let d = imgData.data
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  contrast = (contrast/100) + 1;  //convert to decimal & shift range: [0..2]
  let intercept = 128 * (1 - contrast)
  for( ;i < d.length; i +=4){   //r,g,b,a
    brightness = (d[i]+d[i+1]+d[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      d[i] =   d[i]*contrast + intercept
      d[i+1] = d[i+1]*contrast + intercept
      d[i+2] = d[i+2]*contrast + intercept
    }
  }
  ctx.putImageData(imgData, 0, 0)
}

function openFile () {
  let canvas = document.getElementById('myCanvas')
  let ctx = canvas.getContext('2d')
  let mode = ctx.globalCompositeOperation
  document.getElementById('uploadimage').click();
  ctx.globalCompositeOperation = mode
  syncMarker()
}

function OGImage() {
  if (IMG) {
    let ctx = document.getElementById('myCanvas').getContext('2d')
    ctx.drawImage(IMG, 0, 0);
  }
}

function drawFile () {
  let canvas = document.getElementById('myCanvas')
  let ctx = canvas.getContext('2d')
  let IMG = new Image()
  let f = document.getElementById("uploadimage").files[0]
  let url = window.URL || window.webkitURL
  let src = url.createObjectURL(f);
  IMG.src = src;
 // let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  //document.getElementById('mode')
  IMG.onload = function() {
    canvas.height = this.height
    canvas.width = this.width
    syncBackground(canvas)
    document.getElementById("canvaswidth").value = canvas.width
    document.getElementById("canvasheight").value = canvas.height
    ctx.drawImage(IMG, 0, 0);
    url.revokeObjectURL(src);
    LASTCLICK[0] = canvas.width/2
    LASTCLICK[1] = canvas.height/2
    ctx.globalCompositeOperation = mode
    //ctx.globalAlpha = a
    syncMarker()
  }
  document.getElementById("uploadimage").value = ""
  ctx.globalCompositeOperation = mode
  //refreshMode()
  //syncMarker()
}

function drawFile_other () {
  let canvas = document.getElementById('myCanvas')
  let ctx = canvas.getContext('2d')
  let IMG = new Image()
  let f = document.getElementById("uploadimage").files[0]
  let url = window.URL || window.webkitURL
  let src = url.createObjectURL(f);
  IMG.src = src;
  ctx.globalAlpha = 1
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  document.getElementById('mode')
  IMG.onload = function () {
    canvas.height = this.height
    canvas.width = this.width
    ctx.drawImage(IMG, 0, 0);
    //resizeCanvas()
    url.revokeObjectURL(src);
    extractPalette()
  }
  //document.getElementById("uploadimage").value = ""
}

function clearOff () {
 let OC = document.getElementById('OC')
 let octx = OC.getContext('2d')
 octx.clearRect(0, 0, OC.width, OC.height)
 OCISCLEAR = true
 return true
}

async function copyToOff () {
  let OC = document.getElementById('OC')
  let canvas = document.getElementById('myCanvas')
  if (isCanvasBlank(OC)) {
    OC.height = canvas.height
    OC.width = canvas.width
    OCISCLEAR = false
  }
  let ctx = canvas.getContext('2d')
  let OCctx = OC.getContext('2d')
  ctx.globalAlpha = 1.0
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  OCctx.globalAlpha = 1.0
  OCctx.globalCompositeOperation = "source-over"
  await OCctx.drawImage(canvas, 0, 0)
  ctx.globalCompositeOperation = mode
  OCISCLEAR = false
  return true
}

function pasteFromOff () {
  let OC = document.getElementById('OC')
  if (OC && OC.width > 0) {
    let canvas = document.getElementById('myCanvas')
    let ctx = canvas.getContext('2d')
    let OCctx = OC.getContext('2d')
    OCctx.globalAlpha = document.getElementById("opacity").value/100
    ctx.globalAlpha = document.getElementById("opacity").value/100
    ctx.drawImage(OC, 0, 0)
  }
  return true
}

function swapWithOff () {
  let OC = document.getElementById('OC')
  let canvas = document.getElementById('myCanvas')
  if (isCanvasBlank(OC)) {
    OC.height = canvas.height
    OC.width = canvas.width
    OCISCLEAR = false
  }
  let mode = document.getElementById("mode").value
  if (OC && OC.width > 0) {
    let ctx = canvas.getContext('2d')
    ctx.globalCompositeOperation = "source-over"
    let OCctx = OC.getContext('2d')
    OCctx.globalCompositeOperation = "source-over"
    OCctx.globalAlpha = 1
    ctx.globalAlpha = 1
    let temp = document.createElement('CANVAS')
    let tempctx = temp.getContext('2d')
    temp.width = canvas.width
    temp.height = canvas.height
    tempctx.globalAlpha = 1//document.getElementById("opacity").value/100
    tempctx.drawImage(canvas,0,0)
    ctx.clearRect(0,0,canvas.width,canvas.height)
    ctx.drawImage(OC, 0, 0)
    OCctx.clearRect(0,0,canvas.width,canvas.height)
    OCctx.drawImage(temp,0,0)
    ctx.globalCompositeOperation = mode

  }
  ctx.globalCompositeOperation = mode
  return true
}

document.getElementById("uploadimage").addEventListener("change", drawFile, true)

function pushColor (c) {
  document.getElementById("paintcolor").value = c
}

function randomPickColor() {
  document.getElementById("paintcolor").value = randomColor()
}

function updateColor () {
  let uc = document.getElementById("usercolor").value
  document.getElementById("paintcolor").value = uc
}

function randn_bm (min, max, skew) {
  let u = 0, v = 0;
  while(u === 0) u = Math.random() //Converting [0,1) to (0,1)
  while(v === 0) v = Math.random()
  let num = Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v )
  num = num / 10.0 + 0.5 // Translate to 0 -> 1
  if (num > 1 || num < 0)
   num = randn_bm(min, max, skew) // resample between 0 and 1 if out of range
  else{
    num = Math.pow(num, skew) // Skew
    num *= max - min // Stretch to fill range
    num += min // offset to min
  }
  return num
}

function randomColor() {
  let r = ('0'+(randomFromTo(10,256)).toString(16)).slice(-2),
  g = ('0'+(randomFromTo(10,256)).toString(16)).slice(-2),
  b = ('0'+(randomFromTo(10,256)).toString(16)).slice(-2);
  return '#' +r+g+b;
}

function randomColorMedium() {
  let r = ('0'+(randomFromTo(100,200)).toString(16)).slice(-2),
  g = ('0'+(randomFromTo(100,200)).toString(16)).slice(-2),
  b = ('0'+(randomFromTo(100,200)).toString(16)).slice(-2);
  return '#' +r+g+b;
}

function randomColorLight() {
  let r = ('0'+(randomFromTo(127,256)).toString(16)).slice(-2),
  g = ('0'+(randomFromTo(127,256)).toString(16)).slice(-2),
  b = ('0'+(randomFromTo(127,256)).toString(16)).slice(-2);
  return '#' +r+g+b;
}

function randomColorVLight() {
  let r = ('0'+(randomFromTo(192,256)).toString(16)).slice(-2),
  g = ('0'+(randomFromTo(192,256)).toString(16)).slice(-2),
  b = ('0'+(randomFromTo(192,256)).toString(16)).slice(-2);
  return '#' +r+g+b;
}

function randomColorDark() {
  let r = ('0'+(randomFromTo(10,128)).toString(16)).slice(-2),
  g = ('0'+(randomFromTo(10,128)).toString(16)).slice(-2),
  b = ('0'+(randomFromTo(10,128)).toString(16)).slice(-2);
  return '#' +r+g+b;
}

function randomColorVDark() {
  let r = ('0'+(randomFromTo(10,92)).toString(16)).slice(-2),
  g = ('0'+(randomFromTo(0,92)).toString(16)).slice(-2),
  b = ('0'+(randomFromTo(0,92)).toString(16)).slice(-2);
  return '#' +r+g+b;
}

function randomColorWarm() {
  let r = ('0'+(randomFromTo(120,256)).toString(16)).slice(-2),
  g = ('0'+(randomFromTo(50,190)).toString(16)).slice(-2),
  b = ('0'+(randomFromTo(10,50)).toString(16)).slice(-2);
  return '#' +r+g+b;
}

function randomColorCool() {
  let r = ('0'+(randomFromTo(10,50)).toString(16)).slice(-2),
  g = ('0'+(randomFromTo(50,190)).toString(16)).slice(-2),
  b = ('0'+(randomFromTo(120,256)).toString(16)).slice(-2);
  return '#' +r+g+b;
}


function randomFromTo(from, to) {
  return Math.floor(Math.random() * (to - from + 1) + from);
}

function randomPick (array) {
  return array[Math.floor((array.length) * Math.random())]
}

function clipIrregular () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let angle = Math.random() * 2 * Math.PI;
  let edges = Math.floor(19 * Math.random() + 4)
  edges *= 4
  let maxradius = Math.max(W,H)/10
  let radius = W/5
  let increase = Math.PI * 2/edges * 0.9
  let x = 0
  let y = 0
  let cx = W/2 + pet(220)
  let cy = H/2 + pet(220)
  let points = [], i = 0
  for (; i < edges; i++) {  // blobAt
    radius += (Math.random() - 0.3) * maxradius
    x = cx + radius * Math.cos(angle);
    y = cy + radius * Math.sin(angle);
    points.push([x, y]);
    angle += increase;
  }
  ctx.beginPath()
  i = 0;
  for (; i < points.length; i++) {
    if (i == 0) {
      ctx.moveTo(x, y);
    } else
    if (i % 3 == 0)
      ctx.bezierCurveTo(points[i-2][0], points[i-2][1], points[i-1][0], points[i-1][1], points[i][0], points[i][1]);
  }
  ctx.closePath()
  ctx.clip()
}

function clip () {
  alert ("clip is no longer supported")
  return
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let H = canvas.height
  let len = W/2, maxy = H/2
  ctx.save()
  //let dist = document.getElementById("distro").value
  {
    ctx.beginPath();
    ctx.arc(len, len, len, 0, 2*Math.PI, false);
    ctx.closePath()
    ctx.clip()
  }
}

function drips () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  //ctx.save()
  //clip()
  let W = canvas.width
  let c = W/2
  let margin = W/20
  let w4 = (W-2*margin)/(2+Math.floor(Math.random() * 10))*8////document.getElementById("rows").value
  ctx.globalAlpha = document.getElementById("opacity").value/750
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  let scale = 7+document.getElementById("featuresize").value/5
  let parts = Math.floor(W/(scale*2-1)) *1.8
  let rule = true
  if (Math.random() > 0.5)
    rule = false
  if (!grunge) {
    let t = 0
    colors = []
    for (; t < 21; t++)
      colors.push(randomColor())
  }
  let x = scale, y = 71 + pet(41)
  let i = 0, r = scale/2
  let d = 0, drift = 0
  for (; i < parts; i++) {
    let x1 = x
    let xf = 20 + Math.random() * 100
    let yf = 0.001 + Math.random()/3 * 0.002
    r = scale/2 + pet(scale/4)
    while (y < 1400) {
      d = (x1-c)
      if (d < 1)
        d += -1
      drift = xf/(d+0.01)
      if (rule) {
        if (x1 > c)
          drift -= y * yf
        else
          drift += y * yf
      } else {
        if (x1 < c)
          drift -= y * yf
        else
          drift += y * yf
      }
      x1 += drift
      y += 2
      x1 += pet(1.25)
      if (r < 0.5)
        r = 0.5
      ctx.beginPath();
      ctx.moveTo(x1, y)
      ctx.arc(x1,y,1+r+pet(2) ,0,2*Math.PI)
      ctx.closePath()
      ctx.fillStyle = colors[i%colors.length]
      ctx.fill()
      r*= 0.998
    }
    x += scale * 1.05
    y = 41 + pet(41)
  }
  ctx.restore()
}

function spiral () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let C = W/2 + (Math.random() - 0.5) * W/4
  ctx.globalAlpha = +document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 2+document.getElementById("featuresize").value/20
  ctx.lineCap = "round"
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let radius = 250, r0 = W/2.3 +Math.random() * 250, angle = Math.random() * 6.28
  let n = 0, end = 2400
  let shrink = 100 + Math.random() * 300
  let grow = end -100 - Math.random() * 300
  ctx.beginPath();
  for (; n < end; n++) {
    radius = r0
    // make a complete circle every 50 iterations
    angle += (Math.PI * 2) / 250;
    var x = C + radius * Math.cos(angle);
    var y = C + radius * Math.sin(angle);
    ctx.lineTo(x, y);
    r0 += 0.02 + pet(2)
    if (n > grow)
      r0 += 0.9 + pet(1)
    if (n < shrink)
     r0 -= 0.9 + pet(1)
  }
  ctx.stroke();
}

function spiral2 () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let cx = W/2
  let cy = cx
  let C = W/2 + (Math.random() - 0.5) * W/4
  ctx.globalAlpha = +document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 2+document.getElementById("featuresize").value/20
  ctx.lineCap = "round"
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let radius = 250, r0 = W/4 +Math.random() * 250, angle = Math.random() * 6.28
  let n = 0, end = 3000
  let shrink = W * 0.37
  let grow = W * 0.05
  ctx.beginPath();
  let inc = false, dec = false
  for (; n < end; n++) {
    radius = r0
    // make a complete circle every 50 iterations
    angle += (Math.PI * 2) / 250;
    var x = C + radius * Math.cos(angle);
    var y = C + radius * Math.sin(angle);
    ctx.lineTo(x, y);
    r0 += 0.02 + pet(2)
    let gs = distance(x,y,cx,cy)
    if (n > 151 && gs > shrink) {
      inc = false
      dec = true
    }
    if (gs < grow) {
      inc = true
      dec = false
    }
    if (inc)
      r0 += 3 + pet(0.5)
    else
    if (dec)
      r0 -= 1 + pet(0.5)
  }
  ctx.stroke();
}

function spiral3 () { // chemotaxis like
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let H = canvas.height
  let cx = W/2
  let cy = cx
  let C = W/2 + (Math.random() - 0.5) * W/4
  ctx.globalAlpha = +document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 2+document.getElementById("featuresize").value/20
  ctx.lineCap = "round"
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let radius = 50//250
  let angle = Math.random() * 6.28
  let n = 0, end = 7000
  let shrink = W * 0.37
  let grow = W * 0.05
  let turnAt = W/6+ Math.random() * W/6
  let inc = false, dec = false
  let turn = false
  let A = 0.001 + Math.random()/120
  var x = cx + radius * Math.cos(angle);
  var y = cy + radius * Math.sin(angle);
  ctx.beginPath();
  ctx.moveTo(x, y);
  for (; n < end; n++) {
    x = x + Math.sin(angle) * 1
    y = y + Math.cos(angle) * 1
    ctx.lineTo(x, y);
    let gs = distance(x,y,cx,cy)
    if (gs > turnAt) {
      turn = true
    } else
    if (gs < turnAt) {
      turn = false
    }
    if (turn)
      angle += A +pet(1)/10
    else
      angle += pet(5)/100
  }
  ctx.stroke();
}

function spiral4 () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let cx = W/2
  let cy = cx
  let C = W/2 + (Math.random() - 0.5) * W/4
  ctx.globalAlpha = +document.getElementById("opacity").value/100
  //let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 2+document.getElementById("featuresize").value/20
  ctx.lineCap = "round"
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let radius = W/4 + Math.random() * W/10
  let angle = Math.random() * 6.28
  let n = 0, end = 17000
  let turnAt = W/6+ Math.random() * W/6
  let inc = false, dec = false
  let turn = false
  let A = 0.001 + Math.random()/140
  var x = cx + radius * Math.cos(angle);
  var y = cy + radius * Math.sin(angle);
  let pf = 19
  if (grunge)
    pf = 7
  let dis = distance(x,y,C,C)
  ctx.beginPath();
  ctx.moveTo(x, y);
  for (; n < end; n++) {
    x = x + Math.sin(angle) * 1
    y = y + Math.cos(angle) * 1
    ctx.lineTo(x, y);
    let gs = distance(x,y,cx,cy) - dis
    if (gs > 0) {
      turn = true
      angle += gs/W * 0.02 + pet(1)/pf
    } else
    if (gs <= 0) {
      turn = false
      angle -= gs/W *0.02 + pet(1)/pf
    }
  }
  ctx.stroke();
}

function script () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let cx = 0
  let cy = LASTCLICK[1]//W/2 + pet(W/3)
  let C = W/2 + (Math.random() - 0.5) * W/4
  ctx.globalAlpha = +document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 2+document.getElementById("featuresize").value/20
  ctx.lineCap = "round"
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let radius = W/10 + Math.random() * W/10
  let angle = Math.random() * 6.28
  if (Math.random() > 0.5)
    angle *= -1
  let n = 0, end = 20000//17000
  var x = 10//cx + radius * Math.cos(angle);
  var y = cy //+ radius * Math.sin(angle);
  let pf = 40
  let amult = 0.01 + Math.random()/10
  let ydrift = 0.01 + Math.random()/10
  if (Math.random() > 0.5)
    ydrift *= -1
  if (grunge)
    pf = 20
  ctx.beginPath();
  ctx.moveTo(x, y);
  let avg = 0
  let gs = 1000 * Math.random()
  for (; n < end; n++) {
    x = x + Math.sin(angle) + 0.25 + pet(0.2)
    y = y + Math.cos(angle) + ydrift
    ctx.lineTo(x, y);
    if (gs > 500) {
      angle += gs/W * amult + pet(6)/pf
    } else {
      angle -= gs/W * amult + pet(6)/pf
    }
    if (Math.random() > 0.995) {
      amult = 0.01 + Math.random()/10
      ydrift *= -1
    }
    if (x > W)
      break;
  }
  ctx.stroke();
}

function drops () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
 // ctx.save()
  clip()
  let W = canvas.width
  let c = W/2
  let margin = W/20
  let w4 = (W-2*margin)/(2+Math.floor(Math.random() * 10))*8//document.getElementById("rows").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  let scale = 7+document.getElementById("featuresize").value/5
  let parts = Math.floor(W/(scale*2-1)) *1.8
  let rule = true
  if (Math.random() > 0.5)
    rule = false
  if (!grunge) {
    let t = 0
    colors = []
    for (; t < 21; t++)
      colors.push(randomColor())
  }
  let x = scale, y = 71 + pet(1)
  let i = 0, r = scale/2
  let d = 0, drift = 0
  for (; i < parts; i++) {
    let x1 = x
    let xf = 20 + Math.random() * 100
    let yf = 0.001 + Math.random()/3 * 0.002
    r = scale/2 + pet(scale/4)
    while (y < 72) {
      d = (x1-c)
      if (d < 1)
        d += -1
      drift = xf/(d+0.01)
      if (rule) {
        if (x1 > c)
          drift -= y * yf
        else
          drift += y * yf
      } else {
        if (x1 < c)
          drift -= y * yf
        else
          drift += y * yf
      }
      x1 += drift
      y += 2
      x1 += pet(1.25)
      if (r < 0.5)
        r = 0.5
      ctx.beginPath();
      ctx.moveTo(x1, y)
      ctx.arc(x1,y,1+r+pet(2) ,0,2*Math.PI)
      ctx.closePath()
      ctx.fillStyle = colors[i%colors.length]
      ctx.fill()
      r*= 0.998
    }
    x += scale * 1.05
    y = 41 + pet(41)
  }
  ctx.restore()
}

function chair () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  //clip()
  let W = canvas.width
  let H = canvas.height
  let margin = W/5
  margin = H/5 + Math.floor(Math.random() * H/5)
  
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.lineCap = "round"
  let points = []
  points[0] = [margin, W/2+margin/2]
  points[1] = [margin*2, W/2-margin+margin/2]
  points[2] = [W-margin, W/2-margin+margin/2]
  points[3] = [W-margin*2, W/2+margin/2]
  points[4] = [margin, margin*2+margin/2]
  points[5] = [margin, margin+margin/2]
  points[6] = [margin*2, 0+margin/2]
  
  points[7] = [margin, W-margin+margin/2]
  points[8] = [margin*2, W-margin*2+margin/2]
  points[9] = [W-margin, W-margin*2+margin/2]
  points[10] = [W-margin*2, W-margin+margin/2]
  
  points[11] = [W-margin, margin/2]
  
  ctx.clearRect(0,0, W,H)
  let g = 11
  if (grunge)
    g *= 2
  let i = 0
  for (; i < points.length; i++) {
    points[i][0] += pet(g)
    points[i][1] += pet(g)
  }
  
  ctx.lineCap = "round"
  ctx.strokeStyle = document.getElementById("paintcolor").value
  
  let flip = Math.random() > 0.5
  if (flip) {
    ctx.beginPath();
    ctx.moveTo(points[2][0], points[2][1])
    ctx.lineTo(points[11][0], points[11][1])
    if (grunge)
      ctx.lineWidth += pet(2)
    ctx.stroke()
    
    ctx.beginPath();
    ctx.moveTo(points[6][0], points[6][1])
    ctx.lineTo(points[11][0], points[11][1])
    if (grunge)
      ctx.lineWidth += pet(2)
    ctx.stroke()
  } else {
    ctx.beginPath();
    ctx.moveTo(points[0][0], points[0][1])
    ctx.lineTo(points[5][0], points[5][1])
    if (grunge)
      ctx.lineWidth += pet(2)
    ctx.stroke()
    
    ctx.beginPath();
    ctx.moveTo(points[5][0], points[5][1])
    ctx.lineTo(points[6][0], points[6][1])
    if (grunge)
      ctx.lineWidth += pet(2)
    ctx.stroke()
  }
  
  ctx.beginPath();
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[7][0], points[7][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[1][0], points[1][1])
  ctx.lineTo(points[8][0], points[8][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[2][0], points[2][1])
  ctx.lineTo(points[9][0], points[9][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[3][0], points[3][1])
  ctx.lineTo(points[10][0], points[10][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[1][0], points[1][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[1][0], points[1][1])
  ctx.lineTo(points[2][0], points[2][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[1][0], points[1][1])
  ctx.lineTo(points[6][0], points[6][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[2][0], points[2][1])
  ctx.lineTo(points[3][0], points[3][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[3][0], points[3][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
 // ctx.restore()
}

function point (x, y) {
  this.x = x
  this.y = y
}

function drawLine (ctx, pt1, pt2) {
  ctx.beginPath()
  ctx.moveTo(pt1.x, pt1.y)
  ctx.lineTo(pt2.x, pt2.y)
  ctx.stroke()
}
/*
function person () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineWidth = 0.5+document.getElementById("featuresize").value/10
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let W = canvas.width
  let margin = W/8
  margin = 50 + (W-2*margin)/(2+Math.floor(Math.random() * 10))//document.getElementById("rows").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 0.5+document.getElementById("featuresize").value/10
  let r = 47 + Math.random() * 11

  let points = []
  points[0] = new point(W/2 + margin/2, W/2+margin/2)
  points[1] = new point(W/2 - margin/2, W/2+margin/2)
  //armpits
  points[2] = new point(W/2 + margin/2.2, margin*1.5)
  points[3] = new point(W/2 - margin/2.2, margin*1.5)
  points[5] = new point(W/2, margin*1.5) // shoulders

  points[6] = new point(W/2, margin*0.7) // head
  //hands
  points[7] = new point(margin*1.7, W/2-margin/3)
  points[8] = new point(W - margin*1.7, W/2-margin/3)
  //elbows
  points[13] = new point(margin*1.8, W/2+margin/3)
  points[14] = new point(W - margin*1.8, W/2+margin/3)
  //legs
  points[9] = new point(W/2 + margin/3, W/2+margin/2)
  points[10] = new point(W/2 - margin/3, W/2+margin/2)
  // feet
  points[11] = new point(W/2 + margin/3, W - margin/2)
  points[12] = new point(W/2 - margin/3, W - margin/2)
  // knees
  points[15] = new point(W/2 + margin/3, W-margin*1.5)
  points[16] = new point(W/2 - margin/3, W-margin*1.5)

  // 2,3,5 get petted together
  let py = pet(24)
  let px = pet(24)
  points[2].x += px
  points[2].y += py
  points[3].x += px
  points[3].y += py
  points[5].x += px
  points[5].y += py
  
  points[0].x += pet(24)
  points[0].y += pet(24)
  points[1].x += pet(24)
  points[1].y += pet(24)
  points[6].x += pet(24)
  points[6].y += pet(24)
  points[7].x += pet(24)
  points[7].y += pet(24)
  points[8].x += pet(24)
  points[8].y += pet(24)
  points[9].x += pet(24)
  points[9].y += pet(24)
  points[10].x += pet(24)
  points[10].y += pet(24)
  points[11].x += pet(24)
  points[11].y += pet(24)
  points[12].x += pet(24)
  points[12].y += pet(24)
  points[13].x += pet(24)
  points[13].y += pet(24)
  points[14].x += pet(24)
  points[14].y += pet(24)
  points[15].x += pet(24)
  points[15].y += pet(24)
  points[16].x += pet(24)
  points[16].y += pet(24)

  drawLine(ctx, points[0], points[1])
  drawLine(ctx, points[1], points[3])
  drawLine(ctx, points[0], points[2])
  drawLine(ctx, points[2], points[8])
  drawLine(ctx, points[3], points[7])

  drawLine(ctx, points[14], points[8])
  drawLine(ctx, points[13], points[7])

  drawLine(ctx, points[9], points[15])
  drawLine(ctx, points[10], points[16])
  drawLine(ctx, points[15], points[11])
  drawLine(ctx, points[16], points[12])

  ctx.beginPath()
  ctx.arc(points[5].x, points[5].y, margin/2.2, Math.PI, 2*Math.PI)
  ctx.stroke()
  ctx.beginPath()
  ctx.ellipse(points[6].x, points[6].y,  margin/4, margin/3, pet(100)/100,  0, 2*Math.PI) //head
  ctx.stroke()
}

function lamp () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  ctx.lineWidth = 0.5+document.getElementById("featuresize").value/10
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let W = canvas.width
  let margin = W/8
  margin = 50 + (W-2*margin)/(2+Math.floor(Math.random() * 10))//document.getElementById("rows").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 0.5+document.getElementById("featuresize").value/10
  let r = 47 + Math.random() * 11

  let points = []
  points[0] = [W/2, margin]
  points[1] = [W/2, W/2]
  points[2] = [W/2, W-margin]

  points[3] = [W/2 - margin, W/2]
  points[4] = [W/2 - margin/3, margin]

  points[5] = [W/2 + margin, W/2]
  points[6] = [W/2 + margin/3, margin]

  points[7] = [W/2, W - margin]
  points[8] = [W/2, W/2-margin/2+25]

  points[9] = [W/2-20, W - 2*margin]
  points[10] = [W/2-20, W/2-margin/2+6]

  points[11] = [W/2, W/2-margin/2] //bulb

  let g = 11
  if (grunge)
    g *= 2
  let i = 0
  for (; i < points.length; i++) {
    points[i][0] += pet(g)
    points[i][1] += pet(g)
  }

  ctx.beginPath()
  ctx.moveTo(points[3][0], points[3][1])
  ctx.lineTo(points[4][0], points[4][1])
  ctx.stroke()

  ctx.beginPath()
  ctx.moveTo(points[5][0], points[5][1])
  ctx.lineTo(points[6][0], points[6][1])
  ctx.stroke()

  ctx.beginPath()
  ctx.moveTo(points[7][0], points[7][1])
  ctx.lineTo(points[8][0], points[8][1])
  ctx.stroke()

  ctx.beginPath()
  ctx.moveTo(points[9][0], points[9][1])
  ctx.lineTo(points[10][0], points[10][1]+25)
  ctx.stroke()

  ctx.beginPath()
  ctx.arc(points[9][0], points[9][1], 6+pet(3), 0, 2*Math.PI)
  ctx.stroke()

  ctx.beginPath()
  ctx.arc(points[11][0], points[11][1]-28, 54+pet(8), 0, 2*Math.PI)
  ctx.stroke()

  let radiusX = margin/3+pet(20), radiusY = margin/6+pet(10)
  ctx.beginPath()
  ctx.ellipse(points[0][0], points[0][1], radiusX, radiusY, pet(10)/100, 0, 2* Math.PI )
  ctx.stroke()

  radiusX = margin+pet(10), radiusY = margin/3+pet(20)
  ctx.beginPath()
  ctx.ellipse(points[1][0], points[1][1], radiusX, radiusY, pet(30)/100, 0, 2* Math.PI )
  ctx.stroke()

  radiusX = margin/3+pet(10), radiusY = margin/6+pet(10)
  ctx.beginPath()
  ctx.ellipse(points[2][0], points[2][1], radiusX, radiusY, pet(10)/100, 0, 2* Math.PI )
  ctx.stroke()

  ctx.beginPath()
  ctx.ellipse(points[2][0], points[2][1]+20+pet(10), radiusX, radiusY, 0, 0, 2* Math.PI )
  ctx.stroke()
}

function birdhouse () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  clip()
  let W = canvas.width
  let margin = W/5
  margin = 100 + (W-2*margin)/(2+Math.floor(Math.random() * 10))//document.getElementById("rows").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  ctx.lineWidth = 0.5+document.getElementById("featuresize").value/10
  let r = 47 + Math.random() * 11

  let points = []
  points[0] = [margin, W/2+margin/2]
  points[1] = [margin*2, W/2-margin+margin/2]
  points[2] = [W-margin, W/2-margin+margin/2]
  points[3] = [W-margin*2, W/2+margin/2]
  
  points[4] = [(W/2), margin/2] //peak
  
  points[5] = [margin, margin+margin/2]
  points[6] = [margin*2, 0+margin/2]
  
  points[7] = [margin, W-margin+margin/2]
  points[8] = [margin*2, W-margin*2+margin/2]
  points[9] = [W-margin, W-margin*2+margin/2]
  points[10] = [W-margin*2, W-margin+margin/2]
  
  points[11] = [(W-margin*2+margin)/2 , (W-margin+margin/2+W/2+margin/2)/2]
  
  let g = 11
  if (grunge)
    g *= 2
  let i = 0
  for (; i < points.length; i++) {
    points[i][0] += pet(g)
    points[i][1] += pet(g)
  }
  
  ctx.lineCap = "round"
  ctx.strokeStyle = document.getElementById("paintcolor").value
  
  let flip = Math.random() > 0.5
  
  ctx.beginPath();
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[4][0], points[4][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[1][0], points[1][1])
  ctx.lineTo(points[4][0], points[4][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[2][0], points[2][1])
  ctx.lineTo(points[4][0], points[4][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[3][0], points[3][1])
  ctx.lineTo(points[4][0], points[4][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[7][0], points[7][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[1][0], points[1][1])
  ctx.lineTo(points[8][0], points[8][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[2][0], points[2][1])
  ctx.lineTo(points[9][0], points[9][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[3][0], points[3][1])
  ctx.lineTo(points[10][0], points[10][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[1][0], points[1][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[1][0], points[1][1])
  ctx.lineTo(points[2][0], points[2][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[2][0], points[2][1])
  ctx.lineTo(points[3][0], points[3][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
   ctx.beginPath();
  ctx.moveTo(points[0][0], points[0][1])
  ctx.lineTo(points[3][0], points[3][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[9][0], points[9][1])
  ctx.lineTo(points[10][0], points[10][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()

  ctx.beginPath();
  ctx.moveTo(points[8][0], points[8][1])
  ctx.lineTo(points[9][0], points[9][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[7][0], points[7][1])
  ctx.lineTo(points[8][0], points[8][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.moveTo(points[7][0], points[7][1])
  ctx.lineTo(points[10][0], points[10][1])
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  
  ctx.beginPath();
  ctx.arc(points[11][0], points[11][1], r, 0, Math.PI * 2)
  if (grunge)
    ctx.lineWidth += pet(2)
  ctx.stroke()
  ctx.restore()
}
*/

function quads () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.height * 0.43
  let margin = R/20
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  if (document.getElementById("grungy").checked)
    colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])

  let grunge = document.getElementById("grungy").checked
  let IA = 0
 // if (grunge)
 //   IA = Math.PI * 0.25
  let x = canvas.width/2, y = canvas.height/2
  ctx.fillStyle = (colors[0])
  ctx.beginPath()
  ctx.arc(x,y,R, IA+Math.PI * 0.25, IA+Math.PI * 1.25)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.arc(x,y,R, IA+Math.PI * 1.25, IA+Math.PI * 0.25)
  ctx.closePath()
  ctx.fill()
  /*
  if (grunge) {
    ctx.fillStyle = (colors[2])
    ctx.beginPath()
    ctx.arc(x,y,R/2, Math.PI * 0, Math.PI * 2)
    ctx.closePath()
    ctx.fill()
  } else {*/
    ctx.fillStyle = (colors[2])
    ctx.beginPath()
    ctx.arc(x,y,R, IA+Math.PI * 0.75, IA+Math.PI * 1.75)
    ctx.closePath()
    ctx.fill()
    
    ctx.fillStyle = (colors[3])
    ctx.beginPath()
    ctx.arc(x,y,R, IA+Math.PI * 1.75, IA+Math.PI * 0.75)
    ctx.closePath()
    ctx.fill()
 // }
}

function venn () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.height * 0.31
  let margin = R/20
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  if (Math.random() > 0.5)
    colors = shuffle(['#ff00ff', '#ffff00', '#00ffff', '#7fff7f'])
  let inset = 20
  let grunge = document.getElementById("grungy").checked
  let IA = 0
  if (grunge)
    IA = Math.PI * 0.25
  let x = canvas.width/2, y = canvas.height/3+inset
  ctx.fillStyle = (colors[0])
  ctx.beginPath()
  ctx.arc(x,y,R, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  
  x = canvas.width/3+inset, y = 2*canvas.height/3-inset
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.arc(x,y,R, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  
  x = 2*canvas.width/3-inset, y = 2*canvas.height/3-inset
  ctx.fillStyle = (colors[3])
  ctx.beginPath()
  ctx.arc(x,y,R, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
}

function clock () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = W/2, cy = H/2
  let r1 = W/2.4, r2 = r1/2
  let today = new Date()
  let minute = today.getMinutes()
  let hour = today.getHours()*(60) + minute
  let minutescale = Math.PI*2/60
  let hourscale = Math.PI*2/(12*60)

  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.moveTo(cx, cy+pet(9))
  ctx.arc(cx+pet(9), cy, r1+pet(4), Math.PI*1.5, minutescale*minute-Math.PI/2) // minutes
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.moveTo(cx, cy)
  ctx.arc(cx, cy, r1, minutescale*minute-Math.PI/2, Math.PI*1.5) // anti minutes
  ctx.closePath()
  ctx.fill()
  
  ctx.save()
  ctx.beginPath()
  ctx.arc(cx+pet(13), cy+pet(13), r2+pet(3), 0, Math.PI*2) // anti minutes
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  
  ctx.fillStyle = (colors[3])
  ctx.beginPath()
  ctx.moveTo(cx, cy)
  ctx.arc(cx, cy, r2, Math.PI*1.5, hourscale*hour-Math.PI/2) // minutes
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[4])
  ctx.beginPath()
  ctx.moveTo(cx, cy)
  ctx.arc(cx, cy, r2, hourscale*hour-Math.PI/2, Math.PI*1.5) // anti minutes
  ctx.closePath()
  ctx.fill()
  
  let r3 = r2
  let step = (r1-r2)/4
  let a = 2 * Math.PI * Math.random()
  let i = 0
  for (; i < 5; i++) {
    
    x = cx + r3*Math.cos(a)
    y = cy + r3*Math.sin(a)
    ctx.save()
    ctx.beginPath()
    ctx.arc(x+pet(13), y+pet(8), r3/10+pet(13), 0, Math.PI*2)
    ctx.clip()
    ctx.clearRect(0,0,W,H)
    ctx.restore()
    ctx.fillStyle = randomPick(colors)
    ctx.beginPath()
    ctx.arc(x,y,r3/10 +pet(8),0,Math.PI*2)
    ctx.closePath()
    ctx.fill()
    r3 += step
    a = 2 * Math.PI * Math.random()
  }
}
function dayandnight () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = W/2, cy = cx
  let r1 = W/2.4, r2 = r1/2
 
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.moveTo(cx, cy+pet(9))
  ctx.arc(cx+pet(9), cy+pet(9), r1+pet(4), 0, Math.PI) // minutes
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.moveTo(cx, cy+pet(9))
  ctx.arc(cx+pet(9), cy+pet(9), r1+pet(4), Math.PI, Math.PI*2) // minutes
  ctx.closePath()
  ctx.fill()

  let r3 = r1/15 + (Math.random() * 10)
  i = 0
  ctx.fillStyle = colors[0]
  for (; i < 25; i++) {
    cx = W * Math.random()
    cy = H/2 * Math.random()
    x = cx //+ r3*Math.cos(a)
    y = cy //+ r3*Math.sin(a)
    ctx.save()
    ctx.beginPath()
    ctx.arc(x+pet(8), y+pet(8), r3+pet(5), 0, Math.PI*2)
    ctx.clip()
    ctx.clearRect(0,0,W,H)
    ctx.restore()
   
    ctx.beginPath()
    ctx.arc(x,y,r3+pet(5),0,Math.PI*2)
    ctx.closePath()
    ctx.fill()
    r3 = r1/(10 + (Math.random() * 20))
    a = 2 * Math.PI * Math.random()
  }
  i = 0
  ctx.fillStyle = colors[3]
  for (; i < 25; i++) {
    cx = W * Math.random()
    cy = H/2+H/2 * Math.random()
    x = cx //+ r3*Math.cos(a)
    y = cy //+ r3*Math.sin(a)
    ctx.save()
    ctx.beginPath()
    ctx.arc(x+pet(8), y+pet(8), r3+pet(5), 0, Math.PI*2)
    ctx.clip()
    ctx.clearRect(0,0,W,H)
    ctx.restore()
    ctx.beginPath()
    ctx.arc(x,y,r3+pet(5),0,Math.PI*2)
    ctx.closePath()
    ctx.fill()
    r3 = r1/(10 + (Math.random() * 20))
    a = 2 * Math.PI * Math.random()
  }
}

function floral () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let CCW = true
  let x = 200, y = 200
  let r = W/8
  let i = 0
  for (; i < 100; i++) {
    x = Math.random() * W, y = Math.random() * H
    let a = Math.random() * 2 * Math.PI
    ctx.fillStyle = randomPick(colors)
    ctx.beginPath()
    let start = Math.PI*0.75, end = start + Math.PI/2
    //ctx.moveTo(x,y)
    ctx.ellipse(x, y, r, r, a, start, end)
    ctx.ellipse(x - r*1.44, y, r, r, a, end+Math.PI/2, end+Math.PI)
    ctx.closePath()
    ctx.fill()
  }
}

function system () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let pad = W/20 - pet(30)
  let points = randomPick([90,18,31,33,50,52,56,76,43,44,45])
  ctx.fillStyle = colors[1]
  ctx.clearRect(0,0,W,H)
  ctx.fillStyle = colors[2]
  let incs = (Math.PI* 2)/(points*2)
  let r1 = W/8, r2 = r1/1.2+pet(30)
  let a = 0, cx = W/4, cy = H/4
  let i = 1, maxp = points*2
  ctx.beginPath()
  let x = cx + r1 * Math.cos(a),
      y = cy + r1 * Math.sin(a)
  ctx.moveTo(x,y)
  for (; i < maxp; i++) {
    let r = (i % 2 === 0)? r1: r2;
    a += incs
    x = cx + r * Math.cos(a)
    y = cy + r * Math.sin(a)
    ctx.lineTo(x,y)
  }
  ctx.closePath()
  ctx.fill()
  ctx.save()
  ctx.beginPath()
  ctx.arc(cx+pet(13), cy+pet(13), r2+pet(3), 0, Math.PI*2) // anti minutes
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  ctx.fillStyle = colors[3]
  ctx.beginPath()
  ctx.arc(cx,cy,r2,0,Math.PI*2)
  ctx.closePath()
  ctx.fill()
  
  i = 0//, cy += H/7
  for (; i < 3; i++) {
   // cy += H/6
    cy += r2 * 2.5
    r2 /= 1.4 //+ pet(16)
    ctx.beginPath()
    x = cx + r1 * Math.cos(a),
    y = cy + r1 * Math.sin(a)
    ctx.save()
    ctx.beginPath()
    ctx.arc(cx+pet(13), cy+pet(13), r2+pet(3), 0, Math.PI*2) // anti minutes
    ctx.clip()
    ctx.clearRect(0,0,W,H)
    ctx.restore()
    ctx.fillStyle = randomPick(colors)
    ctx.beginPath()
    ctx.arc(cx,cy,r2,0,Math.PI*2)
    ctx.closePath()
    ctx.fill()
  }
  
  cx = 3*W/4, cy = 2*r1/1.2, i = 0
  for (; i < 5; i++) {
    r2 = 7 + Math.random() * 5
    if (i > 2)
      r2 *= 1.5
    ctx.beginPath()
    x = cx + r1 * Math.cos(a),
    y = cy + r1 * Math.sin(a)
   
    ctx.save()
    ctx.beginPath()
    ctx.arc(cx+pet(13), cy+pet(13), r2+pet(3), 0, Math.PI*2) // anti minutes
    ctx.clip()
    ctx.clearRect(0,0,W,H)
    ctx.restore()
    ctx.fillStyle = randomPick(colors)
    ctx.beginPath()
    ctx.arc(cx,cy,r2,0,Math.PI*2)
    ctx.closePath()
    ctx.fill()
    cy += H/6

  }
}

function star () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let pad = W/20 - pet(30)
  let points = randomPick([180, 100, 90, 18,31,33,20,21,22,76,43,44,45])
  ctx.fillStyle = colors[1]
  ctx.clearRect(0,0,W,H)
  ctx.fillStyle = colors[2]
  let incs = (Math.PI* 2)/(points*2)
  let r1 = W/2.5, r2 = r1/1.6+pet(90)
  let a = 0, cx = W/2, cy = H/2
  let i = 1, maxp = points*2
  ctx.beginPath()
  let x = cx + r1 * Math.cos(a),
      y = cy + r1 * Math.sin(a)
  ctx.moveTo(x,y)
  for (; i < maxp; i++) {
    let r = (i % 2 === 0)? r1: r2;
    a += incs
    x = cx + r * Math.cos(a)
    y = cy + r * Math.sin(a)
    ctx.lineTo(x,y)
  }
  ctx.closePath()
  ctx.fill()
  ctx.save()
  ctx.beginPath()
  ctx.arc(cx+pet(13), cy+pet(13), r2+pet(3), 0, Math.PI*2) // anti minutes
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  ctx.fillStyle = colors[3]
  ctx.beginPath()
  ctx.arc(cx,cy,r2,0,Math.PI*2)
  ctx.closePath()
  ctx.fill()
  if (document.getElementById("grungy").checked) {
    document.getElementById("caption").value = randomPick(placenames_stars)
    document.getElementById("paintcolor").value = colors[0]
    caption()
  }
}

function makePalette () {
  let canvas = document.getElementById("palettecanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let alt = document.getElementById("grungy").checked
  let colors = getCurrentPalette()
  if (ctx.globalAlpha == 1)
    alert("Set opacity to < 1.0 for remix.")
  let mixcolor = document.getElementById("paintcolor").value
  if (!alt) {
    ctx.fillStyle = mixcolor // mix with paintcolor
    ctx.fillRect(0,0,W,H)
    ctx.fillStyle = colors[0]
    ctx.fillRect(0, 0, W/5, H)
    ctx.fillStyle = colors[1]
    ctx.fillRect(W/5, 0, W/5, H)
    ctx.fillStyle = colors[2]
    ctx.fillRect(2*W/5, 0, W/5, H)
    ctx.fillStyle = colors[3]
    ctx.fillRect(3*W/5, 0, W/5, H)
    ctx.fillStyle = colors[4]
    ctx.fillRect(4*W/5, 0, W/5, H)
  } else {
    //color = shuffle(colors) // internal mix
    ctx.fillStyle = colors[0]
    ctx.fillRect(0, 0, W, H)
    ctx.fillStyle = colors[1]
    ctx.fillRect(W/5, 0, W, H)
    ctx.fillStyle = colors[2]
    ctx.fillRect(2*W/5, 0, W, H)
    ctx.fillStyle = colors[3]
    ctx.fillRect(3*W/5, 0, W, H)
    ctx.fillStyle = colors[4]
    ctx.fillRect(4*W/5, 0, W, H)
  }
  extractPalette(canvas)
}

function waves () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  inc = ctx.lineWidth * 2
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let color = document.getElementById("paintcolor").value
  let pad = 0
  let x = pad, y = -20//pad
  ctx.strokeStyle = color
  ctx.fillStyle = color
  let i = 0, offset = 0
  while (y < H+40) {
    ctx.beginPath()
    ctx.moveTo(x,y)
    while (x < W - pad) {
      x += 3
      y = y + Math.sin((x+offset)/inc) * 2
      ctx.lineTo(x,y)
    }
    ctx.stroke()
    y += inc
    x = pad
    //offset += inc * 8
  }
}

function rings () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let pad = W/20 - pet(30)
  ctx.fillStyle = colors[1]
  ctx.clearRect(0,0,W,H)
  ctx.fillStyle = colors[2]
  ctx.clearRect(pad,pad,W-pad*2,H-pad*2)

  let r = H*0.75 + pet(200), r2 = r*(0.6 + (Math.random()/3))
  let x = W/2 + pet(W/1.2), y = H + H/9
 
  let i = 0
  
  // fill center
  ctx.fillStyle = randomPick(colors)
  ctx.beginPath()
  ctx.arc(x, y, r2 * 0.5, 2*Math.PI, 0)
  ctx.closePath()
  ctx.fill()
    
  for ( ; i < 3; i++) {
    ctx.fillStyle = randomPick(colors)
    ctx.beginPath()
    ctx.arc(x,y,r,Math.PI, 0)
    ctx.arc(x,y,r2,0, Math.PI, true)
    ctx.closePath()
    ctx.fill()
    r = r2 * 0.95
    r2 = r * 0.8
  }
  i = 0
  for (; i < 5; i++) {
    y = Math.random() * H
    x = Math.random() * W
    r = 25+pet(10)
    ctx.save()
    ctx.beginPath()
    ctx.arc(x+pet(13), y+pet(13), r+2+pet(7), 0, Math.PI*2) // anti minutes
    ctx.clip()
    ctx.clearRect(0,0,W,H)
    ctx.restore()
    ctx.fillStyle = randomPick(colors)
    ctx.beginPath()
    ctx.arc(x,y,r+pet(7),0,Math.PI*2)
    ctx.closePath()
    ctx.fill()
  }
}

function planet () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let pad = W/20 - pet(30)
  
  ctx.fillStyle = colors[1]
  ctx.clearRect(0,0,W,H)
  ctx.fillStyle = colors[2]
  
  ctx.clearRect(pad,pad,W-pad*2,H-pad*2)

  ctx.fillRect(pad+pet(13), pad+pet(13), W-pad*2+pet(13), H-pad*2+pet(13))
  let r = (H - 3 * pad)/2.9
  let x = W/2, y = 1.3*pad + r
  
  ctx.save()
  ctx.beginPath()
  ctx.arc(x+pet(13), y+pet(13), r+pet(3), 0, Math.PI*2) // anti minutes
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  ctx.fillStyle = colors[3] // clip each arc
  ctx.beginPath()
  ctx.arc(x,y,r,0,Math.PI*2)
  ctx.closePath()
  ctx.fill()
  
  y = H - pad*3.2
  x = W/4
  ctx.save()
  ctx.beginPath()
  ctx.arc(x+pet(13), y+pet(13), r/7+pet(3), 0, Math.PI*2) // anti minutes
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  
  ctx.fillStyle = colors[4]
  ctx.beginPath()
  ctx.arc(x,y,r/7,0,Math.PI*2)
  ctx.closePath()
  ctx.fill()
  
  y = H - pad*2.4
  x = W/2
  ctx.save()
  ctx.beginPath()
  ctx.arc(x+pet(13), y+pet(13), r/12+pet(3), 0, Math.PI*2) // anti minutes
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  ctx.fillStyle = colors[0]
  ctx.beginPath()
  ctx.arc(x,y,r/12,0,Math.PI*2)
  ctx.closePath()
  ctx.fill()
  
  y = H - pad*3.2
  x = W-W/4
  ctx.save()
  ctx.beginPath()
  ctx.arc(x+pet(13), y+pet(13), r/19+pet(3), 0, Math.PI*2) // anti minutes
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  ctx.fillStyle = colors[1]
  ctx.beginPath()
  ctx.arc(x,y,r/19,0,Math.PI*2)
  ctx.closePath()
  ctx.fill()
}

function bust () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let CCW = true
  let x = 0, y =  H/2, cx, cy
  let r = W/6
  
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
 // ctx.moveTo(W, H)
 // ctx.lineTo(0,H) // left bottom
  // control point first
  x = 50
  y =  H/2
  cx = 100
  cy = H/3
  ctx.moveTo(0,H)
  ctx.quadraticCurveTo(cx, cy, 2*W/5, H/2)
  ctx.arc(2*W/5, H/2, 250, Math.PI*0.75, Math.PI*0.25)
  cx = W-100
  
  ctx.quadraticCurveTo(cx, cy, 4*W/5, H)

  x = W
  y = H/2
  cx = W
  cy = H

 // ctx.quadraticCurveTo(cx, cy, x, y)

  ctx.lineTo(W, H)

  ctx.closePath()
  ctx.fill()
}

function bust__ () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let CCW = true
  let x = 0, y = H - H/6 + 30
  let r = W/6
  
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.moveTo(W, H)
  ctx.lineTo(0,H)
  ctx.lineTo(0,y)
  x = W/6
  ctx.arc(x, y, r, Math.PI, Math.PI * 1.5) // left shoulder
  x = W/2-W/3
  y = H/2 + 30
  ctx.arc(x, y, r, Math.PI/2, 0, CCW) // left neck

  /*x = W/2
  y = H/2- 60
  ctx.arc(x, y, r*1.05, Math.PI, 0, CCW) // chin*/
  x = W/2, y = H/3
   // ctx.beginPath()
  ctx.ellipse(x, y, r*1.2, r*1.7, 0, Math.PI * 0.8, Math.PI * 0.2)
  x = W/2+W/3

  y = H/2 + 30
  ctx.arc(x, y, r, Math.PI, Math.PI/2, CCW)  // right neck
  
  x = W-W/6, y = H - H/6+30
  ctx.arc(x, y, r, Math.PI*1.5, 0) // right shoulder
  ctx.closePath()
  ctx.lineTo(W,H)
  ctx.fill()

   // lower face
    x = W/2, y = H/3
    ctx.beginPath()
    ctx.ellipse(x, y, r*1.2, r*1.7, 0, Math.PI * 0.8, Math.PI * 0.2)
    ctx.closePath()
   // ctx.fill()
    /*
x = W/2, y =  r + r/2
    ctx.beginPath()
    ctx.arc(x, y, r, Math.PI, 0) // right shoulder
    ctx.closePath()
    ctx.fill()*/
}

function seasons () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.height * 0.15, r = R*2
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let a = Math.random() * 2 * Math.PI

  let R2 = R*0.7
  //sun
  /*
  ctx.lineWidth = 10
  ctx.setLineDash([28, 28]);
  ctx.strokeStyle = colors[3]
  ctx.beginPath()
  //ctx.arc(cx, cy, R*2.3, 0, Math.PI * 2)
  ctx.ellipse(cx, cy, R*2.3, R*1.5, 0, 0, Math.PI*2);
  ctx.stroke()*/
  
  // bottomr disc
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.arc(cx, cy/1.8, R2, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(cx, cy/1.8, R2, 0, Math.PI*3)
  ctx.closePath()
  ctx.fill()
  //moon
  
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.arc(canvas.width - cx/3, cy, R2, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(canvas.width - cx/3, cy, R2, Math.PI*0.75, Math.PI * 1.75)
  ctx.closePath()
  ctx.fill()
  // sun
  ctx.fillStyle = colors[0]
  ctx.beginPath()
  ctx.arc(cx, cy, R, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.arc(cx/3, cy, R2, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(cx/3, cy, R2, Math.PI*1.75, Math.PI * 0.75)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.arc(cx, canvas.height - cy/1.8, R2, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function phases () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())//['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let a = Math.random() * 2 * Math.PI
  let R = canvas.height * 0.1, r = R*2
  let R2 = R
  
  // background
  let R3 = R+r
  
  // left disc
  ctx.fillStyle = colors[2]
  ctx.beginPath()
  ctx.arc(-R/4, cy, R+r, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  // bottomr disc
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(cx+cx/3, cy, R2, Math.PI/2, Math.PI * 1.5)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = (colors[3])
  ctx.beginPath()
  ctx.arc(cx+cx/3, cy, R2, Math.PI * 1.5, Math.PI/2)
  ctx.closePath()
  ctx.fill()
  //moons
  R2 *= 0.4
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(cx+cx/3, cy+cy/3, R2, Math.PI/2, Math.PI * 1.5)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = (colors[3])
  ctx.beginPath()
  ctx.arc(cx+cx/3, cy+cy/3, R2, Math.PI * 1.5, Math.PI/2)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(cx+cx/3, cy-cy/3, R2, Math.PI/2, Math.PI * 1.5)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = (colors[3])
  ctx.beginPath()
  ctx.arc(cx+cx/3, cy-cy/3, R2, Math.PI * 1.5, Math.PI/2)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(cx+2*cx/3, cy, R2, Math.PI/2, Math.PI * 1.5)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = (colors[3])
  ctx.beginPath()
  ctx.arc(cx+2*cx/3, cy, R2, Math.PI * 1.5, Math.PI/2)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(cx, cy, R2, Math.PI/2, Math.PI * 1.5)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = (colors[3])
  ctx.beginPath()
  ctx.arc(cx, cy, R2, Math.PI * 1.5, Math.PI/2)
  ctx.closePath()
  ctx.fill()
  
  // phases across top
  y = canvas.height/10
  x = 80, mult = 1.0
  let i = 0
  for (; i < 5; i++) {
    ctx.fillStyle = (colors[2])
    ctx.beginPath()
    ctx.ellipse(x, y, R2*mult, R2, 0, Math.PI * 1.5, Math.PI/2)
    ctx.ellipse(x, y, R2, R2, 0, Math.PI/2, Math.PI * 1.5, true)
    ctx.closePath()
    ctx.fill()
    
    ctx.fillStyle = (colors[3])
    ctx.beginPath()
    ctx.ellipse(x, y, R2, R2, 0, Math.PI/2, Math.PI * 1.5)
    ctx.ellipse(x, y, R2*mult, R2, 0, Math.PI * 1.5, Math.PI/2)
    ctx.closePath()
    ctx.fill()
    x += R2 * 3
    mult -= 0.25
  }
  
  i = 0, mult = 0.25
  for (; i < 3; i++) {
    ctx.fillStyle = (colors[3])
    ctx.beginPath()
    ctx.ellipse(x, y, R2*mult, R2, 0, Math.PI/2, Math.PI * 1.5)
    ctx.ellipse(x, y, R2, R2, 0, Math.PI * 1.5, Math.PI/2, true)
    ctx.closePath()
    ctx.fill()
    
    ctx.fillStyle = (colors[2])
    ctx.beginPath()
    ctx.ellipse(x, y, R2, R2, 0, Math.PI * 1.5, Math.PI/2)
    ctx.ellipse(x, y, R2*mult, R2, 0, Math.PI/2, Math.PI * 1.5)
    ctx.closePath()
    ctx.fill()
    x += R2 * 3
    mult += 0.25
  }
  
  i = 0, x = 80, y = canvas.height - canvas.height/10, mult = 1.0
  for (; i < 5; i++) {
    ctx.fillStyle = (colors[3])
    ctx.beginPath()
    ctx.ellipse(x, y, R2*mult, R2, 0, Math.PI * 1.5, Math.PI/2)
    ctx.ellipse(x, y, R2, R2, 0, Math.PI/2, Math.PI * 1.5, true)
    ctx.closePath()
    ctx.fill()
    
    ctx.fillStyle = (colors[2])
    ctx.beginPath()
    ctx.ellipse(x, y, R2, R2, 0, Math.PI/2, Math.PI * 1.5)
    ctx.ellipse(x, y, R2*mult, R2, 0, Math.PI * 1.5, Math.PI/2)
    ctx.closePath()
    ctx.fill()
    x += R2 * 3
    mult -= 0.25
  }
    
  i = 0, mult = 0.25
  for (; i < 3; i++) {
    ctx.fillStyle = (colors[2])
    ctx.beginPath()
    ctx.ellipse(x, y, R2*mult, R2, 0, Math.PI/2, Math.PI * 1.5)
    ctx.ellipse(x, y, R2, R2, 0, Math.PI * 1.5, Math.PI/2, true)
    ctx.closePath()
    ctx.fill()
    
    ctx.fillStyle = (colors[3])
    ctx.beginPath()
    ctx.ellipse(x, y, R2, R2, 0, Math.PI * 1.5, Math.PI/2)
    ctx.ellipse(x, y, R2*mult, R2, 0, Math.PI/2, Math.PI * 1.5)

    ctx.closePath()
    ctx.fill()
    x += R2 * 3
    mult += 0.25
  }
  
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function tides () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/4, x = 0, y = 0
  let a = Math.random() * 2 * Math.PI
  let R = canvas.height * 0.24
  let R2 = R/2
  let moon = randomPick([1,2])
  // background
  let k = 0
  for (; k < 2; k++) {
    let R3 = R
    //ctx.fillStyle = (colors[4])
    ctx.beginPath()
    ctx.moveTo(0,cy-R3)
    ctx.lineTo(0,cy+R3)
    ctx.lineTo(canvas.width,cy+R3)
    ctx.lineTo(canvas.width,cy-R3)
    ctx.closePath()
   // ctx.fill()
    // sun
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.arc(-R/4, cy, R, 0, Math.PI * 2)
    ctx.closePath()
    ctx.fill()
    // earth
    let rotation = 0, mult = 0.9
    if (moon === 3 || moon === 4) // plane of sun
      rotation = Math.PI/2
    
    // moon tide
    ctx.fillStyle = (colors[2])
    ctx.beginPath()
    ctx.ellipse(cx+cx/3, cy, R2*0.8, R2*1.3, rotation, 0, Math.PI * 2)
    ctx.closePath()
    ctx.fill()
    // solar tide
    rotation = Math.PI/2
    ctx.fillStyle = (colors[0])
    ctx.beginPath()
    ctx.ellipse(cx+cx/3, cy, R2*0.8, R2*1.0, rotation, 0, Math.PI * 2)
    ctx.closePath()
    ctx.fill()
    
    // earth
    ctx.fillStyle = (colors[1])
    ctx.beginPath()
    ctx.arc(cx+cx/3, cy, R2*0.7, 0, Math.PI * 2)
    ctx.closePath()
    ctx.fill()
    
    //moons
    R3 = R2 * 0.3
    if (moon === 1) { // bottom
      ctx.fillStyle = (colors[2])
      ctx.beginPath()
      ctx.arc(cx+cx/3, cy+R2*1.3+70, R3, 0, Math.PI * 2)
      ctx.closePath()
      ctx.fill()
    }
    if (moon === 2) { // top
      ctx.fillStyle = (colors[2])
      ctx.beginPath()
      ctx.arc(cx+cx/3, cy-R2*1.3-70, R3, 0, Math.PI * 2)
      ctx.closePath()
      ctx.fill()
    }
    
    if (moon === 3) { // right
      ctx.fillStyle = (colors[2])
      ctx.beginPath()
      ctx.arc(cx+2*cx/3+80, cy, R3, 0, Math.PI * 2)
      ctx.closePath()
      ctx.fill()
    }
    if (moon === 4) {  //left
      ctx.fillStyle = (colors[2])
      ctx.beginPath()
      ctx.arc(cx-80, cy, R3, 0, Math.PI * 2)
      ctx.closePath()
      ctx.fill()
    }
    moon = randomPick([3,4])
    cy = canvas.height - canvas.height/4
  }
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function nudgehalfdown () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  clearOff()
  copyToOff()
  document.getElementById("rednumber").value = canvas.width/2
  LASTCLICK[0] = canvas.width/2
  leftClip()
  swapWithOff()
  flipH()
  leftClip()
  document.getElementById("rednumber").value = 10
  nudgeRight()
  flipH()
  swapWithOff()
  document.getElementById("rednumber").value = 30
  nudgeDown()
  let a = document.getElementById("opacity")
  document.getElementById("opacity").value = 100
  pasteFromOff()
  document.getElementById("opacity").value = a
}

function network () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 2+document.getElementById("featuresize").value/5
  ctx.lineCap = "round"
  let H  = canvas.height, W = canvas.width
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let colors = getCurrentPalette()
  if (document.getElementById("grungy").checked)
    colors = [document.getElementById("paintcolor").value]
  colors = shuffle(colors)
  ctx.strokeStyle = colors[0]
  let i = 0, numpoints = randomPick([6,7,8])
  let x = 0, y = 0
  let r = W/4 * 0.8
  let cx = W/4, cy = H/4
  let s = 0
  for (; s < 4; i++) {
    let points = []
    let a = Math.random() * 2 * Math.PI
    i = 0
    while (i < numpoints) {
      x = cx + r * Math.cos(a)
      y = cy + r * Math.sin(a)
      points.push([x+pet(9), y+pet(9)])
      a += Math.PI * 2/numpoints
      i++
    }
    let j = 0
    i = 0
    for (;i < points.length; i++) {
      j = i + 1
      for (; j < points.length; j++) {
        if (Math.random() < 0.2) {
          ctx.beginPath()
          ctx.moveTo(points[i][0], points[i][1])
          ctx.lineTo(points[j][0], points[j][1])
          ctx.stroke()
        }
      }
    }
    cx += W/2
    if (cx > W) {
      cy += H/2
      cx = W/4
    }
    s++
  }
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function constellations () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 5//+ document.getElementById("featuresize").value/4
  ctx.lineCap = "round"
  let rads = [3,4,5,6,7,8,3,4,5,6,7,8,13]
  let widths = [1,2,3, 4, 5]
  let H  = canvas.height, W = canvas.width
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let colors = getCurrentPalette()
  colors = shuffle(colors)
  let points = []
  let i = 0, numpoints = randomPick([27,37,47])
  let x = 0, y = 0
  let Rf = W/7
  let mindist = Rf/1.1
  numpoints = (W/Rf*H/Rf) * 2
  let row = 0
  while (i < numpoints) {
   // if (Math.random() > 0.41)
      points.push([W*Math.random(), H*Math.random(), 0])
    i++
  }
  let j = 0
  i = 0
  ctx.strokeStyle = colors[0]
  for (;i < points.length; i++) {
    j = i + 1
    for (; j < points.length; j++) {
      if (distance(points[i][0],points[i][1],points[j][0],points[j][1]) < mindist*1.3) {
        ctx.lineWidth = randomPick(widths)
        if (points[j][2] < 2 && points[i][2] < 4) {
          ctx.beginPath()
          ctx.moveTo(points[i][0], points[i][1])
          ctx.lineTo(points[j][0], points[j][1])
          ctx.stroke()
          points[j][2] += 1
          points[i][2] += 1
        }
      }
    }
  }
  i = 0
  ctx.fillStyle = colors[1]
  while (i < points.length) {
    ctx.beginPath()
    ctx.arc(points[i][0], points[i][1], randomPick(rads), 0, Math.PI * 2)
    ctx.closePath()
    ctx.fill()
    i++
  }
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function glass () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.width * 0.3
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  if (document.getElementById("grungy").checked)
    colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let a = Math.random() * 2 * Math.PI
  let pad = 50
  let R2 = R/2
 
  // top
  let height = cy*0.4
  r = (canvas.height + height*-0.5) * 0.3
  ctx.fillStyle = (colors[3])
  ctx.beginPath()
  ctx.ellipse(cx, height, r, r/2, 0, Math.PI, 2 * Math.PI)
  //bottom
  height = canvas.height*0.85
  r = (canvas.height + height*-0.5) * 0.3
  ctx.ellipse(cx, height, r, r/2, 0,  0, Math.PI)
  ctx.closePath()
  ctx.fill()

  ctx.globalAlpha /= 2
  height = cy*0.4
  r = (canvas.height + height*-0.5) * 0.3
  ctx.beginPath()
  ctx.ellipse(cx, height, r, r/2, 0, 0, Math.PI)
  height = canvas.height*0.85
  r = (canvas.height + height*-0.5) * 0.3
  ctx.ellipse(cx, height, r, r/2, 0,  Math.PI, 0, true)
  ctx.closePath()
  ctx.fill()
  ctx.globalAlpha = alpha/10*20

  // fill
  ctx.fillStyle = (colors[0])
  ctx.beginPath()
  height = cy+pet(cy*1.2)
  let savedheight = height
  r = (canvas.height + height*-0.5) * 0.28 // slightly smaller
  ctx.ellipse(cx, height, r, r/2, 0, Math.PI, 2 * Math.PI) // level -> top of filled
  height = canvas.height*0.83
  r = (canvas.height + height*-0.5) * 0.28 // bottom of glass
  ctx.ellipse(cx, height, r, r/2, 0, 0, Math.PI)
  ctx.closePath()
  ctx.fill()
  ctx.globalAlpha /= 2

  ctx.beginPath()
  height = savedheight
  r = (canvas.height + height*-0.5) * 0.28 // slightly smaller
  ctx.ellipse(cx, height, r, r/2, 0, 0, 2 * Math.PI) // level -> top of filled
  ctx.closePath()
  ctx.fill()
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}


function braid () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 16//1 + Math.floor(document.getElementById("featuresize").value/10)
  //let R = canvas.width * 0.3
  let W = canvas.width, H = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let hip = canvas.width * 0.85
  let waist = canvas.width - hip *0.9
  let div = 1 + Math.random() * 5
  let height = 0
  let savedheight = 0
  // fill
  ctx.lineJoin = "round"
  ctx.strokeStyle = (colors[0])
  height = cy+pet(cy*1.2)
  let r = hip/6
  let savedr = r
  y = H - hip/4

  savedy = y
  //left shoulder
  ctx.beginPath()
  ctx.moveTo(hip/8, H)
  ctx.ellipse(hip/8+r, y, r, r, 0, Math.PI, 1.5 * Math.PI)
  ctx.stroke()
  
  //left neck
  
  ctx.beginPath()
  ctx.ellipse(hip/8+2*r/2, y-r*2, r, r, 0, Math.PI/2, 0, true)
  ctx.lineTo(hip/8+2*r/2+r, 0)
  ctx.stroke()
  
  // second strand
  ctx.strokeStyle = (colors[1])

  ctx.beginPath()
  
  ctx.moveTo(hip/8+2*r/2+r, H)
  console.log(H-y, y)
  ctx.ellipse(hip/8+r, y, r, r, 0, 0, 1.5 * Math.PI, true)
  ctx.stroke()
  
  ctx.beginPath()
  ctx.ellipse(hip/8+2*r/2, y-r*2, r, r, 0, Math.PI/2, Math.PI)
  ctx.lineTo(hip/8, 0)
  ctx.stroke()
  
}
function user () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  //let R = canvas.width * 0.3
  let W = canvas.width, H = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let hip = canvas.width * 0.8
  let div = 1 + Math.random() * 5
  let height = 0
  let savedheight = 0
  // fill
  ctx.lineJoin = "round"
  ctx.strokeStyle = (colors[0])
  height = cy+pet(cy*1.2)
  let r = hip/6
  let savedr = r
  y = H - hip/4

  savedy = y
  //left shoulder
  ctx.beginPath()
  ctx.moveTo(hip/8, H)
  ctx.ellipse(hip/8+r, y, r, r, 0, Math.PI, 1.5 * Math.PI)
  ctx.stroke()
  
  //left neck
  ctx.beginPath()
  ctx.ellipse(hip/8+2*r/2, y-r*2, r, r, 0, Math.PI/2, 0, true)
 // ctx.lineTo( hip/8+2*r/2+r, r*2)
  ctx.ellipse(hip/8+2*r/2+r*2, r*2.6 +Math.floor(Math.random()*40), r, r, 0, Math.PI, Math.PI*2)
 // ctx.lineTo( hip/8+2*r/2 + r*3, y-r*2)

  ctx.ellipse(hip/8+2*r/2 + r*4, y-r*2, r, r, 0, Math.PI, Math.PI/2, true)

  ctx.ellipse(hip/8+2*r/2 + r*4, y, r, r, 0, Math.PI * 1.5, 0)
  ctx.lineTo(hip/8+2*r/2 + r*5, H)
  ctx.stroke()
  
  // top of head
}

function blocksX () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 4 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  //let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let H = canvas.height, W = canvas.width
  let cx = W/2, cy = H/2, x = 0, y = 0
  
  ctx.fillStyle = colors[0]
  ctx.fillRect(0,0,W,H)

  ctx.fillStyle = randomPick([colors[1]])
  ctx.fillRect(pet(300),pet(160),W*0.96,H/2)
  
  ctx.fillStyle = randomPick([colors[1]])
  ctx.fillRect(pet(300),cy+pet(160),W*0.96,H/2)
  
  ctx.fillStyle = randomPick([colors[0], colors[0]])
  ctx.fillRect(cx+pet(200),H*0.1+pet(120),W*0.8+pet(100),H*0.8+pet(100))

 // ctx.fillStyle = randomPick([colors[1], colors[0]])
 // ctx.fillRect(cx+pet(100),cy+pet(80),W/2,H*0.48)


  if (Math.random() > 0.5)
    flipV()
  if (Math.random() > 0.5)
    rc()
  if (Math.random() > 0.5)
    rc()


}

function blocks () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 4 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  //let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let H = canvas.height, W = canvas.width
  let cx = W/2, cy = H/2, x = 0, y = 0
  
  ctx.fillStyle = colors[0]
  ctx.fillRect(0,0,W,H)

  ctx.fillStyle = colors[1]
  ctx.fillRect(pet(100),pet(80),W*0.96,H/2)
  ctx.fillRect(pet(100),cy+pet(80),W*0.96,H/2)
  
  ctx.fillStyle = colors[0]
  ctx.fillRect(W*0.1+pet(80),H*0.1+pet(120),W*0.8+pet(100),H*0.8+pet(100))

  if (Math.random() > 0.5)
    flipV()
  if (Math.random() > 0.5)
    rc()
  if (Math.random() > 0.5)
    rc()


}

function foldings () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 4 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.lineWidth *= 1.6
  //ctx.lineJoin = "bevel"
  //let R = canvas.width * 0.3
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let H = canvas.height, W = canvas.width
  let cx = 2*W/3, cy = H/2, x = 0, y = 0
  let pad = 0//H/20
  ctx.strokeStyle = colors[0]
  ctx.fillStyle = colors[1]
  let r = W/9 + Math.random() * W/12
  
  ctx.fillRect(pad,pad,W-2*pad,H-2*pad)
  
  pad = 80
  ctx.beginPath()
  ctx.moveTo(cx/2+pad, cy/2+pad*2)
  ctx.lineTo(pad*2, cy/4+pad*2)
  ctx.lineTo(cx/2+pad, pad*2)
  ctx.stroke()
  
  ctx.beginPath()
  ctx.moveTo(pad*2, cy)
  ctx.lineTo(pad*2, H-pad)
  ctx.stroke()

  ctx.strokeStyle = colors[2]

  ctx.beginPath()
  ctx.moveTo(cx/2, pad+cy) // start
  ctx.lineTo(cx, pad+cy) // top right
  ctx.lineTo(cx, cy*2-pad) // bottom right
  ctx.lineTo(cx/2, cy*2-pad) // bottom right
  ctx.stroke()
  
  ctx.strokeStyle = randomPick(colors)
  ctx.lineWidth *= 1.5
  ctx.beginPath()
  ctx.moveTo(W-pad*2, pad) // start
  ctx.lineTo(W-pad*2, H-pad)
  ctx.stroke()
  
  if (Math.random() > 0.5)
    flipV()
  if (Math.random() > 0.5)
    rc()
  if (Math.random() > 0.5)
    rcc()
    
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}


function arch () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 4 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.lineWidth *= 1.6
  //let R = canvas.width * 0.3
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let H = canvas.height, W = canvas.width
  let cx = 2*W/3, cy = H/2, x = 0, y = 0
  let pad = 0//H/20
  ctx.strokeStyle = colors[0]
  ctx.fillStyle = colors[1]
  let r = W/9 + Math.random() * W/12
  
  ctx.fillRect(pad,pad,W-2*pad,H-2*pad)
  
  if (Math.random() > 0.5) {
    ctx.fillStyle = colors[2]
    ctx.beginPath()
    ctx.arc(cx+pet(5), cy+pet(5)-cy/3, r-2-pet(3), 0, Math.PI*2)
    ctx.closePath()
    ctx.fill()
  } else {
    ctx.fillStyle = colors[2]
    ctx.fillRect(cx+pet(7)-r, H-cy/3-r*2+pet(7), r*2+pet(7), r*2+pet(7)-ctx.lineWidth/2)
  }
  ctx.beginPath()
  ctx.arc(cx, cy-cy/3 , r+ctx.lineWidth/2, Math.PI,Math.PI*2)
  ctx.stroke()
  
  ctx.beginPath()
  ctx.moveTo(cx-r, H-cy/3)
  ctx.lineTo(cx+r+ctx.lineWidth/2, H-cy/3)
  ctx.lineTo(cx+r + ctx.lineWidth/2, cy-cy/3)//-ctx.lineWidth)
  ctx.stroke()
  
  cx = W/4

  ctx.strokeStyle = randomPick(colors)
  ctx.beginPath()
  ctx.moveTo(cx-r/2, cy/3-ctx.lineWidth/2)
  ctx.lineTo(cx-r/2, H-cy/3+ctx.lineWidth/2)
  ctx.stroke()
  
  ctx.beginPath()
  ctx.moveTo(cx-r/2, cy/3)
  ctx.lineTo(cx+ctx.lineWidth/2, cy/3)
  ctx.stroke()
  
  if (Math.random() > 0.5)
    flipV()
  if (Math.random() > 0.5)
    rc()
  if (Math.random() > 0.5)
    rcc()
  
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function venus () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  //let R = canvas.width * 0.3
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let hip = canvas.width * 0.76
  let waist = canvas.width - hip *0.9
  let div = 1 + Math.random() * 5
  let height = 0
  let savedheight = 0
  // fill
  ctx.lineJoin = "round"
  ctx.lineCap = "round"
  ctx.strokeStyle = (colors[0])
  height = cy+pet(cy*1.2)
  let r = hip/9
  let savedr = r
  let DY = 30, DX = 100
  y = cy + r
  
  ctx.beginPath()
  
  ctx.ellipse(cx-r*2+35+DX, canvas.height+r+DY, r*2, r*3.5, 0, Math.PI, Math.PI * 1.35) // left hip

  ctx.ellipse(hip/4+r/2+DX, y+r+DY, r*0.85, r*0.50, -Math.PI/10, Math.PI/2, Math.PI)   // left arm
  ctx.ellipse(hip/4+r/2+DX, y+r+DY, r*0.85, r*0.50, -Math.PI/10, Math.PI, Math.PI*2)
  ctx.ellipse(hip/4+r/2+DX, y+r+DY, r*0.85, r*0.50, -Math.PI/10, Math.PI*2, Math.PI)
  
  ctx.ellipse(hip/4+r/2-20+DX, y-r*1.5+40+DY, r, r, 0, Math.PI, Math.PI*1.3) // left shoulder
  ctx.ellipse(hip/4+r-90+DX,  y-r*3.5+40+DY, r*0.9, r, 0, Math.PI/2-0.1, Math.PI *1.95, true) // left neck
  ctx.ellipse(cx-r*1.5-20+DX, r*1.9+DY, r*1.7, r*1.2, Math.PI/2.1, Math.PI/2, Math.PI*1.5) // face
  ctx.ellipse(cx-r*1.5-20+DX, r*1.9+DY, r*1.7, r*1.2, Math.PI/2.1, Math.PI*1.5, Math.PI/2) // face

  ctx.stroke()
  //left boob
  ctx.beginPath()
  ctx.ellipse(cx-hip/6+DX, y+DY, r, r, 0, Math.PI*1.35, 0, true)
  ctx.stroke()
  

  ctx.beginPath()
  ctx.ellipse(cx+r/2+DX, canvas.height+DY, r*2, r*3.0, 0, Math.PI/2, Math.PI * 1.7, true) // right hip
  ctx.ellipse(cx+hip/9+DX, y-r/2+DY, r, r, 0, Math.PI*2.1, Math.PI*0.9)  //right boob
  ctx.ellipse(cx+hip/9+DX, y-r/2+DY, r, r, 0, Math.PI*0.9, Math.PI*1.8,true)  //right boob
  
  ctx.ellipse(canvas.width - 360+DX, 428+DY, 8, 70, 0, Math.PI/2, Math.PI*2) // right arm
  ctx.ellipse(canvas.width - 360+DX, 428+DY, 8, 70, 0, Math.PI*2, 0) // right arm
  ctx.ellipse(canvas.width - 360+DX, 428+DY, 8, 70, 0, 0, Math.PI*1.5, true) // right arm
  ctx.ellipse(canvas.width - 420+DX, 420+DY, 90, 90, 0, Math.PI*1.7, Math.PI *1.3, true) // right shoulder
  ctx.lineTo(cx-58+DX, 330+DY)
  ctx.lineTo(cx-64+DX, 270+DY)
  ctx.stroke()
 
  ctx.beginPath()
  ctx.ellipse(cx-20+DX, canvas.height-r-10+DY, 6, 2, 0, Math.PI*2, 0, true) // navel
  ctx.stroke()
  
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}


function buns () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  //let R = canvas.width * 0.3
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let hip = canvas.width * 0.76
  let waist = canvas.width - hip *0.9
  let div = 1 + Math.random() * 5
  let height = 0
  let savedheight = 0
  // fill
  ctx.lineJoin = "round"
  ctx.strokeStyle = (colors[0])
  height = cy+pet(cy*1.2)
  let r = hip/4
  let savedr = r
  
  y = cy*0.5 + r

  savedheight = y
  //upper part
  ctx.beginPath()
  ctx.moveTo(waist/2,0)
  ctx.ellipse(cx-hip/4, y, r, r, 0, Math.PI, 0, true)
  ctx.ellipse(cx+hip/4, y, r, r, 0, Math.PI, 0, true)
  ctx.lineTo(canvas.width-waist/2,0)
  ctx.stroke()
  //legs inner
  ctx.beginPath()
  ctx.moveTo(cx, y)
  ctx.lineTo(cx-30, canvas.height)
  ctx.stroke()
  
  ctx.beginPath()
  ctx.moveTo(cx, y)
  ctx.lineTo(cx+30, canvas.height)
  ctx.stroke()
  // legs outer
  ctx.beginPath()
  ctx.moveTo(cx-r*2, y)
  ctx.lineTo(cx-r*2+30, canvas.height)
  ctx.stroke()
  
  ctx.beginPath()
  ctx.moveTo(cx+r*2, y)
  ctx.lineTo(cx+2*r-30, canvas.height)
  ctx.stroke()
  
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function scraps () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
//  ctx.clearRect(0,0,canvas.width,canvas.height)
  let D = 200 + Math.random() * 300//Math.floor(document.getElementById("featuresize").value/10)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  ctx.fillStyle = randomPick(colors)

  let cx = canvas.width/2, cy = canvas.height/2
  let xe = cx-D+pet(D*0.9)
  let ye = cy-D+pet(D*0.9)
  let x0 = xe, y0 = ye
  let i = 0
  for (; i < 1; i++) {
    ctx.fillStyle = randomPick(colors)
    cx =  LASTCLICK[0]//canvas.width*Math.random()
    cy =  LASTCLICK[1]//canvas.height*Math.random()
    xe = cx-D+pet(D*2)
    ye = cy-D+pet(D*2)
    y0 = ye, x0 = xe
    ctx.beginPath()
    ctx.moveTo(xe,ye)
    x = xe
    y = ye
    xe = cx+D+pet(D*2)
    ye += pet(D*2)
    raggedX(ctx,xe,ye,x,y)
    x = xe
    y = ye
    xe += pet(D*2)
    ye = cy+D+pet(D*2)
    raggedX(ctx,xe,ye,x,y)
    x = xe
    y = ye
    xe = cx-D-pet(D*2)
    ye += pet(D*2)
    raggedX(ctx,xe,ye,x,y)
    raggedX(ctx,x0,y0,xe,ye)
    ctx.closePath()
    ctx.fill()
  }
}

function comets () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let alt = document.getElementById("grungy").checked
  let cx = canvas.width/2, cy = canvas.height/2
  let r = canvas.width/9 * 0.8 + pet(40)
  let r2 = r * 0.5
  let x = r + Math.random() * cx/2, y = r +Math.random() *cy/2
  let x2 = cx + r ,y2 = cy + r
  let div = 1 + Math.random() * 4
  let height = 0
  let savedheight = 0
  let a = Math.random() * 2 * Math.PI
  let R = canvas.width/2
  // fill
  ctx.lineJoin = "round"
  ctx.strokeStyle = (colors[0])
  ctx.fillStyle = colors[1]
  let i = 0
  for (; i < 1 ;i++) {
    a = Math.random() * 2 * Math.PI
    r = canvas.width/9 * 0.8 + pet(80)
    r2 = r * 0.5 + pet(30)
    if (Math.random() > 0.9)
      r2=5
    cx =  LASTCLICK[0]//Math.random() * canvas.width
    cy =  LASTCLICK[1]//Math.random() * canvas.height
    if (cy < canvas.height/2)
      a = Math.random()  * Math.PI
    if (cy > canvas.height/2)
      a = Math.PI +Math.random()  * Math.PI

    x = cx + r * Math.cos(a)
    y = cy + r * Math.sin(a)
    
    x2 = cx + r*4 * Math.cos(a)
    y2 = cy + r*4 * Math.sin(a)
 
    ctx.beginPath()
    ctx.ellipse(x, y, r, r, a+Math.PI/2,  0, 2 * Math.PI)
    if (Math.random() > 0.8) {
      ctx.fillStyle = randomPick(colors)
      ctx.fill()
    }
    ctx.ellipse(x2, y2, r2, r2, a+Math.PI/2, 2*Math.PI, 0)
    if (Math.random() > 0.8) {
      ctx.fillStyle = randomPick(colors)
      ctx.fill()
    }
    ctx.ellipse(x2, y2, r2, r2, a+Math.PI/2, 0, Math.PI)
    ctx.ellipse(x, y, r, r, a+Math.PI/2,  Math.PI,-0)
    ctx.lineWidth += pet(2)
    if (!alt)
      ctx.strokeStyle = randomPick(colors)
    ctx.stroke()

    if (Math.random() > 0.9) {
      ctx.beginPath()
      ctx.moveTo(x,y)
      ctx.lineTo(x2,y2)
      ctx.stroke()
    }
  }
  //fill()

  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function pants () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let div = 1 + Math.random() * 4
  let height = 0
  let savedheight = 0
  // fill
  ctx.lineJoin = "round"
  ctx.strokeStyle = (colors[0])
  height = cy+pet(cy*1.2)
  let r = (canvas.height + height*-0.5) * 0.27 // slightly smaller
  let savedr = r
  
  // top
  y = cy*0.5 + r/2/div
  savedheight = y
  r = canvas.width/2 * 0.8
  ctx.strokeStyle = (colors[3])
  ctx.beginPath()
  ctx.ellipse(cx, y, r, r/div, 0, 0, 2 * Math.PI)
  ctx.stroke()
  
  y = canvas.height * 5/6
  r *= 0.5
  let leglength = canvas.height * 5/6
  if (Math.random() > 0.5)
    leglength *= 0.7
  let rotation = 0.0 + Math.random()/3
  r += r/8 * Math.random()
  r *= 1.1
  ctx.ellipse(canvas.width - cx/2, leglength, r, r/div, 0-rotation, 2 * Math.PI, 0)
  ctx.ellipse(canvas.width - cx/2, leglength, r, r/div, 0-rotation, 0, Math.PI)
  
  ctx.lineTo(cx+cx*0.03, cy*1.3)
  ctx.lineTo(cx-cx*0.03, cy*1.3)

  ctx.ellipse(cx/2, leglength, r, r/div, 0+rotation, 0, 2 * Math.PI)
  ctx.ellipse(cx/2, leglength, r, r/div, 0+rotation, 0,  Math.PI)
  r = canvas.width/2 * 0.8
  y = savedheight
  ctx.ellipse(cx, y, r, r/div, 0, Math.PI, Math.PI)
  ctx.stroke()
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}


function glass_line () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  //let R = canvas.width * 0.3
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0

  let div = 1 + Math.random() * 5
  let height = 0
  let savedheight = 0
  // fill
  ctx.strokeStyle = (colors[0])
  height = cy+pet(cy*1.2)
  let r = (canvas.height + height*-0.5) * 0.27 // slightly smaller
  let savedr = r
  height += r/2/div
  savedheight = height
  r = (canvas.height + height*-0.5) * 0.27 // slightly smaller
  savedr = r
  ctx.beginPath()
  ctx.ellipse(cx, height, r, r/div, 0, Math.PI, 2 * Math.PI) // level -> top of filled
  height = canvas.height*0.84

  r = (canvas.height + height*-0.5) * 0.27 // bottom of glass
  ctx.ellipse(cx, height, r, r/div, 0, 0, Math.PI)
  ctx.lineTo(cx-savedr,savedheight) //: \
  ctx.stroke()

  ctx.beginPath()
  height = savedheight
  r = (canvas.height + height*-0.5) * 0.27 // slightly smaller
  ctx.ellipse(cx, height, r, r/div, 0, 0, 2 * Math.PI) // level -> top of filled
  ctx.stroke()
//---------------
  // top
  height = cy*0.4 + r/2/div
  savedheight = height
  r = (canvas.height + height*-0.5) * 0.3
  ctx.strokeStyle = (colors[3])
  ctx.beginPath()
  ctx.ellipse(cx, height, r, r/div, 0, Math.PI, 2 * Math.PI)
  //bottom
  height = canvas.height*0.85
  r = (canvas.height + height*-0.5) * 0.3
  ctx.ellipse(cx, height, r, r/div, 0,  0, Math.PI)
  ctx.stroke()
  
  ctx.strokeStyle = (colors[3])
  height = cy*0.4 + r/div
  height = savedheight

  r = (canvas.height + height*-0.5) * 0.3
  ctx.beginPath()
  ctx.ellipse(cx, height, r, r/div, 0, 0, Math.PI)
  height = canvas.height*0.85
  r = (canvas.height + height*-0.5) * 0.3
    
  ctx.ellipse(cx, height, r, r/div, 0,  Math.PI, 0, true)
  ctx.stroke()
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function eclipse () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.height * 0.15, r = R*2
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
// if (Math.random() > 0.5)
  // colors = shuffle(['#ff00ff', '#ffff00', '#00ffff', '#7fff7f'])
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let a = Math.random() * 2 * Math.PI

  let R2 = R*0.8
  ctx.fillStyle = colors[3]
  ctx.beginPath()
  ctx.moveTo(cx-R*3.2,0)
  ctx.lineTo(cx+R*3.2,0)
  ctx.lineTo(cx+R2, canvas.height)
  ctx.lineTo(cx-R2, canvas.height)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = colors[4]
  ctx.beginPath()
  ctx.moveTo(cx-R2*0.3, (cy+cy/3), 0)
  ctx.lineTo(cx+R2*0.3, (cy+cy/3), 0)
  ctx.lineTo(cx+R2*0.05, canvas.height-R2)
  ctx.lineTo(cx-R2*0.05, canvas.height-R2)
  ctx.closePath()
  ctx.fill()
  // top disc
  ctx.fillStyle = colors[0]
  ctx.beginPath()
  ctx.arc(cx, -R/4, R+r, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  // bottomr disc
  ctx.fillStyle = colors[1]
  ctx.beginPath()
  ctx.arc(cx, canvas.height, R2, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  //moon
  R2 *= 0.3
  ctx.fillStyle = colors[2]
  ctx.beginPath()
  ctx.arc(cx, cy+cy/3, R2, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  
  R += R/2
  R *= 2
  
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function core () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.width * 0.4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  if (document.getElementById("grungy").checked)
    colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0

  // whole world
  //left side surface
  ctx.fillStyle = colors[0]
  ctx.beginPath()
  ctx.arc(cx, cy, R, Math.PI/2, Math.PI * 1.5)
  ctx.ellipse(cx, cy, R*0.67, R, 0, Math.PI * 1.5, Math.PI/2, true)
  ctx.closePath()
  ctx.fill()
  ctx.globalAlpha /= 5
  ctx.fillStyle = "#ffffff"
  ctx.fill()
  ctx.globalAlpha = alpha/100

 //right side surface
  ctx.fillStyle = colors[0]
  ctx.beginPath()
  ctx.arc(cx, cy, R, Math.PI * 1.5, Math.PI/2)
  ctx.ellipse(cx, cy, R*0.67, R, 0, Math.PI/2, Math.PI*1.5, true)
  ctx.closePath()
  ctx.fill()
  ctx.globalAlpha /= 5
  ctx.fillStyle = "#000000"
  ctx.fill()
  ctx.globalAlpha = alpha/100

  // left cutout
  ctx.fillStyle = colors[1] // darken
  ctx.beginPath()
  ctx.ellipse(cx, cy, R*0.67, R, 0, Math.PI/2, Math.PI * 1.5) // bottom to top
  ctx.moveTo(cx, cy-R)
  ctx.lineTo(cx, cy-(R/3)) //down
  ctx.ellipse(cx, cy, R/3, R/3, 0, Math.PI*1.5, Math.PI/2, true) // top to bottom
  ctx.moveTo(cx, cy+R)
  ctx.lineTo(cx, cy+(R/3)) // down
  ctx.closePath()
  ctx.fill()
  ctx.globalAlpha /= 5
  ctx.fillStyle = "#000000"
  ctx.fill()
  ctx.globalAlpha = alpha/100

  // right cutout
  ctx.fillStyle = colors[1] // lighten
  ctx.beginPath()
  ctx.ellipse(cx, cy, R*0.67, R, 0, Math.PI * 1.5, Math.PI/2) // top to bottom
  ctx.moveTo(cx, cy+R)
  ctx.lineTo(cx, cy+(R/3)) //up
  ctx.ellipse(cx, cy, R/3, R/3, 0, Math.PI/2, Math.PI * 1.5, true) // top to bottom
  ctx.moveTo(cx, cy-R)
  ctx.lineTo(cx, cy-(R/3)) // up
  ctx.closePath()
  ctx.fill()
  ctx.globalAlpha /= 5
  ctx.fillStyle = "#ffffff"
  ctx.fill()
  ctx.globalAlpha = alpha/100

  //core
  ctx.fillStyle = colors[2]
  ctx.beginPath()
  ctx.arc(cx, cy, R/3, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
 // core glint
/*
  ctx.beginPath()
  ctx.arc(cx, cy, R/3*0.97, Math.PI/2, Math.PI * 1.5)
  ctx.ellipse(cx, cy, R/3*0.7, R/3*0.97, 0, Math.PI*1.5, Math.PI/2) // top to bottom
  ctx.closePath()
  ctx.globalAlpha /= 20
  ctx.fillStyle = "#ffffff"
 // ctx.fill()
  ctx.globalAlpha = alpha/100*/

  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function fruit () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  let W = canvas.width, H = canvas.height
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.height * 0.05, R2 = 0
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  if (document.getElementById("grungy").checked)
    colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let cx = 12, cy = canvas.height/2, x = 0, y = 0
  let a = Math.random() * Math.PI * 2
  let sixth = Math.PI/6
  let i = 0
  for (; i < 20; i++) {
    R = 100//canvas.height * 0.05 + 55 * Math.random()
    //left side surface
    cx = Math.random() *W, cy = Math.random() * H
   // cy += 44//pet(20)
    let d = 10 + cy * 0.1
  
    a = Math.random() * Math.PI * 2
  //a += 0.3
    R2 =  R * 0.6//Math.random() * R*0.9
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.ellipse(cx, cy, R, R, a, 0, Math.PI)
    ctx.ellipse(cx, cy, R, R2, a, Math.PI, 0, true)
    ctx.closePath()
    ctx.fill()

    let j = 0
    for (; j < 6; j++) {
      ctx.fillStyle = colors[3]
      ctx.beginPath()
    
    // ctx.ellipse(cx, cy, R, R, a, 0, Math.PI)
      ctx.ellipse(cx, cy, R, R2, a, 0, Math.PI/6, true)
      ctx.lineTo(cx,cy)
      ctx.closePath()
      ctx.fill()
      a -= Math.PI/6
    }
  }

  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}


function atom () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.height * 0.40
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
  let colors = shuffle(getCurrentPalette())
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let a = Math.random() * 2 * Math.PI
  let n = randomPick([1,2,3,4,5,6,7,8])
  let nucs = n*2
  let inc = Math.PI/n
  r = R/n, r2 = r
  if (n == 1)
    r2 *= 0.67
  let i = 0
  for (; i < n; i++) {
    let rg = ctx.createRadialGradient(cx, cy, r2, cx, cy, R)
    let col1 = colors[0]
    if (i % 2 == 0)
      col1 = colors[1]
    let col2 = "rgba("+hexToR(col1)+", "+hexToG(col1)+", "+hexToB(col1)+", 0.0)";// transparent
    rg.addColorStop(1.0, col1);
    rg.addColorStop(0.01, col2);
    ctx.fillStyle = rg
    ctx.beginPath()
    ctx.ellipse(cx, cy, r, R, a, 0, Math.PI * 2)
    ctx.closePath()
    ctx.fill()
    a += inc
  }
  ctx.globalAlpha *= 0.67
  i = 0, r = 18, inc = Math.PI/2
  for (; i < nucs; i++) {
    ctx.fillStyle = colors[1]
    if (i % 2)
      ctx.fillStyle = colors[0]
    ctx.beginPath()
    x = cx + r * Math.cos(a)
    y = cy + r * Math.sin(a)
    ctx.arc(x, y, 30, 0, Math.PI * 2)
    ctx.closePath()
    ctx.fill()
    if (i === 3) {
      r *= 4
      inc = 2*Math.PI/(nucs-4)
      a += inc/2
    }
    a += inc
    
  }
  // inner, inner disc
 
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function orbits () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let R = canvas.height * 0.15, r = R*2
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let mode = document.getElementById("mode").value
  let alpha = document.getElementById("opacity").value
 if (Math.random() > 0.5)
   colors = shuffle(['#ff00ff', '#ffff00', '#00ffff', '#7fff7f'])
  let cx = canvas.width/2, cy = canvas.height/2, x = 0, y = 0
  let a = Math.random() * 2 * Math.PI
  ctx.fillStyle = colors[0]
  ctx.beginPath()
  ctx.arc(cx, cy, R+r, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  // inner disc
  x = cx + R * Math.cos(a)
  y = cy + R * Math.sin(a)
  ctx.fillStyle = (colors[1])
  ctx.beginPath()
  ctx.arc(x, y, r, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  cx = x, cy = y
  // inner, inner disc
  a = Math.random() * 2 * Math.PI
  x = cx + r/3* Math.cos(a)
  y = cy + r/3* Math.sin(a)
  ctx.fillStyle = (colors[2])
  ctx.beginPath()
  ctx.arc(x, y, r*0.667, 0, Math.PI * 2)
  ctx.closePath()
  ctx.fill()
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = alpha
}

function necker () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  let W = canvas.width
  let margin = W/20
  let w4 = (W-2*margin)/(2+Math.floor(Math.random() * 10))//document.getElementById("rows").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let grunge = document.getElementById("grungy").checked
  if (Math.random() > 0.5) {
    //bottom
    ctx.beginPath();
    ctx.moveTo(margin, W-margin)
    ctx.lineTo(w4+margin, W-w4-margin)
    ctx.lineTo(W-margin, W-w4-margin)
    ctx.lineTo(W-w4-margin, W-margin)
    ctx.fillStyle = colors[3]
    ctx.fill()
    //left side
    ctx.moveTo(margin, w4+margin)
    ctx.lineTo(w4+margin, margin)
    ctx.lineTo(w4+margin, W-w4-margin)
    ctx.lineTo(margin, W-margin)
    ctx.fillStyle = colors[4]
    ctx.fill()
    
      //upper right
    ctx.beginPath();
    ctx.moveTo(w4+margin, 0+margin)
    ctx.lineTo(W-margin, 0+margin)
    ctx.lineTo(W-margin, W-w4-margin)
    ctx.lineTo(w4+margin, W-w4-margin)
    ctx.fillStyle = colors[0]
    ctx.fill()
    
    // lower left
    ctx.moveTo(margin, w4+margin)
    ctx.lineTo(W-w4-margin, w4+margin)
    ctx.lineTo(W-w4-margin, W-margin)
    ctx.lineTo(margin, W-margin)
    ctx.fillStyle = colors[1]
    ctx.fill()
    
    //top
    ctx.beginPath();
    ctx.moveTo(margin, w4+margin)
    ctx.lineTo(w4+margin, margin)
    ctx.lineTo(W-margin, margin)
    ctx.lineTo(W-w4-margin, w4+margin)
    ctx.fillStyle = colors[2]
    ctx.fill()
    
    //right side
    ctx.beginPath();
    ctx.moveTo(W-w4-margin, w4+margin)
    ctx.lineTo(W-margin, margin)
    ctx.lineTo(W-margin, W-w4-margin)
    ctx.lineTo(W-w4-margin, W-margin)
    ctx.fillStyle = colors[5]
    ctx.fill()
  } else {
      //top
    ctx.beginPath();
    ctx.moveTo(margin, w4+margin)
    ctx.lineTo(w4+margin, margin)
    ctx.lineTo(W-margin, margin)
    ctx.lineTo(W-w4-margin, w4+margin)
    ctx.fillStyle = colors[2]
    ctx.fill()
    
    //right side
    ctx.beginPath();
    ctx.moveTo(W-w4-margin, w4+margin)
    ctx.lineTo(W-margin, margin)
    ctx.lineTo(W-margin, W-w4-margin)
    ctx.lineTo(W-w4-margin, W-margin)
    ctx.fillStyle = colors[5]
    ctx.fill()
    
     // lower left square
    ctx.beginPath();
    ctx.moveTo(margin, w4+margin)
    ctx.lineTo(W-w4-margin, w4+margin)
    ctx.lineTo(W-w4-margin, W-margin)
    ctx.lineTo(margin, W-margin)
    ctx.fillStyle = colors[1]
    ctx.fill()
    
    //bottom
    ctx.beginPath();
    ctx.moveTo(margin, W-margin)
    ctx.lineTo(w4+margin, W-w4-margin)
    ctx.lineTo(W-margin, W-w4-margin)
    ctx.lineTo(W-w4-margin, W-margin)
    ctx.fillStyle = colors[3]
    ctx.fill()
    
    //upper right square
    ctx.beginPath();
    ctx.moveTo(w4+margin, 0+margin)
    ctx.lineTo(W-margin, 0+margin)
    ctx.lineTo(W-margin, W-w4-margin)
    ctx.lineTo(w4+margin, W-w4-margin)
    ctx.fillStyle = colors[2]
    ctx.fill()
   
    //left side
    ctx.beginPath();
    ctx.moveTo(margin, w4+margin)
    ctx.lineTo(w4+margin, margin)
    ctx.lineTo(w4+margin, W-w4-margin)
    ctx.lineTo(margin, W-margin)
    ctx.fillStyle = colors[4]
    ctx.fill()
  }
}

function scratchOut () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/10
  let lw = ctx.lineWidth
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  ctx.lineCap = 'round'
  ctx.lineJoin = 'round'
  let W = canvas.width
  if (W > canvas.height)
    W = canvas.height
  W -= 150
  let depth = W / (lw*3) -25
  if (alt) {
    ctx.save()
    clipIrregular()
  }
  lw *= 2
  let x = 22, y = 32
  let i = 0, x2 = 0, y2 = 0
  for (;i < depth; i++) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    if (y > W) {
      x += lw*6 + pet(lw*2)
      y += pet(33)
      ctx.lineTo(x2, y2)
      x2 += pet(33)
      y2 += lw*6 + pet(lw*2)
      ctx.lineTo(x, y)
    } else {
      x2 += lw*6 + pet(lw*2)
      y2 += pet(33)
      ctx.lineTo(x2, y2)
      x += pet(33)
      y += lw*6 + pet(lw*2)
      ctx.lineTo(x, y)
    }
    ctx.lineWidth = lw + 0.9 * pet(lw)
    ctx.stroke()
  }
  if (alt)
    ctx.restore()
}

function justlines () { // grid paper
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let space = 6 + Math.floor(document.getElementById("featuresize").value/10)
  let pad = 32
  let mod = randomPick([4,5,6])
  let colors = ["#ed6060", "#0000ba", "0000ed", "#ed0000", "#000000"]
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let alpha = ctx.globalAlpha
  ctx.strokeStyle = randomPick(getCurrentPalette())
  ctx.lineWidth = randomPick([1,2,3,4,5])
  ctx.clearRect(0,0,W,H)
  ctx.fillStyle = color
  ctx.shadowColor = "#403030"
  ctx.shadowBlur = 9 + Math.random() * 5
  ctx.shadowOffsetY = 2 + Math.random() * 3
  ctx.shadowOffsetX = -2 + Math.random() * 2
  let x = pad, y = pad
 
  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  ctx.fillStyle = ctx.strokeStyle
  pad += 60 + Math.random() * 60
  let numbers = []
  let i = 0
  for (; i < 33*33; i++)
    numbers.push(i+1)
  let h = 51+Math.floor(Math.random() * 33), w = 1//+Math.floor(Math.random() * 33)
  let text  = 0
  
  let cols = ((W - pad*2)/w)
  let lines = ((H - pad*2)/h)
  i = 0
  let j = 0, p = 1.3;
  y = pad
  ctx.globalAlpha = 0.5
  for (; j < h+1; j++) {
    i = 0
    x = pad
    ctx.lineWidth = randomPick([50,30,100])
    for (; i < w; i++) {  // horizontal
      
      ctx.beginPath()
      ctx.moveTo(x+pet(p), y+pet(p))
      ctx.lineTo(x + cols, y+pet(p))
     // ctx.closePath()
      ctx.stroke()
      x += cols
    }
    y += lines
  }
  ctx.globalAlpha = alpha
}

function rr () {
  // uv = unrounded value
  let uv = [0.00000,0.10000,0.20000,0.30000,0.40000,0.50000,0.60000,0.70000,0.80000,0.90000,1.00000,1.10000,1.20000,1.30000,1.40000,1.50000,1.60000,1.70000,1.80000,1.90000,2.00000,2.10000,2.20000,2.30000,2.40000,2.50000,2.60000,2.70000,2.80000,2.90000,3.00000,3.10000,3.20000,3.30000,3.40000,3.50000,3.60000,3.70000,3.80000,3.90000,4.00000,4.10000,4.20000,4.30000,4.40000,4.50000,4.60000,4.70000,4.80000,4.90000,5.00000,5.10000,5.20000,5.30000,5.40000,5.50000,5.60000,5.70000,5.80000,5.90000,6.00000,6.10000,6.20000,6.30000,6.40000,6.50000,6.60000,6.70000,6.80000,6.90000,7.00000,7.10000,7.20000,7.30000,7.40000,7.50000,7.60000,7.70000,7.80000,7.90000,8.00000,8.10000,8.20000,8.30000,8.40000,8.50000,8.60000,8.70000,8.80000,8.90000,9.00000,9.10000,9.20000,9.30000,9.40000,9.50000,9.60000,9.70000,9.80000,9.90000,10.00000,10.10000,10.20000,10.30000,10.34200,10.50000]
  let mult = 2
  let i = 0
  for (;i < uv.length;i++) {
    console.log(uv[i], Math.round(uv[i]/mult)*mult)
    let prev = Math.floor(uv[i]/mult)*(mult) // previous mulitple
    let next = Math.ceil(uv[i]/mult)*(mult) // next multiple
    if (next !== prev && uv[i] - prev === next - uv[i]) {
      if((prev/mult) % 2 === 0) // test even-ness
        console.log("["+uv[i]+ " use "+prev+"]")
      else
        console.log("["+uv[i]+ " use "+next+"]")
    }
  }
}
function gridpaper () { // grid paper
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let space = 6 + Math.floor(document.getElementById("featuresize").value/10)
  let pad = 32
  let mod = randomPick([4,5,6])
  let colors = ["#ed6060", "#0000ba", "0000ed", "#ed0000", "#000000"]
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let alpha = ctx.globalAlpha
  ctx.strokeStyle = randomPick(getCurrentPalette())
  ctx.lineWidth = randomPick([1,2,3,4,5])
  ctx.clearRect(0,0,W,H)
  ctx.fillStyle = color
  ctx.shadowColor = "#403030"
  ctx.shadowBlur = 9 + Math.random() * 5
  ctx.shadowOffsetY = 2 + Math.random() * 3
  ctx.shadowOffsetX = -2 + Math.random() * 2
  let x = pad, y = pad
  ctx.beginPath()
  ctx.moveTo(pad,pad)
  ragged(ctx,W-pad,pad,x,y)
  x = W-pad
  y = pad
  ragged(ctx,W-pad,H-pad+pet(3),x,y)
  y = H-pad
  ragged(ctx,pad,H-pad+pet(3),x,y)
  x = pad
  y = W-pad
  ragged(ctx,pad,pad+pet(3),x,y)
  ctx.closePath()
  ctx.fill()
  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  ctx.fillStyle = ctx.strokeStyle
  pad += 60 + Math.random() * 60
  let numbers = []
  let i = 0
  for (; i < 33*33; i++)
    numbers.push(i+1)
  let h = 2+Math.floor(Math.random() * 33), w = 2+Math.floor(Math.random() * 33)
  let text  = 0
  
  let cols = ((W - pad*2)/w)
  let lines = ((H - pad*2)/h)
  i = 0
  let j = 0, p = 1.3;
  y = pad
  let r = Math.min(cols,lines)/12
  let n = 0
  
  let face = "Courier"
  ctx.font = "800 "+(r*3)+"pt " + face
  let numb = Math.random() > 0.5
  let width = r*2
  for (; j < h+1; j++) {
    i = 0
    x = pad
    for (; i < w; i++) {  // horizontal
      ctx.beginPath()
      ctx.moveTo(x+pet(p), y+pet(p))
      ctx.lineTo(x + cols, y+pet(p))
      ctx.closePath()
      ctx.stroke()
      if (alt && j > 0) {
        if (numb) {
          ctx.globalAlpha = 0.8
          if (Math.random() > 0.75)
          ctx.globalAlpha = 0.4
          text = numbers[n++]
        //  if (Math.random() > 0.4)
        //    text = "__"
          width = ctx.measureText(text).width
        //  ctx.fillText(text,x+cols/2-width/2+pet(5),y-lines/2+pet(5)+r/2)
       //   ctx.fillText(text,x+cols/2-width/2+pet(5),y-lines/2+pet(5)+r/2)
        //  if (Math.random() > 0.8 && n > 0)
       //     text = numbers[n-1]
      //    ctx.fillText(text,x+cols/2-width/2+pet(5),y-lines/2+pet(5)+r/2)
      //    ctx.fillText(text,x+cols/2-width/2+pet(5),y-lines/2+pet(5)+r/2)
          ctx.save()
          ctx.translate(x+cols/2-width/2+pet(2),y-lines/2+pet(2)+r/2)
          ctx.rotate(Math.random() * 2 * Math.PI) // need to adjust x & y offsets per line
          ctx.fillText(text, 0, 0)
          ctx.restore()
          ctx.globalAlpha = alpha
        } else {
          ctx.globalAlpha /= 10
          dotsNear2(ctx,x+cols/2,y-lines/2,r)
          ctx.globalAlpha = alpha
        }
      }
      x += cols
    }
    y += lines
  }
  ctx.lineWidth = randomPick([1,2,3,4,5])
  j = 0
  x = pad
  for (; j < w+1; j++) {
    i = 0
    y = pad
    for (; i < h; i++) {  // vertical
      ctx.beginPath()
      ctx.moveTo(x+pet(p), y+pet(p))
      ctx.lineTo(x+pet(p), y + lines)
      ctx.closePath()
      ctx.stroke()
      y += lines
    }
    x += cols
  }
}

function gridpaper_og () { // grid paper
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let space = 6 + Math.floor(document.getElementById("featuresize").value/10)
  let pad = 8
  let mod = randomPick([4,5,6])
  let colors = ["#ed6060", "#6060ba", "#6060ed", "#ed6060", "#000000"]
  ctx.globalAlpha = document.getElementById("opacity").value/200
  ctx.strokeStyle = randomPick(colors)
  ctx.lineWidth = 1
  if (alt)
    pad = 42
    
  let AW = (W - (pad*2)) // available width
  let maxcount = (Math.floor(AW/space) - Math.floor(AW/space) % mod) + 1
  let count = 0
  let maxW = pad + space*(maxcount-1)
  let startX = pad+(AW - maxW)
  if (startX < pad)
    startX = pad
  
  let i = 0, x = startX, y = 4
  while (y < H-space) {  // horizontal
    ctx.lineWidth = (i % mod === 0)? 3 : 1;
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(maxW+startX-pad, y)
    ctx.closePath()
    ctx.stroke()
    y += space
    i++
    count++
  }
  i = 0, x = startX, y = 4, count = 0
  while (x < W-pad && count < maxcount) {  // vertical
    ctx.lineWidth = (i % mod === 0)? 3 : 1;
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(x, H - 3)
    ctx.closePath()
    ctx.stroke()
    x += space
    i++
    count++
  }
  space = 8
  if (alt) { // continuous feed
    ctx.globalAlpha = document.getElementById("opacity").value/100
    ctx.fillStyle = "#ffffff"
    ctx.shadowBlur = 1
    ctx.shadowColor = "#cccccc"
    ctx.shadowOffsetX = -1
    ctx.shadowOffsetY = -1
    i = 0, y = 30, x = W-space*2.5
    while (y < H) {
      ctx.beginPath()
      ctx.arc(x, y, 8, 0, 2*Math.PI)
      ctx.closePath()
      ctx.fill()
      y += 40
    }
    i = 0, y = 30, x = space*2.5
    while (y < H) {
      ctx.beginPath()
      ctx.arc(x, y, 8, 0, 2*Math.PI)
      ctx.closePath()
      ctx.fill()
      y += 40
    }
    ctx.shadowBlur = 0
    ctx.shadowOffsetX = 0
    ctx.shadowOffsetY = 0
  }
}

function dividedPad () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let pad = 24
  let H = canvas.height, W = canvas.width
  let x = pad+pet(9), y = pad+pet(9)

  let cx1 = W - pad*4+pet(91), cy1 = pad+pet(21),
    cx2 = W -pad+pet(21), cy2 = 3*pad+pet(21),
    px = cx1+8, py = cy2-3
    
    
  let colors = ["#ed6060", "#6060ba", "#6060ed", "#ed6060", "#000000"]
  ctx.lineWidth = 1.5
  ctx.fillStyle = color
  ctx.shadowBlur = 10
  ctx.shadowColor = "#303020"
  ctx.shadowOffsetX = 2
  ctx.shadowOffsetY = 2
  
 // ctx.fillRect(pad,pad,canvas.width-pad*2,canvas.height-pad*2)
 /* ctx.beginPath()
  ctx.moveTo(pad,pad)
 // ragged(ctx,W-pad,pad+pet(3),x,y)
  ragged(ctx,cx1,cy1,x,y)
  ctx.lineTo(cx2,cy2)
  x = W-pad
  y = cy2
  ragged(ctx,W-pad,H-pad+pet(3),x,y)
  y = H-pad+pet(9)
  ragged(ctx,pad,H-pad+pet(3),x,y)
  x = pad+pet(9)
  y = W-pad+pet(9)
  ragged(ctx,pad+pet(9),pad+pet(3),x,y)
  ctx.closePath()
  ctx.fill()*/
  
  ctx.beginPath()
  ctx.moveTo(pad,pad)
  ragged(ctx,W-pad,pad,x,y)
  x = W-pad
  y = pad
  ragged(ctx,W-pad,H-pad+pet(3),x,y)
  y = H-pad
  ragged(ctx,pad,H-pad+pet(3),x,y)
  x = pad
  y = W-pad
  ragged(ctx,pad,pad+pet(3),x,y)
  ctx.closePath()
  ctx.fill()
  
 // ctx.fillStyle = "#ffaaaa"
  // dogear
  
  ctx.shadowBlur = 20
  ctx.shadowOffsetX = -4
  ctx.shadowOffsetY = -4
  ctx.beginPath()
  ctx.moveTo(cx1,cy1)
  ragged(ctx, px,py,cx1,cy1)
  ragged(ctx, cx2,cy2,px,py)
  ctx.lineTo(cx1, cy1)
  ctx.closePath()
  //ctx.fill()

  ctx.shadowBlur = 0
  ctx.shadowOffsetX = 0
  ctx.shadowOffsetY = 0
  ctx.strokeStyle = "#ff0000"
  ctx.beginPath()
  ctx.moveTo(canvas.width/2, 8+pad)
  ctx.lineTo(canvas.width/2, canvas.height-pad-4)
  ctx.closePath()
  ctx.stroke()
  ctx.lineWidth = 1
  ctx.strokeStyle = randomPick(colors)//"#6060ed"
  let i = 0
  x = 2+pad, y = 100+pad
  while (y < canvas.height-pad) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(canvas.width-pad-4, y)
    ctx.closePath()
    ctx.stroke()
    y += 28
  }
  ctx.strokeStyle = "#ee6060"
  i = 0, y = pad, x = 32+pad
  for (; i < 2; i++) {
    ctx.beginPath()
    ctx.moveTo(x, y+100)
    ctx.lineTo(x, canvas.height-pad-4)
    ctx.closePath()
    ctx.stroke()
    x = canvas.width/2 + 32
  }
}

function thisSpace () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100

  let pad = 24 +Math.floor(Math.random() * 12)
  let H = canvas.height, W = canvas.width
  let x = pad+pet(9), y = pad+pet(9)
  
  let cx1 = W - pad*4+pet(91), cy1 = pad+pet(21),
    cx2 = W -pad+pet(21), cy2 = 3*pad+pet(21),
    px = cx1+8, py = cy2-3
    
  ctx.fillStyle = color
  let colors = [ "#6060ba", "#6060ed", "#000000"]
  ctx.lineWidth = 3
  ctx.shadowBlur = 10
  ctx.shadowColor = "#303020"
  ctx.shadowOffsetX = -3
  ctx.shadowOffsetY = 3
  
  ctx.beginPath()
  ctx.moveTo(pad,pad)
  ragged(ctx,W-pad,pad,x,y)
  x = W-pad
  y = pad
  ragged(ctx,W-pad,H-pad+pet(3),x,y)
  y = H-pad
  ragged(ctx,pad,H-pad+pet(3),x,y)
  x = pad
  y = W-pad
  ragged(ctx,pad,pad+pet(3),x,y)
  ctx.closePath()
  ctx.fill()
  ctx.globalAlpha = 0.7
  ctx.shadowBlur = 0
  ctx.shadowOffsetX = 0
  ctx.shadowOffsetY = 0
  ctx.strokeStyle = randomPick(colors)
  ctx.lineWidth = 3 + Math.floor(Math.random() * 6)
  
  ctx.beginPath()
  ctx.moveTo(pad*3, pad*3)
  ctx.lineTo(W-pad*3, pad*3)
  ctx.lineTo(W-pad*3, H-pad*3)
  ctx.lineTo(pad*3, H-pad*3)
  ctx.lineTo(pad*3, pad*3)
  ctx.stroke()

  let text = "This space intentionally left blank."
  ctx.fillStyle = ctx.strokeStyle//randomPick(colors)
  let face = "Arial"
  ctx.font = "100 "+(14)+"pt " + face
  let width = ctx.measureText(text).width
  ctx.fillText(text, W/2-width/2, H-pad*3.6)
  
  text = 10+Math.floor(Math.random() * 89)
  face = "AmericanTypewriter"
  ctx.font = "800 "+(54)+"pt " + face
  ctx.fillText(text, pad*3.6, pad*3.6+54)
  
  ctx.beginPath()
  ctx.moveTo(W-pad*4-50, pad*3+20)
  ctx.lineTo(W-pad*4+10, pad*3+20)
  ctx.lineTo(W-pad*4+10, pad*3+80)
  ctx.lineTo(W-pad*4-50, pad*3+80)
  ctx.lineTo(W-pad*4-50, pad*3+20)
  ctx.stroke()
  
  ctx.lineWidth /= 2
  ctx.beginPath()
  ctx.moveTo(pad*3, H-pad*3)
  ctx.lineTo(W-pad*3, pad*3)
  ctx.stroke()
  
  ctx.beginPath()
  ctx.moveTo(pad*3, pad*3)
  ctx.lineTo(W-pad*3, H-pad*3)
  ctx.stroke()
  ctx.globalAlpha = document.getElementById("opacity").value/100
}
function requirements () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100

  let pad = 24
  let H = canvas.height, W = canvas.width
  let x = pad+pet(9), y = pad+pet(9)
  
  let cx1 = W - pad*4+pet(91), cy1 = pad+pet(21),
    cx2 = W -pad+pet(21), cy2 = 3*pad+pet(21),
    px = cx1+8, py = cy2-3
    
  ctx.fillStyle = color
  let colors = [ "#6060ba", "#6060ed", "#000000"]
  ctx.lineWidth = 3
  ctx.shadowBlur = 10
  ctx.shadowColor = "#303020"
  ctx.shadowOffsetX = -3
  ctx.shadowOffsetY = 3
  
  ctx.beginPath()
  ctx.moveTo(pad,pad)
  ragged(ctx,W-pad,pad,x,y)
  x = W-pad
  y = pad
  ragged(ctx,W-pad,H-pad+pet(3),x,y)
  y = H-pad
  ragged(ctx,pad,H-pad+pet(3),x,y)
  x = pad
  y = W-pad
  ragged(ctx,pad,pad+pet(3),x,y)
  ctx.closePath()
  ctx.fill()

  ctx.shadowBlur = 0
  ctx.shadowOffsetX = 0
  ctx.shadowOffsetY = 0
  ctx.lineWidth = 7
  ctx.strokeStyle = randomPick(colors)
  let text = "R E Q U I R E M E N T S"
  let face = "Arial"
  ctx.font = "800 "+(20)+"pt " + face
  ctx.fillStyle = ctx.strokeStyle
  
  ctx.font = "800 "+(32)+"pt " + face
  let width = ctx.measureText(text).width
  ctx.globalAlpha = 0.7

  ctx.fillText(text, W/2-width/2,80)
  ctx.font = "800 "+(20)+"pt " + face
  face = "AmericanTypewriter"
  let w = Math.floor(W/11)
  let h = Math.floor(H/7)
  
  let i = 1, ct = 1, im = i
  let hoff = 0
  x = 0, y = 0
  let MAX = randomPick([101,97,87,94])
  for (; i < MAX; i+=2) {
    im = i % 10
    text = ct++
    if (ct < 10)
      text = "0"+text
    ctx.beginPath()
    hoff = pet(5)
    ctx.moveTo(w*im+pet(3), h+hoff+pet(3))
    ctx.lineTo(w*im+w+pet(3), h+hoff)
    ctx.lineWidth = randomPick([3,4,5,5,4,4])
    ctx.stroke()
    ctx.font = "800 "+(randomPick([18,19,16]))+"pt " + face
    ctx.fillText(text, w*im+w*0.8+pet(19), h+30+pet(7))
    if (Math.random() > 0.95)
      dotsNear(ctx,w*im+w*0.8+pet(19), h+30+pet(19),7+pet(4))
    if (ct % 6 == 0) {
      h += Math.floor(H/11)
     // w = W/7
      im = 1
    }
  }
  text = "This space intentionally                  ."
  ctx.font = "100 "+(9)+"pt " + face
  ctx.face = "Arial"
  ctx.fillText(text, pad*2, H-pad*2)
  ctx.globalAlpha = document.getElementById("opacity").value/100
}

function numberShow () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let alt = document.getElementById("grungy").checked
  let mode = document.getElementById("mode").checked
  let W = canvas.width, H = canvas.height
  let pad = 30 + Math.floor(Math.random() * 12)
  let linespace = 34 + Math.floor(pet(16))

  let color = randomPick(getCurrentPalette())
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.lineWidth = 1
  let i = 0, x = pad+2, y = pad+94
  let text = 2+Math.floor(Math.random() * 101)

  let face = "helvetica"
  let size = H*0.8
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = color
  ctx.strokeStyle = "#505050"
  ctx.font = size+"pt " + face
  w = ctx.measureText(text).width

  ctx.fillText(text, W/2-w/2, pad*2+size)
  ctx.scale(-1, 1)

  ctx.globalAlpha /= 2
  ctx.fillText(text-1, -w*1.1+pet(50), pad*2+size+pet(50))

  ctx.setTransform(1, 0, 0, 1, 0, 0);
    
  ctx.globalAlpha = document.getElementById("opacity").value/100
}

function linedPad () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let W = canvas.width, H = canvas.height
  let pad = 30 + Math.floor(Math.random() * 12)
  let linespace = 34 + Math.floor(pet(16))
  ctx.shadowColor = "#403030"
  ctx.shadowBlur = 9 + Math.random() * 5
  ctx.shadowOffsetY = 2 + Math.random() * 3
  ctx.shadowOffsetX = -2 + Math.random() * 2
  ctx.fillStyle = color
  ctx.fillRect(pad,pad,W-pad*2, H-pad*2)
  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  let colors = ["#ed6060", "#6060ba", "#6060ed", "#ed6060", "#000000"]
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.strokeStyle = "#6060ed"
  ctx.lineWidth = 1
  let i = 0, x = pad+2, y = pad+94
  if (alt)
   while (y < canvas.height-pad) {
    if (i % 5 !== 4)
      ctx.strokeStyle = colors[i%5]
    else
      ctx.strokeStyle = "#edaaaa"
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(canvas.width-pad-2, y)
    ctx.closePath()
    if (i % 5 !== 4)
     ctx.stroke()
    y += linespace
    i++
  }
  else
    while (y < canvas.height-pad) {
      ctx.beginPath()
      ctx.moveTo(x, y)
      ctx.lineTo(canvas.width-pad-2, y)
      ctx.closePath()
      ctx.stroke()
      y += linespace
    }
  ctx.strokeStyle = "#ee6060"
  i = 0, y = pad+2, x = 96
  for (; i < 2; i++) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(x, canvas.height-pad)
    ctx.closePath()
    ctx.stroke()
    x += 5
  }
  document.getElementById("paintcolor").value = color
}

function postcard () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let W = canvas.width, H = canvas.height
  let pad = 24, hpad = 7 * pad
  let linespace = 34 + Math.floor(pet(16))
  let colors = ["#6060ba", "#6060ed", "#000000", "#2020cc"]
  ctx.strokeStyle = randomPick(colors)

  ctx.globalAlpha = document.getElementById("opacity")/100
  ctx.shadowColor = "#403030"
  ctx.shadowBlur = 9 + Math.random() * 5
  ctx.shadowOffsetY = 2 + Math.random() * 3
  ctx.shadowOffsetX = -2 + Math.random() * 2
  ctx.lineWidth = 4 + Math.floor(Math.random()*4)

  ctx.fillStyle = color
  let x = pad, y = hpad
  ctx.moveTo(x,y)
  
  ragged(ctx,W-pad,hpad,x,y)
  x = W-pad
  y = hpad
  ragged(ctx,W-pad,H-hpad,x,y)
  y = H-hpad
  ragged(ctx,pad,H-hpad,x,y)
  x = pad
  y = W-hpad
  ragged(ctx,pad,hpad,x,y)
  ctx.closePath()
  ctx.fill()
  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.lineWidth = 1
  let i = 0
  x = pad+2, y = pad+94
  ctx.lineWidth = 4 + Math.floor(Math.random()*4)
  y = hpad*1.8, x = W/2
  ctx.beginPath()
  ctx.moveTo(x, y)
  ctx.lineTo(x, canvas.height-hpad*1.3)
  ctx.closePath()
  ctx.stroke()
  
  ctx.strokeRect(W-pad-130, hpad+20,110,140) // stamp
  x = W/2 + pad*4, y = H/2 - pad*1.3
  i = 0
  for (; i < 4; i++) {
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(x + 340, y)
    ctx.stroke()
    y += 60
  }
  let text = "P O S T C A R D"
  let face = "Courier"
  ctx.font = "800 "+(36)+"pt " + face
  let width = ctx.measureText(text).width
  ctx.fillStyle = ctx.strokeStyle
  ctx.fillText(text,W/2-width/2,hpad+92)
  
  let CENT = W-pad-130 + 55
  y = hpad+50
  text = "Place"
  ctx.font = "100 "+(18)+"pt " + face
  width = ctx.measureText(text).width
  ctx.fillText(text,CENT-width/2,y)
  
  text = "Stamp"
  ctx.font = "100 "+(18)+"pt " + face
  width = ctx.measureText(text).width
  ctx.fillText(text,CENT-width/2,y+140/3)
  
  text = "Here"
  ctx.font = "100 "+(18)+"pt " + face
  width = ctx.measureText(text).width
  ctx.fillText(text,CENT-width/2,y+2*140/3)
  
  document.getElementById("paintcolor").value = color
}


function indexcard () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alt = document.getElementById("grungy").checked
  let W = canvas.width, H = canvas.height
  let pad = 24, hpad = 7 * pad
  let linespace = 34 + Math.floor(pet(16))
  ctx.globalAlpha = document.getElementById("opacity")/100
  ctx.shadowColor = "#403030"
  ctx.shadowBlur = 9 + Math.random() * 5
  ctx.shadowOffsetY = 2 + Math.random() * 3
  ctx.shadowOffsetX = -2 + Math.random() * 2
  ctx.fillStyle = color
  let x = pad, y = hpad+100
 
  ctx.fillRect(pad, hpad, W-2*pad, H-2*hpad)
  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  let colors = ["#6060ba", "#6060ed", "#000000", "#2020cc"]
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.strokeStyle =  "#ff2020"
  ctx.lineWidth = 2
  let i = 0
  while (y < H-hpad) {
    ctx.beginPath()
    ctx.moveTo(pad+2, y)
    ctx.lineTo(W-pad-2, y)
    ctx.stroke()
    y += 36
    ctx.strokeStyle =  "#2020cc"
  }
  document.getElementById("paintcolor").value = color
}

function photoBook () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  const H = canvas.height, W = canvas.width
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alpha = document.getElementById("opacity").value
  let mode = ctx.globalCompositeOperation
  let small = true, half = true
  let pad = 10//Math.floor(H * 0.01)
  ctx.globalAlpha = alpha
  ctx.fillStyle = color
  ctx.fillRect(0, 0, W, H)
  ctx.globalAlpha = 0.2
  ctx.fillStyle = randomGradientRect(canvas, "#ffffff", W/5-(pad*8), H, pad*6, H)
  ctx.fillRect(0, 0, W/5-(pad*6), H)

  ctx.fillStyle = randomGradientRect(canvas, "#000000", W/5, H, W/3, H)
  ctx.fillRect(W/5-(pad*6), 0, W, H)

  ctx.globalAlpha = 1.0
  ctx.fillStyle = "#fefeed"
  ctx.globalCompositeOperation = "destination-out"
  ctx.fillRect(W/5, pad*6, 3*W/4-pad, H-(pad*12))

  ctx.fillRect(0, pad*6, (pad*9), H-(pad*12))
  ctx.globalCompositeOperation = mode
  document.getElementById("opacity").value = alpha
}

function sketchpad () {
  if (document.getElementById("grungy").checked) {
    sketchpage ()
    return
  }
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  const H = canvas.height, W = canvas.width
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alpha = document.getElementById("opacity").value/100//
  let mode = ctx.globalCompositeOperation
  let small = true, half = true
  let pad = 40//Math.floor(H * 0.01)
 
  ctx.globalCompositeOperation = "source-over"
  ctx.globalAlpha = 1.0

  ctx.fillStyle = "#909090"
  ctx.fillRect(pad-10+pet(8), pad+10+pet(8), W/2-pad-14, H-pad*3)
  ctx.fillStyle = "#cccccc"
  ctx.fillRect(pad-8, pad+8, W/2-pad-14, H-pad*3)
  ctx.fillStyle = "#dddddd"
  ctx.fillRect(pad-6, pad+6, W/2-pad-14, H-pad*3)
  ctx.fillStyle = "#ffffff"
  ctx.fillRect(pad-4+pet, pad+4, W/2-pad-14, H-pad*3)

  ctx.fillStyle = "#909090"
  ctx.fillRect(W/2-6, pad*1.5+6, W/2-pad, H-pad*3)
  ctx.fillStyle = "#ffffff"
  ctx.fillRect(W/2-4, pad*1.5+4, W/2-pad, H-pad*3)

  ctx.fillStyle = color
  ctx.globalAlpha = 0.5
  ctx.shadowColor = "#403030"
  ctx.shadowBlur = 15 + Math.random() * 5
  ctx.shadowOffsetY = 12 + Math.random() * 3
  ctx.shadowOffsetX = -12 + Math.random() * 2
  
  ctx.fillRect(pad, pad, W/2-pad-14, H-pad*3)
  ctx.fillRect(W/2, pad*1.5, W/2-pad, H-pad*3)
  
  ctx.clearRect(pad, pad, W/2-pad-14, H-pad*3)
  ctx.clearRect(W/2, pad*1.5, W/2-pad, H-pad*3)
  ctx.globalAlpha = alpha

  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  ctx.fillStyle = "#101010"
  ctx.strokeStyle = "#867033"
  ctx.lineWidth = 5
  ctx.lineCap = "round"
  ctx.lineJoin = "round"
  ctx.globalCompositeOperation = "source-over"
  let x = W/2 -60, y = pad*2, i = 0
  let r = 56

  let sa = Math.PI * 1.35, ea = Math.PI * 1.78
  let sa2 = Math.PI * 0.56, ea2 = Math.PI * 0.81
  let sa3 = Math.PI * 0.36, ea3 = sa2
  let SQUARE = Math.random() > 0.5
  while (y < H - 80) {
    ctx.lineWidth = 5

    ctx.strokeStyle = "#555555"
    ctx.globalCompositeOperation = "darken"
    ctx.globalAlpha = 0.5
    //shadow strokes
    // upper strokes
    ctx.beginPath()
    ctx.arc(x+60, y-20, r-2, sa2, ea2)
    ctx.stroke()
      
    ctx.beginPath()
    ctx.arc(x+60, y-28, r-2, sa3, ea3)
    ctx.stroke()
    // lower strokes
    ctx.beginPath()
    ctx.arc(x+60, y-6, r-2, sa2, ea2)
    ctx.stroke()
      
    ctx.beginPath()
    ctx.arc(x+60, y-12, r-2, sa3, ea3)
    ctx.stroke()
    
    ctx.globalCompositeOperation = "source-over"
    
    ctx.strokeStyle = "#867033"
    ctx.globalAlpha = 1.0
    if (SQUARE) {
      ctx.fillRect(x,y,24,24)
      ctx.fillRect(x+80,y+pad-24,24,24)
    } else {
      ctx.beginPath()
      ctx.arc(x+14, y+12, 14, 0, Math.PI * 2)
      ctx.closePath()
      ctx.fill()
      
      ctx.beginPath()
      ctx.arc(x+90, y+27, 14, 0, Math.PI * 2)
      ctx.closePath()
      ctx.fill()
    }
   
    //rings
    ctx.beginPath()
    ctx.arc(x+46, y+54, r, sa, ea)
    ctx.stroke()
    ctx.beginPath()
    ctx.arc(x+43, y+68-2, r-2, sa, ea)
    ctx.stroke()
    
    // upper glint
    ctx.strokeStyle = "#ffffff"
    ctx.lineWidth = 3

    ctx.beginPath()
    ctx.arc(x+46, y+53, r,  sa+0.7, sa+0.75)
    ctx.stroke()
    //lower glint
    ctx.beginPath()
    ctx.arc(x+43, y+68-3, r-2, sa+0.75, sa+0.8)
    ctx.stroke()

    y += 58
  }
  ctx.globalCompositeOperation = mode
 // document.getElementById("opacity").value = alpha
}

function sketchpage () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  const H = canvas.height, W = canvas.width
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alpha = document.getElementById("opacity").value
  let mode = ctx.globalCompositeOperation
  let small = true, half = true
  let pad = 40//Math.floor(H * 0.01)
  ctx.fillStyle = color//"#101010"
  ctx.globalCompositeOperation = "source-over"
  ctx.clearRect(0, 0, H, H)

  ctx.shadowColor = "#403030"
  ctx.shadowBlur = 10 + Math.random() * 10
  ctx.shadowOffsetY = 4 + Math.random() * 5
  ctx.shadowOffsetX = 4 + Math.random() * 5
  
  ctx.fillRect(pad, pad, W-pad*2, H-pad*2)
  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  
  ctx.fillStyle = "#101010"
  ctx.strokeStyle = "#867033"
  ctx.lineWidth = 5
  ctx.lineCap = "round"
  ctx.lineJoin = "round"
  ctx.globalCompositeOperation = "source-over"
  let x = -8, y = pad + 20, i = 0
  let r = 56

  let sa = Math.PI * 1.35, ea = Math.PI * 1.78
  let sa2 = Math.PI * 0.56, ea2 = Math.PI * 0.81
  let sa3 = Math.PI * 0.36, ea3 = sa2
  let SQUARE = Math.random() > 0.5
  let RIPPED = Math.random() > 0.3
  let yoff = 0
  let a = 1//randomPick([0,1,2,3,4])
  if (SQUARE)
    y -= 12
  let ct = 0
  while (y < H - 76) {
    ct++
    ctx.lineWidth = 5
    
    ctx.strokeStyle = "#555555"
    ctx.globalCompositeOperation = "darken"
    ctx.globalAlpha = 0.5
    
    ctx.globalCompositeOperation = "source-over"
    ctx.strokeStyle = "#867033"
    ctx.globalAlpha = 1.0
    ctx.globalCompositeOperation = "destination-out"

    if (SQUARE) {
      ctx.fillRect(x+78,y+27, 24, 24) // hole
    } else {
      ctx.beginPath()
      ctx.arc(x+90, y+27, 14, 0, Math.PI * 2)
      ctx.closePath()
      ctx.fill()
    }
    if (RIPPED) {
      ctx.globalAlpha = 1.0
      let big = 0
      if (Math.random() > 0.97)
        big += 58
      //y += a
      ctx.beginPath()
      ctx.moveTo(0, y+4+pet(19)+yoff)
      ctx.lineTo(x+80, y+24+pet(9)+yoff)
      ctx.lineTo(x+80, y+30+pet(7)+yoff+big)
      ctx.lineTo(0, y+30 +pet(7)+yoff+big)
      ctx.closePath()
      ctx.fill();
    }
    y += 60
  }
  ctx.globalCompositeOperation = mode
  document.getElementById("opacity").value = alpha
}


function singlePage () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  const H = canvas.height, W = canvas.width
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alpha = document.getElementById("opacity").value
  ctx.globalAlpha = alpha/100
  let mode = ctx.globalCompositeOperation
  let small = true, half = true
  let pad = 40
  ctx.fillStyle = color//"#101010"
  ctx.strokeStyle = 'black'//"#101010"
  ctx.globalCompositeOperation = "source-over"
  let htop = [W-pad*1.1, pad*1.1]
  let hbot = [W-pad*1.1, H-pad*1.1]
  let shadows = ["#101010", "#202020", "#000000"]
  ctx.shadowBlur = 5 + Math.random() * 4
  ctx.shadowOffsetY = 1 + Math.random() * 1
  ctx.shadowOffsetX = -1 + Math.random()
  let i = 0, x = pad, y = pad
  let x0 = x, y0 = y
  let pH = H - pad*2
  ctx.lineWidth = 5
  ctx.beginPath()
  ctx.moveTo(x,y)
  x = pad, y = pad
  x0 = W - pad, y0 = pad
  
  ragged(ctx,x0,y0,x,y)
  x = x0
  y = y0

  x0 = W-pad
  y0 = H-pad
  ragged(ctx,x0,y0,x,y)
  x = x0
  y = y0

  x0 = pad
  y0 = H-pad
  ragged(ctx,x0,y0,x,y)
  x = x0
  y = y0

  x0 = pad
  y0 = pad
  ragged(ctx,x0,y0,x,y)
  ctx.lineTo(x0,y0)
  ctx.closePath()
  ctx.fill()
}

function ragged (ctx,endX,endY,x,y) {
  let inc = 3 + Math.floor(document.getElementById("featuresize").value/50)
  let p = 1 + document.getElementById("number").value/4000
  let xdiff = x - endX, ydiff = y - endY
  let D = distance(x,y,endX,endY)
  let Dy = (endY-y)
  let Dx = (endX-x)
  let xinc = Dx/(D+0.000001)*inc
  let yinc = Dy/(D+0.000001)*inc
  let xsteps = (x - endX)/(xinc + 0.000001)
  let ysteps = (y - endY)/(yinc + 0.000001)
  let xf = xdiff/(xsteps + 0.000001)
  let yf = ydiff/(ysteps + 0.000001)
  let px2 = p*2
  while (distance(endX,endY,x,y) > inc) {
    // add to x and y to get closer to endX,endY
    x += xinc
    y += yinc
    x += xf
    y += yf
    ctx.lineTo(x+pet(p), y+pet(p))
  }
}

function raggedX (ctx,endX,endY,x,y) {
  let inc = 3 + Math.floor(document.getElementById("featuresize").value/10)
  let p = 1 + document.getElementById("number").value/1000
  let xdiff = x - endX, ydiff = y - endY
  let D = distance(x,y,endX,endY)
  let Dy = (endY-y)
  let Dx = (endX-x)
  let xinc = Dx/(D+0.000001)*inc
  let yinc = Dy/(D+0.000001)*inc
  let xsteps = (x - endX)/(xinc + 0.000001)
  let ysteps = (y - endY)/(yinc + 0.000001)
  let xf = xdiff/(xsteps + 0.000001)
  let yf = ydiff/(ysteps + 0.000001)
  let px2 = p*2
  while (distance(endX,endY,x,y) > inc) {
    // add to x and y to get closer to endX,endY
    x += xinc
    y += yinc
    x += xf
    y += yf
    ctx.lineTo(x+pet(p), y+pet(p))
  }
}

function floppyPage () { // half
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  const H = canvas.height, W = canvas.width
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alpha = document.getElementById("opacity").value
  ctx.globalAlpha = alpha/100
  let mode = ctx.globalCompositeOperation
  let small = true, half = true
  let pad = 40
  ctx.fillStyle = color//"#101010"
  ctx.globalCompositeOperation = "source-over"
  let htop = [W-pad*1.1, pad*1.1]
  let hbot = [W-pad*1.1, H-pad*1.1]
  let shadows = ["#101010", "#202020", "#000000"]
  ctx.shadowBlur = 5 + Math.random() * 4
  ctx.shadowOffsetY = 1 + Math.random() * 1
  ctx.shadowOffsetX = -1 + Math.random()
  let i = 0, x = pad+pet(20), y = pad+pet(30)
  let x0 = x, y0 = y
  let pH = H - pad*2
  let cpx = W*0.5, cpy = pad+pet(42)
  let numpages = 3 +Math.floor(Math.random()*5)
  let x_inc = 7 + Math.floor(Math.random()*8)
  for (; i < numpages; i++) {
    ctx.shadowColor = randomPick(shadows)
    ctx.beginPath()
    y = y+pet(20)
    ctx.moveTo(x,y)
    ctx.quadraticCurveTo(cpx, cpy, htop[0], htop[1])
    ctx.lineTo(hbot[0],hbot[1])
    x += pet(30)
    ctx.quadraticCurveTo(cpx, H-cpy, x, y+pH)
    
    // draw fagged line between botton and top
    ragged(ctx,x0,y0,x,y+pH)
    ctx.closePath()
    ctx.fill()
    x += x_inc + pet(6)
    x0 = x
    cpy = pad+pet(32)
    ctx.shadowBlur = 4
  }
  // top page: fill to get drop shadow
  ctx.fillStyle = "#ddddcc"
  ctx.beginPath()
  y = y+pet(20)
  y0 = y
  let ox = x
  ctx.moveTo(x,y)
  ctx.quadraticCurveTo(cpx, cpy, W-pad,pad)
  ctx.lineTo(W-pad,H-pad)
  x += pet(20)
  ctx.quadraticCurveTo(cpx, H-cpy, x, y+pH)
  
  ragged(ctx,ox,y0,x,y+pH)

  ctx.closePath()
  ctx.fill()

  ctx.save()
  ctx.beginPath()
  ctx.moveTo(ox,y)
  ctx.quadraticCurveTo(cpx, cpy, W-pad,pad)
  ctx.lineTo(W-pad,H-pad)
  ctx.quadraticCurveTo(cpx, H-cpy, x, y+pH)
  ragged(ctx,ox,y0,x,y+pH)

  ctx.closePath()
  ctx.clip()
  ctx.clearRect(0,0,W,H)
  ctx.restore()
  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0

  // tint sliver of right page
  let delta = Math.floor((Math.random()) * 13)
  ctx.fillStyle = color
  ctx.beginPath()
  ctx.moveTo(W-pad,pad)
  ctx.lineTo(W,pad-delta)
  ctx.lineTo(W,H-pad+delta)
  ctx.lineTo(W-pad, pad+pH)
  ctx.closePath()
  ctx.fill()
  ctx.fillStyle = randomGradientRect2(canvas, color, "#000000", W-pad*3, H/2, W, H/2)
  ctx.fill()
  ctx.globalCompositeOperation = mode
  document.getElementById("opacity").value = alpha
}

function spiralbound () { //
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  const H = canvas.height, W = canvas.width
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let color = document.getElementById("paintcolor").value
  let alpha = document.getElementById("opacity").value
  let mode = ctx.globalCompositeOperation
  let small = true, half = true
  let pad = 10//Math.floor(H * 0.01)
  ctx.lineCap = "round"
  ctx.lineJoin = "round"
  ctx.globalCompositeOperation = "source-over"
  
  let x = 46, y = 78, i = 0
  let r = 56
  ctx.fillStyle = color
  ctx.fillRect(0,0,W, 48)
  
  let sa = Math.PI * 1.1, ea = Math.PI * 1.3
  ctx.lineWidth = 11

  while (x < W - 30) {
    ctx.strokeStyle = "#555555"
    ctx.beginPath()
    ctx.arc(x+12, y-18, r-2, sa, ea+0.02)
    ctx.stroke()
    
    ctx.strokeStyle = "#404040"
    ctx.beginPath()
    ctx.arc(x+12, y-18, r-2, sa, sa+0.04)
    ctx.stroke()
    
    ctx.strokeStyle = "#707070"
    ctx.beginPath()
    ctx.arc(x+12, y-18, r-2, ea - 0.03, ea)
    ctx.stroke()
    x += 62
  }
  ctx.globalCompositeOperation = "destination-out"

  ctx.fillStyle = "#fefeee"
  ctx.fillRect(0,46,W,H)
  ctx.globalCompositeOperation = "source-over"

  x = 46
  while (x < W - 30) {
    ctx.globalAlpha = 1.0
    ctx.globalCompositeOperation = "source-over"
    ctx.fillStyle = "#202020"
    ctx.globalAlpha = 1.0
    ctx.beginPath()

    ctx.arc(x,y,20,0, 2* Math.PI)
    ctx.closePath()
    ctx.fill()
    //rings
    ctx.lineWidth =11
    ctx.strokeStyle = "#999999"
    ctx.beginPath()
    ctx.arc(x-50, y-18, r+2, Math.PI * 1.71, Math.PI/10+0.1)
    ctx.stroke()
    
    // gliny
    ctx.lineWidth = 10
    ctx.strokeStyle = "#fefefe"
    ctx.beginPath()
    ctx.arc(x-50, y-19, r+3, Math.PI * 1.8, Math.PI * 1.82)
    ctx.stroke()
    
    // glint
    ctx.strokeStyle = "#dcdcdc"
    ctx.beginPath()
    ctx.arc(x-50, y-19, r+3, Math.PI * 1.89, Math.PI * 1.895)
    ctx.stroke()
    
    // shadow
    ctx.strokeStyle = "#404040"
    ctx.beginPath()
    ctx.arc(x-50, y-19, r+2, Math.PI * 2.1, Math.PI * 2.15)
    ctx.stroke()
    
    // shadow of wire on paper
    ctx.globalAlpha = 0.2
    ctx.globalCompositeOperation = "destination-over"
    //ctx.strokeStyle = "#999999"
    ctx.beginPath()
    ctx.arc(x-68, y-13, r, Math.PI * 1.6, Math.PI/10-0.1)
    ctx.stroke()
    x += 62
  }
  ctx.globalCompositeOperation = "destination-over"
  ctx.globalAlpha = 1.0
  ctx.fillStyle = "#eefefe"
 // ctx.fillRect(0,0,W,H)
  
  ctx.strokeStyle = "#8888ff"
  ctx.lineWidth = 1
  ctx.globalCompositeOperation = "source-over"

  x = 2, y = 120
  while (y < H) {
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(W-2,y)
    ctx.closePath()
    ctx.stroke()
    y += 50
  }
  ctx.globalCompositeOperation = mode
  document.getElementById("opacity").value = alpha
}

function letterE () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let colors = shuffle(getCurrentPalette())
  let x = 50, y = 50, len = 70
  ctx.strokeStyle = randomPick(colors)
  ctx.lineWidth = 7
  ctx.beginPath()
  ctx.moveTo(x+pet(5),y)
  ctx.lineTo(x+len/2, y+pet(5))
  ctx.closePath()
  ctx.stroke()
  y += len/2
  ctx.beginPath()
  ctx.moveTo(x+pet(5),y)
  ctx.lineTo(x+len/2.2, y+pet(5))
  ctx.closePath()
  ctx.stroke()
  y += len/2
  ctx.beginPath()
  ctx.moveTo(x+pet(5),y)
  ctx.lineTo(x+len/2, y+pet(5))
  ctx.closePath()
  ctx.stroke()
  y -= len
  ctx.beginPath()
  ctx.moveTo(x+pet(5),y)
  ctx.lineTo(x, y+pet(5)+len)
  ctx.closePath()
  ctx.stroke()
}

function piechart () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let colors = shuffle(getCurrentPalette())
  let x = 50, y = 50, r = 12, i = 0
  ctx.fillStyle = randomPick(colors)
  console.log(ctx.fillColor, colors)
  ctx.globalAlpha = document.getElementById("opacity").value/100

  for (; i < 25; i++)
    dotsNear(ctx, Math.random() * W, Math.random() * H, 1 + Math.random() * 12)
}

function dotsNear(ctx,x,y,r) {
  let i = 0
  x += 12
  for (; i < 26; i++) {
    ctx.beginPath()
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    ctx.fill()
    x += pet(11)
    y += pet(9)
    r = 5 + pet(3)
  }
}


function dotsNear2(ctx,x,y,r) {
  let i = 0
  x += 4
  for (; i < 17; i++) {
    ctx.beginPath()
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    ctx.fill()
    x += pet(9)
    y += pet(9)
   // r = 2 + pet(1)
  }
}
function labyrinth () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let colors = shuffle(getCurrentPalette())
  ctx.clearRect(0,0,W,H)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.lineWidth = 2 + Math.floor(Math.random() * 40)
  ctx.lineCap = "round"
  ctx.lineJoin = "round"
  ctx.strokeStyle = randomPick(colors)
  let bump = randomPick([1.25, 1.5, 2, 1, 0.5])
  
  console.log(bump)
  let pad = 40, r = W/2.5, offset = ctx.lineWidth * 1.7
  let x = W/2, y = H/2
  let a = Math.random() * 2 * Math.PI
  let start = a, end = a+bump*Math.PI
  let xl = 0, yl = 0, i = 0, ccw = false
  ctx.beginPath()
  while (r > 4) {
    r -= offset
    ccw = (Math.random() > 0.8)? true: false;
    if (r < 2*ctx.lineWidth)
      break;
    ctx.arc(x, y ,r, start, end, ccw)
    xl = r * Math.cos(end)+x;
    yl = r * Math.sin(end)+y;
    ctx.moveTo(xl, yl)
    xl = (r - offset) * Math.cos(end)+x;
    yl = (r - offset) * Math.sin(end)+y;
    ctx.lineTo(xl, yl)
    start = end
    end += bump*Math.PI
    i++
  }
  ctx.stroke()
}

function messagepad () { // while you were ouy
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let cx = W/2, cy = W/2
  let colors = shuffle(getCurrentPalette())
  ctx.clearRect(0,0,W,H)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.lineWidth = 5
  ctx.fillStyle = document.getElementById("paintcolor").value//"#ffc0cb"
  ctx.fillRect(0,0,W,H)
  ctx.strokeStyle = "#000000"
  let pad = 40
  ctx.strokeRect(pad-3,pad-3,W-pad*2,H-pad*2) // frame
  ctx.lineWidth = 2
  ctx.strokeRect(pad+6,pad+6,W-pad*2-16,H-pad*2-16) // frame
  ctx.lineWidth = 3
  let x = 0, y = 0
  //ctx.strokeRect(W-pad-290, pad, 279, 60) // urgent
  
  
  ctx.globalAlpha /= 2
  ctx.fillStyle = "#505050"
  ctx.fillRect(W-pad-210, pad*1.4-8, 196, 53)
  ctx.globalAlpha *= 2
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.fillRect(W-pad-60, pad+16, 40, 40) // check box
  ctx.strokeRect(W-pad-60, pad+16, 40, 40) // check box
  let text = "Urgent"
  let face = "serif"
  ctx.font = "800 "+(34)+"pt " + face
  let w = ctx.measureText(text).width
  x = W-pad-270, y = pad * 2
  ctx.fillStyle = "#000000"
  ctx.fillText(text, x+60, y+8)
  y += 24
  ctx.beginPath()
  ctx.moveTo(pad+84, y)
  ctx.lineTo(W-pad*1.4, y)
  ctx.stroke()
  y+= 60
  ctx.beginPath()
  ctx.moveTo(pad+104, y)
  ctx.lineTo(cx+80, y)
  ctx.stroke()
  
  ctx.beginPath()
  ctx.moveTo(cx+160, y)
  ctx.lineTo(W-pad*1.4, y)
  ctx.stroke()
  y += 66
  ctx.globalAlpha /= 2
  ctx.fillStyle = "#505050"
  ctx.fillRect(pad + 12, y-48, W-pad*2.6-2, 80)
  ctx.globalAlpha *= 2
  y += 130
  ctx.strokeRect(cx + cx/4-5, y, W/3, H/5+24)
  let i = 0 // checkboxes
  for (; i < 5; i++) {
    ctx.strokeRect(cx + cx/4+8,y+(i * 46)+12, 30,30)
  }
  y = 100
  
  i = 0 // short lines
  y = cy - 3*60
  for (; i < 4; i++) {
    ctx.beginPath()
    ctx.moveTo(pad+14, y)
    ctx.lineTo(cx + cx/4-8-2, y)
    ctx.stroke()
    y+= 60
  }
  
  i = 0
  y = cy+60
  for (; i < 7; i++) {
    ctx.beginPath()
    ctx.moveTo(pad+14, y)
    ctx.lineTo(W-pad*1.4, y)
    ctx.stroke()
    y+= 60
  }
    ctx.fillStyle = "#000000"

  text = "A-9711"
  face = "sans-serif"
  ctx.font = (12)+"pt " + face
  x = pad+20, y = H-pad * 2 -10
  ctx.fillText(text, x, y)
  text = "T-3002"
  ctx.fillText(text, x, y+20)

}


function calendar () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let colors = shuffle(getCurrentPalette())
  ctx.clearRect(0,0,W,H)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.lineWidth = 3
  let firstofmonth = new Date()
  firstofmonth.setDate(1)
  let thedays = ["S", "M", "T", "W", "T", "F", "S"]
  let today = new Date()
  let day = firstofmonth.getDay()
  lastDayOfMonth = (new Date(today.getFullYear(), today.getMonth()+1, 0)).getDay()
  let pad = 40
  let len = Math.floor((W - 2 * pad)/9)
  let top = (H - 6*len)/2 - len/4
  let left = ((W - (7*len))-pad)/2
  let x = left, y = top
  let i = 0, row = 1, col = 1
  for (; i < 7; i++) {
    ctx.beginPath()
    ctx.moveTo(x+pet(5),y)
    ctx.lineTo(x+len, y+pet(5))
    ctx.lineTo(x+len+pet(5), y+len/2)
    ctx.lineTo(x, y+len/2+pet(5))
    ctx.closePath()
    ctx.strokeStyle = randomPick(colors)
    ctx.fillStyle = randomPick(colors)
    if (Math.random() > 0.2) {
      let face = "AmericanTypewriter-Bold"
      ctx.font = "800 "+(Math.floor(len/3.3))+"pt " + face
      let w = ctx.measureText(thedays[i]).width
      ctx.fillText(thedays[i], pet(5)+(x+len/2) - w/2, pet(5)+y +len/2.7)
      ctx.stroke()
    } else
      ctx.fill()
    x += len
  }
  x = left, y = top+ len/2
  i = 0, row = 1, col = 1
  for (; i < 42; i++) {
    ctx.beginPath()
    ctx.moveTo(x+pet(5),y)
    ctx.lineTo(x+len, y+pet(5))
    ctx.lineTo(x+len+pet(5), y+len)
    ctx.lineTo(x, y+len+pet(5))
    ctx.closePath()
    ctx.strokeStyle = randomPick(colors)
    ctx.fillStyle = randomPick(colors)
    if ((row === 1 && i < day) || (row === 6 && col > lastDayOfMonth+1))
      ;
    else {
      if (Math.random() > 0.3)
        ctx.fill()
      else
        ctx.stroke()
    }
    col++
    x += len
    if (col === 8) {
      x = left
      y += len
      row++
      col = 1
    }
  }
}


function periodictable () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  let colors = shuffle(getCurrentPalette())
  ctx.clearRect(0,0,W,H)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.lineWidth = 3
  let pad = 40
  let len = (W - 2* pad)/18
  let top = (H - 10*len)/2
  let x = pad, y = top
  let i = 0, row = 1, col = 1
  for (; i < 180; i++) {
    ctx.beginPath()
    ctx.moveTo(x+pet(5),y)
    ctx.lineTo(x+len, y+pet(5))
    ctx.lineTo(x+len+pet(5), y+len)
    ctx.lineTo(x, y+len+pet(5))
    ctx.closePath()
    ctx.strokeStyle = randomPick(colors)
    ctx.fillStyle = randomPick(colors)
    if ((row === 8) || (row > 7 && (col < 4 || col > 16)) || ((row === 2 || row ===3) && (col > 2 && col < 13))|| (row === 1 && (col>1 && col<18)))
      ;
    else {
      if (Math.random() > 0.3)
        ctx.fill()
      else
        ctx.stroke()
    }
    col++
    x += len
    if (col === 19) {
      x = pad
      y += len
      row++
      col = 1
    }
  }
}

function datedue () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 2
  let monthIdx = Math.floor(Math.random() * 12)
  let months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"]
  let colors = ["red", "blue", "darkblue", "green", "black", "indigo"], pre = " 0"
  let dates = [], i = 1
  let header1 = "DATE   DUE"
  let header2 = "Return book on or before the last date stamped."
  let header3 = "Failure to comply will result is a fine."
  for (; i < 29; i++) {
    if (i > 9)
      pre = " "
      dates.push(pre+i)
  }
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let face = "arial"
  let text = randomPick(months)
  let color = randomPick(colors)
  let year = randomPick([1994, 1967, 2003, 1974, 1981, 1995])
  ctx.fillStyle = "#fefdcc"
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.fillStyle = "#707070"

  face = "arial"
  ctx.font = "100 "+(50)+"pt " + face
  let w = ctx.measureText(header1).width
  ctx.fillText(header1, canvas.width/2 - w/2, 60)

  face = "AmericanTypewriter-Bold"
  ctx.font = "800 "+(22)+"pt " + face
  w = ctx.measureText(header2).width
  ctx.fillText(header2, canvas.width/2 - w/2, 180)

  face = "AmericanTypewriter-Bold"
  ctx.font = "100 "+(18)+"pt " + face
  w = ctx.measureText(header3).width
  ctx.fillText(header3, canvas.width/2 - w/2, 210)
  ctx.fillStyle = randomPick(colors)

  let size = 28
  let x = 48, y = 261
  let maxdates = 11 + Math.random() * 50
  i = 0
  for (; i < maxdates; i++) {
    ctx.save()
    ctx.rotate((Math.random() - 0.5)/12)
    text = months[monthIdx]
    face = "arial"
    if (Math.random() > 0.8)
      monthIdx = (monthIdx + 1) % 12
    if (Math.random() > 0.7)
      ctx.fillStyle = randomPick(colors)
    ctx.globalAlpha = 0.6
    ctx.strokeStyle = "#505050"
    ctx.font = "500 "+size+"pt " + face
    w = ctx.measureText(text).width
    ctx.fillText(text, x, y)
    ctx.globalAlpha = 0.3
    ctx.fillText(text, x+pet(9), y+pet(7))
    ctx.fillText(text, x+pet(7), y+pet(9))
    
    //drawBlobAt(ctx,x,y,12)
    ctx.globalAlpha = 0.2
    if (Math.random() > 0.95)
      dotsNear(ctx,x+w/2+pet(20),y-12+pet(11),7+pet(4))
    ctx.globalAlpha = 0.3

    text = randomPick(dates)
    face = "AmericanTypewriter"
    ctx.font = "500 "+(size+4)+"pt " + face
    ctx.globalAlpha = 0.6
    ctx.fillText(text, x+w+pet(9), y)
    ctx.globalAlpha = 0.4
    ctx.fillText(text, x+w, y+pet(9))
    ctx.fillText(text, x+w, y+pet(9))
    
    ctx.globalAlpha = 0.1
    if (Math.random() > 0.95)
      dotsNear(ctx,x+w+pet(20),y-12+pet(11),7+pet(4))
    ctx.globalAlpha = 0.3
    ctx.restore()
    y += 55
    if (Math.random() > 0.99) {
      year += 1
      monthIdx = 0
    }
    if (Math.random() > 0.9)
      y += 54
    if (y > canvas.height - 40) {
      y = 260
      x += 160
    }
  }
  ctx.globalAlpha = 0.6
  let eend = Math.floor((canvas.height-220)/64)
  eend = eend * 64 + 220
  i = 0, x = 50 , y = 220
  ctx.strokeStyle = "#707070"
  for (; i < 7; i++) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(x, eend)//canvas.height-20)
    ctx.closePath()
    ctx.stroke()
    x += canvas.width/7
  }
  
  i = 0, x = 50 , y = 220
  let end = 50 + 6*canvas.width/7
  ctx.strokeStyle = "#707070"
  ctx.lineWidth = 6
  while(y < canvas.height-10) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(end, y)
    ctx.closePath()
    ctx.stroke()
    y += 64
    ctx.lineWidth = 1
  }
}

function interdepartmental () { // ideal 8 X 10
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 2 //+ document.getElementById("featuresize").value/4
  let alpha = document.getElementById("opacity").value
  let color = document.getElementById("paintcolor").value
  let BACK = document.getElementById("grungy").checked
  let small = true, half = true
  document.getElementById("paintcolor").value = "#eaae3a"
  fill()
  let face = "helvetica"
  let text = "INTER-DEPARTMENTAL MAIL"
  let size = 40
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = "#505050"
  ctx.strokeStyle = "#505050"
  ctx.font = size+"pt " + face
  let x = canvas.width/2, y = 78
  w = ctx.measureText(text).width
  if (!BACK) {
    ctx.strokeText(text, x-w/2, y)
  }
  if (BACK)
    y += 120
  
  y += 38
  size = 14
  text = "CROSS OUT ENTIRE LINE WHEN RECEIVED AND RE-USE UNTIL ALL LINES ARE FULL."
  ctx.font = "italic 900 "+size+"pt " + "serif"
  w = ctx.measureText(text).width
  ctx.fillText(text, x-w/2, y)
  
  y += 42
  size = 18
  face = "helvetica"
  text = "DATE            DELIVER TO            DEPARTMENT            SENT BY            DEPARTMENT"
  ctx.font = "900 "+size+"pt " + "serif"
  w = ctx.measureText(text).width
  ctx.fillText(text, x-w/2, y)
  
  ctx.lineWidth = 1
  let i = 0
  x = 30, y = 132
  if (BACK)
    y += 120
  ctx.shadowOffsetX = 0
  ctx.shadowOffsetY = 0
  while (y < canvas.height) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(canvas.width-30, y)
    ctx.closePath()
    ctx.stroke()
    y += 34
  }
  let lines = [172, 396, 636, 808]
  i = 0, x = 0, y = 132
  if (BACK)
    y += 120
  for (; i < lines.length; i++) {
    ctx.beginPath()
    ctx.moveTo(lines[i], y)
    ctx.lineTo(lines[i], canvas.height-20)
    ctx.closePath()
    ctx.stroke()
  }
  
  // six holes
  i = 0
  x = 280 // 800
  y = canvas.height / 3 + 53
  ctx.fillStyle = "#ffffff"
  ctx.shadowOffsetX = 0
  ctx.shadowOffsetY = 0
  for (; i < 3; i++) {
    ctx.beginPath()
    ctx.arc(x,y,16, 0, 2 * Math.PI)
    ctx.closePath()
    ctx.fill()
    
    ctx.beginPath()
    ctx.arc(x+500,y,16, 0, 2 * Math.PI)
    ctx.closePath()
    ctx.fill()
    y += canvas.height/4
  }
  
  if (BACK) {
    // top flap of envelope
    x = 0, y = 0
    ctx.fillStyle = "#eaae3a"
    ctx.shadowColor = '#505050';
    ctx.shadowBlur = 9
    
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(x + 50, y + 130)
    ctx.lineTo(canvas.width - 50, y + 130)
    ctx.lineTo(canvas.width, y)
    ctx.closePath()
    ctx.fill()
    // center line
    ctx.shadowColor = '#505050';
    ctx.shadowBlur = 4
    ctx.shadowOffsetX = 3;
    ctx.beginPath()
    ctx.moveTo(canvas.width/2,132)
    ctx.lineTo(canvas.width/2, canvas.height - 60)
    ctx.closePath()
    ctx.stroke()
    ctx.shadowColor = '#505050';
        ctx.shadowBlur = 9

    // red strings
    x = canvas.width/2 - 18
    y = 54
    ctx.lineCap = "round"
    ctx.lineWidth = 7
    ctx.strokeStyle = "red"
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(x + 1, y + 140)
    ctx.stroke()
    
    x = canvas.width/2 + 18
    y = 54
    ctx.lineWidth = 7
    ctx.strokeStyle = "red"
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(x + 1, y + 140)
    ctx.stroke()
    
    x = canvas.width/2 + 18
    y = 54
    ctx.lineWidth = 7
    ctx.strokeStyle = "red"
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(x - 25, y + 140)
    ctx.stroke()
    
    y += 180
    ctx.beginPath()
    ctx.arc(x+20, y, 50+pet(20), 1.4*Math.PI, Math.PI/2+pet(1), true)
    ctx.stroke()
    
    // seals
    ctx.shadowOffsetX = 3;
    ctx.shadowOffsetY = 3;
    
    x = canvas.width/2 + pet(7)
    y = 54
    ctx.fillStyle = "red"
    ctx.shadowColor = '#704000';
    ctx.shadowOffsetX = 2;
    ctx.shadowOffsetY = 2;
    
    ctx.beginPath()
    ctx.arc(x,y,40,0,2*Math.PI)
    ctx.closePath()
    ctx.fill()
    
    ctx.fillStyle = "#b5a642"
    ctx.beginPath()
    ctx.arc(x,y,16,0,2*Math.PI)
    ctx.closePath()
    ctx.fill()
    
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;
    ctx.fillStyle = "#504020"
    ctx.beginPath()
    ctx.arc(x,y,12,0,2*Math.PI)
    ctx.closePath
    ctx.fill()
    x+= pet(7)
    y += 140
    ctx.shadowOffsetX = 2;
    ctx.shadowOffsetY = 2;
    ctx.fillStyle = "red"
    ctx.beginPath()
    ctx.arc(x,y,40,0,2*Math.PI)
    ctx.closePath()
    ctx.fill()
    
    ctx.fillStyle = "#b5a642"
    ctx.beginPath()
    ctx.arc(x,y,16,0,2*Math.PI)
    ctx.closePath()
    ctx.fill()
    
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;
    ctx.fillStyle = "#504020"
    ctx.beginPath()
    ctx.arc(x,y,12,0,2*Math.PI)
    ctx.closePath()
    ctx.fill()
    
    // bottom back flap
    // top flap of envelope
    x = 0, y = 0
    ctx.fillStyle = "#e9a93a"
    ctx.shadowColor = '#505050';
    ctx.shadowBlur = 9
    ctx.shadowOffsetX = 2;
    ctx.shadowOffsetY = 2;
    ctx.beginPath()
    ctx.moveTo(x,canvas.height)
    ctx.lineTo(x + 50, canvas.height - 110)
    ctx.lineTo(canvas.width - 50, canvas.height - 110)
    ctx.lineTo(canvas.width, canvas.height)
    ctx.closePath()
    ctx.fill()
    
  }
  ctx.shadowBlur = 0
  ctx.shadowOffsetX = 0
  ctx.shadowOffsetY = 0
  document.getElementById("opacity").value = alpha
  document.getElementById("paintcolor").value = color
}
/*
function roundedRect (x,y,W,H) {
  x = 0, y = 0, W = 1080 , H = 1080
  let radius = 18, h = 20
 let r = W -60
 let  b = H-60
  ctx.fillStyle = 'red'
  ctx.beginPath();
  ctx.lineWidth="4";
  ctx.moveTo(x+radius, y);
  ctx.lineTo(r-radius, y);
  ctx.quadraticCurveTo(r, y, r, y+radius);
  ctx.lineTo(r, y+h-radius);
  ctx.quadraticCurveTo(r, b, r-radius, b);
  ctx.lineTo(x+radius, b);
  ctx.quadraticCurveTo(x, b, x, b-radius);
  ctx.lineTo(x, y+radius);
  ctx.quadraticCurveTo(x, y, x+radius, y);
  ctx.closePath()
  ctx.fill()
}*/

function roundedRect (x, y, w, h, r, ctx, BF) {
  if (w < 2 * r) r = w / 2;
  if (h < 2 * r) r = h / 2;
  ctx.save()
  ctx.beginPath();
  ctx.moveTo(x+r+pet(7), y+pet(6));
  ctx.arcTo(x+w, y,   x+w, y+h, r); // across to right
  ctx.arcTo(x+w, y+h, x,   y+h, r);
  //x += pet(6)
  ctx.arcTo(x+pet(7),   y+h+pet(5), x,   y,   r);
 // x += pet(6)
  ctx.arcTo(x,   y,   x+w, y,   r);
  ctx.closePath();
  ctx.fill()
  ctx.clip()
  if (BF) {
    blobFill(ctx.fillStyle)
    ctx.fillStyle = "#ececdb"
    ctx.fillRect(w/2, y, w/2, h)
  }
  ctx.restore()
}


function moleskine2 () { // 3D
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let alpha = document.getElementById("opacity").value
  let color = document.getElementById("paintcolor").value
  let small = true, half = true
  let W = canvas.width, H = canvas.height
  document.getElementById("paintcolor").value = "#fdffee"
  ctx.clearRect(0,0,W,H)
  ctx.shadowColor = '#404040';
  let j = 0, x = 20, y = 20, d = 0, BF = true
  for(;j < 5; j++) {
    BF = true
    if (j % 2 ===0)
      ctx.fillStyle = randomColorLight()
    else
      ctx.fillStyle = "#ececdb"//randomColorLight()
    
    if (j === 0) {
      ctx.fillStyle = "#000000"
      ctx.shadowBlur = 8 + Math.random() * 20
      ctx.shadowOffsetX = 5 + Math.random() * 6;
      ctx.shadowOffsetY = 5 + Math.random() * 6;
      BR = false
    }
    if (j === 4) {
      BF = false
      ctx.fillStyle = "#feffee"
    }
    roundedRect(x+d, y, W-49-d, H-49, 14, ctx, BF)
    d += 7 + pet(3)
    ctx.shadowBlur = 0
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;
  }

  rcc()
  let mode = document.getElementById("mode").value
  ctx.globalCompositeOperation = "source-atop"
  afold()
  ctx.globalCompositeOperation = mode
  rc()
 // document.getElementById("paintcolor").value = "#565555"
 // document.getElementById("opacity").value = 21
 // flipH()
//  document.getElementById("paintcolor").value = "#565555"
 // edgeSmear(small)
//  document.getElementById("paintcolor").value = "#fefeee"
//  flipH()
 //ctx.fillRect(0,0,25,canvas.height)
  //edgeSmear(small)
 // document.getElementById("opacity").value = 100
//  document.getElementById("paintcolor").value = "#222228"
  //roundedFrame()
  document.getElementById("opacity").value = alpha
  document.getElementById("paintcolor").value = color
}

function moleskine () { // grid paper
  if (document.getElementById("grungy").checked) {
    moleskinDay()
    return
  }
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let alpha = document.getElementById("opacity").value
  let color = document.getElementById("paintcolor").value
  let small = true, half = true
  document.getElementById("paintcolor").value = "#fdffee"
 // canvas.width = 1160
 // canvas.height = 900
  fill()
  // optonal grid?
  ctx.strokeStyle = "#ccccdc"
  ctx.lineWidth = 1
  let i = 0, x = 27, y = 28
  while (y < canvas.height) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(canvas.width-27, y)
    ctx.closePath()
    ctx.stroke()
    y += 20
  }
  i = 0, y = 0, x = 30
  while (x < canvas.width) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(x, canvas.height)
    ctx.closePath()
    ctx.stroke()
    x += 20
    if (x > canvas.width/2 && half) {
      half = false
      x -= 4
    }
  }
  rcc()
  afold()
  rc()
  document.getElementById("paintcolor").value = "#565555"
  document.getElementById("opacity").value = 21
  flipH()
  document.getElementById("paintcolor").value = "#565555"
  edgeSmear(small)
  document.getElementById("paintcolor").value = "#fefeee"
  flipH()
  ctx.fillRect(0,0,25,canvas.height)
  edgeSmear(small)
  document.getElementById("opacity").value = 100
  document.getElementById("paintcolor").value = "#222228"
  roundedFrame()
  document.getElementById("opacity").value = alpha
  document.getElementById("paintcolor").value = color
}


function moleskinDay () { // day planer
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let alpha = document.getElementById("opacity").value
  let color = document.getElementById("paintcolor").value
  let small = true, half = true
  let monthsFR = [ "janvier", "fvrier", "mars", "avril", "mai", "juin", "juillet", "aot", "septembre", "octobre", "novembre", "dcembre"]
  let months = ["Janeiro", "Fevereiro", "Maro", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"]
  let daysFR = ["DIMANCHE", "LUNDI", "MARDI","MERCREDI","JEUDI","VENDREDI","SAMEDI"]
  let days = ["DOMINGO", "SEGUNDA-FEIRA", "TERA-FEIRA", "QUARTA-FEIRA", "QUINTA-FEIRA", "SEXTA-FEIRA", "SBADO"]
  let week = "semana "
  document.getElementById("paintcolor").value = "#fdffee"
 // canvas.width = 1160
 // canvas.height = 900
  fill()
  // optonal grid?
  ctx.strokeStyle = "#ccccdc"
  ctx.lineWidth = 1
  let hour = 8
  ctx.font = 12+"px serif"
  ctx.fillStyle = document.getElementById("paintcolor").value = "#666666"
  let voff = randomPick([1,2,-1,-2])
    let lasty = 0

  let linespace = Math.floor((canvas.height - 220)/22)
 //console.log( (canvas.height - 144)/22 )
  let i = 0, x = 27, y = 144, last = 0
  while (i < 22) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(canvas.width/2, y)
    ctx.closePath()
    ctx.stroke()
    if (hour < 23) {
      ctx.fillText(hour, 52, y+linespace-5)
      ctx.fillText(hour, canvas.width/2+44, y+linespace-5+voff)
      last = y
    }
    y += linespace
    hour += 1
    i++
  }
  lasty = y - linespace
  i = 0, x = canvas.width/2, y = 144 + voff
  while (i < 22) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(canvas.width-27, y)
    ctx.closePath()
    ctx.stroke()
    y += linespace
    i++
  }
  ctx.font = "12px serif monospace"
  ctx.globalCompositeOperation ="luminosity"
  ctx.fillText("\u{26C5}", 52, lasty-linespace-5)
  ctx.fillText("\u{1F321}", 52, lasty-5)
  ctx.fillText("\u{26C5}", canvas.width/2+44, lasty-linespace-5+voff)
  ctx.fillText("\u{1F321}", canvas.width/2+44, lasty-5+voff)
  ctx.globalCompositeOperation = "source-over"
  const today = new Date()
  const tomorrow = new Date(today)
  tomorrow.setDate(tomorrow.getDate() + 1)
  ctx.fillText(week+today.getWeek(), canvas.width - 88, lasty-5+voff)// FR: "la semaine"
  let size = 20//document.getElementById("featuresize").value/6.25
  if (Math.random() > 0.5) {
    months = monthsFR
    days = daysFR
    week = "la semaine "
  }
  ctx.font = size+"px serif"
  ctx.fillStyle = document.getElementById("paintcolor").value = "#666666"
  x = 40, y = 70
  ctx.fillText(days[today.getDay()], x, y)
  ctx.font = 14+"px serif"
  ctx.fillText(months[today.getMonth()], x, y+26)
  ctx.font = 22+"px serif"
  ctx.fillText(today.getDate(), x, y+56)
  ctx.textAlign = 'right';
  x = canvas.width-40, y = 70
  ctx.font = size+"px serif"
  ctx.fillText(days[tomorrow.getDay()], x, y)
  ctx.font = 14+"px serif"
  ctx.fillText(months[tomorrow.getMonth()], x, y+26)
  ctx.font = 22+"px serif"
  ctx.fillText(tomorrow.getDate(), x, y+56)

  rcc()
  afold()
  rc()
  document.getElementById("paintcolor").value = "#5655ff"
  document.getElementById("opacity").value = 21
  flipH()
  document.getElementById("paintcolor").value = "#565555"
  edgeSmear(small)
  document.getElementById("paintcolor").value = "#fefefe"
  flipH()
  edgeSmear(small)
  document.getElementById("opacity").value = 100
  document.getElementById("paintcolor").value = "#222228"
  roundedFrame()
  document.getElementById("opacity").value = alpha
  document.getElementById("paintcolor").value = color
}

Date.prototype.getWeek = function() {
  let date = new Date(this.getTime());
  date.setHours(0, 0, 0, 0);
  // Thursday in current week decides the year.
  date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
  // January 4 is always in week 1.
  let week1 = new Date(date.getFullYear(), 0, 4);
  // Adjust to Thursday in week 1 and count number of weeks from date to week1.
  return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000
                        - 3 + (week1.getDay() + 6) % 7) / 7);
}

function nested () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineCap = 'square'
  ctx.lineJoin = 'meter'
  let ratio = 1/1.61803
  let W = canvas.width
  if (W > canvas.height)
    W = canvas.height
  let adjust = ctx.lineWidth/2
  let x = 0, y = 0, line = true
  let xd = 0, yd = 0
  drawRectAt(ctx, x+adjust, y+adjust, W-(adjust*2), line) // first square
  let depth = Math.floor((-1/12 * ctx.lineWidth) +(49/6)) // tbd: 3 to 6

  let i = 0, x2, y2, W0
  for (;i < depth; i++) {
    W0 = W
    W *= ratio
    
    let r  = Math.random()
    if (r > 0.667)
      xd = 0
    else
    if (r > 0.333)
      xd = W
    else
      xd = W0 - W
    x += Math.floor(xd)
    r = Math.random()
    if (r > 0.667)
      yd = 0
    else
    if (r > 0.333)
      yd = W
    else
      yd = W0 - W
    y += Math.floor(yd)
    drawRectAt(ctx, x, y, Math.floor(W), line)
  }
}

function neckerline () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.lineWidth = 1+ document.getElementById("featuresize").value/4
  let W = canvas.width
  if (W > canvas.height)
    W = canvas.height
  let margin = W/20
  let w4 = (W-2*margin)/3//(2+Math.floor(Math.random() * 3))//document.getElementById("rows").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineCap = 'round'
  ctx.lineJoin = 'round'

  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  //bottom
  ctx.beginPath();
  ctx.moveTo(margin, W-margin)
  ctx.lineTo(w4+margin, W-w4-margin)
  ctx.lineTo(W-margin, W-w4-margin)
  ctx.lineTo(W-w4-margin, W-margin)
  ctx.lineTo(margin, W-margin)
  ctx.stroke()
  //left side
  ctx.beginPath();
  ctx.moveTo(margin, w4+margin)
  ctx.lineTo(w4+margin, margin)
  ctx.lineTo(w4+margin, W-w4-margin)
  ctx.lineTo(margin, W-margin)
  ctx.lineTo(margin, w4+margin)
  ctx.stroke()
    //upper right
  ctx.beginPath();
  ctx.moveTo(w4+margin, 0+margin)
  ctx.lineTo(W-margin, 0+margin)
  ctx.lineTo(W-margin, W-w4-margin)
  ctx.lineTo(w4+margin, W-w4-margin)
  ctx.stroke()
  
  // lower left
  ctx.beginPath();
  ctx.moveTo(margin, w4+margin)
  ctx.lineTo(W-w4-margin, w4+margin)
  ctx.lineTo(W-w4-margin, W-margin)
  ctx.lineTo(margin, W-margin)
  ctx.stroke()
  
  //top
  ctx.beginPath();
  ctx.moveTo(margin, w4+margin)
  ctx.lineTo(w4+margin, margin)
  ctx.lineTo(W-margin, margin)
  ctx.lineTo(W-w4-margin, w4+margin)
  ctx.stroke()
  
  //right side
  ctx.beginPath();
  ctx.moveTo(W-w4-margin, w4+margin)
  ctx.lineTo(W-margin, margin)
  ctx.lineTo(W-margin, W-w4-margin)
  ctx.lineTo(W-w4-margin, W-margin)
  ctx.stroke()
}
/*
function elle () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  //ctx.save()
  clip()
  let margin = canvas.width/50 * (2+Math.floor(Math.random() * 10))//
  let W = canvas.width
  let w4 = (canvas.width -(2*margin))/4
  let w2 = (canvas.width -(2*margin))/2

  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['#ff0000', '#00ff00', '#FFFF00', '#FFA500', '#800080', "#0000ff"])
  let grunge = false//document.getElementById("grungy").checked
  
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)

  ctx.beginPath();
  ctx.moveTo(0+margin, W-w4-margin) // square in lower left
  ctx.lineTo(w4+margin, W-w4-margin)
  ctx.lineTo(w4+margin, W-margin)
  ctx.lineTo(0+margin, W-margin)
 // ctx.lineTo(w4, W-w4)
  ctx.closePath()
  //if (grunge)
    ctx.fillStyle = colors[0]//randomGradient(canvas, colors[0])
  ctx.fill()
  
  ctx.beginPath();
  ctx.moveTo(0+margin, w2+margin)
  ctx.lineTo(w2+margin, w2+margin)
  ctx.lineTo(w2+margin, W-margin)
  ctx.lineTo(w4+margin, W-margin)
  ctx.lineTo(w4+margin, W-w4-margin)
  ctx.lineTo(0+margin, W-w4-margin)
  ctx.closePath()
  //if (grunge)
    ctx.fillStyle = colors[1]//randomGradient(canvas, colors[0])
  ctx.fill()

  ctx.beginPath();
  ctx.moveTo(0+margin, w4+margin)
  ctx.lineTo(w2+w4+margin, w2-w4+margin)
  ctx.lineTo(w2+w4+margin, W-margin)
  ctx.lineTo(w2+margin, W-margin)
  ctx.lineTo(w2+margin, W-w2-margin)
  ctx.lineTo(0+margin, W-w2-margin)
  ctx.closePath()
  //if (grunge)
    ctx.fillStyle = colors[2]//randomGradient(canvas, colors[0])
  ctx.fill()
  
  ctx.beginPath();
  ctx.moveTo(0+margin, 0+margin)
  ctx.lineTo(W-margin, 0+margin)
  ctx.lineTo(W-margin, W-margin)
  ctx.lineTo(W-w4-margin, W-margin)
  ctx.lineTo(W-w4-margin, w4+margin)
  ctx.lineTo(0+margin, w4+margin)
  ctx.closePath()
  //if (grunge)
    ctx.fillStyle = colors[3]//randomGradient(canvas, colors[0])
  ctx.fill()
}

function flower () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  clip()
  let W = canvas.width
  let margin = W/20
  let w4 = (W-2*margin)/(4 + (document.getElementById("rows").value/2))
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['#ff0000', '#00ff00', '#FFFF00', '#FFA500', '#800080', "#0000ff"])
  let grunge = document.getElementById("grungy").checked
  w4 *= 0.5
  let xf = w4 //* 1.0
  let r = W
  let inc = W/2
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  let i = 0, x = 0, y = 0

  if (Math.random() > 0.5) {
    x = 0, y = 0
    ctx.beginPath();
    ctx.moveTo(x, y) // \
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = randomGradient(canvas, colors[0])
    ctx.fill()
    x = W, y = 0
    
    ctx.beginPath();
    ctx.moveTo(x, y) // \
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = randomGradient(canvas, colors[1])
    ctx.fill()
    x = 0, y = W
    
    ctx.beginPath();
    ctx.moveTo(x, y) // \
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = randomGradient(canvas, colors[2])
    ctx.fill()
    x = W, y = W
    
    ctx.beginPath();
    ctx.moveTo(x, y) // \
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = randomGradient(canvas, colors[3])
    ctx.fill()
  } else {
    x = 0, y = W
    
    ctx.beginPath();
    ctx.moveTo(x, y) // \
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = randomGradient(canvas, colors[2])
    ctx.fill()
    x = W, y = W
    
    ctx.beginPath();
    ctx.moveTo(x, y) // \
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = randomGradient(canvas, colors[3])
    ctx.fill()
    
    x = 0, y = 0
    ctx.beginPath();
    ctx.moveTo(x, y) // \
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = randomGradient(canvas, colors[0])
    ctx.fill()
    x = W, y = 0
    
    ctx.beginPath();
    ctx.moveTo(x, y) // \
    ctx.arc(x,y,r,0,2*Math.PI)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = randomGradient(canvas, colors[1])
    ctx.fill()
  }
}

function folded () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  clip()
  let W = canvas.width
  let margin = W/20
  let w4 = (W-2*margin)/(2+Math.floor(Math.random() * 10))//
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  w4 *= 0.5
  let xf = w4 //* 1.0

  let p1 = [margin, margin] //top left
  let p2 = [w4+margin, margin]  // top
  let p3 = [margin, W-margin]
  let p4 = [w4+ margin, W-margin]
  
  
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(p1[0], p1[1]) // \
  ctx.lineTo(p2[0], p2[1])
  ctx.lineTo(p4[0], p4[1])
  ctx.lineTo(p3[0], p3[1])
  ctx.closePath()
  if (grunge)
    ctx.fillStyle = colors[4]
  ctx.fill()
  
  let maxloop = 7 + +(2+Math.floor(Math.random() * 10))//
  let i = 0
  for (;i < maxloop; i++) {
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p4[0], p4[1]) // /
    ctx.lineTo(p3[0], p3[1])
    ctx.lineTo(p1[0] + xf, p1[1])
    ctx.lineTo(p2[0] + xf, p2[1])
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[i%6]
    ctx.fill()
    
    p1[0] += xf
    p2[0] += xf
    p3[0] += xf
    p4[0] += xf
    
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p1[0], p1[1])
    ctx.lineTo(p2[0], p2[1])
    ctx.lineTo(p4[0], p4[1])
    ctx.lineTo(p3[0], p3[1])
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[(i+1)%6]
    ctx.fill()
  }
}

function pyramid () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  clip()
  let W = canvas.width
  let margin = W/20
  let w4 = (W-2*margin)/(4 + (2+Math.floor(Math.random() * 10)))
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(['red', 'blue', 'yellow', 'orange', 'purple', "green"])
  let grunge = document.getElementById("grungy").checked
  w8 = w4*3

  let p1 = [margin, W/2 + W/4] //left
  let p2 = [W/2, margin]  // top
  let p3 = [W-margin, W/2 + W/4]
  let p4 = [W/2 + W/8-margin, W-margin]
  let p5 = [W/2-W/8+margin, W-W/4-W/8-margin]
  
  if (Math.random() > 0.5) {
   // left
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p1[0], p1[1]) // bottom left
    ctx.lineTo(p2[0], p2[1]) // up
    ctx.lineTo(p4[0], p4[1]) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[0]
    ctx.fill()
    // right
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p2[0], p2[1])
    ctx.lineTo(p3[0], p3[1]) // up
    ctx.lineTo(p4[0], p4[1]) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[1]
    ctx.fill()
    
    
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p2[0], p2[1]) // bottom left
    ctx.lineTo(p3[0], p3[1]) // up
    ctx.lineTo(p5[0], p5[1]) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[2]
    ctx.fill()
    
    // top
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p1[0], p1[1]) // bottom left
    ctx.lineTo(p2[0], p2[1]) //peak
    ctx.lineTo(p5[0], p5[1]) // up
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[3]
    ctx.fill()
   
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p1[0], p1[1]) // bottom left
    ctx.lineTo(p4[0], p4[1]) // up
    ctx.lineTo(p3[0], p3[1]) // up
    ctx.lineTo(p5[0], p5[1]) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[5]
    ctx.fill()
    
 } else {
   
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p1[0], p1[1]) // bottom left
    ctx.lineTo(p4[0], p4[1]) // up
    ctx.lineTo(p3[0], p3[1]) // up
    ctx.lineTo(p5[0], p5[1]) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[5]
    ctx.fill()
    
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p2[0], p2[1]) // bottom left
    ctx.lineTo(p3[0], p3[1]) // up
    ctx.lineTo(p5[0], p5[1]) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[2]
    ctx.fill()
    
    // top
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p1[0], p1[1]) // bottom left
    ctx.lineTo(p2[0], p2[1]) //peak
    ctx.lineTo(p5[0], p5[1]) // up
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[3]
    ctx.fill()
   
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p1[0], p1[1]) // bottom left
    ctx.lineTo(p2[0], p2[1]) // up
    ctx.lineTo(p4[0], p4[1]) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[0]
    ctx.fill()
    // right
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(p2[0], p2[1])
    ctx.lineTo(p3[0], p3[1]) // up
    ctx.lineTo(p4[0], p4[1]) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[1]
    ctx.fill()
  }
}
*/
function house () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let margin = W/16
  let w4 = (W-2*margin)/(4 +(2+Math.floor(Math.random() * 4)))
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let colors = shuffle(getCurrentPalette())
  let grunge = !document.getElementById("grungy").checked
  let w8 = w4*3
  let xf = W-w8
  let yf = W -(2*margin) - w8 - w8/2
  ctx.clearRect(0,0,W,W)
  if (Math.random() > 0.6) {
    // upper right face
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(xf-margin,     W-margin-yf) // bottom left
    ctx.lineTo(xf-margin,     W-w8-margin-yf) // up
    ctx.lineTo(xf-margin+w8/2,W-margin-w8 - w8/2-yf) //peak
    ctx.lineTo(xf+w8-margin,  W-w8-margin- yf)
    ctx.lineTo(xf-margin+w8,  W-margin-yf)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[0]
    ctx.fill()
    
    // floor
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin, W-margin) // bottom left
    ctx.lineTo(margin+w8, W-margin)
    ctx.lineTo(xf-margin+w8,  W-margin-yf)
    ctx.lineTo(xf-margin,     W-margin-yf) // bottom left
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[1]
    ctx.fill()
    
    // left wall
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin, W-margin) // bottom left
    ctx.lineTo(margin, W-w8-margin) // uroof left
    ctx.lineTo(xf-margin,     W-w8-margin-yf) // up
    ctx.lineTo(xf-margin,     W-margin - yf) // bottom left
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[3]
    ctx.fill()
    
   // left roof
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin, W-w8-margin) // uroof left
    ctx.lineTo(margin+w8/2, W-margin-w8 - w8/2) //peak
    ctx.lineTo(xf-margin+w8/2,W-margin-w8 - w8/2 -yf) //peak
    ctx.lineTo(xf-margin,     W-w8-margin-yf) // up
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[4]
    ctx.fill()

    // right roof
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin+w8/2, W-margin-w8 - w8/2) //peak
    ctx.lineTo(w8+margin, W-w8-margin) // roof right
    ctx.lineTo(xf+w8-margin,  W-w8-margin-yf)
    ctx.lineTo(xf-margin+w8/2,W-margin-w8 - w8/2 -yf) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[5]
    ctx.fill()
    
    // right wall
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(w8+margin, W-w8-margin) // roof right
    ctx.lineTo(margin+w8, W-margin) // bottom right
    ctx.lineTo(xf-margin+w8,  W-margin-yf)
    ctx.lineTo(xf+w8-margin,  W-w8-margin-yf)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[2]
    ctx.fill()
    
    // lower left face
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin, W-margin) // bottom left
    ctx.lineTo(margin, W-w8-margin) // uroof left
    ctx.lineTo(margin+w8/2, W-margin-w8 - w8/2) //peak
    ctx.lineTo(w8+margin, W-w8-margin) // roof right
    ctx.lineTo(margin+w8, W-margin) // bottom right
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[1]
    ctx.fill()
  } else {
    // right roof
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin+w8/2, W-margin-w8 - w8/2) //peak
    ctx.lineTo(w8+margin, W-w8-margin) // roof right
    ctx.lineTo(xf+w8-margin,  W-w8-margin-yf)
    ctx.lineTo(xf-margin+w8/2,W-margin-w8 - w8/2 -yf) //peak
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[5]
    ctx.fill()
    
    // right wall
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(w8+margin, W-w8-margin) // roof right
    ctx.lineTo(margin+w8, W-margin) // bottom right
    ctx.lineTo(xf-margin+w8,  W-margin-yf)
    ctx.lineTo(xf+w8-margin,  W-w8-margin-yf)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[2]
    ctx.fill()
    
    // lower left face
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin, W-margin) // bottom left
    ctx.lineTo(margin, W-w8-margin) // uroof left
    ctx.lineTo(margin+w8/2, W-margin-w8 - w8/2) //peak
    ctx.lineTo(w8+margin, W-w8-margin) // roof right
    ctx.lineTo(margin+w8, W-margin) // bottom right
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[1]
    ctx.fill()
    
    // upper right face
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(xf-margin,     W-margin-yf) // bottom left
    ctx.lineTo(xf-margin,     W-w8-margin-yf) // up
    ctx.lineTo(xf-margin+w8/2,W-margin-w8 - w8/2-yf) //peak
    ctx.lineTo(xf+w8-margin,  W-w8-margin- yf)
    ctx.lineTo(xf-margin+w8,  W-margin-yf)
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[0]
    ctx.fill()
    
    // floor
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin, W-margin) // bottom left
    ctx.lineTo(margin+w8, W-margin)
    ctx.lineTo(xf-margin+w8,  W-margin-yf)
    ctx.lineTo(xf-margin,     W-margin-yf) // bottom left
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[1]
    ctx.fill()
    
    // left wall
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin, W-margin) // bottom left
    ctx.lineTo(margin, W-w8-margin) // uroof left
    ctx.lineTo(xf-margin,     W-w8-margin-yf) // up
    ctx.lineTo(xf-margin,     W-margin - yf) // bottom left
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[3]
    ctx.fill()
    
   // left roof
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath();
    ctx.moveTo(margin, W-w8-margin) // uroof left
    ctx.lineTo(margin+w8/2, W-margin-w8 - w8/2) //peak
    ctx.lineTo(xf-margin+w8/2,W-margin-w8 - w8/2 -yf) //peak
    ctx.lineTo(xf-margin,     W-w8-margin-yf) // up
    ctx.closePath()
    if (grunge)
      ctx.fillStyle = colors[4]
    ctx.fill()
  }
}
/*
function origamir () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.globalAlpha = document.getElementById("opacity").value/100
  clip()
  origami()
  ctx.restore()
}

function origami () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let len = W/2, maxy = W/2
  
  // four triangles
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(len, len)
  ctx.lineTo(W, W)
  ctx.lineTo(0, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
  
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(len, len)
  ctx.lineTo(0, 0)
  ctx.lineTo(W, 0)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
  
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(len, len)
  ctx.lineTo(0, 0)
  ctx.lineTo(0, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
  
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(len, len)
  ctx.lineTo(W, 0)
  ctx.lineTo(W, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()

  // 4 rects
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)  // top Horizontal
  ctx.beginPath();
  ctx.moveTo(0, 0)
  ctx.lineTo(W, 0)
  ctx.lineTo(W, len)
  ctx.lineTo(0, len)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(0, len)
  ctx.lineTo(W, len)
  ctx.lineTo(W, W)
  ctx.lineTo(0, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
  
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(0, 0)
  ctx.lineTo(len, 0)
  ctx.lineTo(len, W)
  ctx.lineTo(0, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
  
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(len, 0)
  ctx.lineTo(W, 0)
  ctx.lineTo(W, W)
  ctx.lineTo(len, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()

  // diamond
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(len, 0)
  ctx.lineTo(W, len)
  ctx.lineTo(len, W)
  ctx.lineTo(0, len)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
}


function origami4by4 () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let len = W/2, maxy = W/2
  let quat = len/2
  
  // 4 rects
  // top Horizontal
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(0, 0)
  ctx.lineTo(W, 0)
  ctx.lineTo(W, quat)
  ctx.lineTo(0, quat)
  if (grunge33())
    ctx.fill()
    
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(0, 0)
  ctx.lineTo(quat, 0)
  ctx.lineTo(quat, W)
  ctx.lineTo(0, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
    
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(0, quat)
  ctx.lineTo(W, quat)
  ctx.lineTo(W, len)
  ctx.lineTo(0, len)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
    
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(quat, 0)
  ctx.lineTo(len, 0)
  ctx.lineTo(len, W)
  ctx.lineTo(quat, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
    
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(0, len)
  ctx.lineTo(W, len)
  ctx.lineTo(W, len + quat)
  ctx.lineTo(0, len + quat)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
    
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(len, 0)
  ctx.lineTo(len+quat, 0)
  ctx.lineTo(len+quat, W)
  ctx.lineTo(len, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
    
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(0, len + quat)
  ctx.lineTo(W, len + quat)
  ctx.lineTo(W, W)
  ctx.lineTo(0, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
    
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.beginPath();
  ctx.moveTo(len+quat, 0)
  ctx.lineTo(W, 0)
  ctx.lineTo(W, W)
  ctx.lineTo(len+quat, W)
  ctx.closePath()
  if (grunge33())
    ctx.fill()
}
*/
function strokes () {
  let increase = Math.PI * 2 / 40;
  let x = 0, y = 0, angle = 4.7;
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.save()
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let maxalpha = ctx.globalAlpha
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  let stroke_ct = +document.getElementById("number").value/400 + 1
  let stroke_width = 3
  for (let t = 0; t < stroke_ct; t++) {
    let paths = [];
    let radius = Math.floor(Math.random() * 180) + 20;
    x = 0;
    y = 0;
    let x0 = x;
    let y0 = y;
    angle = Math.floor(Math.random() * 6.42);
    let centx = Math.random()*ctx.canvas.width;
    let centy = Math.random()*ctx.canvas.height;
    let edges = (3 * (Math.floor(Math.random()*6))+6);
    let maxradius = Math.random() * 200 + canvas.width/3;
    increase = Math.PI * 2/edges*0.98;
    points = [];
    bez = [];
    let xmut = -1;
    let ymut = -1;
    if (Math.random() < 0.5)
      xmut *= -1;
    if (Math.random() < 0.5)
      ymut *= -1;
    for (let i = 0; i < edges; i++) {
      radius = (Math.random() * maxradius) + maxradius * 0.8;
      x = radius * Math.cos(angle)+centx;
      y = radius * Math.sin(angle)+centy;
      points.push([x, y]);
      angle += increase;
    }
    paths.push(points);
    let pop = 60
    if (document.getElementById("grungy").checked)
      pop *= 2
    let offset = 20 + stroke_width * 26;
    let numpaths = 20 + Math.random()*30;
    for (let s = 0; s < numpaths; s++) {
      let path = [];
      for (let c = 0; c < points.length; c++) {
        path.push([points[c][0] + xmut*(offset + (pop * (Math.random()-0.5))), points[c][1] + ymut*(offset + (pop * (Math.random()-0.5)))]);
      }
      offset += (Math.random()-0.5) * stroke_width;
      paths.push(path);
    }
    radius = (canvas.width > canvas.height)? canvas.width/2: canvas.height/2;
    angle = Math.random()*6.27;
    let x1 = radius * Math.cos(angle)+centx;
    let y1 = radius * Math.sin(angle)+centy;
    let x2 = radius * Math.cos(angle+3.14)+centx;
    let y2 = radius * Math.sin(angle+3.14)+centy;
    for (let f = 1; f < paths.length; f++) {
      let pts = paths[f];
      ctx.beginPath();
      ctx.lineWidth = 1 + Math.random() * stroke_width;
      let i = 0;
      for (; i < pts.length; i++) {
        x = pts[i][0]
        y = pts[i][1]
        if (i == 0) {
          x0 = x;
          y0 = y;
          ctx.moveTo(x, y);
        } else
        if (i % 3 == 0)
          ctx.bezierCurveTo(pts[i-2][0], pts[i-2][1], pts[i-1][0], pts[i-1][1], pts[i][0], pts[i][1]);
      }
      ctx.globalAlpha = (maxalpha * 0.1 + Math.random() * maxalpha * 0.75)
      ctx.stroke();
    }
  }
  ctx.restore()
}

function strokes2 () {
  let increase = Math.PI * 2 / 40;
  let x = 0, y = 0, angle = 4.7;
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let color = document.getElementById("paintcolor").value
  ctx.save()
  ctx.globalAlpha = document.getElementById("opacity").value/200
  let maxalpha = ctx.globalAlpha
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  let grunge = document.getElementById("grungy").checked
  let stroke_width = 11+ document.getElementById("featuresize").value/20
  let stroke_ct = +document.getElementById("number").value/400 + 1
  for (let t = 0; t < stroke_ct; t++) {
    let paths = [];
    let radius = Math.floor(Math.random() * 50) + 20;
    x = 0;
    y = 0;
    angle = Math.floor(Math.random() * 6.42);
    let centx = Math.random()*canvas.width/2;
    let centy = Math.random()*canvas.height/2;
    let edges = (9 * (Math.floor(Math.random()*6))+2);
    let maxradius = Math.random() * 5 + canvas.width/10;
    increase = Math.PI * 2/edges*0.52;
    points = [];
    bez = [];
    let xmut = -1;
    let ymut = -1;
    if (Math.random() < 0.5)
      xmut *= -1;
    if (Math.random() < 0.5)
      ymut *= -1;
    for (let i = 0; i < edges; i++) {
      centx += pet(canvas.width)//Math.random()*ctx.canvas.width;
      centy += pet(canvas.height)//Math.random()*ctx.canvas.height;
      radius = (Math.random() * maxradius) + maxradius * 0.5;
      x = radius * Math.cos(angle)+centx;
      y = radius * Math.sin(angle)+centy;
      points.push([x, y]);
      angle += increase;
    }
    paths.push(points);
    let pop = 60
    if (grunge)
      pop *= 2
    let offset = 50 + stroke_width * 50;
    let numpaths = 10 + Math.random()*30;
    for (let s = 0; s < numpaths; s++) {
      let path = [];
      for (let c = 0; c < points.length; c++) {
        path.push([points[c][0] + xmut*(offset + (pop * (Math.random()-0.5))), points[c][1] + ymut*(offset + (pop * (Math.random()-0.5)))]);
      }
      offset += (Math.random()-0.5) * stroke_width;
      paths.push(path);
    }
    radius = (canvas.width > canvas.height)? canvas.width/4: canvas.height/4;
    angle = Math.random()*6.27;
    let x1 = radius * Math.cos(angle)+centx;
    let y1 = radius * Math.sin(angle)+centy;
    let x2 = radius * Math.cos(angle+3.14)+centx;
    let y2 = radius * Math.sin(angle+3.14)+centy;
    for (let f = 1; f < paths.length; f++) {
      let pts = paths[f];
      ctx.beginPath();
      ctx.lineWidth = 1 + Math.random() * stroke_width;
      let i = 0;
      for (; i < pts.length; i++) {
        x = pts[i][0] + pet(13)
        y = pts[i][1] + pet(13)
        if (i == 0) {
          ctx.moveTo(x, y);
        } else
        if (i % 3 == 0)
          ctx.bezierCurveTo(pts[i-2][0], pts[i-2][1], pts[i-1][0], pts[i-1][1], pts[i][0], pts[i][1]);
      }
      if (grunge)
        ctx.strokeStyle = petColor(color, 81)
      else
        ctx.strokeStyle = petColor(color, 51)
      ctx.globalAlpha = (maxalpha * 0.1 + Math.random() * maxalpha * 0.2)
      ctx.stroke();
    }
  }
  ctx.restore()
}

function strokesH () {
  let increase = Math.PI * 2 / 40;
  let x = 0, y = 0, angle = 4.7;
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let color = document.getElementById("paintcolor").value
  ctx.save()
  ctx.globalAlpha = document.getElementById("opacity").value/200
  let maxalpha = ctx.globalAlpha
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  let grunge = document.getElementById("grungy").checked
  let stroke_width = 11 + document.getElementById("featuresize").value/10
  let stroke_ct = +document.getElementById("number").value/400 + 1
  let P = 121
  if (grunge)
    P *= 2
  for (let t = 0; t < stroke_ct; t++) {
    let paths = [];
    x = 0;
    y = 0;
    let centx = Math.random()*canvas.width/2;
    let centy = Math.random()*canvas.height/2;
    let edges =  (9 * (Math.floor(Math.random()*6))+2);
    points = [];
    let xmut = -1;
    let ymut = -1;
    if (Math.random() < 0.5)
      xmut *= -1;
    if (Math.random() < 0.5)
      ymut *= -1;
    for (let i = 0; i < edges; i++) {
      x = -10 + pet(P)
      y = Math.random()*ctx.canvas.height;
      points.push([x, y]);
      points.push([canvas.width/3+pet(P), y+pet(P*2)]);
      points.push([canvas.width*2/3+pet(P), y-pet(P*2)]);
      points.push([canvas.width+10+pet(10), y+pet(P)]);
    }
    paths.push(points);
    let pop = 10
    if (grunge)
      pop *= 2
    let offset = 10 + stroke_width * 4;
    let numpaths = 10 + Math.random() * 30;
    for (let s = 0; s < numpaths; s++) {
      let path = [];
      for (let c = 0; c < points.length; c++) {
        path.push([points[c][0] +pet(offset), points[c][1] + ymut*(pet(offset) + (pop * (Math.random()-0.5)))]);
      }
      //offset += (Math.random()-0.5) * 1;
      paths.push(path);
    }
    for (let f = 0; f < paths.length; f++) {
      let pts = paths[f];
      ctx.beginPath();
      ctx.lineWidth = 4 + Math.random() * stroke_width;
      x = pts[0][0] + pet(13)
      y = pts[0][1] + pet(13)
      ctx.moveTo(x, y);
      ctx.bezierCurveTo(pts[1][0], pts[1][1], pts[2][0], pts[2][1], pts[3][0], pts[3][1]);
      if (grunge)
        ctx.strokeStyle = petColor(color, 81)
      else
        ctx.strokeStyle = petColor(color, 51)
      ctx.globalAlpha = (maxalpha * 0.7 + Math.random() * maxalpha * 0.2)
      ctx.stroke();
    }
  }
  ctx.restore()
}

function birds () {
  var increase = Math.PI * 2 / 40;
  let x = 0, y = 0
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let centerx = ctx.canvas.width / 2;
  let centery = ctx.canvas.height / 2;
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let birdradius = 3 + document.getElementById("featuresize").value/20
  let br = birdradius
  let bpet = birdradius/15
  let numshapes = 1 + Math.floor(document.getElementById("number").value/2500)
  let angle = Math.random() * 6.42;
  let m_mod = 2, t = 0;
  for (; t < numshapes; t++) {
    var petalpoints = [];
    var prepoints = [];
    var radius = 100;
    x = 0;
    y = 0;
    var x0 = x;
    var y0 = y;
    var centx = Math.random()*ctx.canvas.width+5;
    var centy = Math.random()*ctx.canvas.height+5;
    var edges = 13 * (Math.floor(Math.random()*7)+4);
    var maxradius = Math.random() * canvas.width/3 + canvas.height/3;
    var increase = Math.PI * 2/edges*0.98;
    var points = [];
    var bez = [];
    var d_angle = angle;
    for (var i = 0; i < edges; i++) {
      if (i % 3 == 0)
        radius = (Math.random() * maxradius) + maxradius * 0.8;
      else
        radius = maxradius * 1.2;
      x = radius * Math.cos(d_angle)+centx;
      y = radius * Math.sin(d_angle)+centy;
      points.push([x, y]);
      x = (radius*1.3) * Math.cos(d_angle)+centx;
      y = (radius*1.3) * Math.sin(d_angle)+centy;
      prepoints.push([x, y]);
      d_angle += increase;
    }
    var i = 0;
    for (; i < points.length; i++) {
      x = points[i][0];
      y = points[i][1];
      var prex = prepoints[i][0];
      var prey = prepoints[i][1];
      if (i == 0) {
        x0 = x;
        y0 = y;
        ctx.moveTo(x, y);
        petalpoints.push([prex, prey]);
      } else
      if (i % 3 == 0) {
        petalpoints.push([points[i][0], points[i][1]]);
      }
    }
    
    i = 0;
    for(; i < petalpoints.length; i++) {
      centx = petalpoints[i][0];
      centy = petalpoints[i][1];
      edges = 12;
      increase = Math.PI * 2/edges*0.98;
      d_angle =  angle + (Math.random() - 0.5) * 1.5;
      var ppoints = [];
      var cents = [];
      
      birdradius = br +  Math.random() * 0.3 * br;
      for (var p = 0; p < edges; p++) {
        radius = birdradius + Math.random() * 0.5 * birdradius;
        if (p === 6) // 6
          radius = birdradius * 1.7 + pet(1);
        if ((p === 3 || p === 9) && m_mod === 2)
          radius = birdradius * (4.5 + Math.random()/3);
        if (p === 5 || p === 7)
          radius = birdradius * (0.2 + Math.random()/3);
        if (p === 2 || p === 10)
          radius = birdradius * (1.0 + Math.random()/3);
        if (p === 1 || p === 11)
          radius = birdradius * (0.05 + Math.random()/3);
        if (p == 0)
          radius = birdradius * (0.6 + Math.random()/3);
        if (p === 4 || p === 8) {
          if (Math.random() > 0.8)
            radius = birdradius * 0.6;
          else
            radius = birdradius * 1.2;
        }
        if (Math.random() < 0.1) {
          if (p === 3 || p === 9 || p == 2 || p == 10)
            radius = birdradius * (1.2 + Math.random()/3);
        }
        x = (radius+pet(8)) * Math.cos(d_angle + pet(bpet)/100)+centx;
        y = (radius+pet(8)) * Math.sin(d_angle + pet(bpet)/100)+centy;
        ppoints.push([x, y]);
        d_angle += increase;
      }
      ctx.beginPath();
      var j = 0;
      for (;j < ppoints.length; j++) {
        x = ppoints[j][0];
        y = ppoints[j][1];
        if (j == 0) {
          x0 = x;
          y0 = y;
          ctx.moveTo(x, y);
        } else
        if (j % m_mod === 0) {
          ctx.bezierCurveTo(ppoints[j-2][0] + pet(bpet), ppoints[j-2][1] + pet(bpet), ppoints[j-1][0] + pet(bpet), ppoints[j-1][1] + pet(bpet), ppoints[j][0], ppoints[j][1]);
        }
      }
      ctx.bezierCurveTo(ppoints[j-2][0], ppoints[j-2][1], ppoints[j-1][0], ppoints[j-1][1], x0, y0);
      ctx.closePath();
      ctx.fill();
    }
  }
}

function rothko () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let w = canvas.width
  let ch = canvas.height
  let rows = 3
  let margin = 16 + Math.random() * rows * 9
  let gap = margin/4
  let oc = ctx.fillStyle = document.getElementById("paintcolor").value
  let op = document.getElementById("opacity").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let grunge = document.getElementById("grungy").checked
  let numshapes = 2 + (Math.floor(Math.random() * 2))
  let colors = shuffle(['#cc0000', '#bb4000', '#a000a0', '#0000aa','#004099', '#007020', '#F8A500', '#d8c500', '#dddddd', '#300000','#444444','#666666'])
  let fcolors = []
  let i = 0
  for (; i < numshapes; i++)
    fcolors.push(randomPick(colors))
  let bcolors = ['#300000','#444444', '#dddddd', '#666666']
  i = 0
  for (; i < fcolors.length; i++)
    bcolors.push(fcolors[i])
  ctx.fillStyle  = randomPick(bcolors)
  ctx.fillRect(0, 0, w, ch)
  let hts = new Array(numshapes)
  let h = 0, H = ch - (margin/numshapes)
  for (; h < numshapes; h++) {
    let part = 61+ Math.random() * H/numshapes
    hts[h] = part
    H -= part
  }
  if (H > margin)
    hts[1] += H - margin
  if (H < 0)
    hts[0] -= H
  let shapeheight = w/numshapes - (margin/numshapes)
  i = 0, g = 0
  let top = margin
  let m0 = margin
  let marvar = w/24
  for (; i < numshapes; i++) {
    let points = []
    shapeheight = hts[i]
    margin += (Math.random() * marvar)
    ctx.beginPath();
    ctx.moveTo(margin+pet(9), top+pet(9))
    ctx.lineTo(w-margin+pet(9), top+pet(9))
    ctx.lineTo(w-margin+pet(9), top+shapeheight-margin+pet(9))
    ctx.lineTo(margin+pet(9), top+shapeheight-margin+pet(9))
    points.push(margin+pet(9), top+pet(9))
    points.push(w-margin+pet(9), top+pet(9))
    points.push(w-margin+pet(9), top+shapeheight-margin+pet(9))
    points.push(margin+pet(9), top+shapeheight-margin+pet(9))
    ctx.closePath()
    ctx.fillStyle = petColor(randomPick(fcolors), 30)
    ctx.fill()
    ctx.globalAlpha = document.getElementById("opacity").value/180
    frameRect(points, ctx.fillStyle, margin)
    ctx.globalAlpha = document.getElementById("opacity").value/100
    g += gap
    top += shapeheight
    margin = m0
  }
  let functions = ["dotblur", /*"jaggyblur", "dirblur"*/]
  document.getElementById("featuresize").value = 45 + pet(15)
  document.getElementById("opacity").value = 25 + pet(15)
  ctx.fillStyle = petColor(randomPick(bcolors), 30)
  dissOver()
  let f = randomPick(functions)
  document.getElementById("opacity").value = 20 + pet(10)
  window[f](canvas)
  document.getElementById("featuresize").value = 20 + Math.random() * 5
  f = randomPick(functions)
  window[f](canvas)
  document.getElementById("featuresize").value = 9 + Math.random() * 5
  dissOver()
  f = randomPick(functions)
  window[f](canvas)
  document.getElementById("opacity").value = 20 + pet(10)
  document.getElementById("paintcolor").value =  "#000000"
  haze()
  document.getElementById("opacity").value = op
  document.getElementById("paintcolor").value = oc
  refreshMode()
}

function testPattern () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.fillStyle = randomColor()
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.fillStyle = randomGradient(canvas);
  drawCircleAt(ctx,canvas.width/2, canvas.height/2, canvas.width/3)
  //ctx.fillRect(0,0,canvas.width, canvas.height)
  grid()
  rcc()
  grid()
  rc()
}

function grid () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let w = canvas.width, h = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = Math.floor(1 +  document.getElementById("featuresize").value/20)
  let spacing = Math.floor(1 + (document.getElementById("number").value/200))
  let ratio = 1
  if (document.getElementById("grungy").checked)
    ratio = 3
  spacing += ctx.lineWidth * 2
  let i = 0
  let margin = 40
  let maxh = (h - (2 * margin))/spacing
  let y = margin
 /* for (; i < maxh; i++) { // horizontal
    ctx.beginPath()
    ctx.moveTo(margin, y)
    ctx.lineTo(w-margin, y)
    ctx.closePath()
    ctx.stroke()
    y += spacing
  }*/
  i = 0
  maxh = (w - (2 * margin))/(spacing*ratio)
  let x = margin
  for (; i < maxh; i++) {
    ctx.beginPath()
    ctx.moveTo(x, margin)
    ctx.lineTo(x, h-margin)
    ctx.closePath()
    ctx.stroke()
    x += spacing*ratio
  }
}


function rays () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let D =  (5 + Math.floor(document.getElementById("featuresize").value/50))
  let grunge = document.getElementById("grungy").checked
  let W = canvas.width
  let H = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/200
  //clip()
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = 0.25
  let x = Math.random() * W, y = Math.random() * H
  let w = 2 +Math.random()*14
  let p = 1+D*3
  let i = 0
  let s = 0
  let x2 = 0, y2 = 0
  while (s < 100) {
    x2 = (Math.random() - 0.5) * W * 4
    y2 = (Math.random() - 0.5) * W * 4
    ctx.beginPath()
    ctx.moveTo(x + pet(p), y+pet(p))
    ctx.lineTo(x2, y2)
    ctx.closePath()
    ctx.stroke()
    
    y += pet(89)
    x += pet(89)
    s++
  }
}

function curveAcross () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let D =  (5 + Math.floor(document.getElementById("featuresize").value/80))
  let grunge = document.getElementById("grungy").checked
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = 12
  ctx.lineCap = "round"
  let W = canvas.width
  let H = canvas.height
  
  let x = 50, y = 100
  let x2 = W - 50, y2 = 100
  let i = 0
  for (; i < 50; i++) {
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.bezierCurveTo(W/3+pet(100), y+pet(450), 2*W/3+pet(100), y+pet(450), x2, y2);
    ctx.stroke();
    y += 100
    y2 += 100
    if (y > H)
      break;
  }
}

function placeText (lines, angle) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let H = canvas.height;
  let W = canvas.width;
  ctx.fillStyle = randomPick(["#404040", "#808080", "#101010"])
  let faces = "serif"
  let size = 6 + Math.floor(Math.random() * 20)
  ctx.textAlign = 'left';
  ctx.textBaseline = 'middle'
  let x = Math.random() * W
  let y = Math.random() * H
  //ctx.font = "bold "+size+"px Helvetica"
  
  ctx.save()
  ctx.font = size+"px SnellRoundhand-Black"
  ctx.translate(x, y)
  ctx.rotate(angle) // need to adjust x & y offsets per line
  ctx.fillText(lines, 0, 0)
  ctx.restore()
}

function roadmap () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let D =  (5 + Math.floor(document.getElementById("featuresize").value/80))
  let grunge = document.getElementById("grungy").checked
  let angledelta = 0.4
  if (grunge)
    angledelta = 0.8
  let W = canvas.width
  let H = canvas.height
  let colors = ['red', 'blue', 'green', 'yellow',]// 'orange', 'purple']
  ctx.lineCap = "round"
  let x = Math.random() * W, y = Math.random() * H
  let p = 1+D*1
  let i = 0
  let s = 0
  let angle = Math.random()*2*Math.PI;
  let stepsize = 1
  let w = 1 + Math.random()*D/10
  let points = []
  lavalamp()
  let numroads = 5 + Math.floor(Math.random() * 5)
  let k = 0
  while (k < numroads) {
    points = []
    s = 0
    ctx.lineWidth = 2 + Math.floor(10 * Math.random())
    ctx.fillStyle = randomPick(colors)
    x = Math.random() * W, y = Math.random() * H
    while (s < 3000) {
      points.push([x,y])
      x += 5 * Math.cos(angle)
      y += 7 * Math.sin(angle)
      s++
      angle += (Math.random()-0.51) * angledelta
    }
    i = 1
    ctx.beginPath()
    ctx.moveTo(points[0][0], points[0][1])
    for(; i < points.length; i++) {
      ctx.lineTo(points[i][0], points[i][1])
    }
    ctx.strokeStyle = randomPick(colors)
    ctx.globalAlpha = 0.4
    ctx.stroke();
    
    // dots on raods
    let rt = ctx.lineWidth * 0.6
    let spacing = randomPick([23, 91, 15, 11, 31, 1000])
    i = 0
     for(; i < points.length; i++) {
      if (i % spacing === 1) {
        ctx.strokeStyle = ("#303030")
        ctx.lineWidth = 3
        ctx.beginPath()
        ctx.arc(points[i][0], points[i][1], rt, 0, 2* Math.PI)
        ctx.globalAlpha = 0.8
        ctx.stroke()
        ctx.fillStyle = "#ffffff"
        ctx.fill()
      }
    }
    // route numbers
    rt = ctx.lineWidth * 4
    spacing = randomPick([120, 91, 150, 1000])
    let routes = [11, 21,31, 17, 6, 89, 50, 67, 3, 10, 104, 24, 33, 2, 6, 44, 128, 95]
    let rtext = randomPick(routes)
    i = 0
     for(; i < points.length; i++) {
      if (i > 0 && i % spacing === 0) {
        ctx.strokeStyle = ("#303030")
        ctx.lineWidth = 3
        ctx.beginPath()
        ctx.ellipse(points[i][0], points[i][1], rt*1.5, rt, 0, 0, 2* Math.PI)
        ctx.globalAlpha = 0.8
        ctx.stroke()
        ctx.fillStyle = "#ffffff"
        ctx.fill()
        ctx.textBaseline = "bottom";
        ctx.textalign = 'left'
        ctx.fillStyle = "#000000"
        ctx.font = "12px helvetica";
        let d = ctx.measureText(rtext).width/2
        ctx.fillText (rtext, points[i][0]-d, points[i][1]+rt/2)
      }
    }
   
    k++
  }
  ctx.globalAlpha = 0.8

  k = 0
  for (; k < 19; k++) {
    angle = pet(2)/6//Math.random() * Math.PI * 2
    placeText(randomPick(placenames), angle)
  }
  
  // dots
   i = 0
  for (; i < 31; i++) {
    ctx.fillStyle = randomPick(colors)
    ctx.beginPath()
    x = Math.random() * W, y = Math.random() * H
    ctx.moveTo(x, y)
    ctx.arc(x, y, Math.random() * 9 + 3 , 0, Math.PI * 2)
    ctx.fill();
  }
  // blue grid lines
  ctx.globalAlpha = document.getElementById("opacity").value / 200
  let yoff = 2*(Math.random()-0.5) * 45
  let div = (2 + Math.random() +3)
  let d = W/div
  y = 2//24 + Math.random() + 40
  i = 0
  for (; i < W/d; i++) {
    ctx.lineWidth = 2 + Math.floor(5 * Math.random())
    ctx.strokeStyle = "#2040ff"
    ctx.beginPath()
    ctx.moveTo(0, y)
    ctx.lineTo(W, y+yoff)
    ctx.stroke();
    y += d
  }
  i = 0, x = 0
  for (; i < H/d; i++) {
    ctx.lineWidth = 2 + Math.floor(3 * Math.random())
    ctx.strokeStyle = "#2040ff"
    ctx.beginPath()
    ctx.moveTo(x, 0)
    ctx.lineTo(x+yoff, H)
    ctx.stroke();
    x += d
  }
}

function diurnal () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let colors = ['red', 'green', 'yellow', 'blue']
      ctx.globalAlpha = 0.5 //+ Math.random()*0.5;

  var numshapes = 5
  for (var t = 0; t < numshapes; t++) {
    var radius = Math.floor(Math.random() * 100) + 20;
    x = 0;
    y = 0;
    var x0 = x;
    var y0 = y;
    angle = 2 * Math.random() * Math.PI;
    ctx.beginPath();
    var cent = Math.random()*ctx.canvas.width+50;
    var centy = Math.random()*ctx.canvas.height+50;
    var edges = Math.random()*22+7;
    var maxradius = Math.random() * 200 + 200;
    radius = Math.random() * maxradius/2 + maxradius;
    ctx.lineWidth = Math.random()*18;
    if (Math.random() < 0.1)
      ctx.setLineDash([ctx.lineWidth*2, ctx.lineWidth*2]);
    else
      ctx.setLineDash([]);
    ctx.strokeStyle = randomPick(colors);
    ctx.save();
    increase = Math.PI * 2/edges;
    for (var i = 0; i < edges-1; i++) {
      radius = Math.random() * maxradius/2 + maxradius;
      x = radius * Math.cos(angle)+cent;
      y = radius * Math.sin(angle)+centy;
      if (i == 0) {
        x0 = x;
        y0 = y;
      }
      ctx.lineTo(x, y);
      angle += increase;
    }
    ctx.lineTo(x0, y0);
    ctx.restore();
    ctx.fillStyle  = randomPick(colors);
    ctx.closePath();
    ctx.save();
    var nofill = (Math.random() < 0.2);
    if (!nofill)
      ctx.clip();
    if (nofill) {
      ctx.save();
      ctx.lineWidth = 6+Math.random()*10;
      ctx.setLineDash([ctx.lineWidth*2]);
    }
    ctx.stroke();
    if (!nofill)
      ctx.fill();
    if (nofill)
      ctx.restore();
    ctx.restore();
  }
  ctx.setLineDash([]);

}
  
function lavalamp () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let increase = Math.PI * 2 / 40;
  let x = 350, y = 270, angle = 4.7;
  //var centerx = ctx.canvas.width / 2;
  //var centery = ctx.canvas.height / 2;
  let colors = shuffle(['red', 'green', 'yellow', 'blue'])
  colors = shuffle(['#ffb3ba', '#baffc9', '#ffffba', '#bae1ff'])
  let centers = shuffle([[0, canvas.height/4],
                 [3 * canvas.width/4, canvas.height/2],
                 [canvas.width/5, 3*canvas.height/4],
                 [canvas.width, canvas.height]])
  ctx.globalAlpha = document.getElementById("opacity").value/100;
  ctx.lineCap = "round";
  ctx.lineJoin = 'round';
  let centx = Math.random()*canvas.width/2;
  let centy = Math.random()*canvas.height/2;
  let numshapes = Math.random() * 2 + 2;
  for (var t = 0; t < numshapes; t++) {
    var radius = Math.floor(Math.random() * 100) + 20;
    x = 0;
    y = 0;
    centx = centers[t][0]
    centy = centers[t][1]
    var x0 = x;
    var y0 = y;
    angle = Math.floor(Math.random() * 6.42);
    let edges = 7 * (Math.floor(Math.random()*3)+3);
    let maxradius = canvas.width/2;
    increase = Math.PI * 2/edges*0.98;
    points = [];
    bez = [];
    for (var i = 0; i < edges; i++) {
      radius = (Math.random() * maxradius/2) + maxradius;
      x = radius * Math.cos(angle)+centx;
      y = radius * Math.sin(angle)+centy;
      points.push([x, y]);
      angle += increase;
    }
    ctx.beginPath();
    ctx.fillStyle= colors[t];
    //ctx.globalAlpha = 0.2;
    var i = 0;
    for (; i < points.length; i++) {
      x = points[i][0];
      y = points[i][1];
      if (i == 0) {
        x0 = x;
        y0 = y;
        ctx.moveTo(x, y);
      } else
      if (i % 3 == 0)
        ctx.bezierCurveTo(points[i-2][0], points[i-2][1], points[i-1][0], points[i-1][1], points[i][0], points[i][1]);
    }
    ctx.bezierCurveTo(points[i-2][0], points[i-2][1], points[i-1][0], points[i-1][1], x0, y0);
    
    ctx.lineWidth = 2 + Math.random()*13;
    if (Math.random() < 0.33)
      ctx.setLineDash([ctx.lineWidth*2, ctx.lineWidth*2]);
    else
      ctx.setLineDash([]);
    ctx.strokeStyle = randomPick(colors);
  //  ctx.globalAlpha = 0.4;
    ctx.stroke()
    ctx.closePath();
  //  ctx.globalAlpha = 0.2;
    ctx.fill();
    ctx.setLineDash([]);
  }
}

function walk () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let D =  (5 + Math.floor(document.getElementById("featuresize").value/80))
  let grunge = document.getElementById("grungy").checked
  let angledelta = 0.1
  if (grunge)
    angledelta = 0.8
  let W = canvas.width
  let H = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/100
 // clip()
  ctx.fillStyle = document.getElementById("paintcolor").value
  let x = Math.random() * W, y = Math.random() * H
  let p = 1+D*1
  let i = 0
  let s = 0
  let angle = Math.random()*2*Math.PI;
  let stepsize = 1
  let w = 1 + Math.random()*D/10
  while (s < 2000) {
    w = 1 + Math.random()*D/25
    ctx.beginPath()
    if (s > 100  && s < 800 && Math.random() > 0.96) {
      D *=1.03
      p = 1+D/2
      stepsize = 2
    } else
    if (s > 800 && Math.random() > 0.9) {
      D /=1.03
      p = 1+D
      stepsize = 1
    }
    angle += (Math.random()-0.5) * angledelta
    ctx.moveTo(x + pet(p), y+pet(p))
    ctx.lineTo(x + w + pet(p), y +pet(p))
    ctx.lineTo(x + w + pet(p), y+w +pet(p))
    ctx.lineTo(x + pet(p), y+w+pet(p))
    ctx.closePath()
    ctx.fill()
    x += 1 * Math.cos(angle)
    y += 1 * Math.sin(angle)
    w += 0.001
    s++
  }
}

function frame () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let D =  (5 + Math.floor(document.getElementById("featuresize").value/4))
  let grunge = document.getElementById("grungy").checked
  let W = canvas.width
  let H = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/100
 // clip()
  ctx.fillStyle = document.getElementById("paintcolor").value
  let x = -1, y = -1
  let w = 6 +Math.random()*14
  let p = 6+D*1.2
  let i = 0
  while (y < canvas.height) {
    w = D +Math.random()*D/2
    ctx.beginPath()
    ctx.moveTo(x + pet(p), y+pet(p))
    ctx.lineTo(x + w + pet(p), y +pet(p))
    ctx.lineTo(x + w + pet(p), y+w +pet(p))
    ctx.lineTo(x + pet(p), y+w+pet(p))
    ctx.closePath()
    ctx.fill()
    
    ctx.beginPath()
    ctx.moveTo(W - pet(p), y+pet(p))
    ctx.lineTo(W - w + pet(p), y +pet(p))
    ctx.lineTo(W - w + pet(p), y+w +pet(p))
    ctx.lineTo(W - pet(p), y+w+pet(p))
    ctx.closePath()
    ctx.fill()
    y += 2
  }
  x = 0, y = -1
  while (x < canvas.width) {
    w = D +Math.random()*D/2
    ctx.beginPath()
    ctx.moveTo(x + pet(p), y+pet(p))
    ctx.lineTo(x + w + pet(p), y +pet(p))
    ctx.lineTo(x + w + pet(p), y+w +pet(p))
    ctx.lineTo(x + pet(p), y+w+pet(p))
    ctx.closePath()
    ctx.fill()
    
    ctx.beginPath()
    ctx.moveTo(x - pet(p), H-pet(p))
    ctx.lineTo(x - w + pet(p), H -pet(p))
    ctx.lineTo(x - w + pet(p), H-w -pet(p))
    ctx.lineTo(x - pet(p), H-w-pet(p))
    ctx.closePath()
    ctx.fill()
    x += 2
  }
  ctx.restore()
}

function roundedFrame () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let off = document.createElement('CANVAS')
  let ctxoff = off.getContext("2d");
  let D =  (5 + Math.floor(document.getElementById("featuresize").value/3))
  let grunge = document.getElementById("grungy").checked
  let W = canvas.width
  let H = canvas.height
  off.height = H
  off.width = W
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.save()
  ctx.fillStyle = document.getElementById("paintcolor").value
  let radius = 36
  //if (grunge)
  //  radius *= 2
  let x = D, y = D
  let w = W - 2*D, h = H - 2*D
  var r = x + w;
  var b = y + h;
  ctxoff.drawImage(canvas, 0, 0)
  ctx.clearRect(0, 0, W, H)
  ctx.fillRect(0,0,W,H)
  ctx.beginPath();
  ctx.lineWidth="4";
  ctx.moveTo(x+radius, y);
  ctx.lineTo(r-radius, y);
  ctx.quadraticCurveTo(r, y, r, y+radius);
  ctx.lineTo(r, y+h-radius);
  ctx.quadraticCurveTo(r, b, r-radius, b);
  ctx.lineTo(x+radius, b);
  ctx.quadraticCurveTo(x, b, x, b-radius);
  ctx.lineTo(x, y+radius);
  ctx.quadraticCurveTo(x, y, x+radius, y);
  ctx.closePath()
  ctx.clip()
  ctx.globalAlpha = 1
  ctx.clearRect(0, 0, W, H)
  ctx.drawImage(off, 0, 0)
  ctx.restore()
  let mode = document.getElementById("mode").value
  ctx.globalCompositeOperation = "destination-over"
  fill()
  ctx.globalCompositeOperation = mode
}

function lineFrame () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let LW = 1 + Math.floor(document.getElementById("featuresize").value/10)
  let grunge = document.getElementById("grungy").checked
  let inset = 1+document.getElementById("number").value/100 // max == 10000
  let W = canvas.width
  let H = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = LW
  let x = 0, y = 0
  ctx.beginPath();
  ctx.moveTo(x+inset, y+inset);
  ctx.lineTo(W-inset, y+inset);
  ctx.lineTo(W-inset, H-inset);
  ctx.lineTo(x+inset, H-inset);
  ctx.closePath()
  ctx.stroke()
}

function rectFrame () {
  const rect = true
  framePolaroid(rect)
}

function framePolaroid (rect) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let D =  (5 + Math.floor(document.getElementById("featuresize").value/3))
  let grunge = document.getElementById("grungy").checked
  let W = canvas.width
  let H = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  let x = -1, y = -1
  let w = 6 + Math.random()*14
  let wobble = 8
  if (document.getElementById("grungy").checked)
    wobble = 4
  let i = 0
  while (y < canvas.height) {
    w = D +Math.random()*D/wobble
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(x + w, y )
    ctx.lineTo(x + w, y+w )
    ctx.lineTo(x , y+w)
    ctx.closePath()
    ctx.fill()
    
    ctx.beginPath()
    ctx.moveTo(W, y)
    ctx.lineTo(W - w, y )
    ctx.lineTo(W - w, y+w )
    ctx.lineTo(W, y+w)
    ctx.closePath()
    ctx.fill()
    y += 2
  }
  x = 0, y = -1
  while (x < canvas.width) {
    w = D +Math.random()*D/wobble
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(x + w, y )
    ctx.lineTo(x + w, y+w )
    ctx.lineTo(x, y+w)
    ctx.closePath()
    ctx.fill()
    if (rect) {
      ctx.beginPath()
      ctx.moveTo(x, H)
      ctx.lineTo(x - w, H)
      ctx.lineTo(x - w, H-w)
      ctx.lineTo(x, H-w)
      ctx.closePath()
      ctx.fill()
      x += 2
    } else {
      ctx.beginPath()
      ctx.moveTo(x, H)
      ctx.lineTo(x - w, H)
      ctx.lineTo(x - w, H-3*w)
      ctx.lineTo(x, H-3*w)
      ctx.closePath()
      ctx.fill()
      x += 2
    }
  }
  //ctx.restore()
}

function frameInstax () {
  let rect = false
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let D = 1
  let grunge = document.getElementById("grungy").checked
  let W = canvas.width
  let H = canvas.height
  ctx.globalAlpha = document.getElementById("opacity").value/100

  ctx.fillStyle = "#FFFFFF"
  let x = -1, y = -1
  let w = 1
  let i = 0
  let  R = false
  if (W > H) {
    rc()
    let T = W
    W = H
    H = T
    R = true
  }
  while (y < canvas.height) {
    ctx.fillStyle = "#FFFFFF"
    w = (W * 0.0706)
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(x + w, y)
    ctx.lineTo(x + w, y+w)
    ctx.lineTo(x , y+w)
    ctx.closePath()
    ctx.fill()
    
    ctx.beginPath()
    ctx.moveTo(W, y)
    ctx.lineTo(W - w, y)
    ctx.lineTo(W - w, y+w)
    ctx.lineTo(W, y+w)
    ctx.closePath()
    ctx.fill()
    y += 2
  }
  x = 0, y = -1
  while (x < canvas.width) {
    w = (W * 0.135)
    //top
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.lineTo(x + w, y)
    ctx.lineTo(x + w, y+w)
    ctx.lineTo(x, y+w)
    ctx.closePath()
    ctx.fill()
    //bottom
    w = (W * 0.281)
    ctx.beginPath()
    ctx.moveTo(x, H)
    ctx.lineTo(x - w, H)
    ctx.lineTo(x - w, H-w)
    ctx.lineTo(x, H-w)
    ctx.closePath()
    ctx.fill()
    x += 2
  }
  if (R)
    rcc()
  //ctx.restore()
}

function frameCircle () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let off = document.createElement('CANVAS')
  let offctx = off.getContext("2d")
  off.width = canvas.width
  off.height = canvas.height
  offctx.drawImage(canvas, 0, 0)
  let r = document.getElementById("featuresize").value/500
  let W = canvas.width
  let H = canvas.height
  let cx = W/2, cy = H/2
  let rx = cx - (cx * r), ry = cy - (cy * r)
  ctx.globalAlpha = 1
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.clearRect(0,0,W,H)
  ctx.save()
  ctx.beginPath()
  ctx.ellipse(cx, cy, rx, ry, 0, 0, Math.PI*2);
  ctx.closePath()
  ctx.clip()
  ctx.drawImage(off,0,0)
  ctx.restore()
  let mode = document.getElementById("mode").value
  ctx.globalCompositeOperation = "destination-over"
  ctx.fillRect(0,0,W,H)
  document.getElementById("mode").value = mode
  ctx.globalCompositeOperation = mode
}

function frameRect (points, c, margin) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let D =  (5 + Math.floor(document.getElementById("featuresize").value/10))
  let grunge = document.getElementById("grungy").checked
  let H = distance(points[0], points[1], points[6], points[7])
  let W = distance(points[0], points[1], points[2], points[3])
  ctx.fillStyle = c
  let w = 6 + Math.random()*14
  let h = w/2
  let p = 6+D*1.5
  let x = points[0], y = points[1]

  while (y < points[5]-w) {
    w = D +Math.random()*D/2
    ctx.beginPath()
    ctx.moveTo(x + pet(p), y+pet(p))
    ctx.lineTo(x + w + pet(p), y +pet(p))
    ctx.lineTo(x + w + pet(p), y+w +pet(p))
    ctx.lineTo(x + pet(p), y+w+pet(p))
    ctx.closePath()
    ctx.fill()
    
    ctx.beginPath()
    ctx.moveTo(points[2] - pet(p), y + pet(p))
    ctx.lineTo(points[2] - w + pet(p), y + pet(p))
    ctx.lineTo(points[2] - w + pet(p), y + w + pet(p))
    ctx.lineTo(points[2] - pet(p), y + w + pet(p))
    ctx.closePath()
    ctx.fill()
    y += 2
  }
  x = points[0], y = points[1]
  while (x < points[2]-w) {
    w = D +Math.random()*D/2
    ctx.beginPath()
    ctx.moveTo(x + pet(p), y+pet(p))
    ctx.lineTo(x + w + pet(p), y+pet(p))
    ctx.lineTo(x + w + pet(p), y+w +pet(p))
    ctx.lineTo(x + pet(p), y+pet(p))
    ctx.closePath()
    ctx.fill()
    
    ctx.beginPath()
    ctx.moveTo(x + pet(p), points[5]-pet(p))
    ctx.lineTo(x + w + pet(p), points[5] -pet(p))
    ctx.lineTo(x + w + pet(p), points[5]-pet(p))
    ctx.lineTo(x + pet(p), points[5]-pet(p))
    ctx.closePath()
    ctx.fill()
    x += 2
  }
}

function shuffle (array) {
  return array.sort(() => Math.random() - 0.5);
}

function circle () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let cx = canvas.width/2 + (Math.random()-0.5) * 200
  let cy = canvas.height/2 + (Math.random()-0.5) * 200
  let r = 10 + Math.floor(document.getElementById("featuresize").value)
  r += pet(r/3)
  //clip()
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.beginPath()
  ctx.moveTo(cx, cy)
  ctx.arc (cx, cy, r, 0, 2*Math.PI)
  ctx.closePath()
  ctx.fill()
  //ctx.restore()
}

function sides () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let w = 21+document.getElementById("featuresize").value/1
  w += 41 * Math.random()
  let x = 0, y = 0
  let x2 = w
  let y2 = canvas.height
  ctx.fillStyle = document.getElementById("paintcolor").value
  if (document.getElementById("grungy").checked)
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  
  ctx.beginPath()
  ctx.moveTo(x, y)
  ctx.lineTo(x2, y)
  ctx.lineTo(x2, y2)
  ctx.lineTo(x, y2)
  ctx.closePath()
  ctx.fill()
}

function sides2 () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let w = 21+document.getElementById("featuresize").value/3
  w += 41 * Math.random()
  let x = canvas.width * Math.random() - w, y = 0
  let x2 = x + w
  let y2 = canvas.height
  ctx.fillStyle = document.getElementById("paintcolor").value
  if (document.getElementById("grungy").checked)
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.beginPath()
  ctx.moveTo(x, y)
  ctx.lineTo(x2, y)
  ctx.lineTo(x2, y2)
  ctx.lineTo(x, y2)
  ctx.closePath()
  ctx.fill()
}

function square (x, y, w) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let cx = canvas.width/2 + (Math.random()-0.5) * 200
  let cy = canvas.height/2 + (Math.random()-0.5) * 200
  let len = 10 + 2 * Math.floor(document.getElementById("featuresize").value)
  cx -= len/2
  cy -= len/2
  ctx.fillStyle = document.getElementById("paintcolor").value
  if (document.getElementById("grungy").checked)
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.beginPath()
  ctx.moveTo(cx, cy)
  ctx.lineTo(cx+len, cy)
  ctx.lineTo(cx+len, cy+len)
  ctx.lineTo(cx, cy+len)
  ctx.closePath()
  ctx.fill()
}

function bwash (x, y, w) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.save()
  if (Math.random() > 0.01) {
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(x+w, y)
    ctx.lineTo(x+w, y+w)
    ctx.lineTo(x, y+w)
    ctx.closePath()
    ctx.fill()
  }
  ctx.restore()
}

/*
function tile (type) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let sides =  (2 + Math.floor(document.getElementById("featuresize").value/20))
  let w = canvas.width
  let n = canvas.width/sides
  ctx.globalAlpha = document.getElementById("opacity").value/100
  clip()
  let colors = []
  let c = 0
  let nc = 1 + (Math.floor(Math.random() * 3))
  for (; c < nc; c++)
    colors.push(randomColor())
  if (type == "C2" || type == "B2") {
    colors.push(randomColor())
    colors.push(randomColor())
    colors.push(randomColor())
  }
  let numshapes = sides*sides
  let i = 0, x = 0, y = 0
  ctx.fillStyle = document.getElementById("paintcolor").value
  if (type != "W")
    ctx.fillRect(0, 0, w, w)
  ctx.fillStyle = randomColor()//randomGradient(canvas, document.getElementById("paintcolor").value)
  let grunge = document.getElementById("grungy").checked
  let rc = randomColor()
  let pattern = [0,1,2,3,4,5,6,7,8,9,10,11]
  shuffle(pattern)
  for (; i < numshapes; i++) {
    ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)]
    if (grunge)
        ctx.fillStyle = randomGradient(canvas, colors[Math.floor(Math.random() * colors.length)])
    if (type == "D")
      dtile(x,y,n,pattern[i%5])
    else
    if (type == "M")
      mtile(x,y,n, pattern[i%8])
    else
    if (type == "C")
      ctile(x,y,n,pattern[i%4])
    else
    if (type == "C2") {
      ctile2(x,y,n, colors, grunge, pattern[i%4])
    } else
    if (type == "B2") {
      btile(x,y,n, colors, grunge)
    } else
    if (type == "W") {
      bwash(x,y,n)
    } else
      triangle(x, y, n, pattern[i%4])
    x += n
    if (i > 0 && i % sides === (sides-1)) {
      y += n
      x = 0
    }
  }
  ctx.restore()
}

function btile (x, y, w, colors, grunge) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.save
  if (grunge) {
    x += pet(13), y += pet(13)
  }
  if (Math.random() > 0.1) {
    shuffle(colors)
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(x+w, y)
    ctx.lineTo(x+w, y+w)
    ctx.lineTo(x, y+w)
    ctx.closePath()
    ctx.fill()
  }
  if (Math.random() > 0.0) {
    
    shuffle(colors)
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x+w/2,y+w/2)
    ctx.arc (x+w/2, y+w/2, w/2.1 - (Math.random() * w/3), 0, 2*Math.PI)
    ctx.closePath()
    ctx.fill()
  }
  ctx.restore()
}

function ctile2 (x, y, w, colors, grunge, i) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let q = i%4
  ctx.save()
  if (q == 0) {
    if (grunge)
      shuffle(colors)
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.arc (x, y, w, 0, 0.5*Math.PI)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = colors[1]
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.arc (x, y, 2*w/3, 0, 0.5*Math.PI)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.arc (x, y, w/3, 0, 0.5*Math.PI)
    ctx.closePath()
    ctx.fill()
  } else
  if (q == 1) {
    if (grunge)
      shuffle(colors)
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x,y+w)
    ctx.arc (x, y+w, w, 1.5*Math.PI, 0)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = colors[1]
    ctx.beginPath()
    ctx.moveTo(x,y+w)
    ctx.arc (x, y+w, 2*w/3, 1.5*Math.PI, 0)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x,y+w)
    ctx.arc (x, y+w, w/3, 1.5*Math.PI, 0)
    ctx.closePath()
    ctx.fill()
  } else
  if (q == 2) {
    if (grunge)
      shuffle(colors)
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x+w,y)
    ctx.arc (x+w, y, w, 0.5*Math.PI, Math.PI)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = colors[1]
    ctx.beginPath()
    ctx.moveTo(x+w,y)
    ctx.arc (x+w, y, 2*w/3, 0.5*Math.PI, Math.PI)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x+w,y)
    ctx.arc (x+w, y, w/3, 0.5*Math.PI, Math.PI)
    ctx.closePath()
    ctx.fill()
  } else
  if (q == 3) {
    if (grunge)
      shuffle(colors)
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x+w,y+w)
    ctx.arc (x+w, y+w, w, Math.PI, 1.5*Math.PI)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = colors[1]
    ctx.beginPath()
    ctx.moveTo(x+w,y+w)
    ctx.arc (x+w, y+w, 2*w/3, Math.PI, 1.5*Math.PI)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.moveTo(x+w,y+w)
    ctx.arc (x+w, y+w, w/3, Math.PI, 1.5*Math.PI)
    ctx.closePath()
    ctx.fill()
  } else
  if (q == 4) {
    if (grunge)
      shuffle(colors)
    ctx.fillStyle = colors[0]
    ctx.beginPath()
    ctx.fillRect(x,y,w,w)
    ctx.closePath()
    if (Math.random() < 0.5) {
      ctx.fillStyle = colors[1]
      ctx.beginPath()
      ctx.moveTo(x+w/3, y)
      ctx.lineTo(x+2*w/3, y)
      ctx.lineTo(x+2*w/3, y+w)
      ctx.lineTo(x+w/3, y+w)
      ctx.closePath()
      ctx.fill()
    } else {
      ctx.fillStyle = colors[1]
      ctx.beginPath()
      ctx.moveTo(x, y+w/3)
      ctx.lineTo(x+w, y+w/3)
      ctx.lineTo(x+w, y+2*w/3)
      ctx.lineTo(x, y+2*w/3)
      ctx.closePath()
      ctx.fill()
    }
  }
  ctx.restore()
}

function ctile (x, y, w, i) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let q = i % 4//Math.floor(Math.random() * 4)
  ctx.beginPath()
  if (q == 1) {
    ctx.moveTo(x,y)
    ctx.arc (x, y, w, 0, 0.5*Math.PI)
  } else
  if (q == 0) {
    ctx.moveTo(x,y+w)
    ctx.arc (x, y+w, w, 1.5*Math.PI, 0)
  } else
  if (q == 3) {
    ctx.moveTo(x+w,y)
    ctx.arc (x+w, y, w, 0.5*Math.PI, Math.PI)
  } else
  if (q == 2) {
    ctx.moveTo(x+w,y+w)
    ctx.arc (x+w, y+w, w, Math.PI, 1.5*Math.PI)
  } else
    ctx.fillRect(x,y,w,w)
  ctx.closePath()
  ctx.fill()
}

function dtile (x, y, w, i) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let q = i%5
  ctx.beginPath()
  if (q == 0) {
    ctx.arc (x+w/2, y, w/2, 0, Math.PI)
  } else
  if (q == 1) {
    ctx.arc (x, y+w/2, w/2, 1.5*Math.PI, 0.5*Math.PI)
    
  } else
  if (q == 2) {
    ctx.arc (x+w, y+w/2, w/2, 0.5*Math.PI, 1.5*Math.PI)
    
  } else
  if (q == 3) {
    ctx.arc (x+w/2, y+w, w/2, Math.PI, 0)
  } else
    ctx.arc (x+w/2, y+w/2, w/2, 2*Math.PI, 0)
  ctx.closePath()
  ctx.fill()
}

function mtile (x, y, w, i) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");

  let q = i%8
  ctx.beginPath()
  if (q == 0) {
    ctx.moveTo (x, y)
    ctx.lineTo(x+w, y)
    ctx.lineTo(x+w/2, y+w/2)
  } else
  if (q == 1) {
    ctx.moveTo (x, y)
    ctx.lineTo(x, y+w)
    ctx.lineTo(x+w/2, y+w/2)
  } else
  if (q == 2) {
    ctx.moveTo (x+w, y)
    ctx.lineTo(x+w, y+w)
    ctx.lineTo(x+w/2, y+w/2)
  } else
  if (q == 3) {
    ctx.moveTo (x+w, y)
    ctx.lineTo(x, y)
    ctx.lineTo(x+w/2, y+w/2)
  } else
  if (q == 4) {
    ctx.arc (x+w/2, y, w/2, 0, Math.PI)
  } else
  if (q == 5) {
    ctx.arc (x, y+w/2, w/2, 1.5*Math.PI, 0.5*Math.PI)
    
  } else
  if (q == 6) {
    ctx.arc (x+w, y+w/2, w/2, 0.5*Math.PI, 1.5*Math.PI)
    
  } else
  if (q == 7) {
    ctx.arc (x+w/2, y+w, w/2, Math.PI, 0)
  }
  ctx.closePath()
  ctx.fill()
}

function triangle (x, y, w, i) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  // draw a triangle in one or four orientations
  // pick 3 corners |_ -| _| |-
  
  let q = i % 4
  ctx.beginPath()
  if (q == 0) {
    ctx.moveTo (x, y)
    ctx.lineTo(x+w, y)
    ctx.lineTo(x+w, y+w)
  } else
  if (q == 1) {
    ctx.moveTo (x, y)
    ctx.lineTo(x, y+w)
    ctx.lineTo(x+w, y+w)
  } else
  if (q == 2) {
    ctx.moveTo (x+w, y)
    ctx.lineTo(x+w, y+w)
    ctx.lineTo(x, y+w)
  } else {
    ctx.moveTo (x+w, y)
    ctx.lineTo(x, y)
    ctx.lineTo(x, y+w)
  }
  ctx.closePath()
  ctx.fill()
}
*/


function albers () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let f1 = W/9.6
  let f2 = 2* f1
  let f3 = 3 * f1
  let f4 = 4 *f1
  let len = W/2, maxy = W/2
  let quat = len/2
  let top = f1/4
  let t = top
  // 4 rects
  ctx.save()
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let grunge = document.getElementById("grungy").checked
  
  top = 0

  ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.moveTo(0+top, 0 + top)
  ctx.lineTo(W-top, 0 + top)
  ctx.lineTo(W-top, W-top)
  ctx.lineTo(0+top, W-top)
  ctx.closePath()
  ctx.fill()
  
  top += t*2
  ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.moveTo(f1, f1+top)
  ctx.lineTo(W-f1, f1+top)
  ctx.lineTo(W-f1, W-f1+top)
  ctx.lineTo(f1, W-f1+top)
  ctx.closePath()
  ctx.fill()
  
  top += t * 2
  ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.moveTo(f2, f2+top)
  ctx.lineTo(W-f2, f2+top)
  ctx.lineTo(W-f2, W-f2+top)
  ctx.lineTo(f2, W-f2+top)
  ctx.closePath()
  ctx.fill()
  
  top += t*2
  ctx.fillStyle = randomColor()
  if (grunge)
    ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.beginPath();
  ctx.moveTo(f3, f3+top)
  ctx.lineTo(W-f3, f3+top)
  ctx.lineTo(W-f3, W-f3+top)
  ctx.lineTo(f3, W-f3+top)
  ctx.closePath()
  ctx.fill()
  ctx.restore()
}
/*
function concentriccirc() {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let r = canvas.width/2
  let f1 = r/4
  let x = r, y = r
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  clip()
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  if (grunge)
    ctx.fillStyle = randomColor()
  ctx.fillRect(0,0,canvas.width,canvas.height)
  ctx.beginPath();
  ctx.arc(x, y, r, 0, 2*Math.PI);
  ctx.closePath()
  ctx.fill()

  r -= f1
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  if (grunge)
    ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.arc(x, y, r, 0, 2*Math.PI);
  ctx.closePath()
  ctx.fill()

  r -= f1
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  if (grunge)
    ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.arc(x, y, r, 0, 2*Math.PI);
  ctx.closePath()
  ctx.fill()

  r -= f1
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  if (grunge)
    ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.arc(x, y, r, 0, 2*Math.PI);
  ctx.closePath()
  ctx.fill()
  ctx.restore()
}

function concentric () {
  if (Math.random() > 0.5)
    concentriccirc()
  else
    concentricrect()
}

function concentricrect () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let f1 = W/8
  let f2 = 2* f1
  let f3 = 3 * f1
  let len = W/2, maxy = W/2
  let quat = len/2
  // 4 rects
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let grunge = document.getElementById("grungy").checked

  clip()
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  if (grunge)
    ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.moveTo(0, 0)
  ctx.lineTo(W, 0)
  ctx.lineTo(W, W)
  ctx.lineTo(0, W)
  ctx.closePath()
  ctx.fill()

  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  if (grunge)
    ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.moveTo(f1, f1)
  ctx.lineTo(W-f1, f1)
  ctx.lineTo(W-f1, W-f1)
  ctx.lineTo(f1, W-f1)
  ctx.closePath()
  ctx.fill()

  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  if (grunge)
    ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.moveTo(f2, f2)
  ctx.lineTo(W-f2, f2)
  ctx.lineTo(W-f2, W-f2)
  ctx.lineTo(f2, W-f2)
  ctx.closePath()
  ctx.fill()

  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  if (grunge)
    ctx.fillStyle = randomColor()
  ctx.beginPath();
  ctx.moveTo(f3, f3)
  ctx.lineTo(W-f3, f3)
  ctx.lineTo(W-f3, W-f3)
  ctx.lineTo(f3, W-f3)
  ctx.closePath()
  ctx.fill()
  ctx.restore()
}*/

function chips () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let maxdist = Math.pow(Math.pow(cx, 2) + Math.pow(cy, 2), 0.5) +200
  let r = 1 + document.getElementById("featuresize").value/4
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.strokeStyle = document.getElementById("paintcolor").value
  for (var t = 0; t < 5; t++) {
    let radius = r + pet(r/2)
    x = 0;
    y = 0;
    angle = Math.random() * 6.42
    ctx.beginPath();
    var cent = Math.random()*ctx.canvas.width+50;
    var centy = Math.random()*ctx.canvas.height+50;
    var edges = 3+Math.random()*26;
    let max = Math.PI * 1.4
    let increase = Math.PI * 2/(2*edges);
    let turn = 0
    for (var i = 0; i < 100; i++) {
      increase += Math.random()/50
      radius += pet(r/2)
      x = radius * Math.cos(angle)+cent;
      y = radius * Math.sin(angle)+centy;
      ctx.lineTo(x, y);
      angle += increase;
      turn += increase
      if (turn >= max)
        break;
    }
    ctx.closePath();
    ctx.fill()
  }
}

function chaze () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let G = document.getElementById("grungy").checked
  let multiplier = 1.5
  if (G)
    multiplies = 3
  let x = canvas.width/2 + pet(170)
  let y = canvas.height/2 + pet(170)
  let x1 = canvas.width/2 + pet(300)
  let y1 = canvas.height/2 + pet(300)
  let r = x * (multiplier + Math.random()/2)
  let r1 = r/5
  let rg = ctx.createRadialGradient(x, y, r, x1, y1, r1)
  let col1 = document.getElementById("paintcolor").value
  let col2 = "rgba("+hexToR(col1)+", "+hexToG(col1)+", "+hexToB(col1)+", 0.0)";// transparent
  rg.addColorStop(0.01, col1);
  rg.addColorStop(document.getElementById("opacity").value/100, col2);
  ctx.fillStyle = rg
  ctx.fillRect(0,0,canvas.width, canvas.height)
}

function rectify () {
  let width = document.getElementById("featuresize").value/5
  width = (100 - width + 2)
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let W = 2 + Math.floor(document.getElementById("featuresize").value/10)
  let wdivs = W
  let cw = canvas.width
  let ch = canvas.height
  let w = cw/wdivs
  let hdivs = Math.round(wdivs * ch/cw)
  let h = ch/hdivs
  let i = 0, x = w, y = 0
  let N =(1+wdivs) * (1+hdivs)
  for (; i < N; i++) {
    if (Math.random() < 0.5)
      hazeRect(x, y, x+w, y-h)
    x += w
    if (x >= (wdivs)*w) {
      x = 0
      y += h
    }
  }
}

function hazeRect (x1, y1, x2, y2) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.fillStyle = randomGradientRect(canvas, document.getElementById("paintcolor").value, x1, y1, x2, y2, true)
  let sx = (x1<x2)? x1:x2
  let lx = (x1>x2)? x1:x2
  
  let sy = (y1<y2)? y1:y2
  let ly = (y1>y2)? y1:y2
  
  ctx.fillRect(sx,sy,lx-sx,ly-sy)
}

function haze () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = document.getElementById("opacity").value/100
  //clip()
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  ctx.fillRect(0,0,canvas.width, canvas.height)
  //ctx.restore()
}

function make4to5 (all) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  W = canvas.width
  H = canvas.height
  let ratio = W/H
  if (ratio == 0.8)
    return
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let canvasoff = document.getElementById("off")
  let ctxoff = canvasoff.getContext("2d")
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctxoff.drawImage(canvas,0,0)
  let pad = 0, x = 0, y = 0
  if (ratio > 0.8) { // too wide: increase height
    pad = 5 * W/4
    canvas.height = pad
    y = (canvas.height-H)/2
  } else
  if (ratio < 0.8) { // too tall: increase width
    pad = 4 * H/5
    canvas.width = pad
    x = (canvas.width-W)/2
  }
  syncBackground(canvas)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.drawImage(canvasoff, x, y)
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctx.globalCompositeOperation = mode
}

function cropInstaxMini () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation

  W = canvas.width
  H = canvas.height
  let iAR = W/H
  let dAR = 1.5926
  if (H > W)
    dAR = 0.6279
  if (Math.abs(iAR - dAR) < 0.01) {
    return
  }
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let canvasoff = document.getElementById("off")
  let ctxoff = canvasoff.getContext("2d")
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctxoff.drawImage(canvas,0,0)
  let x = 0, y = 0
  let oW = W
  let oH = H
  if (iAR > dAR) {
    oW = H * dAR
  } else {
    oH = W / dAR
  }
  canvas.height = oH
  canvas.width = oW
  x = (oW - W)/2
  y = (oH - H)/2
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.drawImage(canvasoff, x, y)
  canvasoff.width = oW
  canvasoff.height = oH
  syncBackground(canvas)
  syncMarker()
  ctx.globalCompositeOperation = mode
}

function cropSquare (all) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  W = canvas.width
  H = canvas.height
  if (W == H)
    return
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let canvasoff = document.getElementById("off")
  let ctxoff = canvasoff.getContext("2d")
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctxoff.drawImage(canvas,0,0)
  let pad = 0, x = 0, y = 0
  if (H > W) {
    y -= (H-W)/2
    canvas.height -= (H-W)
  } else
  if (W > H) {
    x -= (W-H)/2
    canvas.width -= (W-H)
  }
  syncBackground(canvas)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.drawImage(canvasoff, x, y)
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctx.globalCompositeOperation = mode
  syncMarker()
}

function makeSquare (all) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  W = canvas.width
  H = canvas.height
  if (W == H)
    return
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let canvasoff = document.getElementById("off")
  let ctxoff = canvasoff.getContext("2d")
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctxoff.drawImage(canvas,0,0)
  let pad = 0, x = 0, y = 0
  if (H > W) {
    x = (H-W)/2
    canvas.width += (H-W)
  } else
  if (W > H) {
    y = (W-H)/2
    canvas.height += (W-H)
  }
  syncBackground(canvas)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.drawImage(canvasoff, x, y)
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctx.globalCompositeOperation = mode
}

function makeSquare2 (all) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  W = canvas.width
  H = canvas.height
  if (W == H)
    return
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let canvasoff = document.getElementById("off")
  let ctxoff = canvasoff.getContext("2d")
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctxoff.drawImage(canvas,0,0)
  let pad = 0, x = 0, y = 0
  if (H > W) {
    x = 0//(H-W)/2
    canvas.width += (H-W)
  } else
  if (W > H) {
    y = 0//(W-H)/2
    canvas.height += (W-H)
  }
  syncBackground(canvas)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.drawImage(canvasoff, x, y)
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctx.globalCompositeOperation = mode
}

function expandMarginsDown() {
  expandMargins()
}

function expandMarginsAll() {
  expandMargins(true)
}

function expandMargins (all) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let canvasoff = document.getElementById("off")
  let ctxoff = canvasoff.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  let value = +document.getElementById("rednumber").value

  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctxoff.drawImage(canvas,0,0)
  W = canvas.width
  if (all)
    canvas.width += value
  H = canvas.height
  if (!all && grunge)
    canvas.height *= 2
  else
    canvas.height += value
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height

  let yoffset = 0
  if (all)
    yoffset = (canvas.height-H)/2
  ctx.drawImage(canvasoff, (canvas.width-W)/2, yoffset)
  
  syncMarker()
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctx.globalCompositeOperation = mode
  syncBackground(canvas)
}

function tiltshift () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  let mode = ctx.globalCompositeOperation
  let alpha = document.getElementById("opacity").value
  
  clearOff()
  copyToOff()
  copyToOff()
  fadeDown()
  if (grunge)
    motionblur()
  else
    smeardown2()
  destinationOver()
  opacity100()
  pasteFromOff()
  sourceOver()
  /*
  flipV()
  invertLASTCLICK()
  // flipped and faded on one side
  copyToOff()
  copyToOff()
  fadeDown()
  if (grunge)
    motionblur()
  else
    smeardown2()
  copyToOff()
  copyToOff()
  // flipped and faded other side
  destinationOver()
  opacity100()
  pasteFromOff()
  // ready to flip back
  flipV()
  invertLASTCLICK()
  sourceOver()
  copyToOff()
  */
  document.getElementById("opacity").value = alpha
  ctx.globalCompositeOperation = mode
}

function opacity100 () {
  document.getElementById("opacity").value = 100
  return true
}
function invertLASTCLICK () {
  let h = document.getElementById("myCanvas").height
  LASTCLICK[1] = h - LASTCLICK[1]
  return true
}

function sourceOver () {
  let ctx = document.getElementById("myCanvas").getContext("2d")
  ctx.globalCompositeOperation = "source-over"
  return true
}

function destinationOver () {
  let ctx = document.getElementById("myCanvas").getContext("2d")
  ctx.globalCompositeOperation = "destination-over"
  return true
}

function motionblur (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let alpha = ctx.globalAlpha = document.getElementById("opacity").value
  let angle = 11//document.getElementById("angle").value
  let step = document.getElementById("featuresize").value
  let stepsize = step
  let grunge = document.getElementById("grungy").checked
  let maxangle = 9
  if (grunge) {
    stepsize *= 1.5
    //maxangle *= 2
  }
  if (Math.random() > 0.5)
    maxangle *= -1
  ctx.globalAlpha = document.getElementById("opacity").value/200
  newangle = Math.floor((Math.random()-0.5) * maxangle)
  //document.getElementById("angle").value = newangle
  nudgeCWorCCW((Math.random() > 0.5), canvas)
  let dir = [5 + (Math.random()-0.5) * stepsize, 5 + (Math.random()-0.5) * stepsize]
  smearrandom(canvas, dir)
  dir[0] += pet(23), dir[1] += pet(23)
  smearrandom(canvas, dir)
  dir[0] += pet(23), dir[1] += pet(23)
  smearrandom(canvas, dir)
  dir[0] += pet(23), dir[1] += pet(23)
  smearrandom(canvas, dir)

  //document.getElementById("angle").value = angle
  document.getElementById("opacity").value = alpha
}

function ripinhalf () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let top = document.createElement('CANVAS')
  top.width = canvas.width, top.height = canvas.height
  let topctx = top.getContext("2d")
  let bottom = document.createElement('CANVAS')
  bottom.width = canvas.width, bottom.height = canvas.height
  let bottomctx = bottom.getContext("2d")

  let sign =(Math.random() > 0.5)? 1: -1;
  let angle = 2 + 24 * Math.random()
  angle *= sign * -1
  let p = pet(50)
  topctx.translate(top.width/2+p, top.height/2+p)
  topctx.rotate(angle*Math.PI/180)
  topctx.translate(-(top.width/2+p), -(top.height/2+p))
  topctx.drawImage(canvas,0,0, bottom.width, bottom.height/2, 0, 0, canvas.width, canvas.height/2)
  ctx.clearRect(0, 0, canvas.width, canvas.height/2) // clear top rect
  angle = 2 + 24 * Math.random()
  angle *= sign
  p = pet(50)
  bottomctx.translate(bottom.width/2+p, bottom.height/2+p)
  bottomctx.rotate(angle*Math.PI/180)
  bottomctx.translate(-(bottom.width/2+p), -(bottom.height/2+p))
  bottomctx.drawImage(canvas, 0, 0)
  ctx.clearRect(0,0,canvas.width, canvas.height)
  if (Math.random() >= 0.5) {
    ctx.drawImage(bottom,0,0)
    ctx.drawImage(top, 0, 0)
  } else {
    ctx.drawImage(top, 0, 0)
    ctx.drawImage(bottom,0,0)
  }
}

function duplicate () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let top = document.createElement('CANVAS')
  top.width = canvas.width, top.height = canvas.height
  let topctx = top.getContext("2d")
  ctx.clearRect(0,0,canvas.width, canvas.height/4)
  ctx.clearRect(0,Math.round(canvas.height * 0.75) ,canvas.width, canvas.height)
  topctx.drawImage(canvas,0,0)//, bottom.width, bottom.height/2, 0, 0, canvas.width, canvas.height/2)
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(top, 0, canvas.height/4)
  ctx.drawImage(top, 0, -canvas.height/4)
}


function halfRip_mod () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let H = canvas.height, W = canvas.width
  let grunge = document.getElementById("grungy").checked
  let s = document.getElementById("featuresize").value/500
  let half = W*s
  let lx = LASTCLICK[0]
  const offset = 2 + W/100
  let x = 0, y = 0
  x = 0, y = 0
  ctx.save()
  ctx.beginPath()
  ctx.moveTo(x,y)
  x = lx + pet(50)//half-offset
  ctx.lineTo(x, y)
  H += 40
  while (y <= H) {
    x += pet(9)
    y += 9 + pet(4)
    ctx.lineTo(x, y)
    if (Math.random() > 0.95)
      x += pet(60)
    if (Math.random() > 0.95)
      y += 39
  }
  ctx.lineTo(0, y)
  ctx.closePath()
  ctx.clip()
  let color = (Math.random() > 0.5)? "#000000": "#ffffff";
  ctx.fillStyle = randomGradient(canvas, color)
  ctx.globalAlpha = 0.3
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.restore()
  ctx.restore()
}

function ripShade () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let alpha = document.getElementById("opacity").value
  // clip to ragged edge region
  ctx.save()
  
  //left rip
  let color = (Math.random() > 0.5)? "#000000": "#ffffff";
  ctx.fillStyle = randomGradient(canvas, color)
  ctx.globalAlpha = 0.2
  ctx.fillRect(0,0,canvas.width, canvas.height)
  ctx.restore()
  ctx.globalAlpha = alpha/100
}

function crumple () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let H = canvas.height, W = canvas.width
  let increase = Math.PI * 2 / 40;
  let x = 0, y = 0, angle = 4.7;
  ctx.globalAlpha = 0.05
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = document.getElementById("mode").value
  const numshapes = 10 + Math.random() * 5;
  let radius = (H+W)/3
  const maxradius = (H+W)/3
  for (var t = 0; t < numshapes; t++) {
    var centx = Math.random()*W;
    var centy = Math.random()*H;
    var edges = Math.random()*25+10;
    x = 0;
    y = 0;
    var x0 = x;
    var y0 = y;
    angle = Math.floor(Math.random() * 6.42);
    ctx.beginPath();
    increase = Math.PI * 2/edges*0.98;
    points = [];
    bez = [];
    let maxx = -1000000000, maxy = -1000000000, minx = 1000000000, miny = 1000000000
    for (var i = 0; i < edges; i++) {
      radius = Math.random() * maxradius*.4 + maxradius;
      x = radius * Math.cos(angle)+centx;
      y = radius * Math.sin(angle)+centy;
      var cp1x = radius * Math.cos(angle)+centx;
      var cp1y = radius * Math.sin(angle)+centy;
      var cp2x = radius * Math.cos(angle-(0.3*increase))+centx;
      var cp2y = radius * Math.sin(angle-(0.3*increase))+centy;
      var fx = (Math.random()-0.5)*30;
      var fy = (Math.random()-0.5)*30;
      sx = radius * 0.9 * Math.cos(angle)+centx+fx;
      sy = radius * 0.9 * Math.sin(angle)+centy+fy;
      var icp1x = 0.9*radius * Math.cos(angle)+centx+fx;
      var icp1y = 0.9*radius * Math.sin(angle)+centy+fy;
      var icp2x = 0.9*radius * Math.cos(angle-(0.3*increase))+centx+fx;
      var icp2y = 0.9*radius * Math.sin(angle-(0.3*increase))+centy+fy;
      points.push([sx, sy]);
      maxx = (maxx > sx)? maxx: sx;
      maxy = (maxy > sy)? maxy: sy;
      minx = (minx < sx)? minx: sx;
      miny = (miny < sy)? miny: sy;
      bez.push([icp1x, icp1y, icp2x, icp2y]);
      if (i == 0) {
        x0 = x;
        y0 = y;
        ctx.moveTo(x,y);
      } else
        ctx.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y);
      angle += increase;
    }
    ctx.lineTo(x0,y0);
    ctx.closePath();
    ctx.beginPath();
    for (var i = 0; i < points.length; i++) {
      x = points[i][0]-100;
      y = points[i][1]-100;
      if (i == 0) {
        x0 = x;
        y0 = y;
      }
      ctx.bezierCurveTo(bez[i][0], bez[i][1],bez[i][2],bez[i][3], points[i][0], points[i][1]);
    }
    ctx.closePath();
    if (Math.random() > 0.5)
      ctx.fillStyle = randomGradientRect(canvas, "#ffffff", minx+Math.random() * (maxx-minx), miny+Math.random() * (maxy-miny),  minx+Math.random() * (maxx-minx), miny+Math.random() * (maxy-miny))
    else
      ctx.fillStyle = randomGradientRect(canvas, "#000000", minx+Math.random() * (maxx-minx), miny+Math.random() * (maxy-miny),  minx+Math.random() * (maxx-minx), miny+Math.random() * (maxy-miny))
    ctx.fill();
    centx = Math.random()*W;
    centy = Math.random()*H;
  }
  ctx.globalCompositeOperation = mode
}

function trifold () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let nudge = canvas.height/20
  let alpha = document.getElementById("opacity").value
  let colors = (["#ffffff", "#000000"])
  ctx.globalAlpha = 0.1
  let x1 = canvas.width/2, y1 = 0, x2 = canvas.width/2, y2 = canvas.height/3
  ctx.fillStyle = randomGradientRect(canvas, colors[1], x1, y2, x2, y1 + nudge)// - Math.random() * canvas.width/3)
  ctx.fillRect(0,0,canvas.width,canvas.height/3)
  
  y1 = canvas.height/3, y2 = 2*canvas.height/3
  ctx.fillStyle = randomGradientRect(canvas, colors[0], x1, y1, x2, y2 - nudge)//Math.random() * canvas.width/3)
  ctx.fillRect(0, canvas.height/3, canvas.width, 2*canvas.height/3)

  y1 = 2*canvas.height/3, y2 = canvas.height
  ctx.fillStyle = randomGradientRect(canvas, colors[1], x1, y1, x2, y2 - nudge)//Math.random() * canvas.width/3)
  ctx.fillRect(0, 2*canvas.height/3, canvas.width, canvas.height)
  ctx.globalAlpha = alpha/100
}

function afold () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let alpha = document.getElementById("opacity").value
  let colors = (["#000000", "#ffffff"])
  let x1 = canvas.width/2, y1 = 0, x2 = canvas.width/2, y2 = canvas.height/2
  ctx.fillStyle = randomGradientRect(canvas, colors[0], x1, y1, x2, y2 - Math.random() * canvas.width/3)
  ctx.globalAlpha = 0.2
  ctx.fillRect(0,0,canvas.width,canvas.height/2)
  y1 = canvas.height/2, y2 = canvas.height
  ctx.fillStyle = randomGradientRect(canvas, colors[0], x1, y1, x2, y2 - Math.random() * canvas.width/3)
  ctx.fillRect(0,canvas.height/2, canvas.width, canvas.height)
  ctx.globalAlpha = alpha/100
}

function dfold () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let alpha = document.getElementById("opacity").value
 // ctx.clearRect(0,0,canvas.width, canvas.height/2)
  ctx.fillStyle = randomGradient(canvas, "#ffffff")
  ctx.globalAlpha = 0.2
  ctx.beginPath()
  ctx.moveTo(0,0)
  ctx.lineTo(canvas.width,canvas.height)
  ctx.lineTo(0,canvas.height)
  ctx.closePath()
  ctx.fill()
  
  ctx.fillStyle = randomGradient(canvas, "#000000")
  ctx.beginPath()
  ctx.moveTo(0,0)
  ctx.lineTo(canvas.width,canvas.height)
  ctx.lineTo(canvas.width,0)
  ctx.closePath()
  ctx.fill()
  
  ctx.globalAlpha = alpha/100
}

function nudgeCW () {
  nudgeCWorCCW()
}

function nudgeCCW () {
  nudgeCWorCCW(true)
}

function nudgeCWorCCW (cc, canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let h = canvas.height;
  let w = canvas.width;
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  let angle = +document.getElementById("rednumber").value
  angle *= Math.PI/180
  if (cc)
    angle *= -1
  let x = LASTCLICK[0]
  let y = LASTCLICK[1]
  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(angle);
  ctx.drawImage(canvas,-x,-y,canvas.width, canvas.height)
  ctx.restore();
}

function nudgeRight () {
  nudgeCanvas(true)
}

function nudgeDown () {
  nudgeCanvas(false)
}

function nudgeCanvas (right) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalAlpha = 1.0//document.getElementById("opacity").value/100
  let canvasoff = document.getElementById("off")
  let ctxoff = canvasoff.getContext("2d")
  let value = +document.getElementById("rednumber").value
  //if (up)
 //   value *= -1
  canvasoff.width = canvas.width
  canvasoff.height = canvas.height
  ctxoff.drawImage(canvas,0,0)
  ctx.clearRect(0,0,canvas.width, canvas.height)
  if (right)
    ctx.drawImage(canvasoff, value, 0)
  else
    ctx.drawImage(canvasoff, 0, value)
  ctxoff.clearRect(0,0,canvasoff.width, canvasoff.height)
//  syncBackground(canvas)
}

async function fillA (canvas, fs) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  if (fs)
    ctx.fillStyle = fs
  await ctx.fillRect(0,0,canvas.width, canvas.height)
  return true
}

async function fill (canvas, fs) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let gco = ctx.globalCompositeOperation
  let sel = document.getElementById("mode").value
  if (gco !== sel) {
    ctx.globalCompositeOperation = sel
  }
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  if (fs)
    ctx.fillStyle = fs
  await ctx.fillRect(0,0,canvas.width, canvas.height)
  return true
}

function hazeo () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  let G = document.getElementById("grungy").checked
  if ((G && Math.random() > 0.7) || !G)
    ctx.fillRect(0,0,canvas.width, canvas.height)
}

function rc () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  let cx = canvas.height/2, cy = canvas.width/2
  ocanvas.height = (canvas.height > canvas.width)? canvas.height: canvas.width
  ocanvas.width = (canvas.height > canvas.width)? canvas.height: canvas.width
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  octx.drawImage(canvas, 0, 0)
  let swap = canvas.height
  canvas.height = canvas.width
  canvas.width = swap
  syncBackground(canvas)
  cx = canvas.height/2, cy = canvas.width/2
  ctx.translate(cy, cx)
  ctx.rotate(Math.PI * 0.5)
  ctx.translate(-cx,-cy)
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(ocanvas, 0, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  ctx.setTransform(1,0,0,1,0,0)
  ctx.drawImage(ocanvas,0,0,canvas.width,canvas.height)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  //LASTCLICK[0] = myCanvas.width/2
  //LASTCLICK[1] = myCanvas.height/2
  ctx.globalAlpha = a
  refreshMode()
  //syncMarker()
  ctx.globalCompositeOperation = mode
}

function rcc () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  let cx = canvas.height/2, cy = canvas.width/2
  ocanvas.height = (canvas.height > canvas.width)? canvas.height: canvas.width
  ocanvas.width = (canvas.height > canvas.width)? canvas.height: canvas.width
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  octx.drawImage(canvas, 0, 0)
  let swap = canvas.height
  canvas.height = canvas.width
  canvas.width = swap
  syncBackground(canvas)
  cx = canvas.height/2, cy = canvas.width/2
  ctx.translate(cy, cx)
  ctx.rotate(Math.PI * -0.5)
  ctx.translate(-cx,-cy)
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(ocanvas, 0, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  ctx.setTransform(1,0,0,1,0,0)
  ctx.drawImage(ocanvas,0,0,canvas.width,canvas.height)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  //LASTCLICK[0] = myCanvas.width/2
  //LASTCLICK[1] = myCanvas.height/2
  ctx.globalAlpha = a
  refreshMode()
 // syncMarker()
 ctx.globalCompositeOperation = mode
}

function flipH () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  octx.drawImage(canvas, 0, 0)
  ctx.translate(canvas.width, 0)
  ctx.scale(-1,1)
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(ocanvas, 0, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  ctx.setTransform(1,0,0,1,0,0)
  ctx.globalAlpha = a
  ctx.globalCompositeOperation = mode
  return true
}

function flipV () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  octx.drawImage(canvas, 0, 0)
  ctx.translate(0, canvas.height)
  ctx.scale(1,-1)
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(ocanvas, 0, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  ctx.setTransform(1,0,0,1,0,0)
  ctx.globalAlpha = a
  //refreshMode()
  ctx.globalCompositeOperation = mode
  return true
}

function flipStrip () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  let w = 40 + Math.random() * canvas.width/2
  let x = (canvas.width) * Math.random()
  octx.clearRect(0,0,canvas.width,ocanvas.height)
  octx.drawImage(canvas, 0, 0)
  octx.clearRect(0,0,x,ocanvas.height)
  octx.clearRect(x+w,0,ocanvas.width,ocanvas.height)
  ctx.translate(0, canvas.height)
  ctx.scale(1,-1)
  ctx.clearRect(x,0,w,canvas.height)
  ctx.drawImage(ocanvas, 0, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  ctx.setTransform(1,0,0,1,0,0)
  ctx.globalAlpha = a
}

function flipStripH () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  let h = 40 + Math.random() * canvas.height/2
  let y = (canvas.height) * Math.random()
  octx.clearRect(0,0,canvas.width,ocanvas.height)
  octx.drawImage(canvas, 0, 0)
  octx.clearRect(0,0,canvas.width,y)
  octx.clearRect(0,y+h,ocanvas.width,ocanvas.height)
  ctx.translate(canvas.width, 0)
  ctx.scale(-1,1)
  ctx.clearRect(0,y,canvas.width, h)
  ctx.drawImage(ocanvas, 0, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  ctx.setTransform(1,0,0,1,0,0)
  ctx.globalAlpha = a
}

function pixelado () {
  slices()
  rc()
  slices()
  rcc()
}

function shred2 () {
  shred()
  clearOff()
  copyToOff()
  nudgeRight()
  copyToOff()
  nudgeDown()
  copyToOff()
  document.getElementById("rednumber").value *= -1
  nudgeRight()
  pasteFromOff()
}

function shred () {
  blasco()
  rc()
  blasco()
  rcc()
}

function slices () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let a = ctx.globalAlpha
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  let ch = canvas.height
  let h = 4 + Math.floor(document.getElementById("featuresize").value/2)
  let count = ch/h - 1
  let y = 0, i = 0
  for (;i < count; i++) {
    sliceH(y, h, ctx, octx, canvas, ocanvas)
    y += h
  }
  ctx.globalAlpha = a
}

function sliceH (y, h, ctx, octx, canvas, ocanvas) {
  octx.clearRect(0,0,canvas.width,ocanvas.height)
  octx.drawImage(canvas, 0, 0)
  octx.clearRect(0,0,canvas.width,y)
  octx.clearRect(0,y+h,ocanvas.width,ocanvas.height)
  ctx.translate(0,2*y+h)
  ctx.scale(1,-1)
  ctx.clearRect(0,y,canvas.width, h)
  ctx.drawImage(ocanvas, 0, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  ctx.setTransform(1,0,0,1,0,0)
}

function pasta () {
  pastaSlice()
  rc()
  pastaSlice()
  rcc()
}

function closediv (N, d) {
  if (N % d === 0)
    return d
  let i = 0
  let results = []
  for (; i < N; i++) {
    if (N % i == 0)
      results.push(i)
  }
  let min = N
  i = 0
  for (; i < results.length; i++) {
    if (results[i] - d >= 0)
      return results[i]
  }
  return d
}

function pastaSlice () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let a = ctx.globalAlpha
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.drawImage(canvas, 0, 0)
  canvas.width *= 2
  canvas.height /= 2
  let ch = canvas.height
  let h = 4 + Math.floor(document.getElementById("featuresize").value/2)
  //h = closediv(canvas.height, h)
  let count = ch/h*2
  let y = 0, yon =0, i = 0
  for (;i < count; i++) {
    ctx.drawImage(ocanvas, 0, y, ocanvas.width, h, 0, yon, canvas.width/2, h);
    ctx.drawImage(ocanvas, 0, y+h, ocanvas.width, h, canvas.width/2, yon, canvas.width/2, h);
    y += h*2
    yon += h
  }
  ctx.globalAlpha = a
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
}
 
function reverse () { // rotate canvas at touch x,y. concentric circles
  let ocanvas = document.createElement("CANVAS")
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  let h = 2 + Math.floor(document.getElementById("featuresize").value/10)
  let n = canvas.width/h/2
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  octx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  let cx = canvas.width/2
  let cy = canvas.height/2
  let x = 0, y = 0
  let x2 = canvas.width, y2 = canvas.height
  let i = 0
  let angle = Math.PI
  if (grunge)
    angle /= 2
  octx.drawImage(ocanvas, 0,0)

  for (; i < n; i++) {
    ctx.save()
    ctx.beginPath()
    ctx.moveTo(x,y)
    ctx.lineTo(x2,y)
    ctx.lineTo(x2,y2)
    ctx.lineTo(x,y2)
    ctx.closePath()
    ctx.clip()
    octx.translate(cx, cy)
    octx.rotate(angle);
    octx.translate(-cx,-cy)
    octx.drawImage(canvas, 0, 0)
    ctx.drawImage(ocanvas, 0,0)
    ctx.restore()
    x += h
    y += h
    x2 -= h
    y2 -= h
  }
  ctx.globalAlpha = a
  octx = ocanvas.getContext('2d')
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
}

function rotateCent () { // rotate canvas at touch x,y. concentric circles
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  let radius = 4 + Math.floor(document.getElementById("featuresize").value/2)
  let r0 = radius
  let n = canvas.width/radius
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  octx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  let x = canvas.width/2
  let y = canvas.height/2
  x = LASTCLICK[0]
  y = LASTCLICK[1]
  let i = 0
  let angle = -Math.PI/n
  for (; i < n/2; i++) {
    octx.translate(x, y)
    octx.rotate(angle);
    octx.translate(-x,-y)
    ctx.save()
    octx.drawImage(canvas, 0, 0)
    ctx.beginPath()
    ctx.arc(x, y, radius, 0, 2*Math.PI)
    ctx.closePath()
    ctx.clip()
    ctx.drawImage(ocanvas, 0,0)
    octx.translate(x,y)
    octx.rotate(-angle);
    octx.translate(-x,-y)
    ctx.restore()
    radius += r0
  }
  ctx.globalAlpha = a
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
}

function rotateCirc () { // grip of rotated circles
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  let n = 2 + Math.floor(document.getElementById("featuresize").value/20)
  // 27 ... 2 => 2 ... 27
  // max+min - n
  n = (27 + 2) - n
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  let h = canvas.height/n
  let w = canvas.width/n
  let x = w/2
  let y = h/2
  let i = 0
  for (; i < n*n; i++) {
    if (i > 0 && i % (n) == 0) {
      x = w/2
      y += h
    }
    let angle = (Math.PI * (Math.random() - 0.5) * Math.PI/2)
    let radius = canvas.width/(n+1)/2
    if (grunge) {
      radius += pet(radius/2)
      x += pet(radius/2)
      y += pet(radius/2)
    }
    octx.translate(x, y)
    octx.rotate(angle);
    octx.translate(-x,-y)
    ctx.save()
    octx.drawImage(canvas, 0, 0)
    ctx.beginPath()
    ctx.arc(x, y, radius, 0, 2*Math.PI)
    ctx.closePath()
    ctx.clip()
    ctx.drawImage(ocanvas, 0,0)
    octx.translate(x,y)
    octx.rotate(-angle);
    octx.translate(-x,-y)
    ctx.restore()
    x += w
  }
  ctx.globalAlpha = a
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
}

function dots () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = 1.0
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  let ch = canvas.height
  let h = 2 + Math.floor(document.getElementById("featuresize").value/4)
  let w = h
  let off = h/2
  let r = w/2
  let t = 0
  if (grunge) {
    t = 2
    r *= 0.7
  }
  let count = (canvas.height/h + 2) * (canvas.width/w + 2)
  let newline = Math.floor(canvas.width/w)+2
  let counter = 0
  let x = 0, y = 0
  let i = 0
  for (;i < count; i++) {
    ctx.beginPath()
    ctx.arc(x+w/2+pet(t),y+h/2+pet(t),r+pet(w/5),0,Math.PI*2)
    ctx.closePath()
    ctx.fill()
    x += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = -w/2
      y += h
      off *= -1
      x += off/2
    }
  }
}

function diamonds () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let ch = canvas.height
  let h = 4 + Math.floor(document.getElementById("featuresize").value/4)
  let w = h
  let off = 0

  let count = 4*(1+canvas.height/h) * (1+canvas.width/w)
  let newline = 2*Math.floor(canvas.width/w) + 1
  let counter = 0
  let x = 0, y = 0
  let i = 0
  ctx.save()
  ctx.beginPath()
  for (;i < count; i++) {
    ctx.moveTo(x+w/4,y)
    ctx.lineTo(x+w/2, y+h/4)
    ctx.lineTo(x+w/4, y+h/2)
    ctx.lineTo(x, y+h/4)
    x += w/2
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = 0
      y += h/2
    }
  }
  ctx.closePath()
  ctx.clip()
  ctx.clearRect(0,0,canvas.width, canvas.height)
  ctx.restore()
}

function checkerboard () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let ch = canvas.height
  let h = 4 + Math.floor(document.getElementById("featuresize").value/4)
  let w = h
  let off = -1
  let count = 2*(1+canvas.height/h) * (1+canvas.width/w)
  let newline = Math.floor(canvas.width/w) + 1
  let counter = 0
  let x = 0, y = 0
  let i = 0
  ctx.save()
  ctx.beginPath()
  for (;i < count; i++) {
    ctx.moveTo(x,y)
    ctx.lineTo(x+w/2, y)
    ctx.lineTo(x+w/2, y+h/2)
    ctx.lineTo(x, y+h/2)
    x += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      if (off < 0)
        x = w/2
      else
        x = 0
      y += h/2
      off *= -1
    }
  }
  ctx.closePath()
  ctx.clip()
  ctx.clearRect(0,0,canvas.width, canvas.height)
  ctx.restore()
}

function dashes (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let ch = canvas.height
  let h = 4 + Math.floor(document.getElementById("featuresize").value/4)
  let w = h/4
  let off = h/4
  let r = w/2
  let t = r
  if (grunge) {
    t = r*2
    r *= 1.4
  }
  ctx.lineCap = "round"
  ctx.lineWidth = r
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let count = canvas.height/h * canvas.width/w * 4.3
  let newline = Math.floor(canvas.width/w) + 2
  let counter = 0
  let x = 0, y = 0
  let i = 0
  for (;i < count; i++) {
    ctx.save()
    ctx.beginPath()
    ctx.moveTo(x+pet(t), y+pet(t))
    ctx.lineTo(x+w/2+pet(t),y+pet(t))
    ctx.stroke()
    x += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = 0
      y += h/4
    }
  }
}
  
function holes2 (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let ch = canvas.height
  let h = 2 + Math.floor(document.getElementById("featuresize").value/4)
  let w = h
  let off = h/2
  let r = w/2
  let t = r
  if (grunge) {
    t = r*2
    r *= 1.4
  }
  let count = canvas.height/h * canvas.width/w
  let newline = Math.floor(canvas.width/w)
  let counter = 0
  let x = w, y = h/2
  let xo = 0, yo = 0, i = 0
  for (;i < count; i++) {
    ctx.save()
    ctx.beginPath()
    ctx.arc(x+w/2+pet(t),y+h/2+pet(t),r+pet(w/5),0,Math.PI*2)
    ctx.closePath()
    ctx.clip()
    ctx.clearRect(0,0,canvas.width, canvas.height)
    ctx.restore()
    x += w*1.8
    xo += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = w
      xo = 0
      y += 1.5*h
      yo += h
      off *= -1
      x =+ off
    }
  }
}

function holes () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let ch = canvas.height
  let h = 2 + Math.floor(document.getElementById("featuresize").value/4)
  let w = h
  let off = h/2
  let r = w/2
  let t = 0
  if (grunge) {
    t = r
    r *= 1.4
  }
  let count = canvas.height/h * canvas.width/w
  let newline = Math.floor(canvas.width/w)
  let counter = 0
  let x = w, y = h/2
  let xo = 0, yo = 0, i = 0
  for (;i < count; i++) {
    ctx.save()
    ctx.beginPath()
    ctx.arc(x+w/2+pet(t),y+h/2+pet(t),r+pet(w/5),0,Math.PI*2)
    ctx.closePath()
    ctx.clip()
    ctx.clearRect(0,0,canvas.width, canvas.height)
    ctx.restore()
    x += w*2
    xo += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = w
      xo = 0
      y += 2*h
      yo += h
      off *= -1
      x =+ off
    }
  }
}

function samplec () { // circular samples
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let a = ctx.globalAlpha
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.drawImage(canvas, 0, 0)
  ctx.clearRect(0,0,ocanvas.width,canvas.height)
  canvas.width /= 2
  canvas.height /= 2
  syncBackground(canvas)
  let ch = canvas.height
  let h = 4 + Math.floor(document.getElementById("featuresize").value/2)
  let w = h
  let count = canvas.height/h * canvas.width/w
  let newline = Math.floor(canvas.width/w)
  let counter = 0
  let x = w, y = h
  let xo = 0, yo = 0, i = 0
  for (;i < count; i++) {
    ctx.save()
    ctx.beginPath()
    ctx.arc(xo+w/2,yo+h/2,w/2,0,Math.PI*2)
    ctx.closePath()
    ctx.clip()
    //if (i % 4 == 0)
    //  ctx.clearRect(0,0,canvas.width, canvas.height)
    //if (i % 4 == 0)
    ctx.drawImage(ocanvas, x, y, w, h, xo, yo, w, h);
    ctx.restore()
    x += w*2
    xo += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = w
      xo = 0
      y += 2*h
      yo += h
    }
  }
  ctx.globalAlpha = a
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
}

function sample () { // rect samples
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let a = ctx.globalAlpha
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.drawImage(canvas, 0, 0)
  ctx.clearRect(0,0,ocanvas.width,canvas.height)
  canvas.width /= 2
  canvas.height /= 2
  syncBackground(canvas)
  let ch = canvas.height
  let h = 4 + Math.floor(document.getElementById("featuresize").value/2)
  let w = h
  let count = canvas.height/h * canvas.width/w
  let newline = Math.floor(canvas.width/w)
  let counter = 0
  let x = w, y = h
  let xo = 0, yo = 0, i = 0
  for (;i < count; i++) {
    ctx.drawImage(ocanvas, x, y,  w, h, xo, yo, w, h);
    x += w*2
    xo += w
    counter++
    if (i > 0 && newline == counter) {
      counter = 0
      x = w
      xo = 0
      y += 2*h
      yo += h
    }
  }
  ctx.globalAlpha = a
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
}

function dropFrameRagged () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let alpha = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  let W = canvas.width, H = canvas.height
  let padx = (W - 0.95 * W)/2
  let pady = (H - 0.95 * H)/2
  let points = [], x = padx, y = pady
  let endX = W - padx, endY =y
  
  clearOff()
  zoomImage(true, true)
  copyToOff()
  ctx.save()
  ctx.fillStyle = document.getElementById("paintcolor").value//"#ffffff"
  ctx.shadowColor = "#606060"
  ctx.shadowBlur = 29 + Math.random() * 5
  ctx.shadowOffsetY = 19+ Math.random() * 3
  ctx.shadowOffsetX = 19 + Math.random() * 2
  ctx.beginPath()
  ctx.moveTo(x,y)
  ragged (ctx, endX, endY, x, y) // top right
  x = endX, y = endY
  endY = H -pady
  endX+=12
  ragged (ctx, endX, endY, x, y) //bottom right
  x = endX, y = endY
  endX = padx
  ragged (ctx, endX, endY, x, y) //bottom left
  x = endX, y = endY
  endY = pady
  ragged (ctx, endX, endY, x, y) //top left
  ctx.closePath()
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.fill()
  pasteFromOff()
  ctx.clip()

  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  
  ctx.restore()
  ctx.globalCompositeOperation = mode
  ctx.globalAlpha = alpha
}

function dropFrame () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let alpha = document.getElementById("opacity").value/100
  ctx.globalAlpha = 1.0
  clearOff()
  zoomImage(true)
  copyToOff()
  ctx.fillStyle = "#ffffff"
  ctx.shadowColor = "#202020"
  ctx.shadowBlur = 25 + Math.random() * 5
  ctx.shadowOffsetY = 13 + Math.random() * 2
  ctx.shadowOffsetX = 4 + Math.random() * 2
  let padx = (canvas.width - 0.95 * canvas.width)/2
  let pady = (canvas.height - 0.95 * canvas.height)/2
  ctx.fillRect(padx,pady,canvas.width-2*padx,canvas.height-2*pady)
  ctx.shadowBlur = 0
  ctx.shadowOffsetY = 0
  ctx.shadowOffsetX = 0
  pasteFromOff()
  ctx.globalCompositeOperation = mode
  ctx.globalAlpha = alpha
}

function zoomOutImage () {
  zoomImage(true)
}

function zoomImage (out, d) {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  let W = canvas.width, H = canvas.height
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.imageSmoothingEnabled = true
  octx.imageSmoothingQuality = 'high'
  ctx.imageSmoothingEnabled = true
  ctx.imageSmoothingQuality = 'high'
  octx.drawImage(canvas, 0, 0)
  
  let dx = (out)? canvas.width * 0.95: canvas.width * 1.05
  let dy = (out)? canvas.height * 0.95: canvas.height * 1.05

  let diffx = dx - W
  let diffy = dy - H
  let ox = (W/2/W * diffx)
  let oy = (H/2/H * diffy)
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.drawImage(ocanvas, -ox, -oy, dx, dy)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  ctx.globalCompositeOperation = mode
}

function zoom () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.drawImage(canvas, 0, 0)
  canvas.width = Math.round(canvas.width * 1.2)
  canvas.height = Math.round(canvas.height * 1.2)
  syncBackground(canvas)
  ctx.drawImage(ocanvas,0,0,canvas.width,canvas.height)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.globalCompositeOperation = mode
  syncMarker()
}

function zoom_neg () {
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  ctx.globalCompositeOperation = "source-over"
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  octx.drawImage(canvas, 0, 0)
  canvas.width = Math.round(canvas.width / 1.2)
  canvas.height = Math.round(canvas.height / 1.2)
  syncBackground(canvas)
  ctx.drawImage(ocanvas,0,0,canvas.width,canvas.height)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.globalCompositeOperation = mode
  syncMarker()
}

function blasco () {
  let h = 4 + Math.floor(document.getElementById("featuresize").value/2)
  document.getElementById("rednumber").value = h
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let temp = document.createElement("CANVAS")
  let tempctx = temp.getContext("2d")
  let a = ctx.globalAlpha
  let grunge = document.getElementById("grungy").checked
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  temp.height = canvas.height * 2 + h*2
  temp.width = canvas.width
  let ch = canvas.height
  let count = ch/h - 1
  let y = 0, i = 0
  for (;i < count; i++) {
    if (grunge) {
      if (i % 2 == 0) {
        sliceHC(y, h, ctx, octx, canvas, ocanvas, temp, tempctx, grunge)
        y += h
      } else
        y += h
    } else {
      sliceHC(y, h, ctx, octx, canvas, ocanvas, temp, tempctx, grunge)
        y += h
    }
  }
  
  if (grunge) {
    canvas.height *= 1
    canvas.height += 2*h
  } else {
    canvas.height *= 2
    canvas.height += 2*h
  }
  syncBackground(canvas)
  ctx.drawImage(temp, 0, 0)
  ctx.globalAlpha = a
  ctx.setTransform(1,0,0,1,0,0)
  //syncMarker()
}

function sliceHC (y, h, ctx, octx, canvas, ocanvas, t, tctx, g) {
  octx.clearRect(0,0,canvas.width,ocanvas.height)
  octx.drawImage(canvas, 0, 0)
  octx.clearRect(0,0,canvas.width,y)
  octx.clearRect(0,y+h,ocanvas.width,ocanvas.height)
  if (g)
    tctx.translate(0,h)
  else
    tctx.translate(0,y+h)
  tctx.clearRect(0,y,canvas.width, h)
  tctx.drawImage(ocanvas, 0, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  tctx.setTransform(1,0,0,1,0,0)
}

function randomGradientRect(canvas, col1, x1, y1, x2, y2, R) {
  let centx = Math.random() * canvas.width;
  let centy = Math.random() * canvas.height;
  let radius = canvas.width/2;
  let angle = Math.random()*6.27;
  let p = 21//(x1-x2)
  if (R)
    p = (x1-x2)
  let my_gradient = canvas.getContext('2d').createLinearGradient(x1-pet(p), y1-pet(p), x2+pet(p), y2+pet(p));
  let col2 = "rgba("+hexToR(col1)+", "+hexToG(col1)+", "+hexToB(col1)+", 0.0)";// transparent
  my_gradient.addColorStop(0,col1);
  my_gradient.addColorStop(1,col2);
  return my_gradient;
}

function randomGradientRect2(canvas, col1, col2, x1, y1, x2, y2, R) {
  let centx = Math.random() * canvas.width;
  let centy = Math.random() * canvas.height;
  let radius = canvas.width/2;
  let angle = Math.random()*6.27;
  let p = 2
  let my_gradient = canvas.getContext('2d').createLinearGradient(x1-pet(p), y1-pet(p), x2+pet(p), y2+pet(p));
  col2 = "rgba("+hexToR(col2)+", "+hexToG(col2)+", "+hexToB(col2)+", 0.2)";// transparent
  my_gradient.addColorStop(0,col2);
  my_gradient.addColorStop(1,col1);
  return my_gradient;
}

function petColor (c, p) {
  let r = hexToR(c) + Math.floor(pet(p))
  let g = hexToG(c) + Math.floor(pet(p))
  let b = hexToB(c) + Math.floor(pet(p))
  if (r > 255 || r < 0)
    r =  hexToR(c)
  if (g > 255 || g < 0)
    g =  hexToG(c)
  if (b > 255 || b < 0)
    b =  hexToB(c)
  let R = ('0'+(Math.round(r)).toString(16)).slice(-2),
      G = ('0'+(Math.round(g)).toString(16)).slice(-2),
      B = ('0'+(Math.round(b)).toString(16)).slice(-2);
  return "#"+R+G+B
}

function randomGradient(canvas, col1) {
  let x1 = 0, y1 = 0, x2 = 0, y2 = 0;
  let centx = Math.random() * canvas.width;
  let centy = Math.random() * canvas.height;
  let radius = canvas.width/2;
  let angle = Math.random()*6.27;
  x1 = radius * Math.cos(angle)+centx;
  y1 = radius * Math.sin(angle)+centy;
  x2 = radius * Math.cos(angle+3.14)+centx;
  y2 = radius * Math.sin(angle+3.14)+centy;
  let my_gradient = canvas.getContext('2d').createLinearGradient(x1, y1, x2, y2);
  if (col1 === undefined)
    col1 = randomColor();

  let col2 = "rgba("+hexToR(col1)+", "+hexToG(col1)+", "+hexToB(col1)+", 0.0)";// transparent
  my_gradient.addColorStop(0,col1);
  my_gradient.addColorStop(1,col2);
  return my_gradient;
}

function randomGradientLeft(canvas, col1) {
  let x1 = 0, y1 = 0, x2 = 0, y2 = 0;
  let centx = -1//Math.random() * canvas.width;
  let centy = Math.random() * canvas.height;
  let radius = canvas.width/2;
  let angle = Math.random()*6.27;
  x1 = radius * Math.cos(angle)+centx;
  y1 = 0//radius * Math.sin(angle)+centy;
  x2 = radius * Math.cos(angle+3.14)+centx;
  y2 = 0//radius * Math.sin(angle+3.14)+centy;
  let my_gradient = canvas.getContext('2d').createLinearGradient(x1, y1, x2, y2);
  if (col1 === undefined)
    col1 = randomColor();

  let col2 = "rgba("+hexToR(col1)+", "+hexToG(col1)+", "+hexToB(col1)+", 0.0)";// transparent
  my_gradient.addColorStop(0,col1);
  my_gradient.addColorStop(1,col2);
  return my_gradient;
}

//  input: r,g,b in [0,1], out: h in [0,360) and s,v in [0,1]
function rgb2hsv(r,g,b) {
  let v=Math.max(r,g,b), c=v-Math.min(r,g,b);
  let h= c && ((v==r) ? (g-b)/c : ((v==g) ? 2+(b-r)/c : 4+(r-g)/c));
  return [60*(h<0?h+6:h), v&&c/v, v];
}

function hexToR(h) { return parseInt((cutHex(h)).substring(0,2),16) }
function hexToG(h) { return parseInt((cutHex(h)).substring(2,4),16) }
function hexToB(h) { return parseInt((cutHex(h)).substring(4,6),16) }
function cutHex(h) { return (h.charAt(0)=="#") ? h.substring(1,7) : h}

function hrips () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let centerx = canvas.width / 2;
  let centery = canvas.height / 2;
  let thickness = document.getElementById("featuresize").value
  ctx.globalAlpha = document.getElementById("opacity").value/100
  //ctx.save()
  //clip()
  ctx.fillStyle = document.getElementById("paintcolor").value
  let yincrement = 4;
  let numshapes = 1
  for (let t = 0; t < numshapes; t++) {
    let points = [];
    let width = 1 + Math.random()*3;
    ctx.lineWidth = 3+Math.random()*11;
    let x = -20;
    let y = Math.random() * canvas.height * 1.5
    y //+= thickness
    let x0 = x;
    let y0 = y;
    ctx.beginPath();
    ctx.moveTo(x, y);
    points.push([x,y]);
    let direction = 0.8;
    if (y < centery)
      direction = -0.8;
    let yincrement = 1 + Math.random() * 3;
    let jump = 3 + Math.random() * 4;
    while (x < canvas.width+20) {
      y += (Math.random()-0.5) * yincrement;
      x += 1 + 3 * Math.random();
      if (Math.random() < 0.1)
        x += 3 + Math.random() * 7;
      if (Math.random() < 0.5)
        y -= jump * (Math.random()*direction);
      ctx.lineTo(x+Math.random()*4,y+(1+width + Math.random() * 5));
      points.push([x,y]);
      if (Math.random() < 0.05) {
        direction *= -1;
      }
    }
    y -= thickness
    while (x > -20) {
      y -= (Math.random()-0.5) * yincrement;
      x -= 1 + 3 * Math.random();
      if (Math.random() < 0.040)
        x -= 7 + Math.random() * 7;
      if (Math.random() < 0.5)
        y += jump * (Math.random()*direction);
      ctx.lineTo(x+Math.random()*4,y+(1+width + Math.random() * 5));
      points.push([x,y]);
      if (Math.random() < 0.1) {
        direction *= -1;
      }
    }
    ctx.fillStyle = document.getElementById("paintcolor").value
    if (document.getElementById("grungy").checked)
      ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.closePath();
    ctx.fill();
  }
  //ctx.restore()
}

function smudgearcs2 () {
  smudge ('arcs2')
}

function smudgearcs () {
  smudge ('arcs')
}

function smudgestars () {
  smudge ('stars')
}

function smudgestreaks () {
  smudge ('streaks')
}
function smudgestreaks2 () {
  smudge ('streaks2')
}

function smudgewatercolor () {
  smudge ('watercolor')
}

function smudgehorizontal () {
  smudge ('horizontal')
}

function smudgehorizontal2 () {
  smudge ('horizontal2')
}

function smudge (type) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let H = canvas.height
  let xoff = -W, yoff = -W
  let len = W/2, maxy = W/2
  let off = document.getElementById("offscreen");
  let ctoff = off.getContext("2d");
  let canvasoff = document.getElementById("offscreen");
  let ctxoff = canvasoff.getContext("2d");
  let n = 0, x = 0, y = 0
  ctx.globalAlpha = document.getElementById("opacity").value/100 //* 0.75
  let smudge_size = 2 + Math.random()*13
  let dx = pet(smudge_size*3), dy = pet(smudge_size*3)
  let smudge_ct = 1 + document.getElementById("number").value/150
  let area = canvas.width * canvas.height
  let shapemultiplier = area/(1024*1024)
  smudge_ct *= shapemultiplier
  if (type == "watercolor")
    smudge_ct /= 2
  //clip()
  for (; n < smudge_ct; n++) {
    if (type === "streaks")
      offstreaks()
    else
    if (type === "streaks2")
      offmix()
    else
    if (type === "horizontal")
      offhorizontal()
    else
    if (type === "horizontal2")
      offhorizontal2()
    else
    if (type === "arcs")
      offarcs()
    else
    if (type === "arcs2")
      offarcs2()
    else
    if (type === "stars")
      offstars()
    else
    if (type === "watercolor")
      offwatercolor()
    else
      offspecks()
    x = Math.random()*canvas.width
    y = Math.random()*canvas.height
    dx = pet(13), dy = pet(13)
    let i = 0
    let moves = smudge_size
    if (type == "arcs2")
      moves = 1
    for (; i < moves; i++) {
      ctx.drawImage(canvasoff, x,   y)
      ctx.drawImage(canvasoff, x-W, y-H)
      ctx.drawImage(canvasoff, x,   y-H)
      ctx.drawImage(canvasoff, x+W, y-H)
      ctx.drawImage(canvasoff, x-W, y+H)
      ctx.drawImage(canvasoff, x,   y+H)
      ctx.drawImage(canvasoff, x+W, y+H)
      ctx.drawImage(canvasoff, x-W, y)
      ctx.drawImage(canvasoff, x+W, y)
      x += dx + pet(23)
      y += dy + pet(23)
    }
  }
  ctxoff.clearRect(0,0,canvasoff.width, canvasoff.height)
 // ctx.restore()
}

function fog () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let H = canvas.height
  let xoff = -W, yoff = -H
  let len = W/2, maxy = W/2
  let canvasoff = document.getElementById("offscreen");
  let ctxoff = canvasoff.getContext("2d");
  let n = 0, x = 0, y = 0
  ctx.globalAlpha = document.getElementById("opacity").value/100 //* 0.75
  let smudge_size = 51 + Math.random()* 100
  let colors = []
  let grunge = document.getElementById("grungy").checked
  if (grunge)
    colors.push(randomColor())
  else
    colors.push(document.getElementById("paintcolor").value)
  //clip()
  let smudge_ct = 1 + document.getElementById("number").value/100
  let area = canvas.width * canvas.height
  let shapemultiplier = area/(1024*1024)
  smudge_ct *= shapemultiplier
  ctxoff.save()
  for (; n < smudge_ct; n++) {
    x = Math.random() * (W + 40) - 256
    y = Math.random() * (H + 40) - 256
    offbrush(colors)
    let i = 0
    let moves = 15//smudge_size * 8
    for (; i < moves; i++) {
      ctx.drawImage(canvasoff, x += pet(41), y += pet(41))
    }
  }
  ctxoff.restore()
  ctxoff.clearRect(0,0,canvasoff.width, canvasoff.height)
  ctx.restore()
}

function offwatercolor (colors) {
  let canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let x = 0, y = 0
  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height)
  ctx.globalAlpha = 0.05
  let maxradius = 20 + document.getElementById("featuresize").value/11
  let d = 14 + Math.random() * maxradius
  d *= 5
  let count = 10
  ctx.fillStyle = document.getElementById("paintcolor").value
  for (let j = 0; j < count; j++) {
    ctx.beginPath();
    x = cx + pet(d)
    y = cy + pet(d)
    ctx.arc(x, y, 5+Math.random()*maxradius, 0, 2*Math.PI);
    ctx.fill();
  }
  let size = document.getElementById("featuresize").value
  document.getElementById("featuresize").value = 30
  //dirblur(canvas)
  document.getElementById("featuresize").value = size
  smearrandom(canvas)
}

function offbrush (colors) {
  let canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let x = 0, y = 0
  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height)
  ctx.globalAlpha = 0.01
  let maxradius = 1 + document.getElementById("featuresize").value/3
  let d = 41 + Math.random() * maxradius
  d *= 5
  let count = 9
  ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)]
  for (let j = 0; j < count; j++) {
    ctx.beginPath();
    x = cx + pet(d)*Math.cos(Math.random()*6.28)
    y = cy + pet(d)*Math.sin(Math.random()*6.28)
    ctx.arc(x, y, Math.random()*maxradius, 0, 2*Math.PI);
    ctx.fill();
  }
}

function offstars () {
  let canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let csize = ctx.canvas.height
  let x = 0, y = 0
  ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height)
  ctx.globalAlpha = 0.1
  let maxWidth = 0.15 + document.getElementById("featuresize").value/500
  ctx.strokeStyle = document.getElementById("paintcolor").value
  if (document.getElementById("grungy").checked)
    maxWidth *= 2
  ctx.globalAlpha = 0.1
  let s = 0
  let count = 7
  for (; s < count; s++) {
    x = Math.random() * canvas.width;
    y = Math.random() * canvas.height;
    let spokes = 7 + Math.random() * 9
    let spokelength = 20 + 51 * Math.random()
    for (let i = 0; i < spokes; i++) {
      ctx.lineWidth = maxWidth * Math.random()
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(x+Math.cos(Math.random()*6.28)*pet(spokelength), y+Math.sin(Math.random()*6.28)*pet(spokelength));
      ctx.stroke()
    }
  }
}

function offmix () {
  let canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let csize = ctx.canvas.height
  let x = 0, y = 0
  ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height)
  ctx.globalAlpha = 0.1
  let maxWidth = 0.15 + document.getElementById("featuresize").value/300
  ctx.strokeStyle = document.getElementById("paintcolor").value
  if (document.getElementById("grungy").checked)
    maxWidth *= 2
  ctx.globalAlpha = 0.1
  let s = 0
  let count = 7
  let maxradius = 1 + document.getElementById("featuresize").value/150
  for (; s < count; s++) {
    let spokes = 27 + Math.random() * 9
    let spokelength = 20 + 51 * Math.random()
    for (let i = 0; i < spokes; i++) {
      x = Math.random() * canvas.width;
      y = Math.random() * canvas.height;
      ctx.lineWidth = maxWidth * Math.random()
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(x+Math.cos(Math.random()*6.28)*pet(spokelength), y+Math.sin(Math.random()*6.28)*pet(spokelength));
      ctx.stroke()
    }
  }
}

function offhorizontal () {
  let  canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let csize = ctx.canvas.height
  let x = 0, y = 0
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.globalAlpha = 0.1
  let maxWidth = 0.15 + document.getElementById("featuresize").value/500
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  if (grunge)
    maxWidth *= 2
  ctx.lineWidth = 0.1
  let count = 21
  let ybump = 0
  for (let j = 0; j < count; j++) {
    ctx.lineWidth = maxWidth * Math.random()
    ctx.beginPath()
    y = Math.random() * csize
    ctx.moveTo(Math.random() * cx, y)
    ybump = pet(43)
    ctx.lineTo(cx + Math.random() * cx/3, y + ybump)
    ctx.stroke()
  }
}

function offhorizontal2 () {
  let  canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let csize = ctx.canvas.height
  let x = 0, y = 0
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.globalAlpha = 0.1
  let maxWidth = 0.35 + document.getElementById("featuresize").value/500
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let grunge = document.getElementById("grungy").checked
  if (grunge)
    maxWidth *= 2
  ctx.lineWidth = 0.1
  let count = 21
  let ybump = 0
  for (let j = 0; j < count; j++) {
    ctx.lineWidth = maxWidth * Math.random()
    ctx.beginPath()
    y = Math.random() * csize
    ctx.moveTo(Math.random() * cx, y)
    ybump = pet(13)
    ctx.lineTo(cx + Math.random() * cx/3, y + ybump)
    ctx.stroke()
  }
}

function offstreaks () {
  let canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let csize = ctx.canvas.height
  let x = 0, y = 0
  ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height)
  ctx.globalAlpha = 0.1
  let maxWidth = 0.15 + document.getElementById("featuresize").value /500
  if (document.getElementById("grungy").checked)
    maxWidth *= 2
  ctx.strokeStyle = document.getElementById("paintcolor").value
  //ctx.lineWidth = 0.1
  let count = 7
  for (let j = 0; j < count; j++) {
    ctx.lineWidth = maxWidth * Math.random()
    ctx.beginPath()
    ctx.moveTo(Math.random() * cx, Math.random() * csize)
    ctx.lineTo(cx + Math.random() * cx, Math.random() * csize)
    ctx.stroke()
  }
}

function offarcs2 () {
  let  canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let x = 0, y = 0
  let s = 0, e = 0
  ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height)
  ctx.globalAlpha = 0.25
  let maxWidth = 3 + document.getElementById("featuresize").value/500
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let maxradius = 57 + document.getElementById("featuresize").value /2
  if (document.getElementById("grungy").checked)
    maxradius *= 2
  let d = 40 + Math.random() * 39
  let count = 13
  for (let j = 0; j < count; j++) {
    ctx.beginPath();
    ctx.lineWidth = maxWidth * Math.random()
    x = cx + pet(d)*Math.cos(Math.random()*0.5)
    y = cy + pet(d)*Math.sin(Math.random()*0.5)
    e = Math.random()*6.28
    s = e+Math.random()*1.5
    ctx.arc(x, y, Math.random()*maxradius, e, s);
    ctx.stroke();
  }
}

function offarcs () {
  let  canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let x = 0, y = 0
  let s = 0, e = 0
  ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height)
  ctx.globalAlpha = 0.15
  let maxWidth = 0.15 + document.getElementById("featuresize").value /500
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = 0.1
  let maxradius = 17 + document.getElementById("featuresize").value /2
  if (document.getElementById("grungy").checked)
    maxradius *= 2
  let d = 40 + Math.random() * 39
  let count = 53
  for (let j = 0; j < count; j++) {
    ctx.beginPath();
    ctx.lineWidth = maxWidth * Math.random()
    x = cx + pet(d)*Math.cos(Math.random()*0.5)
    y = cy + pet(d)*Math.sin(Math.random()*0.5)
    e = Math.random()*6.28
    s = e+Math.random()*1.5
    ctx.arc(x, y, Math.random()*maxradius, e, s);
    ctx.stroke();
  }
}

function offspecks2 () {
  let canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let x = 0, y = 0
  ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height)
  ctx.globalAlpha = 0.075
  let maxradius = 1 + document.getElementById("featuresize").value /20
  
  let d = 1 + Math.random() * 41
  let count = 7
  for (let j = 0; j < 7; j++) {
    ctx.beginPath();
    x = cx + pet(d)*Math.cos(Math.random()*6.28)
    y = cy +pet(d)*Math.sin(Math.random()*6.28)
    ctx.arc(x, y, Math.random()*maxradius, 0, 2*Math.PI);
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
    ctx.fill();
  }
}

function offspecks () {
  let canvas = document.getElementById("offscreen");
  let ctx = canvas.getContext("2d");
  let cx = ctx.canvas.width/2;
  let cy = ctx.canvas.height/2;
  let x = 0, y = 0
  ctx.clearRect(0,0,ctx.canvas.width, ctx.canvas.height)
  ctx.globalAlpha = 0.0025
  let maxradius = 2 + document.getElementById("featuresize").value /10
  ctx.fillStyle = document.getElementById("paintcolor").value
  let d = 51 + Math.random() * 41
  let count = 5
  for (let j = 0; j < 17; j++) {
    ctx.beginPath();
    x = cx + pet(d)*Math.cos(Math.random()*6.28)
    y = cy +pet(d)*Math.sin(Math.random()*6.28)
    ctx.arc(x, y, Math.random()*maxradius, 0, 2*Math.PI);
    ctx.fill();
  }
}

function specksRadial () {
  let canvas = document.getElementById("myCanvas");
  let dist = "rect"//document.getElementById("distro").value
  let cx = canvas.width/2, cy = canvas.height/2
  let ctx = canvas.getContext("2d");
  let grunge = document.getElementById("grungy").checked
  let num = document.getElementById("number").value
  let area = canvas.width * canvas.height
  let shapemultiplier = area/(1024*1024)
  num *= shapemultiplier
  let featuresize = 0.2+ document.getElementById("featuresize").value/200
  let r0 = featuresize
  let opacity = document.getElementById("opacity").value/100
  let flatness = false//document.getElementById("flatten").value
  let canvas_w = canvas.width
  let canvas_h = canvas.height
  let x = 0, y = 0
  let f = flatness/100 * canvas.height/2
  ctx.globalAlpha = opacity
  let alpha0 = ctx.globalAlpha
 // let maxY = canvas.height/2
  ctx.fillStyle = document.getElementById("paintcolor").value
  if (dist != "gaussian")
    ;//clip()
  for (let j = 0; j < num; j++) {
    ctx.beginPath();
    if (dist == "gaussian") {
      x = randn_bm(0, canvas_w, 1)
      y = randn_bm(0, canvas_h, 1)
      if (flatness > 1) {
        x = randn_bm(f, canvas_size - f, 1)
      }
    } else {
      x = Math.random() * canvas_w
      y = Math.random() * canvas_h
    }
    ctx.arc(x, y, featuresize, 0, 2*Math.PI);
    ctx.closePath();
    if (grunge) {
      featuresize = r0 + Math.random() * r0 * 3
      ctx.globalAlpha = alpha0 + (Math.random() - 0.5) * alpha0
    }
    ctx.fill()
  }
  ctx.restore()
}

function caption () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext('2d');
  let cx = canvas.width/2, cy = canvas.height/2
  let face = document.getElementById("fontface").value
  let text = document.getElementById("caption").value
  let size = document.getElementById("featuresize").value
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.font = size+"pt " + face
  let x = canvas.width/2, y = canvas.height/2+size/2
  console.log(size)
  w = ctx.measureText(text).width
  ctx.fillText(text, x-w/2, y)
}

function character () {
  let grunge = document.getElementById("grungy").checked
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext('2d');
  ctx.globalAlpha = (document.getElementById("opacity").value)/100

  let styles = ["normal", "100", "500", "900", "bold", "italic", "lighter", "oblique"]
  let faces = ["monospaced", "sans-serif", "serif", "courier", "ariel", "times"]

  let x = -32, y = -32, x0 = x, y0 = y, off = 0;
  let numlines = 0;
  let x_inc = 16, y_inc = 16
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let alpha0 = ctx.globalAlpha
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.strokeStyle = document.getElementById("paintcolor").value
  let text = document.getElementById("atext").value
  let radius = document.getElementById("featuresize").value/6.25
  let rad0 = radius
  let rows = Math.pow(2, 9-document.getElementById("rows").value)
  let inc = rows
  let maxy = canvas.height/2
  numlines = 0;
  x_inc = inc, y_inc = inc
  clip()
  ctx.font = radius+"px sans-serif"
  ctx.font = randomPick(styles)+" "+radius+"pt " + randomPick(faces)
  for (var i = 0; i < 24000; i++) {
    if (grunge) {
      ctx.globalAlpha = alpha0 + (Math.random() - 0.5) * alpha0
      radius = rad0 + Math.random() * rad0/3
      ctx.font = radius+"px"
      text = String.fromCharCode(32 + Math.floor(Math.random() * 96)) // 32 - 127 = ascii
    }
    if (grunge && Math.random() < 0.1)
      ctx.strokeText(text, x, y)
    else
      ctx.fillText(text, x, y)
    x += x_inc;
    if (i % (160) === 0) {
      numlines++;
      if (numlines % 2 === 0)
        off = x_inc/2;
      else
        off = 0;
      x = off - (radius/2);
      y += inc;
    }
  }
  ctx.restore()
}

function halftone () {
  let grunge = document.getElementById("grungy").checked
  //clearCanvas()
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext('2d');
  let x = -32, y = -32, x0 = x, y0 = y, off = 0;
  let numlines = 0;
  let x_inc = 16, y_inc = 16
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let alpha0 = ctx.globalAlpha
  ctx.fillStyle = document.getElementById("paintcolor").value
  let radius = 0.2+document.getElementById("featuresize").value/62.5
  let rad0 = radius
  let rows = Math.pow(2, 9-document.getElementById("rows").value)
  let inc = rows
  let maxy = canvas.height/2
  numlines = 0;
  x_inc = inc, y_inc = inc
  clip()
  for (var i = 0; i < 24000; i++) {
    if (grunge) {
      ctx.globalAlpha = alpha0 + (Math.random() - 0.5) * alpha0
      radius = rad0 + Math.random() * rad0/3
    }
    ctx.beginPath();
    ctx.arc(x, y, radius, 0, 2*Math.PI);
    ctx.closePath();
    ctx.fill();
    x += x_inc;
    if (i % (160) === 0) {
      numlines++;
      if (numlines % 2 === 0)
        off = x_inc/2;
      else
        off = 0;
      x = off;
      y += inc;
    }
  }
  ctx.restore()
}

function straightLines (cross) { // vertical lines
  let grunge = document.getElementById("grungy").checked
 // clearCanvas()
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext('2d');
  let x = -50, y = -50;
  let x_inc = 20, y_inc = 20
  ctx.globalAlpha = (document.getElementById("opacity").value) /100
  alpha0 = ctx.globalAlpha
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = document.getElementById("featuresize").value/(5*6.25)
  linewidth0 = ctx.lineWidth
  let radius = document.getElementById("featuresize").value/12.5
  let rows = document.getElementById("rows").value*8
  let inc = 512/rows
  numlines = 0;
  x = -20, y = 0 + ctx.lineWidth/2 // should try different initial offset
  x_inc = inc, y_inc = inc
  let maxy = canvas.height/2
  clip()
  let i = 0
  for (; i < 1000; i++) {
    if (grunge) {
      ctx.globalAlpha = alpha0 + (Math.random() - 0.5) * alpha0/1.3
      ctx.lineWidth = linewidth0 + Math.random() * linewidth0/4
    }
    ctx.beginPath();
    ctx.moveTo(-20, y)
    ctx.lineTo(canvas.width+20, y)
    ctx.stroke();
    y += y_inc
  }
  if (cross) {
    i = 0, x = -20, y = -20
    for (; i < 1000; i++) {
      if (grunge) {
        ctx.globalAlpha = alpha0 + (Math.random() - 0.5) * alpha0/1.3
        ctx.lineWidth = linewidth0 + Math.random() * linewidth0/4
      }
      ctx.beginPath();
      ctx.moveTo(x, y)
      ctx.lineTo(x, canvas.height+20)
      ctx.stroke();
      x += x_inc
      y = -20
    }
  }
  ctx.restore()
}

function slantedLines (cross) {
  let grunge = document.getElementById("grungy").checked
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext('2d');
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  alpha0 = ctx.globalAlpha
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = 1+document.getElementById("featuresize").value/10
  linewidth0 = ctx.lineWidth
  let inc = ctx.lineWidth * 3
  let x = inc, y = inc
  let x_inc = inc, y_inc = inc
  for (var i = 0; i < 1000; i++) {
    ctx.beginPath();
    ctx.moveTo(-20, y)
    ctx.lineTo(x, -20)
    ctx.stroke();
    x += x_inc
    y += y_inc
  }
  if (cross) {
    i = 0, x = -50, y = canvas.height + 50
    for (var i = 0; i < 1000; i++) {
      ctx.beginPath();
      ctx.moveTo(-20, y)
      ctx.lineTo(x, canvas.height+20)
      ctx.stroke();
      x += x_inc
      y -= y_inc
    }
  }
}

function linearSpiral () { // make like skinny Rings
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width, H = canvas.height
  var numpoints = Math.random() * 200 + 250;
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  let ab = ctx.lineWidth/20
  let inc = 3 * ctx.lineWidth
  ctx.lineCap = 'round'
  ctx.lineJoin = 'round'
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.beginPath();
  let x = LASTCLICK[0], y = LASTCLICK[1], a = ab, b = ab
  ctx.moveTo(x, y);
  let angle = Math.random() * Math.PI * 2;
  let increase = 0.1
  while (x < W*2 && y < H*2) {
    ctx.lineTo(x, y);
    x = x + (a + b * angle) * Math.cos(angle);
    y = y + (a + b * angle) * Math.sin(angle);
    angle += increase;
  }
  ctx.stroke();
}

function skinnyRings () {
  let grunge = document.getElementById("grungy").checked
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext('2d');
  let x = -50, y = -50;
  let x_inc = 20, y_inc = 20
  ctx.globalAlpha = (document.getElementById("opacity").value) /100
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  let inc = 3 * ctx.lineWidth
  ctx.lineCap = 'round'
  ctx.lineJoin = 'round'
  linewidth0 = ctx.lineWidth
  let radius = 1
  numlines = 0;
  x = LASTCLICK[0], y = LASTCLICK[1]
  let i = canvas.height/2
  let maxD = Math.max(canvas.width, canvas.height)*2
  let start = 0, end = Math.PI*2
  while (radius < maxD) {
    ctx.beginPath();
    ctx.arc(x,y,radius,start,end)
    ctx.stroke();
    radius += inc
  }
}

function skinnyLines () { // vertical lines
  let grunge = document.getElementById("grungy").checked
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext('2d');
  let x = -50, y = -50;
  let x_inc = 20, y_inc = 20
  ctx.globalAlpha = (document.getElementById("opacity").value) /100
  alpha0 = ctx.globalAlpha
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = 5//1
  ctx.lineCap = 'round'
  ctx.lineJoin = 'round'
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  let inc = ctx.lineWidth*3//512/rows
  numlines = 0;
  x = -20, y = 0 + ctx.lineWidth/2 // should try different initial offset
 // x_inc = inc, y_inc = inc
  let maxy = canvas.height * 2
  let i = canvas.height/2
  for (; i < maxy; i++) {
    if (grunge) {
      //ctx.globalAlpha = alpha0 + (Math.random() - 0.5) * alpha0/1.3
      //ctx.lineWidth = linewidth0 + Math.random() * linewidth0/4
    }
    ctx.beginPath();
    ctx.moveTo(-20, y)
    ctx.lineTo(canvas.width+20, y)
    ctx.stroke();
    y += inc
  }
}

function bezRandom () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let H = canvas.height
  ctx.lineCap = 'round'
  ctx.lineJoin = 'round'
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  let x = 0, y = 0, x0, y0;
  let edges = 8 + 4 * Math.floor(document.getElementById("number").value/1000)
  //console.log(edges)
  if (Math.random() > 0.5)
   ;// edges += 8
  let points = [];
  for (let i = 0; i < edges; i++) {
    x = Math.floor(Math.random() * W)
    y = Math.floor(Math.random() * H)
    points.push([x, y]);
    if (i === 0) {
      x0 = x, y0 = y
    }
  }
  drawBezline(points, 0, 0)
}

function fillPoints (pts, offsetX, offsetY, color) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let x = 0, y = 0, x0 = 0, y0 = 0,  r = 6
  ctx.fillStyle = 'blue'
  ctx.beginPath()
  let i = 0;
  for (; i < pts.length; i++) {
    x = pts[i][0]
    y = pts[i][1]
    if (i == 0) {
      ctx.moveTo(x, y);
    } else
    if (i > 0 && i % 3 == 0)
      ctx.bezierCurveTo(pts[i-2][0], pts[i-2][1], pts[i-1][0], pts[i-1][1], pts[i][0], pts[i][1]);
    
    ctx.fillStyle = 'red'
    if (i % 3 == 0)
      ctx.fillStyle = 'black'
   // ctx.beginPath()
   // ctx.arc(x,y,r,0,Math.PI*2)
   // ctx.closePath();
   // ctx.fill();
  }
  ctx.closePath();
  ctx.fillStyle = color
  ctx.fill();
}


function blobOutline () {
  let grunge = document.getElementById("grungy").checked
  let increase = Math.PI * 2 / 40;
  let x = 350, y = 270, angle = 4.7;
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let W = canvas.width
  let centx = canvas.width/2
  let centy = canvas.height/2
  let area = canvas.width * canvas.height
  let cx = centx, cy = centy
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let alpha0 = ctx.globalAlpha
  ctx.strokeStyle = document.getElementById("paintcolor").value
  ctx.lineWidth = 1 + document.getElementById("featuresize").value/4
  x = 0;
  y = 0;
  let x0 = x;
  let y0 = y;
  angle = Math.floor(Math.random() * 6.42)
  centx = ctx.canvas.width/2
  centy = ctx.canvas.height/2
  let edges = 8 + Math.floor(Math.random() * 18)
  let rmax = W/2.67
  let maxradius = 1 + rmax * Math.random();
  let r0 = maxradius
  increase = Math.PI * 2/edges*0.98;
  points = [];
  bez = [];
  let radius = W/2.5
  for (let i = 0; i < edges; i++) {
    //radius = (Math.random() * maxradius) + maxradius * 0.9;
    radius += pet(maxradius/1.4)
    x = radius * Math.cos(angle)+centx;
    y = radius * Math.sin(angle)+centy;
    points.push([x, y]);
    angle += increase;
  }
  //points.push(x0,y0)
  drawOutline(points, 0, 0)
}

function blobs () {
  let grunge = document.getElementById("grungy").checked
  let increase = Math.PI * 2 / 40;
  let x = 350, y = 270, angle = 4.7;
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let centx = canvas.width/2;
  let centy = canvas.height/2;
  let area = canvas.width * canvas.height
  let shapemultiplier = area/(1024*1024)
  let cx = centx, cy = centy
  ctx.globalAlpha = (document.getElementById("opacity").value)/200
  let alpha0 = ctx.globalAlpha
  let numshapes = 25
  ctx.fillStyle = document.getElementById("paintcolor").value
  numshapes = 1 + document.getElementById("number").value/10
  numshapes *= shapemultiplier
  let radius = 1
  for (let t = 0; t < numshapes; t++) {
    x = 0;
    y = 0;
    let x0 = x;
    let y0 = y;
    angle = Math.floor(Math.random() * 6.42);
    centx = Math.random()*ctx.canvas.width+5;
    centy = Math.random()*ctx.canvas.height+5
    let edges = 19 * Math.random() + 9;
    let rmax = document.getElementById("featuresize").value/20 // max = 500
    let maxradius = 1 + rmax * Math.random();
    let r0 = maxradius
    increase = Math.PI * 2/edges*0.98;
    points = [];
    bez = [];
    radius = (Math.random() * maxradius) + maxradius * 0.9;
    for (let i = 0; i < edges; i++) {
      if (grunge) {
        maxradius = r0 + (Math.random()) * r0 * 2
      }
      //radius = (Math.random() * maxradius) + maxradius * 0.9;
      radius += pet(maxradius/1)
      x = radius * Math.cos(angle)+centx;
      y = radius * Math.sin(angle)+centy;
      points.push([x, y]);
      angle += increase;
    }
    let W = canvas.width
    drawPath(points, 0, 0)
    drawPath(points, -W, -W)
    drawPath(points, 0, -W)
    drawPath(points, W, -W)

    drawPath(points, -W, +W)
    drawPath(points, 0, +W)
    drawPath(points, W, +W)

    drawPath(points, -W, 0)
    drawPath(points, +W, 0)
  }
}

function tatter () {
  let grunge = document.getElementById("grungy").checked
  let increase = Math.PI * 2 / 40;
  let x = 0, y = 0, angle = 0
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let centx = ctx.canvas.width/2;
  let centy = ctx.canvas.height/2;
  let cx = centx, cy = centy
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let numshapes = 1 + document.getElementById("number").value/5
  ctx.fillStyle = document.getElementById("paintcolor").value
  let radius = 1
  for (let t = 0; t < numshapes; t++) {
    x = 0;
    y = 0;
    let y0 = y;
    angle = Math.floor(Math.random() * 6.42);
    centx = Math.random()*ctx.canvas.width+5;
    y0 = canvas.height*3/4 + Math.random() * canvas.height*1/4
    if (grunge)
      y0 = canvas.height/2 + Math.random() * canvas.height/4
    centy = y0 + Math.random()*y0 + 60
    if (100/(canvas.height-centy)/(canvas.height/2) * Math.random() > 0.0004) {
      let edges = 11 * Math.random() + 9;
      let rmax = document.getElementById("featuresize").value/20 // max = 500
      let maxradius = Math.abs(1 + 500/(1+(canvas.height+10-centy)))
      increase = Math.PI * 2/edges*0.98;
      let points = [];
      let i = 0
      for (; i < edges; i++) {
        radius = (Math.random() * maxradius/1.5) + maxradius;
        x = radius * Math.cos(angle)+centx;
        y = radius * Math.sin(angle)+centy;
        points.push([x, y]);
        angle += increase;
      }
      drawPath(points, 0, 0, ctx)
    }
  }
}

function scratch () { // based on blobs
  let grunge = document.getElementById("grungy").checked
  let increase = Math.PI * 2 / 40;
  let x = 0, y = 0, angle = 4.7;
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let centx = LASTCLICK[0] //20 + Math.random() * canvas.width - 40
  let centy = ctx.canvas.height/2;
  let cx = centx, cy = centy
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let alpha0 = ctx.globalAlpha
  let numshapes = 1 + document.getElementById("number").value/20
  let area = canvas.width * canvas.height
  let shapemultiplier = area/(1024*1024)
  numshapes *= shapemultiplier
  ctx.fillStyle = document.getElementById("paintcolor").value
  let radius = 1
  for (let t = 0; t < numshapes; t++) {
    x = 0;
    y = 0;
    angle = Math.floor(Math.random() * 6.42);
    centy = Math.random()*ctx.canvas.height+5
    let edges = 19 * Math.random() + 9;
    let rmax = document.getElementById("featuresize").value/20 // max = 500
    let maxradius = 1 + rmax * Math.random();
    let r0 = maxradius
    increase = Math.PI * 2/edges*0.98;
    points = [];
    radius = (Math.random() * maxradius) + maxradius * 0.9;
    for (let i = 0; i < edges; i++) {
      if (grunge) {
        maxradius = r0 + (Math.random()) * r0 * 2
      }
      radius += pet(maxradius)
      x = radius * Math.cos(angle)+centx;
      y = radius * Math.sin(angle)+centy;
      points.push([x, y]);
      angle += increase;
    }
    //let W = canvas.width
    drawPath(points, 0, 0)
  }
}

function drawBlobAt (ctx, x, y, r) {
  let x0 = x;
  let y0 = y;
  angle = Math.floor(Math.random() * 6.42);
 // centx = Math.random()*ctx.canvas.width+5;
  //centy = Math.random()*ctx.canvas.height+5
  let edges = 39 * Math.random() + 9;
  let rmax = document.getElementById("featuresize").value/50 // max = 500
  let maxradius = 1 + rmax * Math.random();

  let r0 = r
  increase = Math.PI * 2/edges*0.98;
  points = [];
  points.push([x,y])
  radius = (Math.random() * maxradius) + maxradius * 0.9;
  for (let i = 0; i < edges; i++) {
    radius += pet(maxradius)
    x = radius * Math.cos(angle)+x;
    y = radius * Math.sin(angle);
    points.push([x, y]);
    angle += increase;
  }
  drawPath(points, 0, 0, ctx)
}

function drawCircleAt(ctx,x,y,r) {
  ctx.beginPath()
  ctx.moveTo(x, y)
  ctx.arc(x,y,r,0,Math.PI*2)
  ctx.closePath()
  ctx.fill()
}

function drawHouseAt(ctx,x,y,r) {
  ctx.beginPath()
  x += pet(Math.random() * r)
  y -= r
  r *= 2
  ctx.moveTo(x, y)  //top
  x += r/2 + pet(20)
  y += r/2
  ctx.lineTo(x, y) //right tip
  x -= (18)+pet(11)
  ctx.lineTo(x, y+pet(14)) // x in
  y += r/2
  ctx.lineTo(x+pet(11), y+pet(34))// right bottom
  y += r/7
  x -= r/2 + pet (r/2)
  ctx.lineTo(x+pet(4), y+pet(11))// bottom minpoint
  y -= r/7
  x -= r/3
  ctx.lineTo(x+pet(14), y+pet(34)) //left bottom
  y -= r/2
  ctx.lineTo(x+pet(14), y+pet(11)) // x in left
  x -= 17
  ctx.lineTo(x+pet(11), y+pet(14)) // left tip
  
  ctx.closePath()
  ctx.fill()
}

function drawRectAt(ctx,x,y,r,LINE) {
  ctx.beginPath()
  if (!LINE) {
    x -= r
    y -= r
    r *= 2
  }
  ctx.moveTo(x, y)
  ctx.lineTo(x+r, y)
  ctx.lineTo(x+r, y+r)
  ctx.lineTo(x, y+r)
  if (LINE) {
    ctx.lineTo(x, y)
    ctx.stroke()
  } else {
    ctx.closePath()
    ctx.fill()
  }
}

function drawXAt(ctx,x,y,r) {
  ctx.beginPath()
  x -= r
  y -= r
  let h = r*2
  ctx.moveTo(x+h/4, y)
  ctx.lineTo(x+h/2, y+h/4)
  ctx.lineTo(x+h*3/4, y)
  ctx.lineTo(x+h, y+h/4)
  
  ctx.lineTo(x+h*3/4, y+h/2)
  ctx.lineTo(x+h, y+h*3/4)

  ctx.lineTo(x+h*3/4, y+h)
  ctx.lineTo(x+h/2, y+h*3/4)
  ctx.lineTo(x+h/4, y+h)
  
  ctx.lineTo(x, y+h*3/4)
  ctx.lineTo(x+h/4, y+h/2)
  ctx.lineTo(x, y+h/4)

  ctx.closePath()
  ctx.fill()
}

function drawDiamondAt(ctx,x,y,r) {
  ctx.beginPath()
  x -= r
  y -= r
  let h = r*2
  ctx.moveTo(x+h/2, y)
  ctx.lineTo(x+h, y+h/2)
  
  ctx.lineTo(x+h/2, y+h)

  ctx.lineTo(x, y+h/2)

  ctx.closePath()
  ctx.fill()
}


function drawTriangleAt(ctx,x,y,r) {
  ctx.beginPath()
  x -= r
  y -= r
  ctx.moveTo(x+r, y)
  r*=2
  ctx.lineTo(x+r, y+r)
  ctx.lineTo(x, y+r)
  ctx.closePath()
  ctx.fill()
}

function card () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let h = canvas.height;
  let w = canvas.width;
  let centerx = ctx.canvas.width / 2;
  let centery = ctx.canvas.height / 2;
  let x = centerx/2
  let y = centery/2
  let r = h/5
  let colors = []
  let i = 0
  for (; i < 2; i++)
    colors.push(randomColor())
  ctx.fillStyle = randomGradient(canvas);
  //ctx.save()
  clip()
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let grunge = document.getElementById("grungy").checked
  if (grunge) {
    colors = ["red", "blue", "yellow", "green"]
  }

  ctx.fillStyle = randomPick(colors)
  let f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
  
  y = h * 0.75
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
    
  x = h * 0.75
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
  
  y = h * 0.25
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
  //pushColor(randomPick(colors))
  ctx.restore()
}

function card2 () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let h = canvas.height;
  let w = canvas.width;
  let centerx = ctx.canvas.width / 2;
  let centery = ctx.canvas.height / 2;
  let x = centerx/3
  let y = centery/3
  let r = h/6 - 12
  let colors = []
  let i = 0
  for (; i < 3; i++)
    colors.push(randomColor())
  ctx.fillStyle = "#ffffff"
  ctx.fillRect(0,0,canvas.width, canvas.height)

  ctx.fillStyle = randomGradient(canvas);
  ctx.fillRect(0,0,canvas.width, canvas.height)
  //ctx.save()
  clip()
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let grunge = document.getElementById("grungy").checked
  if (grunge) {
    colors = ["red", "blue", "yellow", "green", "orange"]
  }

  ctx.fillStyle = randomPick(colors)
  let f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
  
  x += h * 1/3
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
  
   x += h * 1/3
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
    
    
  x = centerx/3, y =  centery/3 + h * 1/3
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
  
  x += h * 1/3
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
    
  x += h * 1/3
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
    
  // botton row
   
  x = centerx/3, y =  centery/3 + h * 2/3
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
  
  x += h * 1/3
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
    
  x += h * 1/3
  ctx.fillStyle = randomPick(colors)
  f = (Math.floor(Math.random() * 4))
  if (f == 0)
    drawCircleAt(ctx,x,y,r)
  else
  if (f == 1)
    drawTriangleAt(ctx,x,y,r)
  else
  if (f == 2)
    drawRectAt(ctx,x,y,r)
  else
    drawXAt(ctx,x,y,r)
  //pushColor(randomPick(colors))
  ctx.restore()
}


function randomWord () {
  return randomPick(words.split("\n"))
}

function diagonal () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let h = canvas.height;
  let w = canvas.width;
  let centerx = ctx.canvas.width / 2;
  let centery = ctx.canvas.height / 2;
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  let baseline = h * 4/5
  let x =-10
  let y = Math.random() * h/3
  ctx.beginPath()
  ctx.moveTo(x, y)
  let slope = 2 * Math.random()
  let i = 0
  while (y < baseline && x < w) {
    y += slope + pet (13)//+ (Math.random() - 0.5) * 0.5
    x += 5 * Math.random()
    ctx.lineTo(x, y)
    if (Math.random() > 0.8) {
      y += 6 * Math.random()
      x += 7 * Math.random()
    }
    if (Math.random() > 0.9) {
      y -= 5 * Math.random()
      x += 4 * Math.random()
    }
  }
  y = baseline
  while (x > 0) {
    y += 0.25+pet(6)
    x -= 2 * Math.random()
    ctx.lineTo(x,y)
  }
  ctx.closePath()
  ctx.fill()
  flipH()
}

function drawShape (line) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.clearRect(0,0,canvas.width,canvas.height)
  ctx.globalAlpha = document.getElementById("opacity").value/100
  ctx.globalCompositeOperation = document.getElementById("mode").value
  let alt = document.getElementById("grungy").checked
  ctx.lineWidth = 1 + Math.floor(document.getElementById("featuresize").value/10)
  ctx.lineCap = "round"
  ctx.lineJoin = "round"
  let pm = document.getElementById("number").value/4000
  ctx.fillStyle=randomPick(getCurrentPalette())
  let s = canvas.width/800, p = 23 * pm
  let x = 0, y = 0
  let points = document.getElementById('points').value
  let k = 0
  if (points.length > 1) {
    let pointsP = JSON.parse(points)
    for (; k < pointsP.length; k++) {
      let pk = pointsP[k]
      i = 0
      let j = 0
      for (; i < pk.length; i++) {
        j = 0
        for (; j < 2; j++) {
          pk[i][j] = pk[i][j] * s + pet(p)
        }
      }
      ctx.strokeStyle = randomPick(getCurrentPalette())
      ctx.fillStyle = randomPick(getCurrentPalette())
      if (line)
        drawLines(pk, 0, 0, !alt)
      else
        drawBezline(pk, 0, 0, !alt)
    }
  }
  LATESTFUNCTION = "drawShape"
}

function rotatePoint(x, y, centerx, centery, degrees) {
  let newx = (x - centerx) * Math.cos(degrees * Math.PI / 180) - (y - centery) * Math.sin(degrees * Math.PI / 180) + centerx;
  let newy = (x - centerx) * Math.sin(degrees * Math.PI / 180) + (y - centery) * Math.cos(degrees * Math.PI / 180) + centery;
  return [newx, newy];
}

function updatetxtsize () {
  let v = document.getElementById("textsize").value
  document.getElementById("txtsize").innerHTML = v
}

function placeSquareAt () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let h = canvas.height;
  let w = canvas.width;
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  let x = LASTCLICK[0]
  let y = LASTCLICK[1]
  let r = 1 + +document.getElementById("textsize").value
  r += pet(r/3)
  x -= r/2, y += r/2 // offset to place center aligned
  let angle = +document.getElementById("angle").value
  if (document.getElementById("randomangle").checked)
    angle += pet(45)
  let p = rotatePoint(x,y,LASTCLICK[0], LASTCLICK[1], angle)
  ctx.moveTo(p[0], p[1])
  ctx.beginPath()
  p = rotatePoint(x+r,y,LASTCLICK[0], LASTCLICK[1], angle)
  ctx.lineTo(p[0], p[1])
  p = rotatePoint(x+r,y-r,LASTCLICK[0], LASTCLICK[1], angle)
  ctx.lineTo(p[0], p[1])
  p = rotatePoint(x,y-r,LASTCLICK[0], LASTCLICK[1], angle)
  ctx.lineTo(p[0], p[1])
  p = rotatePoint(x,y,LASTCLICK[0], LASTCLICK[1], angle)
  ctx.lineTo(p[0], p[1])
  ctx.closePath()
  ctx.fill()
}

function flareAt (x, y, r, c, a, ctx, offsets) {
  ctx.globalAlpha = a
  ctx.fillStyle = c
  ctx.strokeStyle = c
  let color = c
  let grd = ctx.createRadialGradient(x, y, 0.1, x, y, r*2);
  grd.addColorStop(0,c);
  a = 0.1
  grd.addColorStop(0.5, "rgba("+hexToR(color)+", "+hexToG(color)+", "+hexToB(color)+", "+a+")");
  a = 0
  grd.addColorStop(0.75, "rgba("+hexToR(color)+", "+hexToG(color)+", "+hexToB(color)+", "+a+")");
  ctx.fillStyle = grd
  ctx.beginPath()
  ctx.arc(x, y, r, 0, Math.PI*2);
  ctx.closePath()
  ctx.fill()
  
  let i = 0
  if (document.getElementById("grungy").checked)
  for (; i < offsets.length; i += 2) {
    ctx.lineWidth = 1 + r/44
    ctx.strokeStyle = grd
    ctx.beginPath()
    ctx.moveTo(x+offsets[i]*r, y+offsets[i+1]*r)
    ctx.lineTo(x-offsets[i]*r, y-offsets[i+1]*r)
    ctx.closePath()
    ctx.stroke()
  }
}

function bokehAt (x, y, r, c, a, ctx) {
  ctx.globalAlpha = a
  ctx.fillStyle = c
  ctx.strokeStyle = c
  let color = c
  
  let grd = ctx.createRadialGradient(x+pet(r*1.2), y+pet(r*1.2), 0, x+pet(r*1.2), y+pet(r*1.1), r*1.5);
  grd.addColorStop(0, "rgba("+hexToR(color)+", "+hexToG(color)+", "+hexToB(color)+", "+a+")");
  grd.addColorStop(1,c);
  
  ctx.fillStyle = grd
  ctx.beginPath()
  ctx.arc(x, y, r, 0, Math.PI*2);
  ctx.closePath()
  ctx.fill()
  
  let i = 0
  ctx.globalAlpha /= 10
  for (; i < 5; i++) {
    ctx.beginPath()
    ctx.arc(x+pet(r/2), y+pet(r/2), r, 0, Math.PI*2);
    ctx.closePath()
    ctx.fill()
  }
  ctx.globalAlpha *= 5
  ctx.lineCap = "round"
  i = 0, start = 0
  for (; i < 9; i++) {
    ctx.beginPath()
    start = Math.random() * 2 * Math.PI
    ctx.arc(x, y, r * 0.97, start, start + Math.PI * Math.random()/6);
    ctx.lineWidth = r/50 + Math.random() * 1
    ctx.stroke()
  }
}

function placeBokehAt () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.strokeStyle = document.getElementById("paintcolor").value
  
  let x = LASTCLICK[0]
  let y = LASTCLICK[1]
  let r = 1 + +document.getElementById("textsize").value
  r /= 2
  r += pet(r/3)
  
  let color = document.getElementById("paintcolor").value
  let a = 0.4 + Math.random() * 0.3
  let grd = ctx.createRadialGradient(x+pet(r*1.2), y+pet(r*1.2), 0, x+pet(r*1.2), y+pet(r*1.1), r*1.5);
  grd.addColorStop(0, "rgba("+hexToR(color)+", "+hexToG(color)+", "+hexToB(color)+", "+a+")");
  grd.addColorStop(1, document.getElementById("paintcolor").value);
  
  ctx.fillStyle = grd
  ctx.beginPath()
  ctx.arc(x, y, r, 0, Math.PI*2);
  ctx.closePath()
  ctx.fill()
  
  let i = 0
  ctx.globalAlpha /= 10
  for (; i < 5; i++) {
    ctx.beginPath()
    ctx.arc(x+pet(r/2), y+pet(r/2), r, 0, Math.PI*2);
    ctx.closePath()
    ctx.fill()
  }
  ctx.globalAlpha *= 4
  //ctx.globalAlpha *= 0.4
  ctx.lineCap = "round"
  i = 0, start = 0
  for (; i < 9; i++) {
    ctx.beginPath()
    start = Math.random() * 2 * Math.PI
    ctx.arc(x, y, r * 0.97, start, start + Math.PI * Math.random()/6);
    ctx.lineWidth = r/50 + Math.random() * 1
    ctx.stroke()
  }
}

function placeDotAt () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let h = canvas.height;
  let w = canvas.width;
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  let x = LASTCLICK[0]
  let y = LASTCLICK[1]
  let r = 1 + +document.getElementById("textsize").value
  r /= 2
  r += pet(r/3)
  ctx.beginPath()
  ctx.arc(x, y, r, 0, Math.PI*2);
  ctx.closePath()
  ctx.fill()
  if (document.getElementById("grungy").checked) {
    ctx.globalAlpha = 0.15
    r *= 1.1
    ctx.beginPath()
    ctx.arc(x+pet(2), y, r, 0, Math.PI*2);
    ctx.closePath()
    ctx.fill()
    r*= 1.1
    ctx.beginPath()
    ctx.arc(x, y+pet(2), r, 0, Math.PI*2);
    ctx.closePath()
    ctx.fill()
  }
}

function clearCaption () {
  document.getElementById("caption").value = ""
}
function clearFace () {
  document.getElementById("face").value = ""
}


function placeTextAt () {
  let lines = document.getElementById("caption").value.split(/[\r\n]+/)
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let h = canvas.height;
  let w1 = canvas.width;
  let W = w1
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  ctx.fillStyle = document.getElementById("paintcolor").value
  let styles = document.getElementById("style").value
  let faces = document.getElementById("face").value
  let size0 = +document.getElementById("textsize").value
  let angle = +document.getElementById("angle").value
  ctx.textAlign = 'left';
  ctx.textBaseline = 'middle'
  angle = angle%360
  angle *= Math.PI/180
  let randomangle = document.getElementById("randomangle").checked
  if (randomangle)
    angle += pet(3.14/4)
  if (!faces || faces.length < 1)
    return
  let x = LASTCLICK[0]
  let y = LASTCLICK[1]
  if (!faces || faces.length < 1)
    return
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.strokeStyle = document.getElementById("paintcolor").value
  size = 24
  ctx.font = (styles)+" "+size+"pt " + (faces)
  let i = 0, w = 10
  let H = 0, CW = 0, CH = 0
  let sizes = [], widths = []
  let maxH = 24
  for (;i < lines.length; i++) {
    w = ctx.measureText(lines[i]).width
    CH += 12 + 28 * (W/w)
    CW =  w * (W/w)
    maxH = (12 + 28 * (W/w) > maxH)? 12 + 28 * (W/w): maxH;
    sizes[i] = size0//24*W/w
    if (w <= 0)
      sizes[i]=10
  }
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let center = lines.length * size0 / 2
  i = 0
  for (; i < lines.length; i++) {
    x = LASTCLICK[0]
    y = i*sizes[i] * 1.2 + LASTCLICK[1]
    ctx.save()
    ctx.translate(x, y)
    ctx.rotate(angle) // need to adjust x & y offsets per line
    ctx.font = (styles)+" "+sizes[i]+"pt " + (faces)
    ctx.fillText(lines[i], 0, 0)
    ctx.restore()
  }
}

/*
function stem (x,y,r, m) {
  this.x = x
  this.y = y
  this.r = r
  this.bias = (Math.random() - 0.5) * 0.3
  this.xdelta = (5+Math.random()*5) * (Math.random() - 0.5)
  this.max = m //+ Math.random() * 100
  this.count = 0
}

function branching () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  ctx.fillStyle = document.getElementById("paintcolor").value
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let h = canvas.height;
  let w = canvas.width;
  let branches = []
  let m = 2150, yf = 1
  let x = w/2 + pet(w/2), y = h, r = w/130 + pet(w/120)
  let s = new stem (x,y,r, m)
  branches.push(s)
  let i = 0
  let n = 0
  for (; n < 1700; n++) {
    i = 0
    for (; i < branches.length; i++) {
      if (branches[i].count < branches[i].max) {
        drawCircleAt(ctx, branches[i].x+pet(branches[i].r/4), branches[i].y, branches[i].r +pet(branches[i].r/7))
        branches[i].x += 1.2*(branches[i].xdelta*branches[i].r) * branches[i].bias
        branches[i].y -= branches[i].r/2 + pet(3) * yf
        
        branches[i].r *= 0.991
        branches[i].count++
        branches[i].xdelta *= 1.002
        if (Math.random() > 0.997)
          branches[i].bias *= 0.9
        m *= 0.995
        if (Math.random() > 0.95 && branches.length < 90) {
          branches.push(new stem(branches[i].x, branches[i].y, branches[i].r, m))
        }
      }
    }
  }
}
*/
function land () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let h = canvas.height;
  let w = canvas.width;
  let centerx = ctx.canvas.width / 2;
  let centery = ctx.canvas.height / 2;
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  //document.getElementById("paintcolor").value = randomColor()
  ctx.fillStyle = document.getElementById("paintcolor").value
  let baseline = h - h/7 * Math.random() - 10
  let x =-10
  let y = baseline - h/3 * Math.random() - 30
  ctx.beginPath()
  ctx.moveTo(x, y)
  let slope = 0.01 * Math.random()
  let i = 0
  while (y < baseline && x < w) {
    y += slope + pet (3)//+ (Math.random() - 0.5) * 0.5
    x += 5 * Math.random()
    ctx.lineTo(x, y)
    if (Math.random() > 0.8) {
      y += 6 * Math.random()
      x += 7 * Math.random()
    }
    if (Math.random() > 0.9) {
      y -= 5 * Math.random()
      x += 4 * Math.random()
    }
  }
  y = baseline
  while (x > 0) {
    y += pet(6)
    x -= 5 * Math.random()
    ctx.lineTo(x,y)
  }
  ctx.closePath()
  ctx.fill()
  flipH()
}

function shape2 () {// right side only
  var radvar = 0;
  var increase = Math.PI * 2 / 40;
  var x = 0, y = 0, angle = 4.7;
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  var h = canvas.height;
  var w = canvas.width;
  var centerx = ctx.canvas.width / 2;
  var centery = ctx.canvas.height / 2;
  ctx.fillStyle = randomGradient(canvas);
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let grunge = document.getElementById("grungy").checked
  let numshapes = 1
  let ia = 0
  ctx.save()
  ctx.fillStyle = document.getElementById("paintcolor").value;
  if (grunge)
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  for (var t = 0; t < numshapes; t++) {
    let radius = 10
    x = 0;
    y = 0;
    var x0 = x;
    var y0 = y;
    let turn = 0
    angle = Math.PI/2
    let angle2 = angle
    ctx.beginPath();
    var centx = canvas.width + 20 + canvas.width/3
    var centy = canvas.height/2 + pet(canvas.height);
    var edges = Math.random()*31+Math.random()*31;
    var maxradius = canvas.height/1.7 + Math.random() * canvas.height/5;
    increase = Math.PI * 2/edges;
    ctx.beginPath();
    let rfactor = 2
    let mfactor = maxradius
    for (var i = 0; i < edges-1; i++) {
      angle2 = angle + Math.PI / edges
      rfactor =  maxradius/40 + Math.random() *11
      if (Math.random()> 0.63)
        mfactor += (Math.random() - 0.5) * maxradius/9
      radius = Math.random() * rfactor + mfactor;
      radius += pet(radius/7)
      centx = centx+pet(23)
      centy = centy+pet(23)
      ctx.arc(centx, centy, radius, angle, angle2)
      angle = angle2
      ia = increase + Math.PI/180 * pet(2);
      angle += ia
      turn += ia
      if(turn >= 6.28)
        break;
    }
    ctx.closePath();
    ctx.fill();
    ctx.clip()
    randomColor()
    document.getElementById("opacity").value = 77
    strokes2()
  }
  ctx.restore()
}

function shape () {// right side only
  var radvar = 0;
  var increase = Math.PI * 2 / 40;
  var x = 0, y = 0, angle = 4.7;
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  var h = canvas.height;
  var w = canvas.width;
  var centerx = ctx.canvas.width / 2;
  var centery = ctx.canvas.height / 2;
  ctx.fillStyle = randomGradient(canvas);
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let grunge = document.getElementById("grungy").checked
  let numshapes = 1;//Math.random() * max_shapes() + 2;
  let ia = 0
  ctx.fillStyle = document.getElementById("paintcolor").value;
  if (grunge)
    ctx.fillStyle = randomGradient(canvas, document.getElementById("paintcolor").value)
  for (var t = 0; t < numshapes; t++) {
    let radius = 10
    x = 0;
    y = 0;
    var x0 = x;
    var y0 = y;
    let turn = 0
    angle = Math.floor(Math.random() * 6.42);
    ctx.beginPath();
    var centx = canvas.width + 260
    var centy = canvas.height/2 + pet(canvas.height/2);
    var edges = Math.random()*121+Math.random()*121;
    var maxradius = canvas.height/2 + Math.random() * canvas.height/3;
    increase = Math.PI * 2/edges;
    ctx.beginPath();
    let rfactor = 2
    let mfactor = maxradius
    for (var i = 0; i < edges-1; i++) {
      rfactor =  maxradius/40 + Math.random() *11
      if (Math.random()> 0.63)
        mfactor += (Math.random() - 0.5) * maxradius/9
      radius = Math.random() * rfactor + mfactor;
      x = radius * Math.cos(angle)+centx;
      y = radius * Math.sin(angle)+centy;
      centx = centx+pet(23)
      centy = centy+pet(23)
      if (i == 0) {
        x0 = x;
        y0 = y;
      }
      ctx.lineTo(x, y);
      ia = increase + Math.PI/180 * pet(9);
      angle += ia
      turn += ia
      if(turn >= 6.28)
        break;
    }
    ctx.lineTo(x0, y0);
    ctx.closePath();
    ctx.fill();
  }
}

function drawBezline (pts, offsetX, offsetY, fill) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let x = 0, y = 0, x0 = 0, y0 = 0
  ctx.beginPath()
  let i = 0;
  for (; i < pts.length; i++) {
    x = pts[i][0]
    y = pts[i][1]
    if (i == 0) {
      x0 = x;
      y0 = y;
      ctx.moveTo(x, y);
    } else
    if (i % 3 == 0)
      ctx.bezierCurveTo(pts[i-2][0], pts[i-2][1], pts[i-1][0], pts[i-1][1], pts[i][0], pts[i][1]);
  }
  if (fill) {
    ctx.closePath()
    ctx.fill()
  } else
    ctx.stroke();
}

function drawLines (pts, offsetX, offsetY, fill) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let x = 0, y = 0, x0 = 0, y0 = 0
  ctx.beginPath()
  let i = 0;
  for (; i < pts.length; i++) {
    x = pts[i][0]
    y = pts[i][1]
    if (i == 0) {
      x0 = x;
      y0 = y;
      ctx.moveTo(x, y);
    } else
      ctx.lineTo(pts[i][0], pts[i][1]);
  }
  if (fill) {
    ctx.closePath()
    ctx.fill()
  } else
    ctx.stroke();
}

function drawOutline (pts, offsetX, offsetY) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let x = 0, y = 0, x0 = 0, y0 = 0
  ctx.beginPath()
  let i = 0;
  for (; i < pts.length; i++) {
    x = pts[i][0]
    y = pts[i][1]
    if (i == 0) {
      x0 = x;
      y0 = y;
      ctx.moveTo(x, y);
    } else
    if (i % 3 == 0)
      ctx.bezierCurveTo(pts[i-2][0], pts[i-2][1], pts[i-1][0], pts[i-1][1], pts[i][0], pts[i][1]);
  }
  ctx.closePath();
  ctx.stroke();
}

function drawPath (points, offsetX, offsetY, c) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  if (c)
    ctx = c
  let x = 0, y = 0, x0 = 0, y0 = 0
  ctx.beginPath()
  let i = 0;
  for (; i < points.length; i++) {
    x = points[i][0] + offsetX;
    y = points[i][1] + offsetY;
    if (i == 0) {
      x0 = x;
      y0 = y;
      ctx.moveTo(x, y);
    } else
    ctx.lineTo(x,y)
  }
  ctx.closePath();
  ctx.fill();
}

function fade () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let cx = ctx.canvas.width/2
  let cy = ctx.canvas.height/2
  let w = canvas.width, h = canvas.height
  let maxdist = 101 + Math.random() * w/2
  maxdist = Math.pow(Math.pow(cx, 2) + Math.pow(cy, 2), 0.5)
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let d = 1000
  let data = ctx.getImageData(0,0,canvas.width,canvas.height)
  let i = 0, x = 0, y = 0
  let len = w * h
  for (;i < len; i++) {
    x = i % w
    if (x === 0)
      y += 1
    d = Math.random() * w
    let px = data.data.slice(i*4, i*4+4)
    brightness = (px[0]+px[1]+px[2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      px[3] *= d/maxdist
      data.data.set(px, i*4)
    }
  }
  ctx.putImageData(data, 0, 0);
}

async function fr () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  if (LASTCLICK[0] > canvas.width)
    LASTCLICK[0] = canvas.width/2
  let touch = Math.floor(LASTCLICK[0]) //- canvas.height/5000*spread
  let w = canvas.width, h = canvas.height
  let maxdist = canvas.width - touch
  let d = 0
  let data = ctx.getImageData(0,0,canvas.width,canvas.height)
  let i = 0, x = 0, y = 0
  let len = w * h
  for (;i < len; i++) {
    x = i % w
    if (i > 0 && i % w === 0) {
      x = 0
      y += 1
    }
    if (x > touch) {
      d = (x-touch)
      let px = data.data.slice(i*4, i*4+4)
      px[3] -= px[3] * d/maxdist
      data.data.set(px, i*4)
    }
  }
  await ctx.putImageData(data, 0, 0);
  return true
}

async function fd () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  if (LASTCLICK[1] > canvas.height)
    LASTCLICK[1] = canvas.height/2
  let touch = Math.floor(LASTCLICK[1]) //- canvas.height/5000*spread
  let w = canvas.width, h = canvas.height
  let maxdist = canvas.height - touch
  let d = 0
  let data = ctx.getImageData(0,0,canvas.width,canvas.height)
  let i = 0, x = 0, y = 0
  let len = w * h
  for (;i < len; i++) {
    x = i % w
    if (i > 0 && i % w === 0) {
      x = 0
      y += 1
    }
    if (y > touch) {
      d = (y-touch)
      let px = data.data.slice(i*4, i*4+4)
      px[3] -= px[3] * d/maxdist
      data.data.set(px, i*4)
    }
  }
  await ctx.putImageData(data, 0, 0);
  return true
}

async function fadeDown () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  if (LASTCLICK[1] > canvas.height)
    LASTCLICK[1] = canvas.height/2
  let spread = Math.floor(1 + document.getElementById("number").value/2000)
  // tie spread to canvas.height?
  let touchy = LASTCLICK[1] //- canvas.height/5000*spread
  let w = canvas.width, h = canvas.height
  let maxdist = touchy
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let d = 1000, brightness = 0
  let data = ctx.getImageData(0,0,canvas.width,canvas.height)
  let i = 0, x = 0, y = 0
  let len = w * h
  let dmin = 1000, dmax = 0
  for (;i < len; i++) {
    y = i % w
    if (y === 0)
      x += 1
    d = (touchy - x)
    if (x > touchy)
      d = 0
    let px = data.data.slice(i*4, i*4+4)
    brightness = (px[0]+px[1]+px[2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      px[3] *= d/maxdist
      data.data.set(px, i*4)
    }
  }
  await ctx.putImageData(data, 0, 0);
  return true
}

function downFade () {
  rc()
  leftFade()
  rcc()
}


function leftFadeOG () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let cx = LASTCLICK[0]//ctx.canvas.width/2 + pet(150)
  let cy = ctx.canvas.height/2 + pet(150)
  let rightx = canvas.width
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let w = canvas.width, h = canvas.height
  let maxdist = Math.pow(Math.pow(cx, 2) + Math.pow(cy, 2), 0.5)
  maxdist *= 1.2
  let d = 1000, brightness = 0
  let data = ctx.getImageData(0,0,canvas.width,canvas.height)
  let i = 0, x = 0, y = 0
  let len = w * h
  for (;i < len; i++) {
    x = i % w
    if (x === 0)
      y += 1
    d = lindistance((x*1.5), 0)
    let px = data.data.slice(i*4, i*4+4)
    brightness = (px[0]+px[1]+px[2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      px[3] *= d/maxdist
      data.data.set(px, i*4)
    }
  }
  ctx.putImageData(data, 0, 0);
}

function leftFade () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let cx = LASTCLICK[0]//ctx.canvas.width/2 + pet(150)
  transparenter(0,0,cx,canvas.height)
}

function pop () {
  saturationScale(1.5)
  contrastImage(15)
  //sharpenCanvas()
}

function pale () {
  saturationScale(0.75)
  contrastImage(-15)
  //sharpenCanvas()
}

function edgeGrey () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let ocanvas = document.createElement("CANVAS")
  let octx = ocanvas.getContext('2d')
  ocanvas.width = canvas.width
  ocanvas.height = canvas.height
  octx.drawImage(canvas,0,0)
  greyScale(ocanvas)
  vig(ocanvas)
  ctx.drawImage(ocanvas,0,0)
}

function edgeDarken () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let ocanvas = document.createElement("CANVAS")
  let octx = ocanvas.getContext('2d')
  ocanvas.width = canvas.width
  ocanvas.height = canvas.height
  octx.drawImage(canvas,0,0)
  adjustBrightness(-30, ocanvas)
  vig(ocanvas)
  ctx.drawImage(ocanvas,0,0)
}

function edgeLighten () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let ocanvas = document.createElement("CANVAS")
  let octx = ocanvas.getContext('2d')
  ocanvas.width = canvas.width
  ocanvas.height = canvas.height
  octx.drawImage(canvas,0,0)
  adjustBrightness(30, ocanvas)
  vig(ocanvas)
  ctx.drawImage(ocanvas,0,0)
}

function edgeBlur () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let ocanvas = document.createElement("CANVAS")
  let octx = ocanvas.getContext('2d')
  ocanvas.width = canvas.width
  ocanvas.height = canvas.height
  octx.drawImage(canvas,0,0)
  smearrandom(ocanvas)
  vig(ocanvas)
  ctx.drawImage(ocanvas,0,0)
}

// distace of (x,y) to closest edge
function frameDistance (x, y, w, h) {
  let w2 = w/2, h2 = h/2
  let d1 = (x < w2)? x: w-x;
  let d2 = (y < h2)? y: h-y;
  return Math.min(d1,d2)
}

function fadeCenter() {
  vig(null, true)
}

function vig_rect (canvas, FADE) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let cx = ctx.canvas.width/2 + pet(150)
  let cy = ctx.canvas.height/2 + pet(150)
  cx = LASTCLICK[0]
  cy = LASTCLICK[1]
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let s = 2+document.getElementById("featuresize").value/5 // up to 500
  let s5 = s/7
  // decrease d as s increases?
  let w = canvas.width, h = canvas.height
  let w_wide = w * 0.6
  let weight = 0
  
  let maxdist = frameDistance(cx,cy,w,h)//Math.pow(Math.pow(cx, 2) + Math.pow(cy, 2), 0.5)
 // maxdist *= 1.2
  let d = 1000, brightness = 0
  let data = ctx.getImageData(0,0,canvas.width,canvas.height)
  let i = 0, x = 0, y = 0
  let len = w * h
  for (;i < len; i++) {
    x = i % w
    if (x === 0)
      y += 1
    d = frameDistance(x, y, w, h)
    let px = data.data.slice(i*4, i*4+4)
    brightness = (px[0]+px[1]+px[2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      
      if (FADE && d + pet(s/2) < s) {
        px[3] *= 0.5//maxdist/d
        data.data.set(px, i*4)
      } else
      if (d + pet(s*5) > s) {
        px[3] *= 0.0//maxdist/d
        data.data.set(px, i*4)
      }
    }
  }
  ctx.putImageData(data, 0, 0);
  //vig_OG (canvas, FADE)
}


function vig (canvas, FADE) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let cx = ctx.canvas.width/2 + pet(150)
  let cy = ctx.canvas.height/2 + pet(150)
  cx = LASTCLICK[0]
  cy = LASTCLICK[1]
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let s = 25+document.getElementById("featuresize").value // up to 500
  let s5 = s/10
  // decrease d as s increases?
  let w = canvas.width, h = canvas.height
  //let w_wide = w * 0.6
  let weight = 0.33
  
  let maxdist = Math.min(w,h)/2//.pow(Math.pow(cx, 2) + Math.pow(cy, 2), 0.5)
  maxdist *= 1.2
  
  let w_wide = maxdist * 0.9

  let d = 1000, brightness = 0
  let data = ctx.getImageData(0,0,canvas.width,canvas.height)
  let i = 0, x = 0, y = 0
  let len = w * h
  for (;i < len; i++) {
    x = i % w
    if (x === 0)
      y += 1
    d = distance(x, y, cx+pet(29), cy+pet(29), w, h)
    let px = data.data.slice(i*4, i*4+4)
    brightness = (px[0]+px[1]+px[2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      if (!FADE && d < w_wide + pet(s5)) {
        px[3] *= weight//d/maxdist
        data.data.set(px, i*4)
      } else
      if (FADE) {
        px[3] *= d/maxdist
        data.data.set(px, i*4)
      }
    }
  }
  ctx.putImageData(data, 0, 0);
}

function pasteFromOff () {
  let OC = document.getElementById('OC')
  if (OC && OC.width > 0) {
    let canvas = document.getElementById('myCanvas')
    let ctx = canvas.getContext('2d')
    let OCctx = OC.getContext('2d')
    OCctx.globalAlpha = ctx.globalAlpha//document.getElementById("opacity").value/100
   // ctx.globalAlpha = document.getElementById("opacity").value/100
    ctx.drawImage(OC, 0, 0)
    return true
  }
  return true
}

function smearrandom (c, d) {
  if (c)
    canvas = c
  else
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let off = document.createElement('CANVAS')
  let offctx = off.getContext("2d")
  off.width = canvas.width
  off.height = canvas.height
  offctx.drawImage(canvas, 0, 0)
  let jump = 1 + document.getElementById("featuresize").value/2
  let jump2 = jump
  if (d) {
    jump = d[0]
    jump2 = d[1]
  }
  ctx.globalAlpha = (document.getElementById("opacity").value)/400
  let i = 0
  let n = 2
  ctx.save()
  for (; i < n; i++) {
    if (Math.random() > 0.5)
      jump2 *= -1
    if (Math.random() > 0.5)
      jump *= -1
    ctx.drawImage(off, jump/2 + pet(jump/2),  jump2/2 + pet(jump2/2))
  }
  ctx.restore()
}

function smearrandomoc () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let off = document.getElementById('OC')
  if (off && off.width > 0) {
    let x = off.width/2
    let y = off.height/2
    let angle = 2
    let offctx = off.getContext("2d")
    let c = canvas.width/3
    let jump = 1 + document.getElementById("featuresize").value/2
    let jump2 = jump
    ctx.globalAlpha = (document.getElementById("opacity").value)/400
    let i = 0
    let n = 2
    ctx.save()
    for (; i < n; i++) {
      if (Math.random() > 0.5)
        jump2 *= -1
      if (Math.random() > 0.5)
        jump *= -1
      ctx.drawImage(off, jump/2 + pet(jump/2),  jump2/2 + pet(jump2/2))
    }
    ctx.restore()
  }
}

function smearzoom () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let off = document.createElement('CANVAS')
  off.height = canvas.height*1.05
  off.width = canvas.width*1.05
  let x = LASTCLICK[0]//off.width/2
  let y = LASTCLICK[1]//off.height/2
  let xoffset = (canvas.width - off.width)/2
  let yoffset = (canvas.height - off.height)/2
  xoffset += (canvas.width/2 - x)/2
  yoffset += (canvas.height/2 - y)/2
  let angle = 2
  offctx = off.getContext("2d")
  offctx.drawImage(canvas, xoffset, yoffset, off.width, off.height)
  let c = canvas.width/3
  let jump = 1 + document.getElementById("featuresize").value/10
  let jump2 = jump
  ctx.globalAlpha = (document.getElementById("opacity").value)/200
  let i = 0
  let n = 2 //+ Math.random() * 17
  ctx.save()
  for (; i < n; i++) {
    if (Math.random() > 0.5)
      jump2 *= -1
    if (Math.random() > 0.5)
      jump *= -1
    ctx.drawImage(off, jump/2 + pet(jump/2),  jump2/2 + pet(jump2/2))
  }
  ctx.restore()
}

function smeardown2 () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let off = document.createElement('CANVAS')
  off.height = canvas.height
  off.width = canvas.width
  offctx = off.getContext("2d")
  offctx.drawImage(canvas, 0, 0)
  let jump = 1 + document.getElementById("featuresize").value/5
  ctx.globalAlpha = (document.getElementById("opacity").value)/200
  let i = 0
  let n = 2
  for (; i < n; i++) {
    ctx.drawImage(off, 0, -jump/2 + pet(jump/2))
    jump += pet(33)
  }
  return true
}

function smearside () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let off = document.createElement('CANVAS')
  off.height = canvas.height
  off.width = canvas.width
  offctx = off.getContext("2d")
  offctx.drawImage(canvas, 0, 0)
  let jump = 1 + document.getElementById("featuresize").value/5
  ctx.globalAlpha = (document.getElementById("opacity").value)/200
  let i = 0
  let n = 2
  ctx.save()
  for (; i < n; i++) {
    ctx.drawImage(off, jump/2 + pet(jump/2), 0)
  }
  ctx.restore()
}

function smeardown () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let c = canvas.width/3
  ctx.globalAlpha = (document.getElementById("opacity").value)/400
  let i = 0
  let n = 5 + Math.random() * 17
  ctx.save()
  for (; i < n; i++) {
    ctx.translate(c+pet(3), c+3+pet(3))
    ctx.translate(-c, -c);
    ctx.drawImage(ctx.canvas, 0, 0)
  }
  ctx.restore()
}

function smear (micro) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let c = canvas.width/2
  ctx.globalAlpha = (document.getElementById("opacity").value)/100
  let i = 0
  let m = 7
  if (micro)
    m = 2
  let p = 20, rotation = 0.01
  
  ctx.save()
  for (; i < 5; i++) {
    ctx.translate(c+pet(m), c+pet(m));
    ctx.translate(-c+pet(m), -c+pet(m));
    ctx.drawImage(ctx.canvas, pet(p), pet(p))
  }
  ctx.restore()
}

function edgeSmear (small) {
  let ocanvas = document.createElement("CANVAS")
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let numshapes = 2 + Math.log(document.getElementById("number").value)/2
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let cx = canvas.height/2, cy = canvas.width/2
  ocanvas.height = (canvas.height > canvas.width)? canvas.height: canvas.width
  ocanvas.width = (canvas.height > canvas.width)? canvas.height: canvas.width
  ocanvas.height += 50
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  
  octx.fillStyle = randomGradient(ocanvas, document.getElementById("paintcolor").value)
  octx.globalAlpha = 1//(document.getElementById("opacity").value)/100
  let c = ocanvas.height * 0.5
  let x = 1//canvas.width/100 * Math.random()
  let y = 21
  let r = 17
  let i = 0
  let p = 61
  if (document.getElementById("grungy").checked)
    p *= 3
  if (small) {
    p = canvas.width/200
    r /= 2
  }
  for (; i < numshapes; i++) {
    octx.fillStyle = randomGradient(ocanvas, document.getElementById("paintcolor").value)
    octx.globalAlpha = Math.random()
    let xo = x+pet(p)
    drawBlobAt (octx, xo/2, y, r+pet(2))
  }
  i = 0
  let N = (Math.log(canvas.height+1) * 11.3) - 46

  for (; i < N; i++) {
    octx.globalAlpha = Math.random()
    let co = c+3+pet(1)
    octx.translate(c, co)
    octx.translate(-c, -c)
    octx.drawImage(octx.canvas, 0, 0)
  }
  ctx.drawImage(ocanvas, -5, 0)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
}

function smeardownOff () {
  let ocanvas = document.createElement("CANVAS")
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let numshapes = 2 + Math.log(document.getElementById("number").value)/2
  ctx.globalAlpha = document.getElementById("opacity").value/100
  let cx = canvas.height/2, cy = canvas.width/2
  ocanvas.height = (canvas.height > canvas.width)? canvas.height: canvas.width
  ocanvas.width = (canvas.height > canvas.width)? canvas.height: canvas.width
  ocanvas.height += 50
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  let c = ocanvas.height * 0.5
  octx.fillStyle = randomGradient(ocanvas, document.getElementById("paintcolor").value)
  octx.globalAlpha = (document.getElementById("opacity").value)/100
  let x = canvas.width * Math.random()
  let y = 4
  let r = 17
  let i = 0
  let p = 61
  if (document.getElementById("grungy").checked)
    p *= 3
  for (; i < numshapes; i++) {
    octx.fillStyle = randomGradient(ocanvas, document.getElementById("paintcolor").value)
    octx.globalAlpha = Math.random()
    drawBlobAt (octx, x+pet(p), y+pet(p), r+pet(17))
  }
  i = 0
  let N = (Math.log(canvas.height+1) * 11.3) - 46
  for (; i < N; i++) {
    octx.globalAlpha = Math.random()
    octx.translate(c, c+3+pet(1))
    octx.translate(-c, -c)
    octx.drawImage(octx.canvas, 0, 0)
  }
  ctx.drawImage(ocanvas, 0, -50)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
}

function smearsideways () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let c = canvas.height/2
  ctx.globalAlpha = (document.getElementById("opacity").value)/400
  let i = 0
  let p = 5
  if (document.getElementById("grungy").checked) {
    p = 11
  }
  ctx.save()
  for (; i < 33; i++) {
    ctx.translate(c+3+pet(1), c+pet(1))
    ctx.rotate(0 * Math.PI);
    ctx.translate(-c, -c);
    ctx.drawImage(ctx.canvas,3, pet(p))
  }
  ctx.restore()
}

function refreshMode () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let selectElement = document.getElementById("mode");
  ctx.globalCompositeOperation = selectElement.value
  return true
}

function syncBackground (canvas) {
  let bkg = document.getElementById("background");
  bkg.style.height = canvas.height +"px"
  bkg.style.width = canvas.width +"px"
  displayRatio()
  //syncMarker()
}

function resizeCanvas () {
  let canvas_size = 1080//256 * document.getElementById("canvas_size").value
  let ocanvas = document.getElementById('off')
  let octx = ocanvas.getContext('2d')
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d")
  let mode = ctx.globalCompositeOperation
  let a = ctx.globalAlpha
  ctx.globalAlpha = 1.0
  ocanvas.height = canvas.height
  ocanvas.width = canvas.width
  //ctx.imageSmoothingEnabled = false
  octx.drawImage(canvas, 0, 0)
  canvas.height = canvas_size
  canvas.width = canvas_size
  
  let selection = document.getElementById("canvassizes").value
  if (selection == "portrait") {
    canvas.width = 1080
    canvas.height = 1350
  } else
  if (selection == "landscape") {
    canvas.width = 1080
    canvas.height = 608
  } else
  if (selection == "instax") {
    canvas.width = 344
    canvas.height = 550
    // inset frame
  }
  syncBackground(canvas)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
 // ctx.imageSmoothingEnabled = false
  syncBackground(canvas)
  ctx.drawImage(ocanvas,0,0,canvas.width,canvas.height)
  octx.clearRect(0,0,ocanvas.width,ocanvas.height)
  document.getElementById("canvaswidth").value = canvas.width
  document.getElementById("canvasheight").value = canvas.height
  ctx.globalCompositeOperation = mode
  //syncMarker()
  displayRatio()
}

function clearCanvas () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width, canvas.height)
}

function saveAs () {
  document.getElementById("downloader").download = "image.png";
  document.getElementById("downloader").href = document.getElementById("myCanvas").toDataURL("image/png").replace(/^data:image\/[^;]/, 'data:application/octet-stream');
}

function pet (v) {
  return (Math.random() -0.5) * v;
}

function distance (x1, y1, x2, y2) {
  return Math.pow(Math.pow(x1-x2, 2) + Math.pow(y1-y2, 2), 0.5)
}

function lindistance (x1,x2) {
  return Math.abs(x1,x2)
}

function updateDist () {
  let d = document.getElementById("distribution").value
  let el = document.getElementById("dist")
  if (d == 0)
    el.innerHTML = "gaussian"
  else
    el.innerHTML = "square"
}

function transparenter (x,y,w,h) {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imageData = null
  if (!w)
    imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  else {
    console.log(x,y,w,h)
  
    imgData = ctx.getImageData(x,y,w,h);
  }
  let pixels = imgData.data;

  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let i = 0, brightness = 0
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i + 3] *= 0.9;
    }
  }
  ctx.putImageData(imgData, 0, 0);
}

function opaqueer () {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let i = 0
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i + 3] *= 1.1;
    }
  }
  ctx.putImageData(imgData, 0, 0);
}

function decolorSky () {
  let sv = 0.9
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imageData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let touch = LASTCLICK[1], x = 0, y = 0, w = canvas.width*4
  let dA = imageData.data; // raw pixel data in array
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  //var sv = 1.25; // saturation value. 0 = grayscale, 1 = original
  var luR = 0.3086; // constant to determine luminance of red. Similarly, for green and blue
  var luG = 0.6094;
  var luB = 0.0820;
  var az = (1 - sv)*luR + sv;
  var bz = (1 - sv)*luG;
  var cz = (1 - sv)*luB;
  var dz = (1 - sv)*luR;
  var ez = (1 - sv)*luG + sv;
  var fz = (1 - sv)*luB;
  var gz = (1 - sv)*luR;
  var hz = (1 - sv)*luG;
  var iz = (1 - sv)*luB + sv;
  let i = 0
  for(; i < dA.length; i += 4) {
    x = i % w
    if (i > 0 && i % w === 0) {
      x = 0
      y += 1
    }
    if (y < touch - (Math.random() * 70)) {
      var red = dA[i]; // Extract original red color [0 to 255]. Similarly for green and blue below
      var green = dA[i + 1];
      var blue = dA[i + 2];
      brightness = (dA[i]+dA[i+1]+dA[i+2])/(255*3)
      if (brightness > lowest && brightness <= highest) {
        var saturatedRed = (az*red + bz*green + cz*blue);
        var saturatedGreen = (dz*red + ez*green + fz*blue);
        var saturateddBlue = (gz*red + hz*green + iz*blue);
        dA[i] = saturatedRed;
        dA[i + 1] = saturatedGreen;
        dA[i + 2] = saturateddBlue;
      }
    }
  }
  ctx.putImageData(imageData, 0, 0);
}

function tintSky (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let offcanvas = document.createElement('CANVAS')
  offcanvas.width = canvas.width
  offcanvas.height = canvas.height
  let offctx = offcanvas.getContext("2d");
  let touch = LASTCLICK[1], x = 0, y = 0, w = canvas.width*4
  let color = document.getElementById("paintcolor").value
  let r = hexToR(color)
  let g = hexToG(color)
  let b = hexToB(color)
  let ctx = canvas.getContext("2d");
  let mode = ctx.globalCompositeOperation
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0
  let brightness = 0
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  for (; i < pixels.length; i += 4) {
    x = i % w
    if (i > 0 && i % w === 0) {
      x = 0
      y += 1
    }
    if (y < touch - (Math.random() * 70)) {
      brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
      if (brightness > lowest && brightness <= highest) {
        pixels[i] =     Math.min(pixels[i] * 0.9 + r * 0.1, 255);
        pixels[i + 1] = Math.min(pixels[i+1] * 0.9+ g * 0.1, 255);
        pixels[i + 2] = Math.min(pixels[i+2] * 0.9 + b * 0.1, 255);
      }
    }
  }
  offctx.putImageData(imgData, 0, 0);
  ctx.globalCompositeOperation = "color"
  ctx.drawImage(offcanvas,0,0)
  ctx.globalCompositeOperation = mode
}


function darkenSky (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let n = -5
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  let touch = LASTCLICK[1], x = 0, y = 0
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0, w = canvas.width*4
  for (; i < pixels.length; i += 4) {
    x = i % w
    if (i > 0 && i % w === 0) {
      x = 0
      y += 1
    }
    if (y < touch - (Math.random() * 70)) {
      brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
      if (brightness > lowest && brightness <= highest) {
        pixels[i] += n;
        pixels[i + 1] += n;
        pixels[i + 2] += n;
      }
    }
  }
  ctx.putImageData(imgData, 0, 0, 0,0,canvas.width,y);
}
    
function increaseGrain (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let n = document.getElementById("number").value/200
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let flip = 0.5
  if (document.getElementById("grungy").checked)
    flip = 0.87
  
  let i = 0
  for (; i < pixels.length; i += 4) {
    if (Math.random() > 0.5) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i] += n;
      pixels[i + 1] += n;
      pixels[i + 2] += n;
      if (Math.random() > flip)
        n *= -1
    }
  }
  }
  ctx.putImageData(imgData, 0, 0);
}

function increaseGrainPrinty (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let n = document.getElementById("number").value/200
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let flip = 0.5
  if (document.getElementById("grungy").checked)
    flip = 0.87
  let fudge = []
  let i = 0, ct = 0
  let ff = [53, 59, 61, 67, 71, 73, 37, 41, 43]
  let mm = randomPick(ff)
  console.log(mm)
  for (; i < mm; i++)
    fudge.push((Math.random() > 0.5)?1:-1)
  i = 0
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i] += n;
      pixels[i + 1] += n;
      pixels[i + 2] += n;
      n *= fudge[ct % mm]
      ct++
    }
  }
  ctx.putImageData(imgData, 0, 0);
}

function adjustBrightness (n, canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i] += n;
      pixels[i + 1] += n;
      pixels[i + 2] += n;
    }
  }
  ctx.putImageData(imgData, 0, 0);
}

 function rotateBrightness (canvas, n) {
  if (!n)
    n = 16
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i] = (pixels[i] + n) % 256;
      pixels[i + 1] = (pixels[i+1] + n) % 256;
      pixels[i + 2] = (pixels[i+2] + n) % 256;
    }
  }
   ctx.putImageData(imgData, 0, 0);
  return true
}

async function randomizeColors (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d");
  let n1 = Math.floor(Math.random() * 256)
  let n2 = Math.floor(Math.random() * 256)
  let n3 = Math.floor(Math.random() * 256)
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i] =     (pixels[i] + n1) % 256;
      pixels[i + 1] = (pixels[i+1] + n2) % 256;
      pixels[i + 2] = (pixels[i+2] + n3) % 256;
    }
  }
  await ctx.putImageData(imgData, 0, 0);
  return true
}

async function rotateColors (canvas, D) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
 
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0
  for (; i < pixels.length; i += 4) {
    pixels[i] =     (pixels[i] + D) % 256;
    pixels[i + 1] = (pixels[i+1] + D) % 256;
    pixels[i + 2] = (pixels[i+2] + D) % 256;
  }
  await ctx.putImageData(imgData, 0, 0);
  return true
}

function tint (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let offcanvas = document.createElement('CANVAS')
  offcanvas.width = canvas.width
  offcanvas.height = canvas.height
  let offctx = offcanvas.getContext("2d");
  let color = document.getElementById("paintcolor").value
  let r = hexToR(color)
  let g = hexToG(color)
  let b = hexToB(color)
  let ctx = canvas.getContext("2d");
  let mode = ctx.globalCompositeOperation
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0
  let fudge = []
  for (; i < 31; i++)
    fudge.push((Math.random() - 0.5)/5)
  let brightness = 0, ct = 0
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  i = 0
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3) + fudge[ct%31]
    if (brightness > lowest && brightness <= highest) {
      pixels[i] =     Math.min(pixels[i] * 0.7 + r * 0.3, 255);
      pixels[i + 1] = Math.min(pixels[i+1] * 0.7 + g * 0.3, 255);
      pixels[i + 2] = Math.min(pixels[i+2] * 0.7 + b * 0.3, 255);
    }
    ct++
  }
  offctx.putImageData(imgData, 0, 0);
  ctx.globalCompositeOperation = "color"
  ctx.drawImage(offcanvas,0,0)
  ctx.globalCompositeOperation = mode
}

function adjustWarmth (n, canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let g = n/2
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let i = 0
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  
  for (; i < pixels.length; i += 4) {
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i] += n;
     // pixels[i + 1] += g;
      pixels[i + 2] -= n;
    }
  }
  ctx.putImageData(imgData, 0, 0);
}

function saturationScale (sv, canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imageData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let dA = imageData.data; // raw pixel data in array
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let brightness = 0
  //var sv = 1.25; // saturation value. 0 = grayscale, 1 = original
  var luR = 0.3086; // constant to determine luminance of red. Similarly, for green and blue
  var luG = 0.6094;
  var luB = 0.0820;
  var az = (1 - sv)*luR + sv;
  var bz = (1 - sv)*luG;
  var cz = (1 - sv)*luB;
  var dz = (1 - sv)*luR;
  var ez = (1 - sv)*luG + sv;
  var fz = (1 - sv)*luB;
  var gz = (1 - sv)*luR;
  var hz = (1 - sv)*luG;
  var iz = (1 - sv)*luB + sv;
  let i = 0
  for(; i < dA.length; i += 4) {
      var red = dA[i]; // Extract original red color [0 to 255]. Similarly for green and blue below
      var green = dA[i + 1];
      var blue = dA[i + 2];
      brightness = (dA[i]+dA[i+1]+dA[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
        var saturatedRed = (az*red + bz*green + cz*blue);
        var saturatedGreen = (dz*red + ez*green + fz*blue);
        var saturateddBlue = (gz*red + hz*green + iz*blue);
        dA[i] = saturatedRed;
        dA[i + 1] = saturatedGreen;
        dA[i + 2] = saturateddBlue;
    }
  }
  ctx.putImageData(imageData, 0, 0);
}

function rgb_lrgb1(v) {
  return (v /= 255) <= 0.04045 ? v / 12.92 : ((v + 0.055) / 1.055) ** 2.4;
}

function lrgb_rgb1(v) {
  return (v <= 0.0031308 ? 12.92 * v : 1.055 * (v ** (1 / 2.4)) - 0.055) * 255;
}

function gray (r, g, b) {
  const kr = 0.2126
  const kg = 0.7152
  const kb = 0.0722
  return lrgb_rgb1(kr * rgb_lrgb1(r) + kg * rgb_lrgb1(g) + kb * rgb_lrgb1(b));
}

function greyScale (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
  let pixels = imgData.data;
  let lh = rangecheck()
  let lowest = lh[0], highest = lh[1]
  let i = 0, brightness = 0
  for (; i < pixels.length; i += 4) {
    let lightness = parseInt((pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3);
    
    brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/(255*3)
    if (brightness > lowest && brightness <= highest) {
      pixels[i] = lightness;
      pixels[i + 1] = lightness;
      pixels[i + 2] = lightness;
    }
  }
  ctx.putImageData(imgData, 0, 0);
}

function lum () {
  let c = document.getElementById("paintcolor").value
  let r = hexToR(c) / 255
  let g = hexToG(c) / 255
  let b = hexToB(c) / 255

  // Find greatest and smallest channel values
  let cmin = Math.min(r,g,b),
      cmax = Math.max(r,g,b),
      delta = cmax - cmin,
      h = 0,
      s = 0,
      l = 0;
  return ((cmax + cmin) / 2)
}

function threshold_soft () {
  let threshold = lum() * 255
  let low = threshold - threshold/2
  let high = threshold + threshold/2
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  let d = imageData.data; // raw pixel data in array
  let v = 0, l = 0, r, b, g
  for (var i=0; i<d.length; i+=4) {
    r = d[i];
    g = d[i+1];
    b = d[i+2];
    l = 0.2126*r + 0.7152*g + 0.0722*b
    v = 0
    if (l >= high)
      v = 255
    else
    if (l < low)
      v = 0
    else
      v = l
    d[i] = d[i+1] = d[i+2] = v
  }
  ctx.putImageData(imageData, 0, 0);
}

function threshold (L) {
  let threshold = lum() * 255
  if (L)
    threshold = L
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  let d = imageData.data; // raw pixel data in array
  for (var i=0; i<d.length; i+=4) {
    var r = d[i];
    var g = d[i+1];
    var b = d[i+2];
    var v = (0.2126*r + 0.7152*g + 0.0722*b >= threshold) ? 255 : 0;
    d[i] = d[i+1] = d[i+2] = v
  }
  ctx.putImageData(imageData, 0, 0);
}

function randomKernel () {
  let wts = [0,1,2,3,4,5,1/2]
  let sum = 0, i = 0
  let k = []
  for (; i < 9; i++) {
    k.push(randomPick(wts) * Math.floor(2*(Math.random() - 0.5)))
    sum += k[i]
  }
  if (sum != 0) {
    let sum2 = 0
    i = 0
    for (; i < 9; i++) {
      k[i] /= sum
      sum2 += k[i]
    }
  }
  return k
}

function randomConvolution () {
  let k = randomKernel()
  convolutionMatrix(k, 0)
}

function gaussianBlur () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let data = ctx.getImageData(0,0,canvas.width,canvas.height)
  let px = data.data
  let tmpPx = new Uint8ClampedArray(px.length)
  tmpPx.set(px)
  let i = 0, len= px.length
  for (; i < len; i++) {
     if (i % 4 === 3) {continue;}
     px[i] = ( tmpPx[i]
        + (tmpPx[i - 4] || tmpPx[i])
        + (tmpPx[i + 4] || tmpPx[i])
        + (tmpPx[i - 4 * data.width] || tmpPx[i])
        + (tmpPx[i + 4 * data.width] || tmpPx[i])
        + (tmpPx[i - 4 * data.width - 4] || tmpPx[i])
        + (tmpPx[i + 4 * data.width + 4] || tmpPx[i])
        + (tmpPx[i + 4 * data.width - 4] || tmpPx[i])
        + (tmpPx[i - 4 * data.width + 4] || tmpPx[i])
        )/9
  };
  ctx.putImageData(data,0,0)
  delete tmpPx
  
}

function blurCanvas (canvas) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  let k = [1,1,1,1,1,1,1,1,1]
  convolutionMatrix(k, 0, canvas, 9)
}

function emboseCanvas () {
  let k = [[-1,-1,-1,
           -1,1,1,
            1,1,1],
          
          [1,1,1,
           1,1,-1,
         - 1,-1,-1],
           
          [-1,-1,1,
           -1,1,1,
           -1,1,1],
          
          [1,1,-1,
           1,1,-1,
           1,-1,-1]
        ]
            
    convolutionMatrix(randomPick(k), 0)
}

function sharpen2 () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let mode = document.getElementById("mode").value
  let opacity = document.getElementById("opacity").value
  // opacity 1.0, source-over
  document.getElementById("mode").value = "source-over"
  clearOff()
  copyToOff()
  gaussianBlur()
  document.getElementById("mode").value = "difference"
  ctx.globalCompositeOperation = "difference"
  document.getElementById("opacity").value = 100
  pasteFromOff()
  // unsharp mask ready
  document.getElementById("opacity").value = 75
  swapWithOff()
  pasteFromOff()
  document.getElementById("mode").value = mode
  document.getElementById("opacity").value = opacity
  ctx.globalAlpha = opacity/100
}

function sharpenCanvas () {
  let k = [0,-1, 0,
          -1, 5,-1,
           0,-1, 0]
    if (Math.random() > 0.5)
      k = [-1,0,-1,
            0,5, 0,
           -1,0,-1]
  convolutionMatrix(k, 0)
}

function edgeCanvas () {
  let k = [0,1,0,
           1,-4,1,
           0,1,0]
    convolutionMatrix(k, 0)
    invertColors()
    return true
}

function blur2Canvas () {
  let canvas = document.getElementById("myCanvas");
  let k = [1, 2, 1,
           2, 4, 2,
           1, 2, 1]
    convolutionMatrix(k, 0, canvas, 16)
}

function identityCanvas () {
  let k = [0,0,0,
           0,1,0,
           0,0,0]
    convolutionMatrix(k, 0)
}

function convolutionMatrix (kernel, offset, canvas, div) {
  if (!canvas)
    canvas = document.getElementById("myCanvas")
  if (!div)
    div = 1
  let i = 0
  let ctx = canvas.getContext("2d")
  let input = ctx.getImageData(0, 0, canvas.width, canvas.height)
  let output = ctx.createImageData(input)
  let w = input.width, h = input.height
  let iD = input.data, oD = output.data
  for (let y = 1; y < h - 1; y += 1) {
    for (let x = 1; x < w - 1; x += 1) {
      for (let c = 0; c < 3; c += 1) {
        i = (y * w + x) * 4 + c
        oD[i] = offset +
        (kernel[0] * iD[i - w * 4 - 4] +
          kernel[1] * iD[i - w * 4] +
          kernel[2] * iD[i - w * 4 + 4] +
          kernel[3] * iD[i - 4] +
          kernel[4] * iD[i] +
          kernel[5] * iD[i + 4] +
          kernel[6] * iD[i + w * 4 - 4] +
          kernel[7] * iD[i + w * 4] +
          kernel[8] * iD[i + w * 4 + 4])/div
      }
      oD[(y * w + x) * 4 + 3] = 255
    }
  }
  ctx.putImageData(output, 0, 0)
}

function sobel () {
  let canvas = document.getElementById("myCanvas")
  let ctx = canvas.getContext("2d")
  let imageData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
  let pixels = imageData.data
  let i = 0
  let data = imageData.data
  let width = imageData.width;
  let height = imageData.height;
   const kernelX = [
    [-1,0,1],
    [-2,0,2],
    [-1,0,1]
  ];
  const kernelY = [
    [-1,-2,-1],
    [0,0,0],
    [1,2,1]
  ];
  let sobelData = [];
  let grayscaleData = [];
  function bindPixelAt(data) {
    return function(x, y, i) {
      i = i || 0;
      return data[((width * y) + x) * 4 + i];
    };
  }
  let pixelAt = bindPixelAt(data);
  let x, y;
  for (y = 0; y < height; y++) {
    for (x = 0; x < width; x++) {
      var r = pixelAt(x, y, 0);
      var g = pixelAt(x, y, 1);
      var b = pixelAt(x, y, 2);
      var avg = (r + g + b) / 3;
      grayscaleData.push(avg, avg, avg, 255);
    }
  }
  pixelAt = bindPixelAt(grayscaleData);
  for (y = 0; y < height; y++) {
    for (x = 0; x < width; x++) {
      let pixelX = (
        (kernelX[0][0] * pixelAt(x - 1, y - 1)) +
        (kernelX[0][1] * pixelAt(x, y - 1)) +
        (kernelX[0][2] * pixelAt(x + 1, y - 1)) +
        (kernelX[1][0] * pixelAt(x - 1, y)) +
        (kernelX[1][1] * pixelAt(x, y)) +
        (kernelX[1][2] * pixelAt(x + 1, y)) +
        (kernelX[2][0] * pixelAt(x - 1, y + 1)) +
        (kernelX[2][1] * pixelAt(x, y + 1)) +
        (kernelX[2][2] * pixelAt(x + 1, y + 1))
      );
      let pixelY = (
        (kernelY[0][0] * pixelAt(x - 1, y - 1)) +
        (kernelY[0][1] * pixelAt(x, y - 1)) +
        (kernelY[0][2] * pixelAt(x + 1, y - 1)) +
        (kernelY[1][0] * pixelAt(x - 1, y)) +
        (kernelY[1][1] * pixelAt(x, y)) +
        (kernelY[1][2] * pixelAt(x + 1, y)) +
        (kernelY[2][0] * pixelAt(x - 1, y + 1)) +
        (kernelY[2][1] * pixelAt(x, y + 1)) +
        (kernelY[2][2] * pixelAt(x + 1, y + 1))
      );
      let magnitude = Math.sqrt((pixelX * pixelX) + (pixelY * pixelY))>>>0;
      sobelData.push(magnitude, magnitude, magnitude, 255);
    }
  }
  let clampedArray = sobelData;
  clampedArray = new Uint8ClampedArray(sobelData);
  ctx.putImageData(toImageData(clampedArray,width,height), 0, 0)
  invertColors()
  return true
}

function toImageData(data, width, height) {
  if (typeof ImageData === 'function' && Object.prototype.toString.call(data) === '[object Uint16Array]') {
    return new ImageData(data, width, height);
  } else {
    if (typeof window === 'object' && typeof window.document === 'object') {
      var canvas = document.createElement('canvas');
      if (typeof canvas.getContext === 'function') {
        var context = canvas.getContext('2d');
        var imageData = context.createImageData(width, height);
        imageData.data.set(data);
        return imageData;
      } else {
        return new FakeImageData(data, width, height);
      }
    } else {
      return new FakeImageData(data, width, height);
    }
  }
};

function FakeImageData(data, width, height) {
  return {
    width: width,
    height: height,
    data: data
  };
}

let placenames_stars = ["XO-5", "1 Eridani A", " Eridani A", " Cassiopeiae A", "1 Scorpii Aa", " Crucis Aa", " Cancri Aa", " Leonis Aa", " Canis Majoris A", " Andromedae", " Tauri Aa1", "1 Sagittarii A", " Lyrae Aa", " Andromedae", "HD 168746", " Lyrae", " Sagittarii A", " Aquarii", "1 Cygni Aa", " Corvi", "80 Ursae Majoris Ca", " Tauri A", " Tauri", " Cephei", " Gruis", " Draconis A", " Delphini", " Cephei Aa", "2 Capricorni", " Pegasi", "1 Leonis", " Persei Aa1", " Corvi A", " Geminorum Aa", " Ursae Majoris A", " Cygni Aa", " Ursae Majoris", "2 Cephei", "1 Botis Aa", " Ursae Majoris A", " Pegasi", " Crateris", " Aurigae", " Andromedae A", " Leonis", " Gruis", "2 Sagittarii", " Orionis", " Orionis Aa", " Scorpii Aa1", " Hydrae", " Coronae Borealis", " Andromedae Aa", " Piscium A", " Draconis A", " Piscium A", "HD 161693", " Draconis", "31 Lyncis", " Velorum Aa", " Aquilae A", " Capricorni A", " Aquilae", " Draconis", " Leonis", " Canis Majoris", " Ursae Majoris Aa", " Ursae Majoris", "1 Serpentis A", " Geminorum", "HD 43197", "WASP-34", "WASP-52", " Aquarii", "2 Eridani", "HD 102956", " Phoenicis", " Vulpeculae", " Scorpii A", "HD 131496", " Botis", "2 Sagittarii", "1 Sagittarii", " Leporis A", " Sagittarii A", " Cancri Aa", " Cancri Aa", " Hydrae A", " Botis", " Botis", " Botis", " Carinae", "21 Tauri A", "WASP-64", " Draconis A", " Persei A", "27 Tauri Aa1", " Trianguli Australis", " Carinae A", "HD 224693", "HD 18742", "1 Cygni", " Eridani", " Puppis", "8 Ursae Minoris", "V2500 Ophiuchi", " Ceti Aa", "3 Eridani", "1 Eridani", "HD 181342", "HD 8574", " Orionis", "HAT-P-15", " Orionis Aa", "41 Arietis Aa", "HD 86081", " Pegasi", "HD 206610", " Arietis", " Librae A", "HD 38283", "HD 16175", " Aquarii A", " Carinae A", " Aurigae Aa", " Cassiopeiae A", " Geminorum Aa", "2 Cassiopeiae", " Ophiuchi", "HD 63454", "16 Tauri", " Arae", "47 Ursae Majoris", "2 Tauri Aa", "WASP-50", " Canum Venaticorum Aa", "HAT-P-5", "HD 192699", " Leonis", "HD 1502", "HD 52265", "HD 4208", "55 Cancri A", "2 Canum Venaticorum Aa", " Herculis A", " Eridani", "1 Capricorni Aa", " Fornacis A", " Cygni", " Capricorni Aa", " Leonis", " Comae Berenices A", "HD 96063", " Ceti", "WASP-17", "WASP-72", "HD 117618", "HAT-P-3", " Scorpii A", " Ursae Majoris A", "1 Draconis A", "HD 218566", " Draconis", "17 Tauri", " Virginis A", " Columbae", " Tauri Aa", " Draconis", "HD 7199", " Pegasi", " Cephei Aa", "42 Draconis A", " Scorpii Aa", " Cygni A", "HD 85951", "BD17 63", "HD 102195", " Piscis Austrini A", "HD 100655", "HAT-P-14", " Cassiopeiae", "HD 109246", " Piscium", " Canis Majoris Aa", "G Scorpii", " Crucis", "HD 73534", " Cephei", " Draconis", " Corvi A", " Crucis", "WASP-13", " Canis Minoris A", " Scorpii", " Draconis A", " Serpentis", "HD 179949", "36 Ophiuchi A", " Centauri Aa", " Aurigae", " Arietis", " Aurigae", " Orionis Aa", "51 Pegasi", " Virginis A", "HD 28678", " Pegasi A", "HAT-P-38", "HD 98219", "HAT-P-2", " Scorpii Aa", "HD 82886", " Crucis", "41 Lyncis", "HD 156411", "HD 20868", "WASP-38", "HD 208487", " Botis A", " Scorpii Aa", " Geminorum", " Ceti A", " Lupi", "HD 83443", "HD 145457", " Virginis", "HD 137388", " Sagittarii A", " Sagittarii", " Sagittarii", "HD 175541", " Lupi", "2 Eridani A", " Virginis A", " Equulei A", " Ursae Minoris", "HIP 12961", "XO-4", " Herculis Aa", " Corvi", " Draconis", " Cephei Aa", "Y Canum Venaticorum", " Scorpii", "HAT-P-42", " Scorpii", " Aquilae A", "PSR B1257+12", "HD 118203", "39 Arietis", "HD 212771", "HD 45350", "HD 45652", " Herculis", "HD 93083", "HD 32518", " Aurigae A", "HD 152581", "20 Tauri", "WASP-39", " Cassiopeiae", " Ophiuchi A", " Pegasi", " Velorum", "WASP-6", " Herculis A", " Pegasi Aa", "HAT-P-21", " Geminorum", " Ursae Majoris", " Orionis A", " Geminorum Aa", " Cancri Aa", " Aurigae Aa", " Ceti", " Centauri", " Persei", " Ursae Majoris", "38 Botis", " Coronae Australis", "23 Tauri Aa", "1 Arietis A", " Carinae", " Crucis", " Hydrae", " Virginis", " Orionis Aa", " Ceti Aa", " Andromedae", " Persei A", " Persei", " Canis Majoris", " Persei Aa", " Ursae Majoris Aa", "XO-1", "HD 130322", "WASP-79", "WASP-60", "HAT-P-23", " Trianguli", "HD 30856", "WASP-71", " Canis Majoris", " Botis Aa", " Ursae Majoris A", "18 Delphini", "HAT-P-29", " Cancri A", "WASP-62", " Puppis", "1 Sagittarii A", " Capricorni A", "HD 68988", "HD 85390", " Cassiopeiae", " Botis", "51 Andromedae", "HD 6434", "HD 49674", " Leporis A", "HD 136418", "HD 48265", " Sagittarii Aa", " Coronae Borealis A", "HD 17156", "WASP-15", "HD 149026", " Aquilae A", " Scorpii A", "WASP-32", " Pavonis Aa", "WASP-80", " Columbae", " Ursae Majoris Aa", " Ursae Minoris", "HD 192263", " Cancri", "HD 164604", "TrES-3", "2 Scorpii A", "28 Tauri Aa", "HD 221287", " Ursae Minoris", " Octantis", " Sagittarii Aa", " Geminorum", " Virginis A", "46 Leonis Minoris", " Tauri A", " Canis Minoris A", " Geminorum A", " Centauri C", " Eridani", "HD 153950", " Leonis", "1 Herculis Aa", " Ophiuchi A", " Draconis A", " Velorum", " Leonis A", " Piscium A", " Orionis A", " Centauri A", "HD 149143", " Delphini A", " Cassiopeiae Aa", " Sagittarii", " Ophiuchi A", " Aurigae A", " Aquarii Aa", " Pegasi", " Aquarii A", " Aquarii A", " Cygni A", "HD 100777", " Orionis", " Pegasi", "HD 205739", "HAT-P-34", " Scorpii A", " Herculis Aa", " Ursae Majoris", "53 Eridani A", " Pegasi", " Cassiopeiae", " Tauri Aa", " Cassiopeiae", " Botis Aa", " Sagittae", "HD 99109", "HIP 79431", " Scorpii Aa", " Lyrae Aa1", " Arietis A", "HD 181720", " Canis Majoris A", " Aquarii A", " Aquarii A", "BD+14 4559", " Virginis Aa", "HAT-P-6", "HD 75898", " Delphini Aa", " Leonis Aa", " Velorum", " Lyrae", " Virginis", "3 Orionis", "HAT-P-40", " Ursae Majoris", "8 Draconis", " Ursae Majoris Aa", "WASP-21", " Ursae Majoris A", " Ursae Majoris A", "HD 63765", " Aquilae", " Cancri A", "19 Tauri Aa", "1 Cancri A", " Geminorum Aa", " Sagittarii A", "HAT-P-9", " Orionis", "2 Eridani", " Draconis A", " Gruis", " Tauri A", "7 Draconis", "HD 148427", "WASP-161", " Andromedae A", "WASP-22", " Centauri B", "HD 104985", " Piscium A", "HAT-P-36", "HD 108147", "HD 23079", " Puppis A", " Hydrae", "HD 102117", " Serpentis", " Canis Majoris", "HD 231701", " Lyrae", "14 Andromedae A", " Virginis", " Geminorum Aa", " Columbae", " Canis Majoris Aa", " Phoenicis Aa", "1 Scorpii Aa", "HD 173416", " Botis", " Ophiuchi", " Ophiuchi", " Ursae Minoris", " Virginis Aa", " Eridani", " Virginis", "1 Hydrae A", " Eridani Aa", " Leonis", "2 Librae Aa", " Librae A", " Librae", "Phalacrocorax carbo", "Phalacrocorax urile", "Phalacrocorax pelagicus", "Egretta rufescens", "Egretta tricolor", "Egretta caerulea", "Egretta garzetta", "Egretta gularis", "Egretta thula", "Egretta eulophotes", "Ardea cinerea", "Ardea herodias", "Bubulcus ibis", "Ardeola bacchus", "Butorides striatus", "Butorides virescens", "Nyctanassa violacea", "Nycticorax nycticorax", "Ixobrychus sinensis", "Ixobrychus exilis", "Botaurus lentiginosus", "Phoenicopterus ruber", "Eudocimus albus", "Eudocimus ruber", "Plegadis falcinellus", "Plegadis chihi", "Ajaia ajaja", "Pelecanus erythrorhynchos", "Pelecanus occidentalis", "Coragyps atratus", "Cathartes aura", "Gymnogyps californianus", "Mycteria americana", "Jabiru mycteria", "Fregata magnificens", "Fregata minor", "Gavia stellata", "Gavia arctica", "Gavia pacifica", "Gavia immer", "Gavia adamsii", "Fulmarus glacialis", "Daption capense", "Pterodroma inexpectata", "Pterodroma cookii", "Pterodroma longirostris", "Pterodroma ultima", "Pterodroma macroptera", "Pterodroma feae", "Pterodroma hasitata", "Bulweria bulwerii", "Procellaria aequinoctialis", "Calonectris diomedea", "Puffinus pacificus", "Puffinus bulleri", "Puffinus carneipes", "Puffinus creatopus", "Puffinus gravis", "Puffinus griseus", "Puffinus tenuirostris", "Puffinus puffinus", "Puffinus opisthomelas", "Puffinus lherminieri", "Puffinus assimilis", "Diomedea exulans", "Oceanites oceanicus", "Pelagodroma marina", "Fregetta tropica", "Oceanodroma microsoma", "Oceanodroma tethys", "Oceanodroma castro", "Oceanodroma leucorhoa", "Oceanodroma melania", "Oceanodroma homochroa", "Oceanodroma hornbyi", "Oceanodroma furcata", "Camptostoma imberbe", "Myiopagis viridicata", "Mitrephanes phaeocercus", "Contopus pertinax", "Contopus sordidulus", "Contopus virens", "Contopus caribaeus", "Empidonax flaviventris", "Empidonax virescens", "Empidonax alnorum", "Empidonax traillii", "Empidonax minimus", "Empidonax hammondii", "Empidonax wrightii", "Empidonax oberholseri", "Empidonax difficilis", "Empidonax occidentalis", "Empidonax fulvifrons", "Sayornis phoebe", "Sayornis saya", "Sayornis nigricans", "Pyrocephalus rubinus", "Myiarchus tuberculifer", "Myiarchus cinerascens", "Myiarchus nuttingi", "Myiarchus crinitus", "Myiarchus tyrannulus", "Myiarchus sagrae", "Tyrannus melancholicus", "Tyrannus couchii", "Tyrannus vociferans", "Tyrannus crassirostris", "Tyrannus verticalis", "Tyrannus forficatus", "Tyrannus savana", "Tyrannus tyrannus", "Tyrannus dominicensis", "Empidonomus varius", "Myiodynastes luteiventris", "Myiozetetes similis", "Legatus leucophaius", "Pitangus sulphuratus", "Pachyramphus aglaiae", "Tityra semifasciata", "Lanius cristatus", "Lanius ludovicianus", "Lanius excubitor", "Vireo bellii", "Vireo atricapillus", "Vireo huttoni", "Vireo griseus", "Vireo crassirostris", "Vireo vicinior", "Vireo cassinii", "Vireo plumbeus", "Vireo solitarius", "Vireo flavifrons", "Vireo philadelphicus", "Vireo olivaceus", "Vireo flavoviridis", "Vireo altiloquus", "Vireo magister", "Vireo gilvus", "Gymnorhinus cyanocephalus", "Cyanocitta cristata", "Cyanocitta stelleri", "Aphelocoma insularis", "Aphelocoma californica", "Aphelocoma coerulescens", "Aphelocoma ultramarina", "Cyanocorax yncas", "Psilorhinus morio", "Perisoreus canadensis", "Pica pica", "Pica nuttalli", "Nucifraga columbiana", "Corvus monedula", "Corvus caurinus", "Corvus brachyrhynchos", "Corvus ossifragus", "Corvus imparatus", "Corvus cryptoleucus", "Corvus corax", "Lalage leucomela", "Ptilogonys cinereus", "Phainopepla nitens", "Bombycilla garrulus", "Bombycilla cedrorum", "Cinclus mexicanus", "Zoothera naevia", "Zoothera pinicola", "Sialia sialis", "Sialia mexicana", "Sialia currucoides", "Myadestes townsendi", "Myadestes occidentalis", "Catharus gracilirostris", "Catharus aurantiirostris", "Catharus fuscescens", "Catharus minimus", "Catharus ustulatus", "Catharus guttatus", "Hylocichla mustelina", "Turdus obscurus", "Turdus naumanni", "Turdus pilaris", "Turdus iliacus", "Turdus grayi", "Turdus rufopalliatus", "Turdus migratorius", "Muscicapa striata", "Muscicapa griseisticta", "Muscicapa sibirica", "Muscicapa dauurica", "Ficedula narcissina", "Ficedula mugimaki", "Ficedula parva", "Luscinia sibilans", "Luscinia calliope", "Luscinia svecica", "Luscinia cyane", "Tarsiger cyanurus", "Irania gutturalis", "Saxicola torquata", "Oenanthe oenanthe", "Sturnus vulgaris", "Acridotheres tristis", "Acridotheres grandis", "Dumetella carolinensis", "Melanoptila glabrirostris", "Melanotis caerulescens", "Mimus polyglottos", "Mimus gundlachii", "Oreoscoptes montanus", "Toxostoma rufum", "Toxostoma longirostre", "Toxostoma bendirei", "Toxostoma curvirostre", "Toxostoma lecontei", "Toxostoma redivivum", "Toxostoma crissale", "Sitta pygmaea", "Sitta pusilla", "Sitta canadensis", "Sitta carolinensis", "Certhia americana", "Campylorhynchus brunneicapillus", "Salpinctes obsoletus", "Catherpes mexicanus", "Cistothorus platensis", "Cistothorus palustris", "Thryomanes bewickii", "Thryothorus ludovicianus", "Troglodytes troglodytes", "Troglodytes aedon", "Auriparus flaviceps", "Polioptila caerulea", "Polioptila californica", "Polioptila melanura", "Polioptila nigriceps", "Poecile carolinensis", "Poecile atricapillus", "Poecile gambeli", "Poecile sclateri", "Poecile cinctus", "Poecile hudsonicus", "Poecile rufescens", "Parus major", "Baeolophus wollweberi", "Baeolophus inornatus", "Baeolophus bicolor", "Baeolophus atricristatus", "Psaltriparus minimus", "Tachycineta bicolor", "Tachycineta albilinea", "Tachycineta thalassina", "Tachycineta cyaneoviridis", "Progne subis", "Progne cryptoleuca", "Progne chalybea", "Progne modesta", "Stelgidopteryx serripennis", "Riparia riparia", "Hirundo rustica", "Petrochelidon pyrrhonota", "Petrochelidon fulva", "Delichon urbica", "Regulus calendula", "Regulus satrapa", "Pycnonotus jocosus", "Locustella lanceolata", "Locustella ochotensis", "Phylloscopus trochilus", "Phylloscopus sibilatrix", "Phylloscopus fuscatus", "Phylloscopus proregulus", "Phylloscopus inornatus", "Phylloscopus borealis", "Chamaea fasciata", "Sylvia curruca", "Alauda arvensis", "Eremophila alpestris", "Passer domesticus", "Passer montanus", "Motacilla alba", "Motacilla lugens", "Motacilla citreola", "Motacilla flava", "Motacilla cinerea", "Anthus trivialis", "Anthus hodgsoni", "Anthus gustavi", "Anthus cervinus", "Anthus spinoletta", "Anthus rubescens", "Anthus spragueii", "Prunella montanella", "Ploceus golandi", "Peucedramus taeniatus", "Fringilla coelebs", "Fringilla montifringilla", "Carduelis sinica", "Carduelis spinus", "Carduelis pinus", "Carduelis tristis", "Carduelis psaltria", "Carduelis lawrencei", "Carduelis carduelis", "Carduelis hornemanni", "Carduelis flammea", "Leucosticte tephrocotis", "Leucosticte atrata", "Leucosticte australis", "Carpodacus purpureus", "Carpodacus erythrinus", "Carpodacus cassinii", "Carpodacus mexicanus", "Pinicola enucleator", "Loxia curvirostra", "Loxia leucoptera", "Pyrrhula pyrrhula", "Coccothraustes coccothraustes", "Hesperiphona vespertina", "Emberiza leucocephalos", "Emberiza pusilla", "Emberiza rustica", "Emberiza elegans", "Emberiza aureola", "Emberiza variabilis", "Emberiza pallasi", "Emberiza schoeniclus", "Calcarius mccownii", "Calcarius lapponicus", "Calcarius pictus", "Calcarius ornatus", "Plectrophenax nivalis", "Plectrophenax hyperboreus", "Calamospiza melanocorys", "Passerella iliaca", "Melospiza melodia", "Melospiza lincolnii", "Melospiza georgiana", "Zonotrichia querula", "Zonotrichia albicollis", "Zonotrichia leucophrys", "Zonotrichia atricapilla", "Junco hyemalis", "Junco phaeonotus", "Passerculus sandwichensis", "Ammodramus maritimus", "Ammodramus caudacutus", "Ammodramus leconteii", "Ammodramus henslowii", "Ammodramus bairdii", "Ammodramus savannarum", "Spizella arborea", "Spizella passerina", "Spizella pallida", "Spizella breweri", "Spizella pusilla", "Spizella wortheni", "Spizella atrogularis", "Pooecetes gramineus", "Chondestes grammacus", "Amphispiza bilineata", "Amphispiza belli", "Aimophila quinquestriata", "Aimophila aestivalis", "Aimophila botterii", "Aimophila cassinii", "Aimophila carpalis", "Aimophila ruficeps", "Pipilo chlorurus", "Pipilo erythrophthalmus", "Pipilo aberti", "Pipilo crissalis", "Pipilo fuscus", "Arremonops rufivirgatus", "Vermivora bachmanii", "Vermivora pinus", "Vermivora chrysoptera", "Vermivora peregrina", "Vermivora celata", "Vermivora ruficapilla", "Vermivora virginiae", "Vermivora crissalis", "Vermivora luciae", "Parula americana", "Parula pitiayumi", "Parula superciliosa", "Dendroica petechia", "Dendroica pensylvanica", "Dendroica magnolia", "Dendroica tigrina", "Dendroica caerulescens", "Dendroica coronata", "Dendroica nigrescens", "Dendroica townsendi", "Dendroica occidentalis", "Dendroica virens", "Dendroica chrysoparia", "Dendroica fusca", "Dendroica dominica", "Dendroica graciae", "Dendroica pinus", "Dendroica kirtlandii", "Dendroica discolor", "Dendroica palmarum", "Dendroica castanea", "Dendroica striata", "Dendroica cerulea", "Mniotilta varia", "Setophaga ruticilla", "Protonotaria citrea", "Helmitheros vermivorus", "Limnothlypis swainsonii", "Seiurus aurocapillus", "Seiurus noveboracensis", "Seiurus motacilla", "Oporornis formosus", "Oporornis agilis", "Oporornis philadelphia", "Oporornis tolmiei", "Geothlypis trichas", "Geothlypis nelsoni", "Geothlypis poliocephala", "Wilsonia citrina", "Wilsonia pusilla", "Wilsonia canadensis", "Cardellina rubrifrons", "Myioborus pictus", "Myioborus miniatus", "Euthlypis lachrymosa", "Basileuterus culicivorus", "Basileuterus rufifrons", "Icteria virens", "Coereba flaveola", "Piranga bidentata", "Piranga flava", "Piranga rubra", "Piranga olivacea", "Piranga ludoviciana", "Spindalis zena", "Poospiza lateralis", "Sporophila torqueola", "Tiaris olivacea", "Tiaris bicolor", "Spiza americana", "Pheucticus chrysopeplus", "Pheucticus ludovicianus", "Pheucticus melanocephalus", "Cardinalis cardinalis", "Cardinalis sinuatus", "Rhodothraupis celaeno", "Cyanocompsa parellina", "Guiraca caerulea", "Passerina amoena", "Passerina cyanea", "Passerina versicolor", "Passerina ciris", "Passerina rositae", "Icterus graduacauda", "Icterus pectoralis", "Icterus gularis", "Icterus pustulatus", "Icterus galbula", "Icterus cucullatus", "Icterus spurius", "Icterus wagleri", "Icterus parisorum", "Xanthocephalus xanthocephalus", "Agelaius cyanopus", "Agelaius phoeniceus", "Agelaius tricolor", "Agelaius humeralis", "Sturnella magna", "Sturnella neglecta", "Quiscalus mexicanus", "Quiscalus major", "Quiscalus quiscula", "Euphagus carolinus", "Euphagus cyanocephalus", "Molothrus bonariensis", "Molothrus aeneus", "Molothrus ater", "Dolichonyx oryzivorus", "Falcipennis canadensis", "Nomonyx dominica", "Branta hutchinsii", "Picoides dorsalis", "Tyto detorta", "Otus sunia", "Phalaropus tricolor", "Catharacta skua", "Catharacta maccormicki", "Larus brachyrhynchus", "Brachyramphus perdix", "Buteo nitidus", "Caracara plancus", "Caracara cheriway", "Sula granti", "Ardea alba", "Ardea intermedia", "Pterodroma heraldica", "Phoebastria albatrus", "Phoebastria nigripes", "Phoebastria immutabilis", "Thalassarche melanophris", "Thalassarche cauta", "Thalassarche chlororhynchos", "Contopus cooperi", "Cyanocorax luxuosus", "Catharus bicknelli", "Parus ridgwayi", "Progne tapera", "Ammodramus nelsoni", "Pipilo maculatus", "Icterus bullockii", "Icterus abeillei"]


let placenames = ["Elegant Crested-Tinamou", "Plain Chachalaca", "Himalayan Snowcock", "Rock Partridge", "Chukar", "Grey Partridge", "Common Quail", "Common Pheasant", "Indian Peafowl", "Dusky Grouse", "Sooty Grouse", "Willow Ptarmigan", "Rock Ptarmigan", "White-tailed Ptarmigan", "Ruffed Grouse", "Sage Grouse", "Gunnison Sage-Grouse", "Sharp-tailed Grouse", "Greater Prairie-chicken", "Lesser Prairie-chicken", "Wild Turkey", "Mountain Quail", "Scaled Quail", "California Quail", "Gambel's Quail", "Northern Bobwhite", "Montezuma Quail", "Fulvous Whistling-Duck", "Black-bellied Whistling-Duck", "Ruddy Duck", "Mute Swan", "Whooper Swan", "Trumpeter Swan", "Tundra Swan", "Pink-footed Goose", "Bean Goose", "Greater White-fronted Goose", "Lesser White-fronted Goose", "Snow Goose", "Ross's Goose", "Emperor Goose", "Canada Goose", "Barnacle Goose", "Brent Goose", "Muscovy Duck", "Wood Duck", "Gadwall", "Falcated Teal", "Eurasian Wigeon", "American Wigeon", "American Black Duck", "Mottled Duck", "Mallard", "Spot-billed Duck", "Blue-winged Teal", "Cinnamon Teal", "Red Shoveler", "Northern Shoveler", "White-cheeked Pintail", "Northern Pintail", "Garganey", "Baikal Teal", "Common Teal", "Common Pochard", "Canvasback", "Redhead", "Ring-necked Duck", "Tufted Duck", "Greater Scaup", "Lesser Scaup", "Common Eider", "King Eider", "Spectacled Eider", "Steller's Eider", "Labrador Duck", "Harlequin Duck", "Long-tailed Duck", "Black Scoter", "Surf Scoter", "White-winged Scoter", "Common Goldeneye", "Barrow's Goldeneye", "Bufflehead", "Smew", "Hooded Merganser", "Red-breasted Merganser", "Common Merganser", "Lark Buttonquail", "Eurasian Wryneck", "Lewis's Woodpecker", "Red-headed Woodpecker", "Acorn Woodpecker", "Gila Woodpecker", "Red-bellied Woodpecker", "Golden-fronted Woodpecker", "Yellow-bellied Sapsucker", "Red-naped Sapsucker", "Red-breasted Sapsucker", "Williamson's Sapsucker", "Great Spotted Woodpecker", "Nuttall's Woodpecker", "Ladder-backed Woodpecker", "Downy Woodpecker", "Red-cockaded Woodpecker", "Strickland's Woodpecker", "Hairy Woodpecker", "White-headed Woodpecker", "Three-toed Woodpecker", "Black-backed Woodpecker", "Northern Flicker", "Gilded Flicker", "Pileated Woodpecker", "Ivory-billed Woodpecker", "Eurasian Hoopoe", "Eared Trogon", "Elegant Trogon", "Belted Kingfisher", "Ringed Kingfisher", "Green Kingfisher", "Common Cuckoo", "Oriental Cuckoo", "Black-billed Cuckoo", "Yellow-billed Cuckoo", "Mangrove Cuckoo", "Dark-billed Cuckoo", "Smooth-billed Ani", "Groove-billed Ani", "Greater Roadrunner", "Budgerigar", "Green Parakeet", "Nanday Parakeet", "Thick-billed Parrot", "Carolina Parakeet", "Monk Parakeet", "Canary-winged Parakeet", "Red-crowned Parrot", "Black Swift", "White-collared Swift", "White-throated Needletail", "Chimney Swift", "Vaux's Swift", "White-throated Swift", "Antillean Palm-Swift", "Common Swift", "Fork-tailed Swift", "Green Violet-ear", "Green-breasted Mango", "Broad-billed Hummingbird", "Xantus's Hummingbird", "White-eared Hummingbird", "Berylline Hummingbird", "Cinnamon Hummingbird", "Buff-bellied Hummingbird", "Violet-crowned Hummingbird", "Blue-throated Hummingbird", "Magnificent Hummingbird", "Green-tailed Trainbearer", "Plain-capped Starthroat", "Lucifer Hummingbird", "Ruby-throated Hummingbird", "Black-chinned Hummingbird", "Anna's Hummingbird", "Costa's Hummingbird", "Calliope Hummingbird", "Bumblebee Hummingbird", "Broad-tailed Hummingbird", "Rufous Hummingbird", "Allen's Hummingbird", "Barn Owl", "Flammulated Owl", "Western Screech-Owl", "Eastern Screech-Owl", "Whiskered Screech-Owl", "Great Horned Owl", "Snowy Owl", "Spotted Owl", "Barred Owl", "Great Grey Owl", "Mottled Owl", "Northern Hawk Owl", "Northern Pygmy-Owl", "Mountain Pygmy-Owl", "Ferruginous Pygmy-Owl", "Elf Owl", "Spotted Owlet", "Burrowing Owl", "Boreal Owl", "Saw-whet Owl", "Stygian Owl", "Long-eared Owl", "Short-eared Owl", "Barred Owlet-Nightjar", "Lesser Nighthawk", "Common Nighthawk", "Antillean Nighthawk", "Pauraque", "Common Poorwill", "Chuck-will's-widow", "Buff-collared Nightjar", "Whip-poor-will", "Grey Nightjar", "Rock Dove", "White-crowned Pigeon", "Scaly-naped Pigeon", "Band-tailed Pigeon", "Red-billed Pigeon", "European Turtle-Dove", "Oriental Turtle-Dove", "Spotted Dove", "Eurasian Collared-Dove", "White-winged Collared-Dove", "Passenger Pigeon", "Mourning Dove", "Zenaida Dove", "White-winged Dove", "Inca Dove", "Common Ground-Dove", "Ruddy Ground-Dove", "White-tipped Dove", "Key West Quail-Dove", "Ruddy Quail-Dove", "Sandhill Crane", "Demoiselle Crane", "Common Crane", "Whooping Crane", "Limpkin", "Yellow Rail", "Black Rail", "Clapper Rail", "King Rail", "Virginia Rail", "Corn Crake", "Baillon's Crake", "Sora", "Hawaiian Crake", "Paint-billed Crake", "Spotted Rail", "Purple Swamphen", "Purple Gallinule", "Azure Gallinule", "Common Moorhen", "American Coot", "Eurasian Woodcock", "American Woodcock", "Pintail Snipe", "Common Snipe", "Jack Snipe", "Black-tailed Godwit", "Hudsonian Godwit", "Bar-tailed Godwit", "Marbled Godwit", "Little Curlew", "Eskimo Curlew", "Whimbrel", "Bristle-thighed Curlew", "Slender-billed Curlew", "Eurasian Curlew", "Long-billed Curlew", "Far Eastern Curlew", "Upland Sandpiper", "Spotted Redshank", "Common Redshank", "Marsh Sandpiper", "Common Greenshank", "Greater Yellowlegs", "Lesser Yellowlegs", "Solitary Sandpiper", "Green Sandpiper", "Wood Sandpiper", "Terek Sandpiper", "Common Sandpiper", "Spotted Sandpiper", "Grey-tailed Tattler", "Wandering Tattler", "Willet", "Ruddy Turnstone", "Black Turnstone", "Short-billed Dowitcher", "Long-billed Dowitcher", "Surfbird", "Great Knot", "Red Knot", "Sanderling", "Semipalmated Sandpiper", "Western Sandpiper", "Little Stint", "Red-necked Stint", "Temminck's Stint", "Long-toed Stint", "Least Sandpiper", "White-rumped Sandpiper", "Baird's Sandpiper", "Pectoral Sandpiper", "Sharp-tailed Sandpiper", "Purple Sandpiper", "Rock Sandpiper", "Dunlin", "Curlew Sandpiper", "Stilt Sandpiper", "Buff-breasted Sandpiper", "Spoonbill Sandpiper", "Broad-billed Sandpiper", "Ruff", "Red-necked Phalarope", "Red Phalarope", "Northern Jacana", "Double-striped Thick-knee", "Black Oystercatcher", "American Oystercatcher", "Black-winged Stilt", "Black Stilt", "Black-necked Stilt", "American Avocet", "European Golden-Plover", "Pacific Golden-Plover", "American Golden-Plover", "Grey Plover", "Common Ringed Plover", "Semipalmated Plover", "Little Ringed Plover", "Wilson's Plover", "Killdeer", "Piping Plover", "Kentish Plover", "Collared Plover", "Mongolian Plover", "Greater Sand Plover", "Mountain Plover", "Eurasian Dotterel", "Northern Lapwing", "Oriental Pratincole", "Rock Pratincole", "Pomarine Jaeger", "Parasitic Jaeger", "Long-tailed Jaeger", "Black Skimmer", "Band-tailed Gull", "Black-tailed Gull", "Heermann's Gull", "Common Gull", "Ring-billed Gull", "California Gull", "Great Black-backed Gull", "Kelp Gull", "Glaucous-winged Gull", "Western Gull", "Yellow-footed Gull", "Glaucous Gull", "Iceland Gull", "Herring Gull", "Slaty-backed Gull", "Yellow-legged Gull", "Lesser Black-backed Gull", "Great Black-headed Gull", "Grey-headed Gull", "Black-headed Gull", "Bonaparte's Gull", "Thayer's Gull", "Laughing Gull", "Franklin's Gull", "Little Gull", "Ivory Gull", "Ross's Gull", "Sabine's Gull", "Swallow-tailed Gull", "Black-legged Kittiwake", "Red-legged Kittiwake", "Gull-billed Tern", "Caspian Tern", "Royal Tern", "Elegant Tern", "Sandwich Tern", "Roseate Tern", "Common Tern", "Arctic Tern", "Forster's Tern", "Least Tern", "Aleutian Tern", "Bridled Tern", "Sooty Tern", "White-winged Tern", "Black Tern", "Large-billed Tern", "Brown Noddy", "Black Noddy", "Dovekie", "Common Murre", "Thick-billed Murre", "Razorbill", "Great Auk", "Black Guillemot", "Pigeon Guillemot", "Marbled Murrelet", "Kittlitz's Murrelet", "Xantus's Murrelet", "Craveri's Murrelet", "Ancient Murrelet", "Cassin's Auklet", "Parakeet Auklet", "Crested Auklet", "Whiskered Auklet", "Least Auklet", "Rhinoceros Auklet", "Atlantic Puffin", "Horned Puffin", "Tufted Puffin", "Osprey", "Hook-billed Kite", "Swallow-tailed Kite", "Black-shouldered Kite", "White-tailed Kite", "Snail Kite", "Rufous-thighed Kite", "Mississippi Kite", "White-tailed Eagle", "Bald Eagle", "Steller's Sea-Eagle", "Western Marsh-Harrier", "Northern Harrier", "Chinese Goshawk", "Sharp-shinned Hawk", "Cooper's Hawk", "Northern Goshawk", "Crane Hawk", "Common Black-Hawk", "Harris's Hawk", "Roadside Hawk", "Red-shouldered Hawk", "Broad-winged Hawk", "Short-tailed Hawk", "Swainson's Hawk", "White-tailed Hawk", "Zone-tailed Hawk", "Red-tailed Hawk", "Common Buzzard", "Ferruginous Hawk", "Rough-legged Hawk", "Golden Eagle", "Collared Forest-Falcon", "Common Kestrel", "American Kestrel", "Aplomado Falcon", "Merlin", "Eurasian Hobby", "Gyrfalcon", "Prairie Falcon", "Peregrine Falcon", "Least Grebe", "Pied-billed Grebe", "Red-necked Grebe", "Horned Grebe", "Black-necked Grebe", "Western Grebe", "Clark's Grebe", "Red-billed Tropicbird", "Red-tailed Tropicbird", "White-tailed Tropicbird", "Northern Gannet", "Blue-footed Booby", "Masked Booby", "Red-footed Booby", "Brown Booby", "Anhinga", "Brandt's Cormorant", "Neotropic Cormorant", "Double-crested Cormorant", "Great Cormorant", "Red-faced Cormorant", "Pelagic Cormorant", "Reddish Egret", "Tricolored Heron", "Little Blue Heron", "Little Egret", "Western Reef-Egret", "Snowy Egret", "Chinese Egret", "Grey Heron", "Great Blue Heron", "Cattle Egret", "Chinese Pond-Heron", "Striated Heron", "Green Heron", "Yellow-crowned Night-Heron", "Black-crowned Night-Heron", "Yellow Bittern", "Least Bittern", "American Bittern", "Greater Flamingo", "White Ibis", "Scarlet Ibis", "Glossy Ibis", "White-faced Ibis", "Roseate Spoonbill", "American White Pelican", "Brown Pelican", "Black Vulture", "Turkey Vulture", "California Condor", "Wood Stork", "Jabiru", "Magnificent Frigatebird", "Great Frigatebird", "Red-throated Loon", "Arctic Loon", "Pacific Loon", "Common Loon", "Yellow-billed Loon", "Northern Fulmar", "Cape Petrel", "Mottled Petrel", "Cook's Petrel", "Stejneger's Petrel", "Murphy's Petrel", "Great-winged Petrel", "Fea's Petrel", "Black-capped Petrel", "Bulwer's Petrel", "White-chinned Petrel", "Cory's Shearwater", "Wedge-tailed Shearwater", "Buller's Shearwater", "Flesh-footed Shearwater", "Pink-footed Shearwater", "Great Shearwater", "Sooty Shearwater", "Short-tailed Shearwater", "Manx Shearwater", "Black-vented Shearwater", "Audubon's Shearwater", "Little Shearwater", "Wandering Albatross", "Wilson's Storm-Petrel", "White-faced Storm-Petrel", "Black-bellied Storm-Petrel", "Least Storm-Petrel", "Wedge-rumped Storm-Petrel", "Band-rumped Storm-Petrel", "Leach's Storm-Petrel", "Black Storm-Petrel", "Ashy Storm-Petrel", "Ringed Storm-Petrel", "Fork-tailed Storm-Petrel", "Northern Beardless-Tyrannulet", "Greenish Elaenia", "Tufted Flycatcher", "Greater Pewee", "Western Wood-Pewee", "Eastern Wood-Pewee", "Cuban Pewee", "Yellow-bellied Flycatcher", "Acadian Flycatcher", "Alder Flycatcher", "Willow Flycatcher", "Least Flycatcher", "Hammond's Flycatcher", "Grey Flycatcher", "Dusky Flycatcher", "Pacific-slope Flycatcher", "Cordilleran Flycatcher", "Buff-breasted Flycatcher", "Eastern Phoebe", "Say's Phoebe", "Black Phoebe", "Vermilion Flycatcher", "Dusky-capped Flycatcher", "Ash-throated Flycatcher", "Nutting's Flycatcher", "Great Crested Flycatcher", "Brown-crested Flycatcher", "La Sagra's Flycatcher", "Tropical Kingbird", "Couch's Kingbird", "Cassin's Kingbird", "Thick-billed Kingbird", "Western Kingbird", "Scissor-tailed Flycatcher", "Fork-tailed Flycatcher", "Eastern Kingbird", "Grey Kingbird", "Variegated Flycatcher", "Sulphur-bellied Flycatcher", "Social Flycatcher", "Piratic Flycatcher", "Great Kiskadee", "Rose-throated Becard", "Masked Tityra", "Brown Shrike", "Loggerhead Shrike", "Northern Shrike", "Bell's Vireo", "Black-capped Vireo", "Hutton's Vireo", "White-eyed Vireo", "Thick-billed Vireo", "Grey Vireo", "Cassin's Vireo", "Plumbeous Vireo", "Blue-headed Vireo", "Yellow-throated Vireo", "Philadelphia Vireo", "Red-eyed Vireo", "Yellow-green Vireo", "Black-whiskered Vireo", "Yucatan Vireo", "Eastern Warbling-Vireo", "Pinyon Jay", "Blue Jay", "Steller's Jay", "Island Scrub-Jay", "Western Scrub-Jay", "Florida Scrub-Jay", "Mexican Jay", "Inca Jay", "Brown Jay", "Grey Jay", "Black-billed Magpie", "Yellow-billed Magpie", "Clark's Nutcracker", "Eurasian Jackdaw", "Northwestern Crow", "American Crow", "Fish Crow", "Tamaulipas Crow", "Chihuahuan Raven", "Common Raven", "Varied Triller", "Grey Silky-flycatcher", "Phainopepla", "Bohemian Waxwing", "Cedar Waxwing", "American Dipper", "Varied Thrush", "Aztec Thrush", "Eastern Bluebird", "Western Bluebird", "Mountain Bluebird", "Townsend's Solitaire", "Brown-backed Solitaire", "Black-billed Nightingale-Thrush", "Orange-billed Nightingale-Thrush", "Veery", "Grey-cheeked Thrush", "Swainson's Thrush", "Hermit Thrush", "Wood Thrush", "Eyebrowed Thrush", "Dusky Thrush", "Fieldfare", "Redwing", "Clay-colored Thrush", "Rufous-backed Thrush", "American Robin", "Spotted Flycatcher", "Grey-streaked Flycatcher", "Dark-sided Flycatcher", "Asian Brown Flycatcher", "Narcissus Flycatcher", "Mugimaki Flycatcher", "Red-breasted Flycatcher", "Rufous-tailed Robin", "Siberian Rubythroat", "Bluethroat", "Siberian Blue Robin", "Red-flanked Bluetail", "White-throated Robin", "Common Stonechat", "Northern Wheatear", "Common Starling", "Common Myna", "White-vented Myna", "Grey Catbird", "Black Catbird", "Blue Mockingbird", "Northern Mockingbird", "Bahama Mockingbird", "Sage Thrasher", "Brown Thrasher", "Long-billed Thrasher", "Bendire's Thrasher", "Curve-billed Thrasher", "Le Conte's Thrasher", "California Thrasher", "Crissal Thrasher", "Pygmy Nuthatch", "Brown-headed Nuthatch", "Red-breasted Nuthatch", "White-breasted Nuthatch", "Brown Creeper", "Cactus Wren", "Rock Wren", "Canyon Wren", "Sedge Wren", "Marsh Wren", "Bewick's Wren", "Carolina Wren", "Winter Wren", "House Wren", "Verdin", "Blue-grey Gnatcatcher", "California Gnatcatcher", "Black-tailed Gnatcatcher", "Black-capped Gnatcatcher", "Carolina Chickadee", "Black-capped Chickadee", "Mountain Chickadee", "Mexican Chickadee", "Siberian Tit", "Boreal Chickadee", "Chestnut-backed Chickadee", "Great Tit", "Bridled Titmouse", "Plain Titmouse", "Tufted Titmouse", "Black-crested Titmouse", "Bushtit", "Tree Swallow", "Mangrove Swallow", "Violet-green Swallow", "Bahama Swallow", "Purple Martin", "Cuban Martin", "Grey-breasted Martin", "Southern Martin", "Northern Rough-winged Swallow", "Sand Martin", "Barn Swallow", "Cliff Swallow", "Cave Swallow", "Northern House-Martin", "Ruby-crowned Kinglet", "Golden-crowned Kinglet", "Red-whiskered Bulbul", "Lanceolated Warbler", "Middendorff's Grasshopper-Warbler", "Willow Warbler", "Wood Warbler", "Dusky Warbler", "Pallas's Leaf-Warbler", "Inornate Warbler", "Arctic Warbler", "Wrentit", "Lesser Whitethroat", "Sky Lark", "Horned Lark", "House Sparrow", "Eurasian Tree Sparrow", "White Wagtail", "Black-backed Wagtail", "Citrine Wagtail", "Yellow Wagtail", "Grey Wagtail", "Tree Pipit", "Olive-backed Pipit", "Pechora Pipit", "Red-throated Pipit", "Water Pipit", "American Pipit", "Sprague's Pipit", "Siberian Accentor", "Clarke's Weaver", "Olive Warbler", "Chaffinch", "Brambling", "Grey-capped Greenfinch", "Eurasian Siskin", "Pine Siskin", "American Goldfinch", "Lesser Goldfinch", "Lawrence's Goldfinch", "European Goldfinch", "Hoary Redpoll", "Common Redpoll", "Grey-crowned Rosy-Finch", "Black Rosy-Finch", "Brown-capped Rosy-Finch", "Purple Finch", "Common Rosefinch", "Cassin's Finch", "House Finch", "Pine Grosbeak", "Red Crossbill", "White-winged Crossbill", "Eurasian Bullfinch", "Hawfinch", "Evening Grosbeak", "Pine Bunting", "Little Bunting", "Rustic Bunting", "Yellow-throated Bunting", "Yellow-breasted Bunting", "Grey Bunting", "Pallas's Bunting", "Reed Bunting", "McCown's Longspur", "Lapland Longspur", "Smith's Longspur", "Chestnut-collared Longspur", "Snow Bunting", "McKay's Bunting", "Lark Bunting", "Fox Sparrow", "Song Sparrow", "Lincoln's Sparrow", "Swamp Sparrow", "Harris's Sparrow", "White-throated Sparrow", "White-crowned Sparrow", "Golden-crowned Sparrow", "Dark-eyed Junco", "Yellow-eyed Junco", "Savannah Sparrow", "Seaside Sparrow", "Saltmarsh Sharp-tailed Sparrow", "Le Conte's Sparrow", "Henslow's Sparrow", "Baird's Sparrow", "Grasshopper Sparrow", "American Tree Sparrow", "Chipping Sparrow", "Clay-colored Sparrow", "Brewer's Sparrow", "Field Sparrow", "Worthen's Sparrow", "Black-chinned Sparrow", "Vesper Sparrow", "Lark Sparrow", "Black-throated Sparrow", "Sage Sparrow", "Five-striped Sparrow", "Bachman's Sparrow", "Botteri's Sparrow", "Cassin's Sparrow", "Rufous-winged Sparrow", "Rufous-crowned Sparrow", "Green-tailed Towhee", "Eastern Towhee", "Abert's Towhee", "California Towhee", "Canyon Towhee", "Olive Sparrow", "Bachman's Warbler", "Blue-winged Warbler", "Golden-winged Warbler", "Tennessee Warbler", "Orange-crowned Warbler", "Nashville Warbler", "Virginia's Warbler", "Colima Warbler", "Lucy's Warbler", "Northern Parula", "Tropical Parula", "Crescent-chested Warbler", "Yellow Warbler", "Chestnut-sided Warbler", "Magnolia Warbler", "Cape May Warbler", "Black-throated Blue Warbler", "Yellow-rumped Warbler", "Black-throated Grey Warbler", "Townsend's Warbler", "Hermit Warbler", "Black-throated Green Warbler", "Golden-cheeked Warbler", "Blackburnian Warbler", "Yellow-throated Warbler", "Grace's Warbler", "Pine Warbler", "Kirtland's Warbler", "Prairie Warbler", "Palm Warbler", "Bay-breasted Warbler", "Blackpoll Warbler", "Cerulean Warbler", "Black-and-white Warbler", "American Redstart", "Prothonotary Warbler", "Worm-eating Warbler", "Swainson's Warbler", "Ovenbird", "Northern Waterthrush", "Louisiana Waterthrush", "Kentucky Warbler", "Connecticut Warbler", "Mourning Warbler", "MacGillivray's Warbler", "Common Yellowthroat", "Hooded Yellowthroat", "Grey-crowned Yellowthroat", "Hooded Warbler", "Wilson's Warbler", "Canada Warbler", "Red-faced Warbler", "Painted Redstart", "Slate-throated Redstart", "Fan-tailed Warbler", "Golden-crowned Warbler", "Rufous-capped Warbler", "Yellow-breasted Chat", "Bananaquit", "Flame-colored Tanager", "Hepatic Tanager", "Summer Tanager", "Scarlet Tanager", "Westfern Tanager", "Stripe-headed Tanager", "Red-rumped Warbling-Finch", "White-collared Seedeater", "Yellow-faced Grassquit", "Black-faced Grassquit", "Dickcissel", "Yellow Grosbeak", "Rose-breasted Grosbeak", "Black-headed Grosbeak", "Northern Cardinal", "Pyrrhuloxia", "Crimson-collared Grosbeak", "Blue Bunting", "Blue Grosbeak", "Lazuli Bunting", "Indigo Bunting", "Varied Bunting", "Painted Bunting", "Rose-bellied Bunting", "Audubon's Oriole", "Spot-breasted Oriole", "Altamira Oriole", "Streak-backed Oriole", "Baltimore Oriole", "Hooded Oriole", "Orchard Oriole", "Black-vented Oriole", "Scott's Oriole", "Yellow-headed Blackbird", "Unicolored Blackbird", "Red-winged Blackbird", "Tricolored Blackbird", "Tawny-shouldered Blackbird", "Eastern Meadowlark", "Western Meadowlark", "Great-tailed Grackle", "Boat-tailed Grackle", "Common Grackle", "Rusty Blackbird", "Brewer's Blackbird", "Shiny Cowbird", "Bronzed Cowbird", "Brown-headed Cowbird", "Bobolink", "Spruce Grouse", "Masked Duck", "Tundra Goose", "American Three-toed Woodpecker", "Cape Verde Barn Owl", "Oriental Scops-Owl", "Wilson's Phalarope", "Great Skua", "South Polar Skua", "Mew Gull", "Long-billed Murrelet", "Grey-lined Hawk", "Southern Caracara", "Crested Caracara", "Nazca Booby", "Great Egret", "Intermediate Egret", "Herald Petrel", "Short-tailed Albatross", "Black-footed Albatross", "Laysan Albatross", "Black-browed Albatross", "Shy Albatross", "Yellow-nosed Albatross", "Olive-sided Flycatcher", "Green Jay", "Bicknell's Thrush", "Ridgway's Titmouse", "Brown-chested Martin", "Nelson's Sharp-tailed Sparrow", "Spotted Towhee", "Bullock's Oriole", "Black-backed Oriole"]

let placenames_ = ["Abara", "Abar", "Acajutiba", "Adustina", "gua Fria", "Aiquara", "Alagoinhas", "Alcobaa", "Almadina", "Amargosa", "Amlia Rodrigues", "Amrica Dourada", "Anag", "Andara", "Andorinha", "Angical", "Anguera", "Antas", "Antnio Cardoso", "Antnio Gonalves", "Apor", "Apuarema", "Aras", "Aracatu", "Araci", "Aramari", "Arataca", "Aratupe", "Aurelino Leal", "Baianpolis", "Baixa Grande", "Banza", "Barra", "Barra da Estiva", "Barra do Choa", "Barra do Mendes", "Barra do Rocha", "Barreiras", "Barro Alto", "Barro Preto", "Barrocas", "Belmonte", "Belo Campo", "Biritinga", "Boa Nova", "Boa Vista do Tupim", "Bom Jesus da Lapa", "Bom Jesus da Serra", "Boninal", "Bonito", "Boquira", "Botupor", "Brejes", "Brejolndia", "Brotas de Macabas", "Brumado", "Buerarema", "Buritirama", "Caatiba", "Cabaceiras do Paraguau", "Cachoeira", "Cacul", "Cam", "Caetanos", "Caetit", "Cafarnaum", "Cairu", "Caldeiro Grande", "Camacan", "Camaari", "Camamu", "Campo Alegre de Lourdes", "Campo Formoso", "Canpolis", "Canarana", "Canavieiras", "Candeal", "Candeias", "Candiba", "Cndido Sales", "Cansano", "Canudos", "Capela do Alto Alegre", "Capim Grosso", "Carabas", "Caravelas", "Cardeal da Silva", "Carinhanha", "Casa Nova", "Castro Alves", "Catolndia", "Catu", "Caturama", "Central", "Chorroch", "Ccero Dantas", "Cip", "Coaraci", "Cocos", "Conceio da Feira", "Conceio do Almeida", "Conceio do Coit", "Conceio do Jacupe", "Conde", "Condeba", "Contendas do Sincor", "Corao de Maria", "Cordeiros", "Coribe", "Coronel Joo S", "Correntina", "Cotegipe", "Cravolndia", "Crispolis", "Cristpolis", "Cruz das Almas", "Cura", "Drio Meira", "Dias d'vila", "Dom Baslio", "Dom Macedo Costa", "Elsio Medrado", "Encruzilhada", "Entre Rios", "rico Cardoso", "Esplanada", "Euclides da Cunha", "Eunpolis", "Ftima", "Feira da Mata", "Feira de Santana", "Filadlfia", "Firmino Alves", "Floresta Azul", "Formosa do Rio Preto", "Gandu", "Gavio", "Gentio do Ouro", "Glria", "Gongogi", "Governador Mangabeira", "Guajeru", "Guanambi", "Guaratinga", "Helipolis", "Iau", "Ibiassuc", "Ibicara", "Ibicoara", "Ibicu", "Ibipeba", "Ibipitanga", "Ibiquera", "Ibirapitanga", "Ibirapu", "Ibirataia", "Ibitiara", "Ibitit", "Ibotirama", "Ichu", "Igapor", "Igrapina", "Igua", "Ilhus", "Inhambupe", "Ipecaet", "Ipia", "Ipir", "Ipupiara", "Irajuba", "Iramaia", "Iraquara", "Irar", "Irec", "Itabela", "Itaberaba", "Itabuna", "Itacar", "Itaet", "Itagi", "Itagib", "Itagimirim", "Itaguau da Bahia", "Itaju do Colnia", "Itajupe", "Itamaraju", "Itamari", "Itamb", "Itanagra", "Itanhm", "Itaparica", "Itap", "Itapebi", "Itapetinga", "Itapicuru", "Itapitanga", "Itaquara", "Itarantim", "Itatim", "Itiruu", "Itiba", "Itoror", "Ituau", "Ituber", "Iui", "Jaborandi", "Jacaraci", "Jacobina", "Jaguaquara", "Jaguarari", "Jaguaripe", "Jandara", "Jequi", "Jeremoabo", "Jiquiri", "Jitana", "Joo Dourado", "Juazeiro", "Jucuruu", "Jussara", "Jussari", "Jussiape", "Lafaiete Coutinho", "Lagoa Real", "Laje", "Lajedo", "Lajedinho", "Lajedo do Tabocal", "Lamaro", "Lapo", "Lauro de Freitas", "Lenis", "Licnio de Almeida", "Livramento de Nossa Senhora", "Luis Eduardo Magalhes", "Macajuba", "Macarani", "Macabas", "Macurur", "Madre de Deus", "Maetinga", "Maiquinique", "Mairi", "Malhada", "Malhada de Pedras", "Manoel Vitorino", "Mansido", "Maracs", "Maragogipe", "Mara", "Marcionlio Souza", "Mascote", "Mata de So Joo", "Matina", "Medeiros Neto", "Miguel Calmon", "Milagres", "Mirangaba", "Mirante", "Monte Santo", "Morpar", "Morro do Chapu", "Mortugaba", "Mucug", "Mucuri", "Mulungu do Morro", "Mundo Novo", "Muniz Ferreira", "Muqum de So Francisco", "Muritiba", "Mutupe", "Nazar", "Nilo Peanha", "Nordestina", "Nova Cana", "Nova Ftima", "Nova Ibi", "Nova Itarana", "Nova Redeno", "Nova Soure", "Nova Viosa", "Novo Horizonte", "Novo Triunfo", "Olindina", "Oliveira dos Brejinhos", "Ouriangas", "Ourolndia", "Palmas de Monte Alto", "Palmeiras", "Paramirim", "Paratinga", "Paripiranga", "Pau Brasil", "Paulo Afonso", "P de Serra", "Pedro", "Pedro Alexandre", "Piat", "Pilo Arcado", "Pinda", "Pindobau", "Pintadas", "Pira do Norte", "Pirip", "Piritiba", "Planaltino", "Planalto", "Poes", "Pojuca", "Ponto Novo", "Porto Seguro", "Potiragu", "Prado", "Presidente Dutra", "Presidente Jnio Quadros", "Presidente Tancredo Neves", "Queimadas", "Quijingue", "Quixabeira", "Rafael Jambeiro", "Remanso", "Retirolndia", "Riacho do Jacupe", "Riacho de Santana", "Ribeira do Amparo", "Ribeira do Pombal", "Ribeiro do Largo", "Rio de Contas", "Rio do Antnio", "Rio do Pires", "Rio Real", "Rodelas", "Ruy Barbosa", "Salinas da Margarida", "Salvador", "Santa Brbara", "Santa Brgida", "Santa Cruz Cabrlia", "Santa Cruz da Vitria", "Santa Ins", "Santa Luzia", "Santa Maria da Vitria", "Santa Rita de Cssia", "Santa Teresinha", "Santaluz", "Santana", "Santanpolis", "Santo Amaro", "Santo Antnio de Jesus", "Santo Estvo", "So Desidrio", "So Domingos", "So Felipe", "So Flix", "So Flix do Coribe", "So Francisco do Conde", "So Gabriel", "So Gonalo dos Campos", "So Jos da Vitria", "So Jos do Jacupe", "So Miguel das Matas", "So Sebastio do Pass", "Sapeau", "Stiro Dias", "Saubara", "Sade", "Seabra", "Sebastio Laranjeiras", "Senhor do Bonfim", "Sento S", "Serra do Ramalho", "Serra Dourada", "Serra Preta", "Serrinha", "Serrolndia", "Simes Filho", "Stio do Mato", "Stio do Quinto", "Sobradinho", "Souto Soares", "Tabocas do Brejo Velho", "Tanhau", "Tanque Novo", "Tanquinho", "Tapero", "Tapiramut", "Teixeira de Freitas", "Teodoro Sampaio", "Teofilndia", "Teolndia", "Tremedal", "Tucano", "Uau", "Ubara", "Ubaitaba", "Ubat", "Uiba", "Umburanas", "Una", "Urandi", "Uruuca", "Utinga", "Valena", "Valente", "Vrzea da Roa", "Vrzea do Poo", "Vrzea Nova", "Varzedo", "Vera Cruz", "Vereda", "Vitria da Conquista", "Wagner", "Wanderley", "Wenceslau Guimares", "Xique-Xique"];
</script>
</body>
</html>